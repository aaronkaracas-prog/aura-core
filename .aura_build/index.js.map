{
  "version": 3,
  "sources": ["../src/index.js"],
  "sourceRoot": ".\\.aura_build",
  "sourcesContent": ["// AURA_CORE__2026-01-21__AUTONOMY_STEP_17M__DYNAMIC_HEADER_PROBE__DEPLOYER_DIAG__KV_TOKEN_FALLBACK\n// Merge: Step 16C (full staging-first + rollback memory + verify modes) + bounded autonomy two-key model.\n// Autonomy auth: requires autonomy_enabled == \"true\" AND X-Aura-Autonomy matches (env.AURA_AUTONOMY_TOKEN OR KV autonomy_token).\n// Root admin invariant preserved: /admin/* remains gated unless route is explicitly allowlisted for autonomy.\n// UI untouched. Secrets never returned.\n\nasync function sha256Hex(text) {\n  const data = new TextEncoder().encode(text);\n  const digest = await crypto.subtle.digest(\"SHA-256\", data);\n  return Array.from(new Uint8Array(digest))\n    .map((b) => b.toString(16).padStart(2, \"0\"))\n    .join(\"\");\n}\n\nfunction json(status, obj, extraHeaders) {\n  return new Response(JSON.stringify(obj), {\n    status,\n    headers: {\n      \"Content-Type\": \"application/json\",\n      ...(extraHeaders || {})\n    }\n  });\n}\n\nfunction nowMs() {\n  return Date.now();\n}\n\nfunction safeHeaderValue(v) {\n  if (!v) return null;\n  const s = String(v);\n  return s.length > 200 ? s.slice(0, 200) + \"\u2026\" : s;\n}\n\nfunction safeBodySnippet(text) {\n  if (text == null) return null;\n  const s = String(text);\n  return s.length > 400 ? s.slice(0, 400) + \"\u2026\" : s;\n}\n\nasync function phraseMeta(phrase) {\n  if (!phrase) return { present: false, sha256: null, length: 0 };\n  const p = String(phrase);\n  return { present: true, sha256: await sha256Hex(p), length: p.length };\n}\n\nfunction phraseHeaderBundle(phrase) {\n  if (!phrase) return {};\n  const p = String(phrase);\n  // Try a small set of likely header names.\n  return {\n    \"X-Promotion-Phrase\": p,\n    \"X-Aura-Phrase\": p,\n    \"X-Promotion-Passphrase\": p,\n    \"X-Promotion-Phrase-Token\": p,\n    \"X-Promotion-Token\": p,\n    \"X-Phrase\": p\n  };\n}\n\nasync function fetchWithTimeout(url, ms) {\n  const controller = new AbortController();\n  const t = setTimeout(() => controller.abort(), ms);\n  try {\n    const resp = await fetch(url, { method: \"GET\", signal: controller.signal });\n    return resp;\n  } finally {\n    clearTimeout(t);\n  }\n}\n\nfunction buildHealthObject() {\n  return {\n    ok: true,\n    service: \"aura-core\",\n    autonomy: true,\n    version:\n      \"AURA_CORE__2026-01-21__AUTONOMY_STEP_17M__DYNAMIC_HEADER_PROBE__DEPLOYER_DIAG__KV_TOKEN_FALLBACK\"\n  };\n}\n\nfunction safeEq(a, b) {\n  if (!a || !b) return false;\n  const sa = String(a);\n  const sb = String(b);\n  if (sa.length !== sb.length) return false;\n  let out = 0;\n  for (let i = 0; i < sa.length; i++) out |= sa.charCodeAt(i) ^ sb.charCodeAt(i);\n  return out === 0;\n}\n\nfunction extractPhrase(payload) {\n  if (!payload) return null;\n  return (\n    payload.promotion_phrase ||\n    payload.promotionPhrase ||\n    payload.phrase ||\n    payload.value ||\n    null\n  );\n}\n\n\nexport default {\n  async fetch(request, env, ctx) {\n    try {\n      const url = new URL(request.url);\n\n      const admin =\n        request.headers.get(\"X-Core-Pass\") ||\n        request.headers.get(\"X-Aura-Pass\") ||\n        request.headers.get(\"X-Admin-Token\");\n\n      const autonomyHeader = request.headers.get(\"X-Aura-Autonomy\");\n\n      const isAdmin = admin && admin === env.AURA_ADMIN_TOKEN;\n\n      const KV = (env && env.AURA_KV) ? env.AURA_KV : null;\n\n      // Autonomy gate + token (env OR KV)\n      let autonomyEnabled = false;\n      let kvAutonomyToken = null;\n      if (KV) {\n        autonomyEnabled = (await KV.get(\"autonomy_enabled\")) === \"true\";\n        kvAutonomyToken = await KV.get(\"autonomy_token\");\n      }\n      const envAutonomyToken = (env && env.AURA_AUTONOMY_TOKEN) ? env.AURA_AUTONOMY_TOKEN : null;\n\n      const isAutonomy =\n        autonomyEnabled &&\n        !!autonomyHeader &&\n        (\n          (envAutonomyToken && safeEq(autonomyHeader, envAutonomyToken)) ||\n          (kvAutonomyToken && safeEq(autonomyHeader, kvAutonomyToken))\n        );\n\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n      // ROOT OPERATOR INVARIANT: /admin always gated (unless explicit autonomy allowlist)\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n      if (url.pathname.startsWith(\"/admin\")) {\n        if (!isAdmin) {\n          const allowedAutonomy =\n            isAutonomy &&\n            (\n              // bounded autonomy: deploy pipeline only\n              (url.pathname === \"/admin/aura/deploy/request\" && request.method === \"POST\") ||\n              (url.pathname === \"/admin/aura/deploy/verify\" && request.method === \"POST\") ||\n              (url.pathname === \"/admin/aura/deploy/promote\" && request.method === \"POST\")\n            );\n\n          if (!allowedAutonomy) {\n            return json(401, { ok: false, error: \"unauthorized\" });\n          }\n        }\n      }\n\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n      // DEPLOYER PROBE (ROOT ONLY) \u2014 diagnostics for phrase/header expectations\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n      if (url.pathname === \"/admin/deployer/probe\" && request.method === \"POST\") {\n        if (!isAdmin) {\n          return json(403, { ok: false, error: \"root_only\" });\n        }\n\n        const body = await request.text();\n        let payload;\n        try {\n          payload = JSON.parse(body || \"{}\");\n        } catch {\n          return json(400, { ok: false, error: \"bad_json\" });\n        }\n\n        const phrase = extractPhrase(payload) || null;\n        const meta = await phraseMeta(phrase);\n\n        const extraPhraseHeaders = Array.isArray(payload.extra_phrase_headers)\n          ? payload.extra_phrase_headers.map((h) => String(h)).filter((h) => h && h.length < 100)\n          : [];\n\n        const queryPhrase = payload.query_phrase === true;\n\n        const probeHeaders = {\n          \"Content-Type\": \"application/json\",\n          \"X-Deploy-Key\": env.DEPLOY_SECRET,\n          ...(phrase ? phraseHeaderBundle(phrase) : {})\n        };\n\n        for (const h of extraPhraseHeaders) {\n          // Do not allow overriding core headers\n          if (h.toLowerCase() === \"content-type\" || h.toLowerCase() === \"x-deploy-key\") continue;\n          if (phrase) probeHeaders[h] = String(phrase);\n        }\n\n        const baseUrl = \"https://deployer/deploy\";\n        const urlOut = queryPhrase && phrase ? (baseUrl + \"?promotion_phrase=\" + encodeURIComponent(String(phrase))) : baseUrl;\n\n        // Forward payload as-is (do not mutate), but attach phrase headers if present.\n        const resp = await env.AURA_DEPLOYER.fetch(urlOut, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"X-Deploy-Key\": env.DEPLOY_SECRET,\n            ...(phrase ? phraseHeaderBundle(phrase) : {})\n          },\n          body\n        });\n\n        const text = await resp.text();\n\n        return json(200, {\n          ok: true,\n          action: \"deployer_probe\",\n          phrase: meta,\n          headers_sent: Object.keys(probeHeaders).filter((k) => ![\"content-type\",\"x-deploy-key\"].includes(String(k).toLowerCase())),\n          query_phrase: queryPhrase,\n          deployer_http_status: resp.status,\n          deployer_ok: resp.ok,\n          deployer_body_snippet: safeBodySnippet(text)\n        });\n      }\n\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n      // FOUNDRY DEPLOY PROXY (ROOT ONLY)\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n      if (url.pathname === \"/admin/foundry/deploy\" && request.method === \"POST\") {\n        if (!isAdmin) {\n          return json(403, { ok: false, error: \"root_only\" });\n        }\n\n        const body = await request.text();\n\n        let foundryPhrase = null;\n        try {\n          const p = JSON.parse(body);\n          foundryPhrase = extractPhrase(p);\n        } catch {\n          foundryPhrase = null;\n        }\n\n        const resp = await env.AURA_DEPLOYER.fetch(\"https://deployer/deploy\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"X-Deploy-Key\": env.DEPLOY_SECRET,\n            ...(foundryPhrase ? phraseHeaderBundle(foundryPhrase) : {})\n          },\n          body\n        });\n\n        return new Response(await resp.text(), { status: resp.status });\n      }\n\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n      // AURA-INITIATED SELF DEPLOY (ROOT ONLY) \u2014 unchanged from Step 16C\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n      if (url.pathname === \"/admin/aura/self_deploy\" && request.method === \"POST\") {\n        if (!isAdmin) {\n          return json(403, { ok: false, error: \"root_only\" });\n        }\n\n        const body = await request.text();\n\n        if (!body || body.length < 10) {\n          return json(400, { ok: false, error: \"invalid_deploy_payload\" });\n        }\n\n        const resp = await env.AURA_DEPLOYER.fetch(\"https://deployer/deploy\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"X-Deploy-Key\": env.DEPLOY_SECRET,\n            \"X-Aura-Action\": \"self-deploy\"\n          },\n          body\n        });\n\n        return json(resp.status, {\n          ok: resp.ok,\n          status: resp.status,\n          action: \"aura_self_deploy\",\n          timestamp: nowMs()\n        });\n      }\n\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n      // AUTONOMY + STAGING-FIRST + ROLLBACK MEMORY + SELF VERIFY (Step 16C full)\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n\n      const KV_KEYS = {\n        // phrase ticket (root-minted)\n        phrase: \"deploy:promotion_phrase\",\n        phraseExpiresAt: \"deploy:promotion_phrase_expires_at\",\n        phraseSingleUse: \"deploy:promotion_phrase_single_use\",\n        lastStagingHash: \"deploy:last_staging_hash\",\n        lastStagingAt: \"deploy:last_staging_at\",\n        lastStagingVerifiedAt: \"deploy:last_staging_verified_at\",\n        lastStagingVerifyUrl: \"deploy:last_staging_verify_url\",\n        lastStagingVerifyMode: \"deploy:last_staging_verify_mode\",\n        lastProdHash: \"deploy:last_prod_hash\",\n        lastProdAt: \"deploy:last_prod_at\",\n        lastKnownGoodProdHash: \"deploy:last_known_good_prod_hash\",\n        lastKnownGoodProdAt: \"deploy:last_known_good_prod_at\"\n      };\n\n      async function readStatus() {\n        const [\n          lastStagingHash,\n          lastStagingAt,\n          lastStagingVerifiedAt,\n          lastStagingVerifyUrl,\n          lastStagingVerifyMode,\n          lastProdHash,\n          lastProdAt,\n          lastKnownGoodProdHash,\n          lastKnownGoodProdAt\n        ] = await Promise.all([\n          KV.get(KV_KEYS.lastStagingHash),\n          KV.get(KV_KEYS.lastStagingAt),\n          KV.get(KV_KEYS.lastStagingVerifiedAt),\n          KV.get(KV_KEYS.lastStagingVerifyUrl),\n          KV.get(KV_KEYS.lastStagingVerifyMode),\n          KV.get(KV_KEYS.lastProdHash),\n          KV.get(KV_KEYS.lastProdAt),\n          KV.get(KV_KEYS.lastKnownGoodProdHash),\n          KV.get(KV_KEYS.lastKnownGoodProdAt)\n        ]);\n\n        return {\n          last_staging_hash: lastStagingHash || null,\n          last_staging_at: lastStagingAt ? Number(lastStagingAt) : null,\n          last_staging_verified_at: lastStagingVerifiedAt ? Number(lastStagingVerifiedAt) : null,\n          last_staging_verify_url: lastStagingVerifyUrl || null,\n          last_staging_verify_mode: lastStagingVerifyMode || null,\n          last_prod_hash: lastProdHash || null,\n          last_prod_at: lastProdAt ? Number(lastProdAt) : null,\n          last_known_good_prod_hash: lastKnownGoodProdHash || null,\n          last_known_good_prod_at: lastKnownGoodProdAt ? Number(lastKnownGoodProdAt) : null\n        };\n      }\n\n      async function setPhraseTicket(phrase, ttlMs, singleUse) {\n        const expiresAt = nowMs() + (ttlMs || 10 * 60 * 1000);\n        await Promise.all([\n          KV.put(KV_KEYS.phrase, String(phrase)),\n          KV.put(KV_KEYS.phraseExpiresAt, String(expiresAt)),\n          KV.put(KV_KEYS.phraseSingleUse, singleUse ? \"true\" : \"false\")\n        ]);\n        return { phrase_set: true, expires_at: expiresAt, single_use: !!singleUse };\n      }\n\n      async function clearPhraseTicket() {\n        await Promise.all([\n          KV.delete(KV_KEYS.phrase),\n          KV.delete(KV_KEYS.phraseExpiresAt),\n          KV.delete(KV_KEYS.phraseSingleUse)\n        ]);\n        return { phrase_cleared: true };\n      }\n\n      async function getPhraseTicket() {\n        const [phrase, expiresAt, singleUse] = await Promise.all([\n          KV.get(KV_KEYS.phrase),\n          KV.get(KV_KEYS.phraseExpiresAt),\n          KV.get(KV_KEYS.phraseSingleUse)\n        ]);\n        const exp = expiresAt ? Number(expiresAt) : null;\n        const isExpired = exp != null && nowMs() > exp;\n        if (!phrase || !exp || isExpired) {\n          return { ok: false, error: \"no_valid_phrase_ticket\" };\n        }\n        return { ok: true, phrase: String(phrase), expires_at: exp, single_use: singleUse === \"true\" };\n      }\n\n      async function consumePhraseIfNeeded(ticket) {\n        if (ticket && ticket.single_use) {\n          await clearPhraseTicket();\n        }\n      }\n\n\n      // GET status (ROOT ONLY) \u2014 keeps root surface minimal.\n      if (url.pathname === \"/admin/aura/deploy/status\" && request.method === \"GET\") {\n        if (!isAdmin) {\n          return json(403, { ok: false, error: \"root_only\" });\n        }\n        // Deployer safety brake: requires promotion_phrase.\n        if (!isAdmin) {\n          if (!payload.promotion_phrase) {\n            const ticket = await getPhraseTicket();\n            if (!ticket.ok) {\n              return json(409, { ok: false, error: \"promotion_phrase_required\", message: \"Root must set a phrase ticket via /admin/aura/deploy/phrase before autonomy can promote.\" });\n            }\n            payload.promotion_phrase = ticket.phrase;\n            payload.__kv_phrase_ticket = ticket;\n          }\n        }\n\n        const status = await readStatus();\n        return json(200, { ok: true, status });\n      }\n\n      if (url.pathname === \"/admin/aura/deploy/phrase\" && request.method === \"POST\") {\n        if (!isAdmin) {\n          return json(403, { ok: false, error: \"root_only\" });\n        }\n        const body = await request.text();\n        let payload;\n        try {\n          payload = JSON.parse(body || \"{}\");\n        } catch {\n          return json(400, { ok: false, error: \"bad_json\" });\n        }\n        const phrase = payload.promotion_phrase || payload.phrase || payload.value;\n        if (!phrase || String(phrase).length < 3) {\n          return json(400, { ok: false, error: \"missing_promotion_phrase\" });\n        }\n        const ttlMs = payload.ttl_ms ? Number(payload.ttl_ms) : 10 * 60 * 1000;\n        const singleUse = payload.single_use !== false; // default true\n        const result = await setPhraseTicket(String(phrase), ttlMs, singleUse);\n        return json(200, { ok: true, action: \"phrase_ticket_set\", ...result });\n      }\n\n      if (url.pathname === \"/admin/aura/deploy/phrase\" && request.method === \"DELETE\") {\n        if (!isAdmin) {\n          return json(403, { ok: false, error: \"root_only\" });\n        }\n        const result = await clearPhraseTicket();\n        return json(200, { ok: true, action: \"phrase_ticket_cleared\", ...result });\n      }\n\n      // POST request deploy (staging-first enforced)\n      if (url.pathname === \"/admin/aura/deploy/request\" && request.method === \"POST\") {\n        const body = await request.text();\n        if (!body || body.length < 10) {\n          return json(400, { ok: false, error: \"invalid_deploy_payload\" });\n        }\n\n        let payload;\n        try {\n          payload = JSON.parse(body);\n        } catch {\n          return json(400, { ok: false, error: \"bad_json\" });\n        }\n\n\n\n        // Deployer safety brake: requires promotion_phrase.\n        // Root can provide it directly in payload.\n        // Autonomy may only use a root-minted KV phrase ticket (single-use, TTL).\n        if (!isAdmin) {\n          if (!payload.promotion_phrase) {\n            const ticket = await getPhraseTicket();\n            if (!ticket.ok) {\n              return json(409, { ok: false, error: \"promotion_phrase_required\", message: \"Root must set a phrase ticket via /admin/aura/deploy/phrase before autonomy can deploy.\" });\n            }\n            payload.promotion_phrase = ticket.phrase;\n            // If single-use, we will consume after successful deployer response.\n            payload.__kv_phrase_ticket = ticket;\n          }\n        }\n\n        const target =\n          (payload && (payload.target || payload.env || payload.environment)) ||\n          request.headers.get(\"X-Aura-Deploy-Target\") ||\n          \"staging\";\n\n        // Autonomy hard-rule: staging only.\n        if (!isAdmin) {\n          const t = String(target).toLowerCase();\n          if (t !== \"staging\") {\n            return json(403, { ok: false, error: \"autonomy_staging_only\" });\n          }\n        }\n\n        if (String(target).toLowerCase() === \"prod\" || String(target).toLowerCase() === \"production\") {\n          // Deployer safety brake: requires promotion_phrase.\n        if (!isAdmin) {\n          if (!payload.promotion_phrase) {\n            const ticket = await getPhraseTicket();\n            if (!ticket.ok) {\n              return json(409, { ok: false, error: \"promotion_phrase_required\", message: \"Root must set a phrase ticket via /admin/aura/deploy/phrase before autonomy can promote.\" });\n            }\n            payload.promotion_phrase = ticket.phrase;\n            payload.__kv_phrase_ticket = ticket;\n          }\n        }\n\n        const status = await readStatus();\n          if (!status.last_staging_hash || !status.last_staging_verified_at) {\n            return json(409, {\n              ok: false,\n              error: \"staging_required\",\n              message: \"Staging deploy + verify is required before prod promotion.\"\n            });\n          }\n\n          const promotingHash =\n            payload.promoting_hash ||\n            payload.staging_hash ||\n            request.headers.get(\"X-Aura-Promoting-Hash\");\n\n          if (!promotingHash || promotingHash !== status.last_staging_hash) {\n            return json(409, {\n              ok: false,\n              error: \"promoting_hash_mismatch\",\n              required: status.last_staging_hash\n            });\n          }\n        }\n\n        const bodyToSend = JSON.stringify(payload);\n        const bodyHash = await sha256Hex(bodyToSend);\n\n        if (String(target).toLowerCase() === \"staging\") {\n          await Promise.all([\n            KV.put(KV_KEYS.lastStagingHash, bodyHash),\n            KV.put(KV_KEYS.lastStagingAt, String(nowMs())),\n            KV.put(KV_KEYS.lastStagingVerifiedAt, \"\"),\n            KV.put(KV_KEYS.lastStagingVerifyUrl, \"\"),\n            KV.put(KV_KEYS.lastStagingVerifyMode, \"\")\n          ]);\n        }\n\n        const resp = await env.AURA_DEPLOYER.fetch(\"https://deployer/deploy\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"X-Deploy-Key\": env.DEPLOY_SECRET,\n            \"X-Aura-Action\": isAdmin ? \"deploy-request-root\" : \"deploy-request-autonomy\",\n            ...(payload && payload.promotion_phrase ? phraseHeaderBundle(payload.promotion_phrase) : {})\n          },\n          body: bodyToSend\n        });\n\n        const deployerText = await resp.text();\n        const deployerSnippet = safeBodySnippet(deployerText);\n\n        if (!isAdmin && payload.__kv_phrase_ticket && resp.ok) {\n          await consumePhraseIfNeeded(payload.__kv_phrase_ticket);\n        }\n\n        if (!isAdmin && payload.__kv_phrase_ticket && resp.ok) {\n          await consumePhraseIfNeeded(payload.__kv_phrase_ticket);\n        }\n\n        if (resp.ok && (String(target).toLowerCase() === \"prod\" || String(target).toLowerCase() === \"production\")) {\n          await Promise.all([\n            KV.put(KV_KEYS.lastProdHash, bodyHash),\n            KV.put(KV_KEYS.lastProdAt, String(nowMs())),\n            KV.put(KV_KEYS.lastKnownGoodProdHash, bodyHash),\n            KV.put(KV_KEYS.lastKnownGoodProdAt, String(nowMs()))\n          ]);\n        }\n\n        return json(resp.status, {\n          ok: resp.ok,\n          status: resp.status,\n          action: \"deploy_request\",\n          target: String(target),\n          hash: bodyHash,\n          timestamp: nowMs(),\n          auth: isAdmin ? \"root\" : \"autonomy\",\n          deployer_http_status: resp.status,\n          deployer_body_snippet: deployerSnippet\n        });\n      }\n\n      // POST verify staging (supports local verify)\n      if (url.pathname === \"/admin/aura/deploy/verify\" && request.method === \"POST\") {\n        const body = await request.text();\n\n        let payload = {};\n        if (body && body.trim().length) {\n          try {\n            payload = JSON.parse(body);\n          } catch {\n            return json(400, { ok: false, error: \"bad_json\" });\n          }\n        }\n\n        // Deployer safety brake: requires promotion_phrase.\n        if (!isAdmin) {\n          if (!payload.promotion_phrase) {\n            const ticket = await getPhraseTicket();\n            if (!ticket.ok) {\n              return json(409, { ok: false, error: \"promotion_phrase_required\", message: \"Root must set a phrase ticket via /admin/aura/deploy/phrase before autonomy can promote.\" });\n            }\n            payload.promotion_phrase = ticket.phrase;\n            payload.__kv_phrase_ticket = ticket;\n          }\n        }\n\n        const status = await readStatus();\n        if (!status.last_staging_hash) {\n          return json(409, { ok: false, error: \"no_staging_deploy_to_verify\" });\n        }\n\n        // mode: \"local\" or \"fetch\" (default fetch with fallback to local)\n        const mode =\n          (payload && payload.mode) ||\n          request.headers.get(\"X-Aura-Verify-Mode\") ||\n          \"fetch_fallback_local\";\n\n        const healthUrl =\n          payload.health_url ||\n          payload.url ||\n          request.headers.get(\"X-Aura-Health-Url\") ||\n          null;\n\n        // Autonomy hard-rule: local verify only.\n        if (!isAdmin) {\n          if (String(mode).toLowerCase() !== \"local\") {\n            return json(403, { ok: false, error: \"autonomy_local_verify_only\" });\n          }\n        }\n\n        // LOCAL VERIFY\n        if (String(mode).toLowerCase() === \"local\") {\n          const healthJson = buildHealthObject();\n          await Promise.all([\n            KV.put(KV_KEYS.lastStagingVerifiedAt, String(nowMs())),\n            KV.put(KV_KEYS.lastStagingVerifyUrl, healthUrl ? String(healthUrl) : \"local\"),\n            KV.put(KV_KEYS.lastStagingVerifyMode, \"local\")\n          ]);\n\n          return json(200, {\n            ok: true,\n            action: \"staging_verified\",\n            staging_hash: status.last_staging_hash,\n            verified_at: nowMs(),\n            verify_mode: \"local\",\n            health: healthJson,\n            auth: isAdmin ? \"root\" : \"autonomy\"\n          });\n        }\n\n        // FETCH VERIFY (with fallback to local on failures) \u2014 root only reachable due to autonomy rule above.\n        if (!healthUrl) {\n          return json(400, {\n            ok: false,\n            error: \"missing_health_url\",\n            message: \"Provide health_url or set mode=local.\"\n          });\n        }\n\n        let resp;\n        let txt;\n        try {\n          resp = await fetchWithTimeout(healthUrl, 8000);\n          txt = await resp.text();\n        } catch (e) {\n          if (String(mode).toLowerCase() === \"fetch_fallback_local\") {\n            const healthJson = buildHealthObject();\n            await Promise.all([\n              KV.put(KV_KEYS.lastStagingVerifiedAt, String(nowMs())),\n              KV.put(KV_KEYS.lastStagingVerifyUrl, String(healthUrl)),\n              KV.put(KV_KEYS.lastStagingVerifyMode, \"fallback_local_after_fetch_error\")\n            ]);\n            return json(200, {\n              ok: true,\n              action: \"staging_verified\",\n              staging_hash: status.last_staging_hash,\n              verified_at: nowMs(),\n              verify_mode: \"fallback_local_after_fetch_error\",\n              fetch_error: {\n                name: e && e.name ? String(e.name) : null,\n                message: e && e.message ? String(e.message) : null\n              },\n              health: healthJson,\n              auth: \"root\"\n            });\n          }\n\n          return json(502, {\n            ok: false,\n            error: \"health_fetch_error\",\n            name: e && e.name ? String(e.name) : null,\n            message: e && e.message ? String(e.message) : null,\n            health_url: String(healthUrl)\n          });\n        }\n\n        const contentType = safeHeaderValue(resp.headers.get(\"content-type\"));\n\n        let healthJson;\n        try {\n          healthJson = JSON.parse(txt);\n        } catch {\n          if (String(mode).toLowerCase() === \"fetch_fallback_local\") {\n            const localHealth = buildHealthObject();\n            await Promise.all([\n              KV.put(KV_KEYS.lastStagingVerifiedAt, String(nowMs())),\n              KV.put(KV_KEYS.lastStagingVerifyUrl, String(healthUrl)),\n              KV.put(KV_KEYS.lastStagingVerifyMode, \"fallback_local_after_not_json\")\n            ]);\n            return json(200, {\n              ok: true,\n              action: \"staging_verified\",\n              staging_hash: status.last_staging_hash,\n              verified_at: nowMs(),\n              verify_mode: \"fallback_local_after_not_json\",\n              fetch_result: {\n                http_status: resp.status,\n                content_type: contentType,\n                body_snippet: safeBodySnippet(txt)\n              },\n              health: localHealth,\n              auth: \"root\"\n            });\n          }\n\n          return json(502, {\n            ok: false,\n            error: \"health_not_json\",\n            health_url: String(healthUrl),\n            http_status: resp.status,\n            content_type: contentType,\n            body_snippet: safeBodySnippet(txt)\n          });\n        }\n\n        if (!healthJson || healthJson.ok !== true) {\n          return json(409, {\n            ok: false,\n            error: \"health_not_ok\",\n            health_url: String(healthUrl),\n            http_status: resp.status,\n            content_type: contentType,\n            health: healthJson || null\n          });\n        }\n\n        await Promise.all([\n          KV.put(KV_KEYS.lastStagingVerifiedAt, String(nowMs())),\n          KV.put(KV_KEYS.lastStagingVerifyUrl, String(healthUrl)),\n          KV.put(KV_KEYS.lastStagingVerifyMode, \"fetch_ok\")\n        ]);\n\n        return json(200, {\n          ok: true,\n          action: \"staging_verified\",\n          staging_hash: status.last_staging_hash,\n          verified_at: nowMs(),\n          verify_mode: \"fetch_ok\",\n          health_url: String(healthUrl),\n          http_status: resp.status,\n          content_type: contentType,\n          health: healthJson,\n          auth: \"root\"\n        });\n      }\n\n      // POST promote to prod (strict)\n      if (url.pathname === \"/admin/aura/deploy/promote\" && request.method === \"POST\") {\n        const body = await request.text();\n        if (!body || body.length < 10) {\n          return json(400, { ok: false, error: \"invalid_deploy_payload\" });\n        }\n\n        let payload;\n        try {\n          payload = JSON.parse(body);\n        } catch {\n          return json(400, { ok: false, error: \"bad_json\" });\n        }\n\n        // Deployer safety brake: requires promotion_phrase.\n        if (!isAdmin) {\n          if (!payload.promotion_phrase) {\n            const ticket = await getPhraseTicket();\n            if (!ticket.ok) {\n              return json(409, { ok: false, error: \"promotion_phrase_required\", message: \"Root must set a phrase ticket via /admin/aura/deploy/phrase before autonomy can promote.\" });\n            }\n            payload.promotion_phrase = ticket.phrase;\n            payload.__kv_phrase_ticket = ticket;\n          }\n        }\n\n        const status = await readStatus();\n        if (!status.last_staging_hash || !status.last_staging_verified_at) {\n          return json(409, { ok: false, error: \"staging_required\" });\n        }\n\n        const promotingHash =\n          payload.promoting_hash ||\n          payload.staging_hash ||\n          request.headers.get(\"X-Aura-Promoting-Hash\");\n\n        if (!promotingHash || promotingHash !== status.last_staging_hash) {\n          return json(409, { ok: false, error: \"promoting_hash_mismatch\", required: status.last_staging_hash });\n        }\n\n        // Autonomy hard-rule: cannot bypass hash check (already enforced) and cannot \"request prod\" elsewhere.\n        const bodyToSend = JSON.stringify(payload);\n        const bodyHash = await sha256Hex(bodyToSend);\n\n        const resp = await env.AURA_DEPLOYER.fetch(\"https://deployer/deploy\", {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"X-Deploy-Key\": env.DEPLOY_SECRET,\n            \"X-Aura-Action\": isAdmin ? \"promote-to-prod-root\" : \"promote-to-prod-autonomy\",\n            ...(payload && payload.promotion_phrase ? phraseHeaderBundle(payload.promotion_phrase) : {})\n          },\n          body: bodyToSend\n        });\n\n        const deployerText = await resp.text();\n        const deployerSnippet = safeBodySnippet(deployerText);\n\n        if (!isAdmin && payload.__kv_phrase_ticket && resp.ok) {\n          await consumePhraseIfNeeded(payload.__kv_phrase_ticket);\n        }\n\n        if (resp.ok) {\n          await Promise.all([\n            KV.put(KV_KEYS.lastProdHash, bodyHash),\n            KV.put(KV_KEYS.lastProdAt, String(nowMs())),\n            KV.put(KV_KEYS.lastKnownGoodProdHash, bodyHash),\n            KV.put(KV_KEYS.lastKnownGoodProdAt, String(nowMs()))\n          ]);\n        }\n\n        return json(resp.status, {\n          ok: resp.ok,\n          status: resp.status,\n          action: \"promote_to_prod\",\n          promoting_hash: promotingHash,\n          prod_hash: bodyHash,\n          timestamp: nowMs(),\n          auth: isAdmin ? \"root\" : \"autonomy\",\n          deployer_http_status: resp.status,\n          deployer_body_snippet: deployerSnippet\n        });\n      }\n\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n      // HEALTH\n      // \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\n      if (url.pathname === \"/health\") {\n        return json(200, buildHealthObject());\n      }\n\n      return new Response(\"ok\");\n    } catch (err) {\n      // Safe error detail for root on /admin paths only (never includes secrets)\n      try {\n        const reqUrl = new URL(request.url);\n        const isAdminPath = reqUrl.pathname.startsWith(\"/admin\");\n        const adminHeader =\n          request.headers.get(\"X-Core-Pass\") ||\n          request.headers.get(\"X-Aura-Pass\") ||\n          request.headers.get(\"X-Admin-Token\");\n\n        const isRoot = adminHeader && (env && env.AURA_ADMIN_TOKEN) && adminHeader === env.AURA_ADMIN_TOKEN;\n\n        if (isAdminPath && isRoot) {\n          const msg = err && err.message ? String(err.message) : \"unknown\";\n          const name = err && err.name ? String(err.name) : null;\n          const stack = err && err.stack ? String(err.stack) : null;\n          const stackSnippet = stack ? (stack.length > 800 ? stack.slice(0, 800) + \"\u2026\" : stack) : null;\n\n          return json(500, {\n            ok: false,\n            error: \"internal_error\",\n            name,\n            message: msg,\n            stack_snippet: stackSnippet\n          });\n        }\n      } catch {}\n      return new Response(\"internal error\", { status: 500 });\n    }\n  },\n\n  async scheduled(event, env, ctx) {\n    // No-op cron handler to satisfy Cloudflare scheduler.\n    // Intentionally empty.\n  }\n};\n"],
  "mappings": "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",
  "names": ["payload", "healthJson"]
}
