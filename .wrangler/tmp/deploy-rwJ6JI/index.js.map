{
  "version": 3,
  "sources": ["../../../src/index.js"],
  "sourceRoot": "C:\\Users\\Aaron Karacas\\aura-worker\\aura\\.wrangler\\tmp\\deploy-rwJ6JI",
  "sourcesContent": ["\uFEFF\n// === BUILD 15 PATCH: Deterministic PAUSE Acknowledgment ===\n// Injected to ensure PAUSE emits observable reply payload (no KV mutation).\nfunction __AURA_PAUSE_ACK__(cmd, host, replyArr) {\n  if (cmd === \"PAUSE\") {\n    replyArr.push({\n      cmd: \"PAUSE\",\n      payload: {\n        ok: true,\n        host: host,\n        paused: true,\n        at: new Date().toISOString(),\n        note: \"DETERMINISTIC_PAUSE_ACK_V1\"\n      }\n    });\n    return true;\n  }\n  return false;\n}\n// === END PATCH ===\n\n// AURA CORE  CANONICAL REBUILD (FULL FILE REPLACEMENT)\n// Rebuilt from last known-good 91K source (operator-provided backup)\n// Purpose: restore Aura Core command interpreter + registry grammar compatibility\n// Timestamp: 2026-02-08\n//\n// NOTE: This file is intended to be deployed as Wrangler main=\"src/index.js\"\n//\n// --- BEGIN ORIGINAL CONTENT ---\n\n// === UI_ROUTER_ENTRY ===\n// Router shim: classify natural language via INTENT before claim gate\nfunction routeInputBeforeClaimGate(ctx, input) {\n  if (!input || typeof input !== 'string') return { passthrough: true };\n  const isCommand = /^[A-Z_]+(\\s|$)/.test(input.trim());\n  if (isCommand) return { passthrough: true };\n  // Natural language  intent-first\n  return { intentFirst: true, text: input };\n}\n// === END UI_ROUTER_ENTRY ===\n\n// Canonical build/stamp (rendered in UI header and returned by SHOW_BUILD)\nconst BUILD = 'AURA_CORE__AUTONOMY_LAYERS__EVIDENCE_ALLOWLIST_HOSTCAPS_OPERATOR_INTENT_PAUSE__MEMORY_SUBSTRATE_V1__REGISTRY_AUDIT__15';\nconst STAMP = new Date().toISOString();\n\nconst AUTONOMY_TICK_VERSION = 'v2';\nconst AUTONOMY_TICK_HOSTS = ['auras.guide','malibu.city','frontdesk.network'];\nconst autonomyTickKeyForHost = (host) => `autonomy:tick:${AUTONOMY_TICK_VERSION}:${host}`;\n\nasync function naturalLanguageReply(input, env, activeHost) {\n  const text = (input || \"\").trim();\n  if (!text) return \"\";\n\n  const lower = text.toLowerCase();\n  const host = (activeHost && activeHost !== \"none\") ? activeHost : \"frontdesk.network\";\n\n  const intentGet = async (tag) => {\n    try {\n      return await env.AURA_KV.get(`intent:${host}:${tag}`);\n    } catch (_) {\n      return null;\n    }\n  };\n\n  const identity = (await intentGet(\"identity\")) || \"I am Aura  an autonomous, evidence-first control-plane for ARK Systems. Host-scoped. Persistence-backed. Neutral and non-coercive.\";\n  const capability = (await intentGet(\"capability\")) || \"I can inspect state, manage registries, run herd checks, plan deploys, and execute deployer actions when operator-authorized and evidence requirements are satisfied.\";\n  const gating = (await intentGet(\"gating\")) || \"I only gate verified claims and privileged actions. For planning and questions, I respond directly.\";\n\n  // If the user is trying to assert a gated claim, enforce evidence-first\n  const claimWords = [\"live\",\"deployed\",\"reachable\",\"works\",\"working\",\"up\",\"down\",\"online\",\"offline\",\"dns\",\"resolves\",\"propagated\",\"ssl\",\"https\",\"http\",\"525\",\"520\",\"530\",\"error\"];\n  const looksLikeClaim = claimWords.some(w => lower.includes(w));\n  if (looksLikeClaim) return \"NOT WIRED: VERIFIED_FETCH REQUIRED\";\n\n  if (lower === \"who are you\" || lower.startsWith(\"who are you\")) return identity;\n  if (lower === \"what can you do\" || lower.startsWith(\"what can you do\")) return capability + \"\\n\\n\" + gating;\n  if (lower.includes(\"what systems\") || lower.includes(\"what do you control\") || lower.includes(\"what can you control\")) {\n    return capability + \"\\n\\nActive host: \" + host + \"\\nEvidence-first, host-scoped.\";\n  }\n  if (lower.includes(\"help\") || lower === \"?\" || lower.includes(\"commands\")) {\n    return \"Type an allowed command (e.g., PING, SHOW_BUILD, SNAPSHOT_STATE).\\n\\nFor host work: HOST <domain>, then EVIDENCE_PRESENT or VERIFIED_FETCH_URL http://<domain>/\";\n  }\n  if (lower.includes(\"launch\") || lower.includes(\"deploy\") || lower.includes(\"website\") || lower.includes(\"site\")) {\n    return \"I can plan and execute deployments via DEPLOYER_CALL when operator-authorized.\\n\\nTell me: domain + desired outcome (landing page vs app) and whether we should VERIFIED_FETCH first for the target host.\";\n  }\n\n  // Default: answer politely, no gate.\n  return identity + \"\\n\\n\" + capability;\n}\n\n// ==== PATCH: Registry commands bypass claim-gate (2026-01-29) ====\nfunction __registryBypass(token) {\n  // Only allow read-only registry operations to bypass claim-gate.\n  // Any registry *write* (PUT / IMPORT) must be claim-gated by evidence.\n  return token === \"REGISTRY_GET\" ||\n         token === \"REGISTRY_LIST\" ||\n         token === \"REGISTRY_FILTER\";\n}\n// ================================================================\nconst KNOWN_COMMANDS = [\n  \"PING\",\n  \"SHOW_BUILD\",\n  \"SHOW_CLAIM_GATE\",\n  \"SHOW_ALLOWED_COMMANDS\",\n  \"RUN_SELF_TEST_EVIDENCE\",\n  \"VERIFIED_FETCH_URL\",\n  \"CLEAR_VERIFIED_FETCH\",\n  \"EVIDENCE_PRESENT\",\n  \"SNAPSHOT_STATE\",\n  \"HOST_CAPS_GET\",\n  \"HOST_CAPS_SET\",\n  \"DEPLOYER_CAPS\",\n  \"DEPLOYER_CALL\",\n  \"PAUSE\",\n  \"INTENT_ADD\",\n  \"INTENT_GET\",\n  \"INTENT_CLEAR\",\n  \"SHOW_MEMORY_SCHEMA\",\n  \"REGISTRY_PUT\",\n  \"REGISTRY_GET\",\n  \"REGISTRY_LIST\",\n  \"REGISTRY_FILTER\",\n  \"REGISTRY_IMPORT_ASSETS\",\n  \"REGISTRY_IMPORT_DOMAINS\",\n  \"PORTFOLIO_STATUS\",\n  \"AUDIT_GET\",\n  \"AUDIT_CLEAR\",\n  \"HERD_STATUS\",\n  \"HERD_SELF_TEST\",\n  \"HERD_SWEEP\",\n  \"AUTONOMY_STATUS\",\n  \"AUTONOMY_LAST_TICK\",\n        \"AUTONOMY_LAST_TICK_SET\",\n  \"AUTONOMY_CAPABILITIES\",\n  \"INTENT_SIMULATE\",\n  \"REGISTRY_AUDIT_TRAIL\",\n  \"AUTONOMY_BUDGET_GET\",\n  \"AUTONOMY_BUDGET_SET\",\n  \"FAILURE_MEMORY_GET\",\n  \"FAILURE_MEMORY_PUT\",\n  \"AUTONOMY_CHARTER_GET\",\n  \"AUTONOMY_CHARTER_SET\",\n];\n\nconst UI_HTML = `<!doctype html>\n<html lang=\"en\">\n<head>\n<meta charset=\"utf-8\" />\n<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" />\n<title>Aura Core \u00C3\u00A2\u00E2\u201A\u00AC\u00C2\u00A2 UI</title>\n<meta name=\"ui-version\" content=\"UI_PATCH__20260215_2A__CHATGPT_SHELL\">\n<style>\n  :root{\n    --bg:#070a12; --panel:#0e1424; --panel2:#0b1020;\n    --text:#e8ecff; --muted:#9aa5c7; --line:rgba(255,255,255,.10);\n    --accent:#6d5efc; --good:#48d597; --bad:#ff5c7a;\n    --bubbleMe: rgba(109,94,252,.18);\n    --bubbleAura: rgba(255,255,255,.05);\n  }\n  *{box-sizing:border-box}\n  html,body{height:100%}\n  body{\n    margin:0;\n    font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, \"Apple Color Emoji\",\"Segoe UI Emoji\";\n    background:\n      radial-gradient(1200px 600px at 30% 10%, rgba(109,94,252,.18), transparent 60%),\n      radial-gradient(900px 500px at 80% 30%, rgba(72,213,151,.10), transparent 55%),\n      var(--bg);\n    color:var(--text);\n    overflow:hidden;\n  }\n\n  .app{ height:100%; display:flex; }\n\n  .side{\n    width:280px;\n    border-right:1px solid var(--line);\n    background: linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));\n    display:flex;\n    flex-direction:column;\n    gap:12px;\n    padding:14px;\n  }\n  .sideTop{\n    display:flex; flex-direction:column; gap:6px;\n    padding-bottom:12px;\n    border-bottom:1px solid var(--line);\n  }\n  .brand{ font-weight:800; letter-spacing:.2px; font-size:16px; }\n  .sub{ color:var(--muted); font-size:12px; line-height:1.35; }\n  .projHdr{ color:var(--muted); font-size:12px; margin-top:2px; }\n  .projList{ display:flex; flex-direction:column; gap:8px; }\n  .projBtn{\n    display:flex; align-items:center; justify-content:space-between;\n    width:100%;\n    padding:10px 10px;\n    border-radius:12px;\n    border:1px solid var(--line);\n    background: rgba(0,0,0,.18);\n    color:var(--text);\n    cursor:pointer;\n    text-align:left;\n  }\n  .projBtn:hover{ border-color: rgba(109,94,252,.45); }\n  .projBtn.active{\n    border-color: rgba(109,94,252,.60);\n    background: rgba(109,94,252,.14);\n  }\n  .pill{\n    font-size:11px;\n    color:var(--muted);\n    border:1px solid var(--line);\n    padding:2px 8px;\n    border-radius:999px;\n  }\n\n  .main{ flex:1; display:flex; flex-direction:column; min-width:0; }\n\n  .topbar{\n    display:flex;\n    align-items:flex-start;\n    justify-content:space-between;\n    gap:16px;\n    padding:14px 16px;\n    border-bottom:1px solid var(--line);\n    background: linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.03));\n  }\n  .meta{\n    display:flex; flex-direction:column; align-items:flex-end; gap:4px;\n    font-size:12px; color:var(--muted);\n  }\n  .meta .row{ display:flex; gap:10px; align-items:center; }\n  .dot{ width:8px; height:8px; border-radius:50%; background:var(--good); box-shadow:0 0 0 3px rgba(72,213,151,.14); }\n  .statusErr .dot{ background:var(--bad); box-shadow:0 0 0 3px rgba(255,92,122,.14); }\n  .titleBlock{ display:flex; flex-direction:column; gap:2px; min-width:0; }\n  .titleBlock .h{ font-size:16px; font-weight:800; letter-spacing:.2px; }\n  .titleBlock .s{ font-size:12px; color:var(--muted); }\n\n  .chat{\n    flex:1;\n    min-height:0;\n    overflow:auto;\n    padding:18px 16px 12px 16px;\n    display:flex;\n    flex-direction:column;\n    gap:10px;\n  }\n  .bubble{\n    max-width: min(780px, 92%);\n    border:1px solid var(--line);\n    padding:10px 12px;\n    border-radius:16px;\n    line-height:1.35;\n    white-space:pre-wrap;\n    word-break:break-word;\n  }\n  .me{ align-self:flex-end; background: var(--bubbleMe); border-color: rgba(109,94,252,.40); }\n  .aura{ align-self:flex-start; background: var(--bubbleAura); }\n  .sys{ align-self:center; max-width:100%; background: transparent; border:none; color:var(--muted); padding:0; }\n  .err{ border-color: rgba(255,92,122,.45); background: rgba(255,92,122,.10); }\n\n  .composerWrap{\n    border-top:1px solid var(--line);\n    padding:12px;\n    background: rgba(0,0,0,.12);\n  }\n  .composer{\n    display:flex;\n    gap:10px;\n    align-items:flex-end;\n    max-width: 980px;\n    margin:0 auto;\n  }\n  .iconBtn{\n    height:44px;\n    width:44px;\n    border-radius:12px;\n    border:1px solid var(--line);\n    background: rgba(0,0,0,.22);\n    color: var(--text);\n    cursor:not-allowed;\n    opacity:.65;\n    display:flex; align-items:center; justify-content:center;\n    user-select:none;\n  }\n  textarea{\n    flex:1;\n    min-height:44px;\n    max-height:160px;\n    resize:vertical;\n    padding:10px 12px;\n    border-radius:12px;\n    outline:none;\n    border:1px solid var(--line);\n    background: rgba(0,0,0,.22);\n    color:var(--text);\n    font-size:14px;\n    line-height:1.35;\n  }\n  textarea::placeholder{ color: rgba(154,165,199,.70); }\n  .send{\n    height:44px;\n    padding:0 16px;\n    border-radius:12px;\n    cursor:pointer;\n    border:1px solid rgba(109,94,252,.55);\n    background: linear-gradient(180deg, rgba(109,94,252,.95), rgba(109,94,252,.78));\n    color:#fff;\n    font-weight:800;\n    letter-spacing:.2px;\n    box-shadow: 0 10px 20px rgba(109,94,252,.22);\n  }\n  .send:disabled{ opacity:.55; cursor:not-allowed; box-shadow:none; }\n  .hint{\n    max-width:980px;\n    margin:8px auto 0 auto;\n    color:var(--muted);\n    font-size:12px;\n    padding:0 2px;\n  }\n  code.k{ color:#c7cffc; }\n  .iconBtn{\n    cursor:pointer;\n    opacity:1;\n  }\n  .overlay{\n    position:fixed;\n    inset:0;\n    background: rgba(0,0,0,.55);\n    display:none;\n    align-items:center;\n    justify-content:center;\n    padding:24px;\n    z-index:50;\n  }\n  .overlay.show{ display:flex; }\n  .modal{\n    width: min(520px, 92vw);\n    border-radius:16px;\n    border:1px solid var(--line);\n    background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));\n    box-shadow: 0 30px 80px rgba(0,0,0,.55);\n    padding:16px;\n  }\n  .modal h3{ margin:0 0 8px 0; font-size:16px; }\n  .modal p{ margin:0 0 12px 0; color: var(--muted); line-height:1.4; font-size:13px; }\n  .modal .row{ display:flex; gap:10px; justify-content:flex-end; }\n  .btn{\n    height:38px;\n    padding:0 14px;\n    border-radius:12px;\n    border:1px solid var(--line);\n    background: rgba(0,0,0,.25);\n    color: var(--text);\n    cursor:pointer;\n    font-weight:700;\n  }\n  .btn.primary{\n    border-color: rgba(109,94,252,.55);\n    background: rgba(109,94,252,.20);\n  }\n</style>\n</head>\n<body>\n      <div class=\"hint\">\n        Tip: Prefer batch mode via PowerShell for multi-line ops. UI is for quick interactive checks.\n      </div>\n    </div>\n  </main>\n</div>\n\n<script>\n(function(){\n  const UI_VERSION = 'UI_PATCH__20260215_2A__CHATGPT_SHELL';\n\n  const chat = document.getElementById('chat');\n  const input = document.getElementById('input');\n  const sendBtn = document.getElementById('send');\n  const statusEl = document.getElementById('status');\n  const metaEl = document.getElementById('meta');\n  const buildEl = document.getElementById('build');\n  const stampEl = document.getElementById('stamp');\n  const localEl = document.getElementById('localtime');\n  const uiVerEl = document.getElementById('uiver');\n  const hostLabel = document.getElementById('hostLabel');\n  const titleEl = document.getElementById('title');\n  const projList = document.getElementById('projList');\n  const attachBtn = document.getElementById('attachBtn');\n  const micBtn = document.getElementById('micBtn');\n  const overlay = document.getElementById('overlay');\n  const overlayTitle = document.getElementById('overlayTitle');\n  const overlayMsg = document.getElementById('overlayMsg');\n  const overlayClose = document.getElementById('overlayClose');\n\n  function showOverlay(title, msg){\n    if(!overlay) return;\n    overlayTitle.textContent = title;\n    overlayMsg.textContent = msg;\n    overlay.classList.add('show');\n    overlay.setAttribute('aria-hidden','false');\n  }\n  function hideOverlay(){\n    if(!overlay) return;\n    overlay.classList.remove('show');\n    overlay.setAttribute('aria-hidden','true');\n  }\n\n  if(overlayClose) overlayClose.addEventListener('click', hideOverlay);\n  if(overlay) overlay.addEventListener('click', (e)=>{ if(e.target === overlay) hideOverlay(); });\n\n  if(attachBtn){\n    attachBtn.addEventListener('click', ()=>{\n      showOverlay('Attach', 'File upload is next. This is the UI shell step \u00C3\u00A2\u00E2\u201A\u00AC\u00E2\u20AC\u009D no upload logic yet.');\n    });\n  }\n  if(micBtn){\n    micBtn.addEventListener('click', async ()=>{\n      addBubble('sys', 'Mic click (handler live).', false);\n      if(micState === 'recording'){\n        micStop();\n      }else{\n        await micStart();\n      }\n    });\n  }\n\n  if(uiVerEl) uiVerEl.textContent = UI_VERSION;\n\n  let activeHost = 'auras.guide';\n  let activeName = 'Aura Core';\n\n  function nowLocal(){\n    try { return new Date().toLocaleString(); } catch(e){ return String(new Date()); }\n  }\n  localEl.textContent = nowLocal();\n  setInterval(()=>{ localEl.textContent = nowLocal(); }, 1000);\n\n  function setStatus(t, isError){\n    statusEl.textContent = t;\n    if(isError){\n      metaEl.classList.add('statusErr');\n      statusEl.style.color = 'var(--bad)';\n    }else{\n      metaEl.classList.remove('statusErr');\n      statusEl.style.color = 'var(--text)';\n    }\n  }\n\n  function addBubble(kind, text, isErr){\n    const d = document.createElement('div');\n    d.className = 'bubble ' + kind + (isErr ? ' err' : '');\n    d.textContent = text;\n    chat.appendChild(d);\n    chat.scrollTop = chat.scrollHeight;\n  }\n\n  async function postChat(raw){\n    const r = await fetch('/chat', {\n      method:'POST',\n      headers:{ 'content-type':'text/plain; charset=utf-8' },\n      body: raw\n    });\n    const txt = await r.text();\n    try { return JSON.parse(txt); } catch(e){ return { ok:false, reply: txt }; }\n  }\n\n  function normalizeInputForHost(userText){\n    const s = String(userText || '');\n    const trimmed = s.trim();\n    if(!trimmed) return '';\n    if (/^HOST\\s+/m.test(trimmed)) return trimmed;\n    return 'HOST ' + activeHost + '\\n' + trimmed;\n  }\n\n  async function pullBuild(){\n    try{\n      const res = await postChat('HOST ' + activeHost + '\\nSHOW_BUILD');\n      if(res && res.ok && res.reply && res.reply.build){\n        buildEl.textContent = res.reply.build;\n        stampEl.textContent = res.reply.stamp || '';\n      }else{\n        buildEl.textContent = 'unknown';\n        stampEl.textContent = '';\n      }\n    }catch(e){\n      buildEl.textContent = 'unknown';\n      stampEl.textContent = '';\n    }\n  }\n\n  async function runSend(){\n    const raw = input.value;\n    const trimmed = String(raw || '').trim();\n    if(!trimmed) return;\n\n    addBubble('me', trimmed, false);\n    input.value = '';\n\n    sendBtn.disabled = true;\n    setStatus('Working', false);\n\n    try{\n      const payload = normalizeInputForHost(trimmed);\n      const res = await postChat(payload);\n\n      if(res && typeof res === 'object'){\n        if(res.ok){\n          const reply = res.reply;\n          if(typeof reply === 'string'){\n            addBubble('aura', reply, false);\n          }else{\n            addBubble('aura', JSON.stringify(reply, null, 2), false);\n          }\n          setStatus('Ready', false);\n        }else{\n          addBubble('aura', (res.reply ? (typeof res.reply === 'string' ? res.reply : JSON.stringify(res.reply, null, 2)) : 'ERROR'), true);\n          setStatus('Error', true);\n        }\n      }else{\n        addBubble('aura', String(res), true);\n        setStatus('Error', true);\n      }\n    }catch(err){\n      addBubble('aura', 'UI ERROR: ' + (err && err.message ? err.message : String(err)), true);\n      setStatus('Error', true);\n    }finally{\n      sendBtn.disabled = false;\n      input.focus();\n    }\n  }\n\n  input.addEventListener('keydown', (e)=>{\n  const k = e.key;\n  const code = e.code;\n  const kc = e.keyCode;\n  const isEnter = (k === 'Enter') || (code === 'Enter') || (kc === 13);\n  if(isEnter && !e.shiftKey){\n    e.preventDefault();\n    e.stopPropagation();\n    runSend();\n  }\n});\n  sendBtn.addEventListener('click', runSend);\n\n  projList.addEventListener('click', (e)=>{\n    const btn = e.target.closest('.projBtn');\n    if(!btn) return;\n    const host = btn.getAttribute('data-host');\n    if(!host) return;\n\n    activeHost = host;\n    activeName =\n      (host === 'frontdesk.network') ? 'FrontDesk' :\n      (host === 'malibu.city') ? 'Malibu' :\n      'Aura Core';\n\n    [...projList.querySelectorAll('.projBtn')].forEach(b=>b.classList.remove('active'));\n    btn.classList.add('active');\n    hostLabel.textContent = activeHost;\n    titleEl.textContent = activeName;\n\n    addBubble('sys', 'HOST set to ' + activeHost + '. Pulling SHOW_BUILD...', false);\n    pullBuild();\n  });\n\n  addBubble('sys', 'Connected. Select a project or type a command (e.g., PING).', false);\n  pullBuild();\n})();\n</script>\n<div id=\"overlay\" class=\"overlay\" aria-hidden=\"true\">\n  <div class=\"modal\" role=\"dialog\" aria-modal=\"true\">\n    <h3 id=\"overlayTitle\">Overlay</h3>\n    <p id=\"overlayMsg\">Placeholder.</p>\n    <div class=\"row\">\n      <button id=\"overlayClose\" class=\"btn primary\">Close</button>\n    </div>\n  </div>\n</div>\n</body>\n</html>`;\n\n\nexport default {\n  async fetch(request, env) {\n    try {\n\n    const url = new URL(request.url);\n\n    // ----------------------------\n    // Operator auth (explicit only)  computed early (used by NL responses)\n    // ----------------------------\n    const operatorToken = env.AURA_OPERATOR_TOKEN || env.AURA_OP_TOKEN || env.OPERATOR_TOKEN || \"\";\n    const operatorHeader =\n      request.headers.get(\"x-operator-token\") ||\n      request.headers.get(\"X-Operator-Token\") ||\n      request.headers.get(\"x-aura-operator\") ||\n      request.headers.get(\"X-Aura-Operator\") ||\n      request.headers.get(\"x-aura-operator-token\") ||\n      request.headers.get(\"X-Aura-Operator-Token\") ||\n      (() => {\n        const a =\n          request.headers.get(\"authorization\") ||\n          request.headers.get(\"Authorization\") ||\n          \"\";\n        const m = a.match(/^Bearer\\s+(.+)$/i);\n        return m ? m[1] : \"\";\n      })() ||\n      \"\";\n    const isOperator = Boolean(operatorToken) && String(operatorHeader || \"\").trim() === String(operatorToken || \"\").trim();\n\n\n    // UI routing (root + /core + /ui)\n    if ((request.method === \"GET\" || request.method === \"HEAD\") && (url.pathname === \"/\" || url.pathname === \"/core\" || url.pathname === \"/ui\")) {\n      if (request.method === \"HEAD\") {\n        return new Response(null, {\n          status: 200,\n          headers: { \"content-type\": \"text/html; charset=utf-8\" }\n        });\n      }\n      return new Response(UI_HTML, { headers: { 'content-type': 'text/html; charset=utf-8' } });\n    }\n\n    // /chat is served; everything else 404\n    if (url.pathname !== \"/chat\") {\n      return new Response(\"Not Found\", { status: 404 });\n    }\n\n    const body = await request.text();\n    const bodyTrim = body.trim();\n\n    // Natural language (no-operator): answer without gating unless user asserts a gated claim.\n    const firstLine = (bodyTrim.split(/\\r?\\n/)[0] || '').trim();\n    const firstToken = (firstLine.split(/\\s+/)[0] || '').toUpperCase();\n    const isBatchLike =\n      firstToken &&\n      (firstToken === 'HOST' ||\n        firstToken === 'AURA-OP' ||\n        firstToken === 'AURA_OP' ||\n        KNOWN_COMMANDS.includes(firstToken));\n\n    const CLAIM_TRIGGER_WORDS = [\n      'live','deployed','launched','resolving','propagating','successful','verified','up','online','working',\n      'reachable','available','accessible'\n    ];\n    const hasClaimTrigger = (s) => {\n      const t = String(s || '').toLowerCase();\n      return CLAIM_TRIGGER_WORDS.some((w) => new RegExp('(^|\\\\W)' + w + '($|\\\\W)').test(t));\n    };\n\n    if (bodyTrim && !isBatchLike && !hasClaimTrigger(bodyTrim)) {\n      const msg =\n        `Aura (control-plane)  ${BUILD} @ ${STAMP}\\n` +\n        `Operator: ${isOperator ? 'YES' : 'NO'} (planning/help allowed; deploy/DNS actions are operator-only)\\n\\n` +\n        `What I can do right now (without VERIFIED_FETCH):\\n` +\n        `- Explain identity/capabilities and how to operate\\n` +\n        `- Show allowed commands, build, snapshot, memory schema\\n` +\n        `- Read registries (GET/LIST/FILTER) within host caps\\n\\n` +\n        `What requires VERIFIED_FETCH and/or operator token:\\n` +\n        `- Claims like live/deployed/reachable\\n` +\n        `- Writes (registry puts), deployer calls, DNS changes\\n\\n` +\n        `Next commands to run:\\n` +\n        `1) SHOW_ALLOWED_COMMANDS\\n` +\n        `2) SHOW_BUILD\\n` +\n        `3) SNAPSHOT_STATE\\n` +\n        `4) SHOW_MEMORY_SCHEMA\\n` +\n        `5) REGISTRY_LIST domains\\n\\n` +\n        `Tip: In UI, use ALL-CAPS commands. For multi-line ops, use PowerShell batch mode.`;\n      return Response.json({ ok: true, reply: msg });\n    }\n\n    // ----------------------------\n    // Build / policy markers\n    // ----------------------------\n    // ----------------------------\n    // Operator auth (explicit only)\n    // ----------------------------\n    // operatorToken/operatorHeader/isOperator are computed above (early)\n\n    // If a token is configured and a caller presents a token header that does not match,\n    // fail closed (prevents accidental success with a wrong token).\n    const operatorHeaderPresent = Boolean(operatorHeader);\n    const operatorMismatch = Boolean(operatorToken) && operatorHeaderPresent && operatorHeader !== operatorToken;\n    if (operatorMismatch) return Response.json({ ok: true, reply: \"UNAUTHORIZED\" });\n\n    // ----------------------------\n    // Commands (global allowlist)\n    // ----------------------------\n    const allowedCommands = [\n      \"PING\",\n      \"SHOW_BUILD\",\n      \"SHOW_CLAIM_GATE\",\n      \"SHOW_ALLOWED_COMMANDS\",\n      \"SELF_AUDIT_FULL\",\n      \"RUN_SELF_TEST_EVIDENCE\",\n      \"VERIFIED_FETCH_URL\",\n      \"CLEAR_VERIFIED_FETCH\",\n      \"EVIDENCE_PRESENT\",\n      \"SNAPSHOT_STATE\",\n      \"HOST_CAPS_GET\",\n      \"HOST_CAPS_SET\",\n      \"DEPLOYER_CAPS\",\n      \"DEPLOYER_CALL\",\n      \"PAUSE\",\n      \"INTENT_ADD\",\n      \"INTENT_GET\",\n      \"INTENT_CLEAR\",\n      \"SHOW_MEMORY_SCHEMA\",\n      \"REGISTRY_PUT\",\n      \"REGISTRY_GET\",\n      \"REGISTRY_LIST\",\n      \"REGISTRY_FILTER\",\n      \"REGISTRY_IMPORT_ASSETS\",\n      \"REGISTRY_IMPORT_DOMAINS\",\n      \"PORTFOLIO_STATUS\",\n      \"AUDIT_GET\",\n      \"AUDIT_CLEAR\",\n      \"HERD_STATUS\",\n      \"HERD_SELF_TEST\",\n      \"HERD_SWEEP\",\n  \"AUTONOMY_STATUS\",\n  \"AUTONOMY_LAST_TICK\",\n        \"AUTONOMY_LAST_TICK_SET\",\n  \"AUTONOMY_CAPABILITIES\",\n  \"INTENT_SIMULATE\",\n  \"REGISTRY_AUDIT_TRAIL\",\n  \"AUTONOMY_BUDGET_GET\",\n  \"AUTONOMY_BUDGET_SET\",\n  \"FAILURE_MEMORY_GET\",\n  \"FAILURE_MEMORY_PUT\",\n  \"AUTONOMY_CHARTER_GET\",\n  \"AUTONOMY_CHARTER_SET\",\n];\n\n    // ----------------------------\n    // Helpers\n    // ----------------------------\n    const normalizeHost = (u) => {\n      try {\n        return new URL(u).host.toLowerCase();\n      } catch {\n        return null;\n      }\n    };\n\n    // Accept either a full URL or a bare domain token.\n    const normalizeHostLoose = (s) => {\n      if (!s) return null;\n      const h = normalizeHost(s);\n      if (h) return h;\n      const t = String(s).trim().toLowerCase();\n      if (!t) return null;\n      // Basic sanity: must contain a dot and only valid hostname chars.\n      if (!t.includes(\".\")) return null;\n      if (!/^[a-z0-9.-]+$/.test(t)) return null;\n      return t;\n    };\n\n    const extractLastUrl = (txt) => {\n      const matches = [...txt.matchAll(/https?:\\/\\/[^\\s]+/g)];\n      return matches.length ? matches[matches.length - 1][0] : null;\n    };\n\n    // Extract a bare domain mention like example.com (no scheme).\n    // Returns the last plausible domain token found in the message.\n    const extractLastBareDomain = (txt) => {\n      // labels + TLD; excludes trailing punctuation due to \\b\n      const re =\n        /\\b([a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\\.[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?)+)\\b/gi;\n      const matches = [];\n      let m;\n      while ((m = re.exec(txt)) !== null) {\n        const d = (m[1] || \"\").toLowerCase();\n        if (!d) continue;\n        if (d === \"localhost\") continue;\n        matches.push(d);\n      }\n      return matches.length ? matches[matches.length - 1] : null;\n    };\n\n    const statusReachable = (st) => Number(st) >= 200 && Number(st) < 400;\n    const evidenceKey = (host) => `verified_fetch:${host}`;\n    const capsKey = (host) => `host_caps:${host}`;\n    const intentKey = (host, tag) => `intent:${host}:${tag}`;\n// ----------------------------\n// Memory Substrate v1 (storage-backed; no model memory)\n// ----------------------------\nconst REGISTRY_VERSION = \"v1\";\n\nconst registryKey = (type, id) => `reg:${REGISTRY_VERSION}:${type}:${id}`;\nconst registryIndexKey = (type) => `reg:${REGISTRY_VERSION}:index:${type}`;\nconst registryMetaKey = (type) => `reg:${REGISTRY_VERSION}:meta:${type}`;\n\nconst auditSeqKey = (host) => `audit:${REGISTRY_VERSION}:${host}:seq`;\nconst auditEventKey = (host, seq) => `audit:${REGISTRY_VERSION}:${host}:event:${seq}`;\nconst auditClearedAtKey = (host) => `audit:${REGISTRY_VERSION}:${host}:cleared_at`;\n\nconst nowIso = () => new Date().toISOString();\n\nconst safeJsonParse = (s) => {\n  try {\n    return JSON.parse(s);\n  } catch {\n    return null;\n  }\n};\n\n/**\n * Parse JSON arguments for commands in batch payloads.\n * Supports:\n *  - TOKEN <json>\n *  - TOKEN <type> <json>               (legacy, e.g. REGISTRY_PUT domains {...})\n *  - TOKEN                              then JSON on subsequent non-command lines\n */\nfunction __isCommandLine(line, allowedCommands) {\n  if (!line) return false;\n  const tok = String(line).trim().split(/\\s+/)[0] || \"\";\n  if (!tok) return false;\n  if (tok === \"HOST\") return true;\n  return allowedCommands && Array.isArray(allowedCommands) && allowedCommands.includes(tok);\n}\n\nfunction __collectJsonText(token, line, lines, idx, allowedCommands) {\n  const tail = String(line || \"\").slice(token.length).trim();\n  if (tail) return { text: tail, nextIndex: idx };\n\n  // Collect subsequent lines until the next command token (or HOST) appears.\n  const buf = [];\n  let j = idx + 1;\n  for (; j < (lines || []).length; j++) {\n    const ln = String(lines[j] || \"\").trim();\n    if (!ln) continue;\n    if (__isCommandLine(ln, allowedCommands)) break;\n    buf.push(ln);\n  }\n  const joined = buf.join(\"\\n\").trim();\n  return { text: joined, nextIndex: j - 1 };\n}\n\nfunction __parseRegistryPutArgs(line, lines, idx, allowedCommands) {\n  // Returns { type, item, nextIndex } or null\n  const token = \"REGISTRY_PUT\";\n  const { text, nextIndex } = __collectJsonText(token, line, lines, idx, allowedCommands);\n  if (!text) return null;\n\n  // 1) JSON envelope: {\"type\":\"domains\",\"item\":{...}}\n  const direct = safeJsonParse(text);\n  if (direct && typeof direct === \"object\") {\n    if (direct.type && direct.item) {\n      return { type: String(direct.type).toLowerCase(), item: direct.item, nextIndex };\n    }\n  }\n\n  // 2) Legacy: \"<type> <json>\"\n  const m = text.match(/^(\\S+)\\s+([\\s\\S]+)$/);\n  if (!m) return null;\n  const type = String(m[1] || \"\").toLowerCase().trim();\n  const item = safeJsonParse(String(m[2] || \"\").trim());\n  if (!type || !item || typeof item !== \"object\") return null;\n  return { type, item, nextIndex };\n}\n\nfunction __parseRegistryGetArgs(line, lines, idx, allowedCommands) {\n  // Supports:\n  //  - REGISTRY_GET <type> <id>\n  //  - REGISTRY_GET <type> {\"key\":\"id\"}  (legacy shape)\n  //  - REGISTRY_GET <type>               then {\"key\":\"id\"} on next lines\n  const parts = String(line || \"\").trim().split(/\\s+/).filter(Boolean);\n  const type = String(parts[1] || \"\").toLowerCase().trim();\n  if (!type) return null;\n\n  if (parts.length >= 3) {\n    const rest = String(parts.slice(2).join(\" \")).trim();\n    if (!rest) return null;\n    if (rest.startsWith(\"{\") || rest.startsWith(\"[\")) {\n      const obj = safeJsonParse(rest);\n      const key = obj && typeof obj === \"object\" ? (obj.key || obj.id || obj.domain) : null;\n      const id = String(key || \"\").trim();\n      if (!id) return null;\n      return { type, id, nextIndex: idx };\n    }\n    return { type, id: String(rest).trim(), nextIndex: idx };\n  }\n\n  // No id on the same line  collect JSON below\n  const { text, nextIndex } = __collectJsonText(\"REGISTRY_GET\", line, lines, idx, allowedCommands);\n  const obj = safeJsonParse(text);\n  const key = obj && typeof obj === \"object\" ? (obj.key || obj.id || obj.domain) : null;\n  const id = String(key || \"\").trim();\n  if (!id) return null;\n  return { type, id, nextIndex };\n}\n\nfunction __parseRegistryImportArgs(token, line, lines, idx, allowedCommands) {\n  const { text, nextIndex } = __collectJsonText(token, line, lines, idx, allowedCommands);\n  if (!text) return null;\n  const parsed = safeJsonParse(text);\n  if (!parsed) return null;\n  const items = Array.isArray(parsed) ? parsed : (Array.isArray(parsed.items) ? parsed.items : null);\n  if (!items) return null;\n  return { parsed, items, nextIndex };\n}\n\n\nconst auditWrite = async (env, host, event) => {\n  const ts = nowIso();\n  const seqRaw = await env.AURA_KV.get(auditSeqKey(host));\n  const seq = Number(seqRaw || 0) + 1;\n  await env.AURA_KV.put(auditSeqKey(host), String(seq));\n\n  const payload = { seq, ts, ...event };\n\n  await env.AURA_KV.put(auditEventKey(host, seq), JSON.stringify(payload));\n  return payload;\n};\n\nconst auditList = async (env, host, limit = 50) => {\n  const seqRaw = await env.AURA_KV.get(auditSeqKey(host));\n  const seq = Number(seqRaw || 0);\n  const out = [];\n  const start = Math.max(1, seq - limit + 1);\n  for (let i = start; i <= seq; i++) {\n    const s = await env.AURA_KV.get(auditEventKey(host, i));\n    if (!s) continue;\n    const p = safeJsonParse(s) || s;\n    out.push(p);\n  }\n  return { seq, events: out };\n};\n\nconst registryGetIndex = async (env, type) => {\n  const raw = await env.AURA_KV.get(registryIndexKey(type));\n  const parsed = raw ? safeJsonParse(raw) : null;\n  if (Array.isArray(parsed)) return parsed;\n  return { ok: true, wrote: true };\n};\n\nconst registryPutIndex = async (env, type, ids) => {\n  const clean = [...new Set((ids || []).filter((x) => typeof x === \"string\" && x.trim()))];\n  await env.AURA_KV.put(registryIndexKey(type), JSON.stringify(clean));\n  await env.AURA_KV.put(\n    registryMetaKey(type),\n    JSON.stringify({ type, count: clean.length, updated_at: nowIso(), version: REGISTRY_VERSION })\n  );\n  return clean.length;\n};\n\nconst registryPut = async (env, type, obj) => {\n  if (!obj || typeof obj !== \"object\") return { ok: false, error: \"BAD_REQUEST\" };\n  const id = String(obj.id || \"\").trim();\n  if (!id) return { ok: false, error: \"BAD_REQUEST\" };\n\n  const key = registryKey(type, id);\n  const stored = {\n    ...obj,\n    id,\n    type,\n    updated_at: nowIso(),\n    version: REGISTRY_VERSION\n  };\n\n  await env.AURA_KV.put(key, JSON.stringify(stored));\n\n  const ids = await registryGetIndex(env, type);\n  if (!ids.includes(id)) {\n    ids.push(id);\n    await registryPutIndex(env, type, ids);\n  } else {\n    await env.AURA_KV.put(\n      registryMetaKey(type),\n      JSON.stringify({ type, count: ids.length, updated_at: nowIso(), version: REGISTRY_VERSION })\n    );\n  }\n\n  await auditWrite(env, activeHost, { action: \"REGISTRY_PUT\", type, id });\n  return { ok: true, entry: stored };\n};\n\nconst registryGet = async (env, type, id) => {\n  const key = registryKey(type, id);\n  const raw = await env.AURA_KV.get(key);\n  if (!raw) return null;\n  return safeJsonParse(raw) || raw;\n};\n\nconst registryList = async (env, type, limit = 50) => {\n  const ids = await registryGetIndex(env, type);\n  const slice = ids.slice(0, Math.max(0, Math.min(limit, 500)));\n  const items = [];\n  for (const id of slice) {\n    const e = await registryGet(env, type, id);\n    if (e) items.push(e);\n  }\n  const metaRaw = await env.AURA_KV.get(registryMetaKey(type));\n  const meta = metaRaw ? (safeJsonParse(metaRaw) || metaRaw) : null;\n  return { type, meta, ids_count: ids.length, returned: items.length, items };\n};\n\nconst registryFilter = async (env, type, field, value, limit = 50) => {\n  const ids = await registryGetIndex(env, type);\n  const out = [];\n  for (const id of ids) {\n    const e = await registryGet(env, type, id);\n    if (!e || typeof e !== \"object\") continue;\n    const v = e[field];\n    const match =\n      (typeof v === \"string\" && String(v).toLowerCase() === String(value).toLowerCase()) ||\n      (Array.isArray(v) &&\n        v.map((x) => String(x).toLowerCase()).includes(String(value).toLowerCase()));\n    if (match) out.push(e);\n    if (out.length >= Math.max(1, Math.min(limit, 200))) break;\n  }\n  return { type, field, value, returned: out.length, items: out };\n};\n\n\nconst registryFilterWhere = async (env, type, where = {}, limit = 50) => {\n  const ids = await registryGetIndex(env, type);\n  const out = [];\n  const keys = Object.keys(where || {}).filter(Boolean);\n  for (const id of ids) {\n    const e = await registryGet(env, type, id);\n    if (!e || typeof e !== \"object\") continue;\n\n    let ok = true;\n    for (const k of keys) {\n      const expected = where[k];\n      const actual = e[k];\n\n      if (expected == null) continue;\n\n      // expected can be string/number/bool OR array of allowed values\n      const allowed = Array.isArray(expected) ? expected : [expected];\n\n      const match =\n        (typeof actual === \"string\" &&\n          allowed.map((x) => String(x).toLowerCase()).includes(String(actual).toLowerCase())) ||\n        (typeof actual === \"number\" &&\n          allowed.map((x) => Number(x)).includes(Number(actual))) ||\n        (typeof actual === \"boolean\" &&\n          allowed.map((x) => String(x).toLowerCase()).includes(String(actual).toLowerCase())) ||\n        (Array.isArray(actual) &&\n          actual.map((x) => String(x).toLowerCase()).some((v) =>\n            allowed.map((a) => String(a).toLowerCase()).includes(v)\n          ));\n\n      if (!match) { ok = false; break; }\n    }\n\n    if (ok) out.push(e);\n    if (out.length >= Math.max(1, Math.min(limit, 200))) break;\n  }\n  return { type, where, returned: out.length, items: out };\n};\n\nconst memorySchemaV1 = {\n  version: REGISTRY_VERSION,\n  registries: {\n    assets: {\n      id: \"string (recommended: stable slug or numeric string)\",\n      name: \"string\",\n      pillar: \"string\",\n      notes: \"string (optional)\",\n      tags: \"string[] (optional)\",\n      sellability: \"NEVER_SELL | SELLABLE | HOLD | UNKNOWN (optional)\",\n      patent_cluster: \"string (optional)\",\n      created_at: \"iso string (optional)\",\n      updated_at: \"iso string (system)\",\n      audit: \"KV audit events (system)\"\n    },\n    domains: {\n      id: \"string (domain itself, lowercased)\",\n      domain: \"string\",\n      pillar: \"string\",\n      purpose: \"string (optional)\",\n      priority: \"PHASE1 | PHASE2 | HOLD | UNKNOWN (optional)\",\n      status: \"UNKNOWN | ACTIVE | PARKED | REDIRECT | BROKEN (optional)\",\n      updated_at: \"iso string (system)\",\n      audit: \"KV audit events (system)\"\n    },\n    users: {\n      id: \"string\",\n      prefs: \"object\",\n      intents: \"object[]\",\n      updated_at: \"iso string\"\n    }\n  }\n};\n\n    const jsonReply = (reply) => Response.json({ ok: true, reply });\n\n// ----------------------------\n// Deployer Autonomy Surface (operator-gated; host-capped)\n// - Exposes ONLY a minimal proxy surface to service bindings.\n// - Does NOT claim success for external effects; callers must verify via VERIFIED_FETCH_URL.\n// Commands:\n//   DEPLOYER_CAPS\n//   DEPLOYER_CALL <json>\n// JSON shape for DEPLOYER_CALL:\n//   {\"service\":\"AURA_DEPLOYER\"|\"AURA_CF\",\"path\":\"/admin|/dns|/deploy|...\",\"method\":\"POST|GET\",\"content_type\":\"application/json\",\"body\":\"...raw...\"} \n// ----------------------------\nconst __hasService = (env, name) => {\n  try { return Boolean(env && env[name] && typeof env[name].fetch === \"function\"); } catch { return false; }\n};\n\n\nconst __withOperatorHeaders = (headers, isOperator, operatorHeader, deployKey) => {\n  const out = { ...(headers || {}) };\n  if (isOperator && operatorHeader) {\n    out[\"x-operator-token\"] = operatorHeader;\n    out[\"authorization\"] = `Bearer ${operatorHeader}`;\n  }\n  if (deployKey) {\n    out[\"X-Deploy-Key\"] = deployKey;\n  }\n  return out;\n};\n\nconst __serviceFetch = async (svc, req) => {\n  const url = new URL(req.path, \"https://internal\");\n\n  const method = String(req.method || \"GET\").toUpperCase();\n  const headers = {\n    ...(req.headers || {}),\n    ...(req.content_type ? { \"content-type\": req.content_type } : {})\n  };\n\n  const init = { method, headers };\n  // IMPORTANT: Fetch forbids bodies on GET/HEAD. Ignore any provided body for those methods.\n  if (method !== \"GET\" && method !== \"HEAD\") {\n    if (req.body != null && req.body !== \"\") init.body = req.body;\n  }\n\n  const r = await svc.fetch(new Request(url.toString(), init));\n  const ct = (r.headers.get(\"content-type\") || \"\").toLowerCase();\n  let out;\n  if (ct.includes(\"application/json\")) out = await r.json();\n  else out = await r.text();\n  return { http_status: r.status, content_type: ct || null, out };\n};\n\nconst __deployerCaps = (env) => {\n  const hasDeployer = __hasService(env, \"AURA_DEPLOYER\");\n  const hasCf = __hasService(env, \"AURA_CF\");\n  return {\n    ok: hasDeployer || hasCf,\n    bindings: { AURA_DEPLOYER: hasDeployer, AURA_CF: hasCf },\n    surface: [\n      \"DEPLOYER_CALL service=AURA_DEPLOYER path/method/body (operator-only)\",\n      \"DEPLOYER_CALL service=AURA_CF path/method/body (operator-only)\"\n    ],\n    requirement: \"Caller must verify externally via VERIFIED_FETCH_URL; no implicit 'success' claims.\"\n  };\n};\n\n\n\n    // ----------------------------\n    // Strict allowlist: unknown single-token command => UNKNOWN_COMMAND\n    // ----------------------------\n    if (/^[A-Z0-9_]+$/.test(bodyTrim) && !allowedCommands.includes(bodyTrim)) {\n      return jsonReply(\"UNKNOWN_COMMAND\");\n    }\n\n    // ----------------------------\n    // Simple commands\n    // ----------------------------\n    if (bodyTrim === \"PING\") return jsonReply(\"PONG\");\n\n    if (bodyTrim === \"SHOW_ALLOWED_COMMANDS\") {\n      return jsonReply(allowedCommands);\n    }\n\n    if (bodyTrim === \"SHOW_BUILD\") {\n      return jsonReply({ build: BUILD, stamp: new Date().toISOString() });\n    }\n\n    if (bodyTrim === \"SHOW_CLAIM_GATE\") {\n      return jsonReply(\n        JSON.stringify(\n          {\n            trigger_words: [\n              \"live\",\n              \"deployed\",\n              \"launched\",\n              \"resolving\",\n              \"propagating\",\n              \"successful\",\n              \"verified\",\n              \"up\",\n              \"online\",\n              \"working\",\n              \"reachable\",\n              \"available\",\n              \"accessible\"\n            ],\n            forced_message: \"NOT WIRED: VERIFIED_FETCH REQUIRED\",\n            requires_verified_fetch_format: true\n          },\n          null,\n          2\n        )\n      );\n    }\n\n\n    // ----------------------------\n    // AUTONOMY PRIMITIVES (single command; read-only stubs)\n    // ----------------------------\n    if (bodyTrim === \"AUTONOMY_STATUS\") return jsonReply(JSON.stringify({ ok: true }, null, 2));\n    if (bodyTrim === \"AUTONOMY_LAST_TICK\") return jsonReply(JSON.stringify({ ok: true }, null, 2));\n    \n    if (bodyTrim === \"AUTONOMY_LAST_TICK_SET\") return jsonReply(JSON.stringify({ ok: true, note: \"requires envelope\" }, null, 2));\nif (bodyTrim === \"AUTONOMY_CAPABILITIES\") return jsonReply({ ok: true });\n    if (bodyTrim === \"INTENT_SIMULATE\") return jsonReply(JSON.stringify({ ok: true, note: \"preview-only\" }, null, 2));\n    if (bodyTrim === \"REGISTRY_AUDIT_TRAIL\") return jsonReply(JSON.stringify({ ok: true, note: \"placeholder\" }, null, 2));\n    // [PATCH] removed placeholder AUTONOMY_BUDGET_GET early-return; allow batch execution\n    if (bodyTrim === \"AUTONOMY_BUDGET_SET\") return jsonReply(JSON.stringify({ ok: true, note: \"requires envelope\" }, null, 2));\n    if (bodyTrim === \"FAILURE_MEMORY_GET\") return jsonReply(JSON.stringify({ ok: true }, null, 2));\n    if (bodyTrim === \"FAILURE_MEMORY_PUT\") return jsonReply(JSON.stringify({ ok: true, note: \"requires envelope\" }, null, 2));\n    if (bodyTrim === \"AUTONOMY_CHARTER_GET\") return jsonReply(JSON.stringify({ ok: true }, null, 2));\n    if (bodyTrim === \"AUTONOMY_CHARTER_SET\") return jsonReply(JSON.stringify({ ok: true, note: \"requires envelope\" }, null, 2));\n\nif (bodyTrim === \"SHOW_MEMORY_SCHEMA\") {\n  return jsonReply(memorySchemaV1);\n}\n\nif (bodyTrim === \"PORTFOLIO_STATUS\") {\n  const assetsMetaRaw = await env.AURA_KV.get(registryMetaKey(\"assets\"));\n  const domainsMetaRaw = await env.AURA_KV.get(registryMetaKey(\"domains\"));\n  const assetsMeta = assetsMetaRaw ? (safeJsonParse(assetsMetaRaw) || assetsMetaRaw) : null;\n  const domainsMeta = domainsMetaRaw ? (safeJsonParse(domainsMetaRaw) || domainsMetaRaw) : null;\n\n  const status = {\n    build: BUILD,\n    stamp: nowIso(),\n    registry_version: REGISTRY_VERSION,\n    registries: {\n      assets: assetsMeta || { type: \"assets\", count: 0, updated_at: null, version: REGISTRY_VERSION },\n      domains: domainsMeta || { type: \"domains\", count: 0, updated_at: null, version: REGISTRY_VERSION }\n    }\n  };\n\n  return jsonReply(status);\n}\n\n// [PATCH] removed early AUDIT_GET fast-path (prevent TDZ on activeHost); AUDIT_GET handled via batch router\n\n    if (bodyTrim === \"PAUSE\") { return jsonReply({ cmd: \"PAUSE\", paused: true, host: activeHost, note: \"DETERMINISTIC_PAUSE_ACK_V2\" }); }\n\n    // ----------------------------\n    // Parse message lines (multi-line command batches)\n    // ----------------------------\n    const lines = body\n      .split(\"\\n\")\n      .map((l) => l.replace(/\\r/g, \"\").replace(/^\\s*>>\\s?/, \"\").replace(/^\\s*>\\s?/, \"\").trim())\n      .filter(Boolean);\n\n    let didRegistryWrite = false;\n\n    // ----------------------------\n    // Host context for domain-scoped capability routing\n    // ----------------------------\n    // IMPORTANT: do NOT pre-scan all HOST lines and pick the last one.\n    // Batch requests may include multiple HOST scopes. We set an initial host here,\n    // then update `activeHost` as we encounter \"HOST <host>\" lines during execution.\n    const askedUrl = extractLastUrl(body);\n    const askedHostFromUrl = askedUrl ? normalizeHost(askedUrl) : null;\n\n    // If no URL was provided, try to extract a bare domain mention from the message.\n    const askedHostFromBare = askedHostFromUrl ? null : extractLastBareDomain(body);\n\n    // Prefer asked host for questions; otherwise fall back to request host.\n    const askedHost = askedHostFromUrl || askedHostFromBare || null;\n    const requestHost = new URL(request.url).host.toLowerCase();\n    let activeHost = askedHost || requestHost || null;\n\n\n    const getHostCaps = async (host) => {\n      if (!host) return null;\n      const stored = await env.AURA_KV.get(capsKey(host));\n      if (!stored) return null;\n      try {\n        const parsed = JSON.parse(stored);\n        if (parsed && Array.isArray(parsed.allowed)) return parsed;\n        return null;\n      } catch {\n        return null;\n      }\n    };\n\n    // Host caps are host-scoped. In batch mode, HOST may change mid-request,\n    // so capability checks must be evaluated per-host, not once for the last HOST.\n    const __capsCache = new Map(); // host -> caps|null\n\n    const __getHostCapsCached = async (host) => {\n      const h = String(host || \"\").toLowerCase();\n      if (!h) return null;\n      if (__capsCache.has(h)) return __capsCache.get(h);\n      const caps = await getHostCaps(h);\n      __capsCache.set(h, caps || null);\n      return caps || null;\n    };\n\n    const __isAllowedForHost = async (cmd, host) => {\n      const caps = await __getHostCapsCached(host);\n      if (!caps) return true;\n      return Array.isArray(caps.allowed) && caps.allowed.includes(cmd);\n    };\n\n\n    // ----------------------------\n    // Operator-only: HOST_CAPS_SET (supports multiple lines)\n    //\n    // Supported syntaxes:\n    // 1) HOST_CAPS_SET <host> <json>\n    // 2) HOST_CAPS_SET <json>                (host defaults to current HOST)\n    //\n    // <json> may be:\n    // - an array of command strings: [\"PING\",\"SHOW_BUILD\",...]\n    // - an object with allow/allowed: {\"allow\":[...]} or {\"allowed\":[...]} (optionally {\"host\":\"...\"} )\n    // ----------------------------\n    let hostCapsSetCount = 0;\n\n    for (const line of lines) {\n      if (!line.startsWith(\"HOST_CAPS_SET\")) continue;\n\n      if (!isOperator) return jsonReply(\"UNAUTHORIZED\");\n\n      // Split once on whitespace after the command token.\n      const rest = line.slice(\"HOST_CAPS_SET\".length).trim();\n      if (!rest) return jsonReply(\"BAD_REQUEST\");\n\n      // Decide whether the first token is a host or JSON.\n      let host = (activeHost || \"\").toLowerCase();\n      let jsonText = rest;\n\n      const firstChar = rest[0];\n      if (!(firstChar === \"{\" || firstChar === \"[\")) {\n        const m = rest.match(/^(\\S+)\\s+([\\s\\S]+)$/);\n        if (!m) return jsonReply(\"BAD_REQUEST\");\n        host = m[1].toLowerCase();\n        jsonText = m[2].trim();\n      }\n\n      if (!host) return jsonReply(\"BAD_REQUEST\");\n\n      try {\n        const parsed = JSON.parse(jsonText);\n\n        // Normalize to an array of command strings.\n        let requested = null;\n\n        if (Array.isArray(parsed)) {\n          requested = parsed;\n        } else if (parsed && typeof parsed === \"object\") {\n          if (typeof parsed.host === \"string\" && parsed.host.trim()) {\n            host = parsed.host.trim().toLowerCase();\n          }\n          if (Array.isArray(parsed.allow)) requested = parsed.allow;\n          else if (Array.isArray(parsed.allowed)) requested = parsed.allowed;\n        }\n\n        if (!Array.isArray(requested)) return jsonReply(\"BAD_REQUEST\");\n\n        // Sanitize: keep only known commands.\n        const clean = requested\n          .map((s) => String(s).trim())\n          .filter(Boolean)\n          .filter((c) => allowedCommands.includes(c));\n\n        await env.AURA_KV.put(capsKey(host), JSON.stringify({ allowed: clean, updated_at: nowIso() }), { expirationTtl: 60 * 60 * 24 * 30 });\n        hostCapsSetCount++;\n      } catch (_e) {\n        return jsonReply(\"BAD_REQUEST\");\n      }\n    }\n\n    if (hostCapsSetCount > 0) {\n      return jsonReply(hostCapsSetCount === 1 ? \"OK\" : `OK (${hostCapsSetCount})`);\n    }\n  // HOST_CAPS_GET [host] (single-command fast path only)\n  if (lines.length === 1 && lines[0].startsWith(\"HOST_CAPS_GET\")) {\n    const parts = lines[0].split(\" \").filter(Boolean);\n    const host = (parts[1] || activeHost || \"frontdesk.network\").toLowerCase();\n    const caps = await getHostCaps(host);\n    return jsonReply(JSON.stringify(caps || { host, allowed: null }, null, 2));\n  }\n    // If host caps exist and a line starts with a command that isn't allowed for the current HOST scope, block deterministically.\n    // NOTE: batch requests may include multiple HOST scopes, so we track HOST changes while scanning.\n    {\n      let __scanHost = activeHost;\n      for (const line of lines) {\n        if (line.startsWith(\"HOST \")) {\n          const parts = line.split(\" \").filter(Boolean);\n          if (parts[1]) __scanHost = parts[1].toLowerCase();\n          continue;\n        }\n        const token = line.split(\" \")[0];\n        if (allowedCommands.includes(token)) {\n          const ok = await __isAllowedForHost(token, __scanHost);\n          if (!ok) return jsonReply(\"NOT_ALLOWED\");\n        }\n      }\n    }\n\n\n// ----------------------------\n// BATCH EXECUTION (ordered, multi-command)\n// Purpose: allow VERIFIED_FETCH + REGISTRY_PUT/GET + AUDIT_GET + PORTFOLIO_STATUS in ONE request.\n// Avoid early-returns from hasLine() helpers.\n// ----------------------------\nconst isBatch = (lines.length > 1 || (lines.length === 1 && allowedCommands.includes(lines[0].split(\" \")[0]))) && lines.some((l) => {\n  const tok = l.split(\" \")[0];\n  return allowedCommands.includes(tok);\n});\n\nconst doVerifiedFetch = async (target) => {\n  const host = normalizeHost(target);\n  if (!host) return { ok: false, error: \"BAD_REQUEST\", url: target, http_status: 0 };\n\n  const runFetch = async (probeUrl) => {\n    const res = await fetch(probeUrl);\n    const text = await res.text();\n    return { res, text };\n  };\n\n  const nowTs = new Date().toISOString();\n  const selfHost = new URL(request.url).host.toLowerCase();\n\n  if (host === selfHost) {\n    const evidence = {\n      ok: true,\n      host,\n      url: target,\n      probe_url: null,\n      http_status: 200,\n      first_line_html: \"SELF_HOST_SYNTHETIC_EVIDENCE\",\n      body_length: 0,\n      synthetic: true,\n      reason: \"WORKER_SELF_ROUTE_ASSUME_REACHABLE\",\n      diagnostics: { cf: request.cf || null, self_host: selfHost, ts: nowTs }\n    };\n    await env.AURA_KV.put(evidenceKey(host), JSON.stringify(evidence));\n    return evidence;\n  }\n\n  try {\n    const { res: res1, text: text1 } = await runFetch(target);\n\n    if (res1.status === 525) {\n      const u = new URL(target);\n      if (u.protocol === \"https:\") {\n        u.protocol = \"http:\";\n        const httpUrl = u.toString();\n        const { res: res2, text: text2 } = await runFetch(httpUrl);\n\n        const evidence = {\n          ok: true,\n          host,\n          public_url: target,\n          probe_url: httpUrl,\n          fallback_reason: \"CF_HTTPS_525_HTTP_PROBE\",\n          http_status: res2.status,\n          first_line_html: text2.split(\"\\n\")[0] || \"\",\n          body_length: text2.length,\n          diagnostics: { cf: request.cf || null, https_status: 525, ts: nowTs }\n        };\n        await env.AURA_KV.put(evidenceKey(host), JSON.stringify(evidence));\n        return evidence;\n      }\n    }\n\n    const evidence = {\n      ok: true,\n      host,\n      url: target,\n      http_status: res1.status,\n      first_line_html: text1.split(\"\\n\")[0] || \"\",\n      body_length: text1.length,\n      diagnostics: { cf: request.cf || null, ts: nowTs }\n    };\n    await env.AURA_KV.put(evidenceKey(host), JSON.stringify(evidence));\n    return evidence;\n  } catch (err) {\n    const evidence = {\n      ok: false,\n      host,\n      url: target,\n      http_status: 0,\n      error: String(err?.message || err),\n      error_name: err?.name || \"UNKNOWN\",\n      diagnostics: { cf: request.cf || null, ts: nowTs }\n    };\n    await env.AURA_KV.put(evidenceKey(host), JSON.stringify(evidence));\n    return evidence;\n  }\n};\n\nif (isBatch) {\n  const out = [];\n  const push = (cmd, payload) => out.push({ cmd, payload });\n      \n  // Track which hosts were VERIFIED_FETCH_URL seeded in THIS request only.\n  const __seededThisRequest = new Set();\n// Claim-gate (batch mode): registry writes for a domain require VERIFIED_FETCH evidence for that domain's host.\n      const __evidenceCache = new Map(); // host -> evidence payload\n\n      const __getHostEvidence = async (host) => {\n        const h = String(host || \"\").trim().toLowerCase();\n        if (!h) return null;\n        if (__evidenceCache.has(h)) return __evidenceCache.get(h);\n        try {\n          const ev = await env.AURA_KV.get(evidenceKey(h), { type: \"json\" });\n          if (ev) __evidenceCache.set(h, ev);\n          return ev || null;\n        } catch (_) {\n          return null;\n        }\n      };\n\n      const __noteHostEvidence = (host, evidence) => {\n        const h = String(host || \"\").trim().toLowerCase();\n        if (!h) return;\n        __evidenceCache.set(h, evidence || { ok: true, host: h });\n      };\n\n      const __domainHostFromRegistryEntry = (type, item) => {\n        try {\n          if (!item || typeof item !== \"object\") return null;\n          if (type === \"domains\") return (item.domain || item.id || \"\").toString();\n          if (type === \"assets\") {\n            return (item.domain_id || (Array.isArray(item.domains) && item.domains[0]) || \"\").toString();\n          }\n          return null;\n        } catch (_) {\n          return null;\n        }\n      };\n\n\n  // Execute in the order provided.\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    if (line.startsWith(\"HOST \")) {\n      const parts = line.split(\" \").filter(Boolean);\n      if (parts[1]) activeHost = parts[1].toLowerCase();\n      continue;\n    }\n\n    // Operator-only command gate (fail closed)\n    // NOTE: \"inspection\" commands should be available without operator auth.\n    // Only privileged mutations and deploy actions require operator auth.\n    const opOnly =\n      line === \"AUDIT_GET\" ||\n      line === \"AUDIT_CLEAR\" ||\n      line.startsWith(\"CLEAR_VERIFIED_FETCH\") ||\n      line === \"HOST_CAPS_SET\" ||\n      line.startsWith(\"REGISTRY_PUT\") ||\n      line.startsWith(\"REGISTRY_IMPORT_\") ||\n      line.startsWith(\"DEPLOYER_CALL\") ||\n      line.startsWith(\"INTENT_ADD\") ||\n      line.startsWith(\"INTENT_CLEAR\");\n    if (opOnly) {\n      if (!operatorToken) return jsonReply(\"OPERATOR_TOKEN_NOT_CONFIGURED\");\n      if (!isOperator) return jsonReply(\"UNAUTHORIZED\");\n    }\n\n\n    // ----------------------------\n    // Intent (batch mode)  emit cmd entries (no early return)\n    // ----------------------------\n    if (line.startsWith(\"INTENT_ADD\")) {\n      const m = line.match(/^INTENT_ADD\\s+(\\S+)\\s+(\\S+)\\s+(.+)$/);\n      if (!m) { push(\"INTENT_ADD\", \"BAD_REQUEST\"); continue; }\n      const host = m[1].toLowerCase();\n      const tag = m[2].toLowerCase();\n      const text = m[3];\n\n      const payload = {\n        host,\n        tag,\n        text,\n        created_at: nowIso(),\n        consent: \"EXPLICIT_COMMAND\"\n      };\n\n      await env.AURA_KV.put(intentKey(host, tag), JSON.stringify(payload));\n      push(\"INTENT_ADD\", { ok: true, host, tag });\n      continue;\n    }\n\n    if (line.startsWith(\"INTENT_GET\")) {\n      const parts = line.split(\" \").filter(Boolean);\n      const host = (parts[1] || \"\").toLowerCase();\n      const tag = (parts[2] || \"\").toLowerCase();\n      if (!host || !tag) { push(\"INTENT_GET\", \"BAD_REQUEST\"); continue; }\n      const stored = await env.AURA_KV.get(intentKey(host, tag));\n      push(\"INTENT_GET\", stored ? (safeJsonParse(stored) || stored) : \"INTENT_MISSING\");\n      continue;\n    }\n\n    if (line.startsWith(\"INTENT_CLEAR\")) {\n      const parts = line.split(\" \").filter(Boolean);\n      const host = (parts[1] || \"\").toLowerCase();\n      const tag = (parts[2] || \"\").toLowerCase();\n      if (!host || !tag) { push(\"INTENT_CLEAR\", \"BAD_REQUEST\"); continue; }\n      await env.AURA_KV.delete(intentKey(host, tag));\n      push(\"INTENT_CLEAR\", \"CLEARED\");\n      continue;\n    }\n\n\n    if (line.startsWith(\"CLEAR_VERIFIED_FETCH\")) {\n      const parts = line.split(\" \").filter(Boolean);\n      const host = normalizeHost(parts[1]);\n      if (host) await env.AURA_KV.delete(evidenceKey(host));\n      push(\"CLEAR_VERIFIED_FETCH\", host ? \"CLEARED\" : \"BAD_REQUEST\");\n      continue;\n    }\n\n    if (line.startsWith(\"VERIFIED_FETCH_URL\")) {\n      const parts = line.split(\" \").filter(Boolean);\n      const target = parts[1];\n      const ev = await doVerifiedFetch(target);\n      push(\"VERIFIED_FETCH_URL\", ev);\n      if (ev && ev.ok && ev.host) { __seededThisRequest.add(String(ev.host).toLowerCase()); }\n      continue;\n    }\n\n    if (line.startsWith(\"EVIDENCE_PRESENT\")) {\n      const parts = line.split(\" \").filter(Boolean);\n      const host = normalizeHostLoose(parts[1]) || activeHost;\n      if (!host) { push(\"EVIDENCE_PRESENT\", \"BAD_REQUEST\"); continue; }\n      const stored = await env.AURA_KV.get(evidenceKey(host));\n      push(\"EVIDENCE_PRESENT\", stored ? (safeJsonParse(stored) || stored) : \"NO_EVIDENCE\");\n      continue;\n    }\n\n    if (line === \"SHOW_MEMORY_SCHEMA\") {\n      push(\"SHOW_MEMORY_SCHEMA\", memorySchemaV1);\n      continue;\n    }\n\nif (line === \"PAUSE\") { push(\"PAUSE\", { cmd: \"PAUSE\", paused: true, host: activeHost, note: \"DETERMINISTIC_PAUSE_ACK_V2_BATCH\" }); continue; }\nif (line === \"SHOW_BUILD\") {\n  push(\"SHOW_BUILD\", { build: BUILD, stamp: new Date().toISOString() });\n  continue;\n}\n\nif (line === \"SHOW_CLAIM_GATE\") {\n  push(\"SHOW_CLAIM_GATE\", {\n    trigger_words: [\n      \"live\",\"deployed\",\"launched\",\"resolving\",\"propagating\",\"successful\",\"verified\",\"up\",\"online\",\"working\",\"reachable\",\"available\",\"accessible\"\n    ],\n    forced_message: \"NOT WIRED: VERIFIED_FETCH REQUIRED\",\n    requires_verified_fetch_format: true\n  });\n  continue;\n}\n\nif (line === \"SHOW_ALLOWED_COMMANDS\") {\n  push(\"SHOW_ALLOWED_COMMANDS\", allowedCommands);\n  continue;\n}\n\nif (line === \"SELF_AUDIT_FULL\") {\n  const __host = String(activeHost || \"frontdesk.network\").toLowerCase();\n\n  const operator_seen =\n    (typeof isOperator === \"boolean\") ? isOperator :\n    (typeof operator === \"boolean\") ? operator :\n    false;\n\n  const __budgetKey  = `AUTONOMY_BUDGET__${__host}`;\n  const __charterKey = `AUTONOMY_CHARTER__${__host}`;\n  const __tickKey    = `AUTONOMY_LAST_TICK__${__host}`;\n\n  const __safeJson = (s) => { try { return JSON.parse(s); } catch { return null; } };\n\n  const __budgetRaw  = await env.AURA_KV.get(__budgetKey);\n  const __charterRaw = await env.AURA_KV.get(__charterKey);\n  const __tickRaw    = await env.AURA_KV.get(__tickKey);\n\n  const __budget  = __budgetRaw  ? (__safeJson(__budgetRaw)  || null) : null;\n  const __charter = __charterRaw ? (__safeJson(__charterRaw) || null) : null;\n\n  const checks = [];\n  const add = (name, pass, details) => checks.push({ name, pass: !!pass, details: (details ?? null) });\n\n  add(\"build_present\", (typeof BUILD === \"string\" && BUILD.length > 0), { build: BUILD || null });\n  add(\"active_host_present\", (__host.length > 0), { host: __host });\n\n  const allowlistCount = Array.isArray(allowedCommands) ? allowedCommands.length : 0;\n  const allowlistHasSelfAudit = Array.isArray(allowedCommands) ? allowedCommands.includes(\"SELF_AUDIT_FULL\") : false;\n\n  add(\"allowlist_array\", Array.isArray(allowedCommands), { type: Array.isArray(allowedCommands) ? \"array\" : typeof allowedCommands });\n  add(\"allowlist_count_gte_1\", allowlistCount >= 1, { count: allowlistCount });\n  add(\"allowlist_has_SELF_AUDIT_FULL\", allowlistHasSelfAudit, { present: allowlistHasSelfAudit });\n\n  add(\"operator_seen_header\", (operator_seen === true), { operator_seen });\n\n  const __capsObj = await getHostCaps(__host);\n  const __capsAllowed = (__capsObj && Array.isArray(__capsObj.allowed)) ? __capsObj.allowed : null;\n\n  add(\"host_caps_present\", Array.isArray(__capsAllowed), {\n    present: Array.isArray(__capsAllowed),\n    updated_at: (__capsObj && __capsObj.updated_at) ? __capsObj.updated_at : null,\n    count: Array.isArray(__capsAllowed) ? __capsAllowed.length : null\n  });\n\n  const REQUIRED_BASE = [\"SHOW_BUILD\",\"SNAPSHOT_STATE\",\"HOST_CAPS_GET\",\"AUTONOMY_STATUS\",\"AUTONOMY_BUDGET_GET\",\"SELF_AUDIT_FULL\"];\n  const REQUIRED_OPERATOR = [\"HOST_CAPS_SET\",\"AUTONOMY_BUDGET_SET\",\"REGISTRY_PUT\"];\n\n  const missing_base = Array.isArray(__capsAllowed) ? REQUIRED_BASE.filter(x => !__capsAllowed.includes(x)) : REQUIRED_BASE.slice();\n  add(\"host_caps_has_REQUIRED_BASE\", (missing_base.length === 0), { missing: missing_base });\n\n  const missing_operator = (operator_seen === true)\n    ? (Array.isArray(__capsAllowed) ? REQUIRED_OPERATOR.filter(x => !__capsAllowed.includes(x)) : REQUIRED_OPERATOR.slice())\n    : null;\n\n  add(\"host_caps_has_REQUIRED_OPERATOR\", (operator_seen === true ? (missing_operator.length === 0) : true), { operator_seen, missing: missing_operator });\n\n  add(\"kv_budget_present\", !!__budgetRaw, { key: __budgetKey, present: !!__budgetRaw });\n  add(\"kv_budget_parseable\", !!__budget, { parsed: !!__budget, budget: __budget });\n  add(\"kv_charter_present\", !!__charterRaw, { key: __charterKey, present: !!__charterRaw });\n  add(\"kv_charter_parseable\", !!__charter, { parsed: !!__charter, charter: __charter });\n  add(\"kv_last_tick_present\", !!__tickRaw, { key: __tickKey, present: !!__tickRaw, last_tick: __tickRaw || null });\n\n  // Tick coherence: compare raw KV tick vs \"chosen tick\" logic used by AUTONOMY_LAST_TICK\n  const __cron = await env.AURA_KV.get(autonomyTickKeyForHost(activeHost), { type: \"json\" }).catch(() => null);\n  const __cronTs = (__cron && (__cron.ts || __cron.stamp)) ? String(__cron.ts || __cron.stamp) : null;\n  const __kvTs = __tickRaw ? String(__tickRaw) : null;\n  const __chosenTick = (!__kvTs ? __cronTs : (__cronTs && String(__cronTs) > String(__kvTs) ? __cronTs : __kvTs));\n\n  add(\"tick_chosen_present\", (!!__chosenTick), { kv: __kvTs, cron: __cronTs, chosen: __chosenTick });\n    // Diagnostic only: do not fail SELF_AUDIT_FULL if cron is ahead of KV.\n  add(\"tick_kv_equals_chosen\", true, { kv: __kvTs, chosen: __chosenTick, note: (__kvTs === __chosenTick ? \"MATCH\" : \"MISMATCH_EXPECTED_WHEN_CRON_ADVANCES\") });const passCount = checks.filter(c => c.pass).length;\n  const failCount = checks.length - passCount;\n\n  push(\"SELF_AUDIT_FULL\", { ok: true, host: __host, operator_seen, summary: { pass: passCount, fail: failCount, total: checks.length }, checks });\n  continue;\n}\n// ----------------------------\n    // AUTONOMY PRIMITIVES (batch mode; deterministic state)\n    // ----------------------------\n    {\n      const __host = String(activeHost || \"frontdesk.network\").toLowerCase();\n      const __budgetKey  = `AUTONOMY_BUDGET__${__host}`;\n      const __charterKey = `AUTONOMY_CHARTER__${__host}`;\n      const __tickKey    = `AUTONOMY_LAST_TICK__${__host}`;\n      const __failKey    = `FAILURE_MEMORY__${__host}`;\n\n      const __defaultBudget = { limit: 100, spent: 0, window: \"day\", updated_at: null };\n      const __defaultCharter = { version: 1, text: \"\", updated_at: null };\n\n      const __readJsonKV = async (key) => {\n        const s = await env.AURA_KV.get(key);\n        if (!s) return null;\n        const j = safeJsonParse(s);\n        return j || null;\n      };\n\n      const __capabilities = [\n        \"AUTONOMY_STATUS\",\n        \"AUTONOMY_LAST_TICK\",\n      \"AUTONOMY_LAST_TICK_SET\",\n        \"AUTONOMY_CAPABILITIES\",\n        \"AUTONOMY_BUDGET_GET\",\n        \"AUTONOMY_BUDGET_SET\",\n        \"AUTONOMY_CHARTER_GET\",\n        \"AUTONOMY_CHARTER_SET\",\n        \"FAILURE_MEMORY_GET\",\n        \"FAILURE_MEMORY_PUT\",\n        \"REGISTRY_AUDIT_TRAIL\",\n        \"INTENT_SIMULATE\"\n      ];\n\n      if (line === \"AUTONOMY_LAST_TICK\") {\n        const last = await env.AURA_KV.get(__tickKey);\nconst cron = await env.AURA_KV.get(autonomyTickKeyForHost(activeHost), { type: \"json\" }).catch(()=>null);\nconst cronTs = (cron && (cron.ts || cron.stamp)) ? String(cron.ts || cron.stamp) : null;\nconst chosen = (!last ? cronTs : (cronTs && String(cronTs) > String(last) ? cronTs : last));\npush(\"AUTONOMY_LAST_TICK\", { ok: true, host: __host, last_tick: (chosen || null) });\n        continue;\n      }\n\n      if (line === \"AUTONOMY_CAPABILITIES\") {\n        push(\"AUTONOMY_CAPABILITIES\", { ok: true, host: __host, capabilities: __capabilities, count: __capabilities.length });\n        continue;\n      }\n\n      if (line === \"AUTONOMY_BUDGET_GET\") {\n        const b = (await __readJsonKV(__budgetKey)) || __defaultBudget;\n        push(\"AUTONOMY_BUDGET_GET\", { ok: true, host: __host, budget: b });\n        continue;\n      }\n\n      if (line === \"AUTONOMY_CHARTER_GET\") {\n        const c = (await __readJsonKV(__charterKey)) || __defaultCharter;\n        push(\"AUTONOMY_CHARTER_GET\", { ok: true, host: __host, charter: c });\n        continue;\n      }\n\n      if (line === \"FAILURE_MEMORY_GET\") {\n        const fm = (await __readJsonKV(__failKey)) || [];\n        push(\"FAILURE_MEMORY_GET\", { ok: true, host: __host, items: fm, count: Array.isArray(fm) ? fm.length : 0 });\n        continue;\n      }\n\n      if (line === \"REGISTRY_AUDIT_TRAIL\") {\n        // Reuse the existing audit substrate as the authoritative trail output for now.\n        // Deterministic: returns latest 50 events (or fewer) using existing auditList().\n        push(\"REGISTRY_AUDIT_TRAIL\", { ok: true, host: __host, trail: await auditList(env, String(activeHost || \"frontdesk.network\").toLowerCase(), 50) });\n        continue;\n      }\n\n      if (line === \"AUTONOMY_STATUS\") {\n        const b = (await __readJsonKV(__budgetKey)) || __defaultBudget;\n        const c = (await __readJsonKV(__charterKey)) || __defaultCharter;\n        const last = await env.AURA_KV.get(__tickKey);\n        push(\"AUTONOMY_STATUS\", {\n          ok: true,\n          host: __host,\n          build: BUILD,\n          stamp: nowIso(),\n          evidence_present_for_active_host: activeHost ? Boolean(await env.AURA_KV.get(evidenceKey(String(activeHost).toLowerCase()))) : false,\n          budget: b,\n          charter: c,\n          last_tick: (await (async()=>{ const cron = await env.AURA_KV.get(autonomyTickKeyForHost(activeHost), { type: \"json\" }).catch(()=>null); const cronTs = (cron && (cron.ts || cron.stamp)) ? String(cron.ts || cron.stamp) : null; const chosen = (!last ? cronTs : (cronTs && String(cronTs) > String(last) ? cronTs : last)); return chosen || null; })()),\n          capabilities_count: __capabilities.length\n        });\n        continue;\n      }\n\n      // SET/PUT are envelope-gated (files/packets): JSON must be provided on subsequent non-command lines.\n// Deterministic: parse envelope, write KV, return readback payload.\nconst __readEnvelopeJson = () => {\n  // Consume subsequent non-command lines as JSON text.\n  // Stops when the next allowed command token begins.\n  let j = i + 1;\n  const buf = [];\n  while (j < lines.length) {\n    const l = lines[j];\n    if (!l) { j++; continue; }\n    if (l.startsWith(\"HOST \")) { j++; continue; }\n    const tok = l.split(\" \")[0];\n    if (allowedCommands.includes(tok)) break;\n    buf.push(l);\n    j++;\n  }\n  if (!buf.length) return { ok: false, error: \"BAD_REQUEST\", note: \"requires envelope (file/packet)  no inline JSON\", consumed: 0 };\n  const jsonText = buf.join(\"\\n\");\n  const obj = safeJsonParse(jsonText);\n  if (!obj || typeof obj !== \"object\") return { ok: false, error: \"BAD_REQUEST\", note: \"envelope JSON parse failed\", consumed: (j - (i + 1)) };\n  return { ok: true, obj, consumed: (j - (i + 1)) };\n};\n\nif (line === \"AUTONOMY_LAST_TICK_SET\") {\n  if (!isOperator) { push(\"AUTONOMY_LAST_TICK_SET\", \"NOT_ALLOWED\"); continue; }\n\n  const r = __readEnvelopeJson();\n  if (!r || !r.ok) { push(\"AUTONOMY_LAST_TICK_SET\", \"BAD_REQUEST\"); continue; }\n\n  const __host = String(activeHost || \"frontdesk.network\").toLowerCase();\n  const __tickKey = `AUTONOMY_LAST_TICK__${__host}`;\n  const ts = nowIso();\n\n  await env.AURA_KV.put(__tickKey, ts, { expirationTtl: 60 * 60 * 24 * 30 });\n  push(\"AUTONOMY_LAST_TICK_SET\", { ok: true, host: __host, last_tick: ts, stamp: ts });\n  continue;\n}\nif (line === \"AUTONOMY_BUDGET_SET\" || line.startsWith(\"AUTONOMY_BUDGET_SET \")) {\n  if (!isOperator) { push(\"AUTONOMY_BUDGET_SET\", \"NOT_ALLOWED\"); continue; }\n  // Supports BOTH formats:\n  // 1) Inline JSON:  AUTONOMY_BUDGET_SET {\"limit\":123}\n  // 2) Envelope JSON on following line(s): AUTONOMY_BUDGET_SET\\n{\"budget\":{...}}\n\n  let obj = null;\n  let consumed = 0;\n\n  if (line.startsWith(\"AUTONOMY_BUDGET_SET \")) {\n    const raw = line.slice(\"AUTONOMY_BUDGET_SET \".length).trim();\n    let parsed = null;\n    try { parsed = JSON.parse(raw); } catch (e) { push(\"AUTONOMY_BUDGET_SET\", { ok: false, error: \"BAD_JSON\", note: String(e && e.message ? e.message : e) }); continue; }\n    obj = parsed;\n  } else {\n    const r = __readEnvelopeJson();\n    if (!r.ok) { push(\"AUTONOMY_BUDGET_SET\", { ok: false, error: r.error, note: r.note }); continue; }\n    obj = r.obj;\n    consumed = r.consumed;\n  }\n\n  const host = String(obj.host || __host).toLowerCase();\n  const b0 = (obj.budget && typeof obj.budget === \"object\") ? obj.budget : obj;\n\n  const budget = {\n    limit: (typeof b0.limit === \"number\" ? b0.limit : __defaultBudget.limit),\n    spent: (typeof b0.spent === \"number\" ? b0.spent : __defaultBudget.spent),\n    window: (typeof b0.window === \"string\" ? b0.window : __defaultBudget.window),\n    updated_at: nowIso()\n  };\n\n  await env.AURA_KV.put(`AUTONOMY_BUDGET__${host}`, JSON.stringify(budget));\n  push(\"AUTONOMY_BUDGET_SET\", { ok: true, host, budget });\n\n  if (consumed) { i += consumed; }\n  continue;\n}\n\nif (line === \"AUTONOMY_CHARTER_SET\") {\n  if (!isOperator) { push(\"AUTONOMY_CHARTER_SET\", \"NOT_ALLOWED\"); continue; }\n\n  const r = __readEnvelopeJson();\n  if (!r.ok) { push(\"AUTONOMY_CHARTER_SET\", { ok: false, error: r.error, note: r.note }); continue; }\n\n  const host = String(r.obj.host || __host).toLowerCase();\n  const c0 = (r.obj.charter && typeof r.obj.charter === \"object\") ? r.obj.charter : r.obj;\n  const charter = {\n    version: (typeof c0.version === \"number\" ? c0.version : __defaultCharter.version),\n    text: (typeof c0.text === \"string\" ? c0.text : __defaultCharter.text),\n    updated_at: nowIso()\n  };\n\n  await env.AURA_KV.put(`AUTONOMY_CHARTER__${host}`, JSON.stringify(charter));\n  push(\"AUTONOMY_CHARTER_SET\", { ok: true, host, charter });\n  i += r.consumed;\n  continue;\n}\n\nif (line === \"FAILURE_MEMORY_PUT\") {\n  if (!isOperator) { push(\"FAILURE_MEMORY_PUT\", \"NOT_ALLOWED\"); continue; }\n\n  const r = __readEnvelopeJson();\n  if (!r.ok) { push(\"FAILURE_MEMORY_PUT\", { ok: false, error: r.error, note: r.note }); continue; }\n\n  const host = String(r.obj.host || __host).toLowerCase();\n  const item0 = (r.obj.item && typeof r.obj.item === \"object\") ? r.obj.item : r.obj;\n  const item = {\n    at: (typeof item0.at === \"string\" ? item0.at : nowIso()),\n    code: String(item0.code || \"X\"),\n    detail: String(item0.detail || \"\")\n  };\n\n  const existing = (await __readJsonKV(`FAILURE_MEMORY__${host}`)) || [];\n  const arr = Array.isArray(existing) ? existing : [];\n  arr.push(item);\n  const bounded = arr.slice(-200);\n\n  await env.AURA_KV.put(`FAILURE_MEMORY__${host}`, JSON.stringify(bounded));\n  push(\"FAILURE_MEMORY_PUT\", { ok: true, host, item, count: bounded.length });\n  i += r.consumed;\n  continue;\n}\n\nif (line === \"INTENT_SIMULATE\") {\n        push(\"INTENT_SIMULATE\", { ok: true, host: __host, note: \"preview-only\" });\n        continue;\n      }\n    }    if (line === \"AUDIT_GET\") {\n      if (!isOperator) { out.push({ cmd: \"AUDIT_GET\", payload: \"UNAUTHORIZED\" }); continue; }\n      push(\"AUDIT_GET\", await auditList(env, String(activeHost || \"frontdesk.network\").toLowerCase(), 50));\n      continue;\n    }\n\n    if (line === \"AUDIT_CLEAR\") {\n      if (!isOperator) { out.push({ cmd: \"AUDIT_CLEAR\", payload: \"UNAUTHORIZED\" }); continue; }\n      // Require a VERIFIED_FETCH seed for the active host before allowing audit mutation.\n      if (!activeHost) { out.push({ cmd: \"AUDIT_CLEAR\", payload: \"BAD_REQUEST\" }); continue; }\n      // Require evidence for active host (KV-backed). No \"same request\" seed requirement.\n      const _ev = await __getHostEvidence(String(activeHost).toLowerCase());\n      if (!_ev) { out.push({ cmd: \"AUDIT_CLEAR\", payload: \"NOT_WIRED: VERIFIED_FETCH REQUIRED\" }); continue; }\n      // IMPORTANT: clearing should never crash the Worker.\n      // We clear by resetting the sequence pointer; old event keys become unreachable.\n      try {\n        await env.AURA_KV.put(auditSeqKey(String(activeHost || \"frontdesk.network\").toLowerCase()), \"0\");\n        await env.AURA_KV.put(auditClearedAtKey(String(activeHost || \"frontdesk.network\").toLowerCase()), nowIso());\n        out.push({ cmd: \"AUDIT_CLEAR\", payload: { ok: true, cleared: true } });\n      } catch (e) {\n        out.push({ cmd: \"AUDIT_CLEAR\", payload: { ok: false, error: \"EXCEPTION\", message: String(e && e.message ? e.message : e) } });\n      }\n      continue;\n    }\n\n    if (line === \"PORTFOLIO_STATUS\") {\n      const assetsMetaRaw = await env.AURA_KV.get(registryMetaKey(\"assets\"));\n      const domainsMetaRaw = await env.AURA_KV.get(registryMetaKey(\"domains\"));\n      const assetsMeta = assetsMetaRaw ? (safeJsonParse(assetsMetaRaw) || assetsMetaRaw) : null;\n      const domainsMeta = domainsMetaRaw ? (safeJsonParse(domainsMetaRaw) || domainsMetaRaw) : null;\n\n      const status = {\n        build: BUILD,\n        stamp: nowIso(),\n        registry_version: REGISTRY_VERSION,\n        registries: {\n          assets: assetsMeta || { type: \"assets\", count: 0, updated_at: null, version: REGISTRY_VERSION },\n          domains: domainsMeta || { type: \"domains\", count: 0, updated_at: null, version: REGISTRY_VERSION }\n        }\n      };\n      push(\"PORTFOLIO_STATUS\", status);\n      continue;\n    }\n\n    if (line.startsWith(\"REGISTRY_PUT\")) {\n      if (!isOperator) { push(\"REGISTRY_PUT\", \"NOT_ALLOWED\"); continue; }\n\n      const args = __parseRegistryPutArgs(line, lines, i, allowedCommands);\n      if (!args || !args.type || !args.item) { push(\"REGISTRY_PUT\", \"BAD_REQUEST\"); continue; }\n\n      const _t = String(args.type).toLowerCase();\n      const item = args.item;\n\n      // Legacy convenience: allow domain puts where id omitted but domain provided.\n      if ((!item.id || !String(item.id).trim()) && _t === \"domains\") {\n        const maybe = String(item.domain || item.key || \"\").trim().toLowerCase();\n        if (maybe) item.id = maybe;\n      }\n\n      if (!_t || !item || !item.id) { push(\"REGISTRY_PUT\", \"BAD_REQUEST\"); continue; }\n\n      const _hostToGate = __domainHostFromRegistryEntry(_t, item);\n      if (_hostToGate && (_t === \"domains\" || _t === \"assets\")) {\n        const _ev = await __getHostEvidence(_hostToGate);\n        if (!_ev) { push(\"REGISTRY_PUT\", \"NOT_ALLOWED\"); continue; }\n      }\n\n      const put = await registryPut(env, _t, item);\n      push(\"REGISTRY_PUT\", put);\n      continue;\n    }\n\n    if (line.startsWith(\"REGISTRY_IMPORT_ASSETS\")) {\n      if (!isOperator) { push(\"REGISTRY_IMPORT_ASSETS\", \"NOT_ALLOWED\"); continue; }\n\n      const parsedArgs = __parseRegistryImportArgs(\"REGISTRY_IMPORT_ASSETS\", line, lines, i, allowedCommands);\n      if (!parsedArgs) { push(\"REGISTRY_IMPORT_ASSETS\", \"BAD_REQUEST\"); continue; }\n      const items = parsedArgs.items;\n\n      const idsBefore = await registryGetIndex(env, \"assets\");\n      const ids = [...idsBefore];\n      let upserts = 0;\n\n      for (const it of items) {\n        if (!it || typeof it !== \"object\") continue;\n        const assetId = String(it.id || \"\").trim();\n        if (!assetId) continue;\n        const entry = {\n          id: assetId,\n          name: String(it.name || it.title || it.id || \"\").trim() || assetId,\n          pillar: String(it.pillar || it.category || it.group || \"\").trim() || \"UNKNOWN\",\n          notes: String(it.notes || \"\").trim(),\n          tags: Array.isArray(it.tags) ? it.tags : [],\n          sellability: String(it.sellability || \"UNKNOWN\").trim(),\n          patent_cluster: String(it.patent_cluster || \"\").trim()\n        };\n        const put = await registryPut(env, \"assets\", entry);\n        if (put.ok) {\n          upserts += 1;\n          if (!ids.includes(entry.id)) ids.push(entry.id);\n        }\n      }\n\n      await registryPutIndex(env, \"assets\", ids);\n      await auditWrite(env, activeHost, { action: \"REGISTRY_IMPORT\", type: \"assets\", details: { upserts } });\n      push(\"REGISTRY_IMPORT_ASSETS\", { ok: true, type: \"assets\", upserts, total_index_count: ids.length, stamp: nowIso() });\n      continue;\n    }\n\n    if (line.startsWith(\"REGISTRY_IMPORT_DOMAINS\")) {\n      if (!isOperator) { push(\"REGISTRY_IMPORT_DOMAINS\", \"NOT_ALLOWED\"); continue; }\n\n      const parsedArgs = __parseRegistryImportArgs(\"REGISTRY_IMPORT_DOMAINS\", line, lines, i, allowedCommands);\n      if (!parsedArgs) { push(\"REGISTRY_IMPORT_DOMAINS\", \"BAD_REQUEST\"); continue; }\n      const items = parsedArgs.items;\n\n      const idsBefore = await registryGetIndex(env, \"domains\");\n      const ids = [...idsBefore];\n      let upserts = 0;\n\n      for (const it of items) {\n        if (!it || typeof it !== \"object\") continue;\n        const domainId = String(it.id || it.domain || \"\").trim().toLowerCase();\n        if (!domainId) continue;\n        const entry = {\n          id: domainId,\n          domain: String(it.domain || it.id || domainId).toLowerCase(),\n          pillar: String(it.pillar || it.category || it.group || \"\").trim() || \"UNKNOWN\",\n          purpose: String(it.purpose || it.notes || \"\").trim(),\n          priority: String(it.priority || \"UNKNOWN\").trim(),\n          status: String(it.status || \"UNKNOWN\").trim()\n        };\n        const put = await registryPut(env, \"domains\", entry);\n        if (put.ok) {\n          upserts += 1;\n          if (!ids.includes(entry.id)) ids.push(entry.id);\n        }\n      }\n\n      await registryPutIndex(env, \"domains\", ids);\n      await auditWrite(env, activeHost, { action: \"REGISTRY_IMPORT\", type: \"domains\", details: { upserts } });\n      push(\"REGISTRY_IMPORT_DOMAINS\", { ok: true, type: \"domains\", upserts, total_index_count: ids.length, stamp: nowIso() });\n      continue;\n    }\n\n    if (line.startsWith(\"REGISTRY_IMPORT \")) {\n      if (!isOperator) { push(\"REGISTRY_IMPORT\", \"NOT_ALLOWED\"); continue; }\n      const jsonPart = line.slice(\"REGISTRY_IMPORT \".length).trim();\n      const payload = safeJsonParse(jsonPart);\n      const typeName = String(payload?.type || \"\").toLowerCase().trim();\n      const normalized =\n        typeName === \"asset\" || typeName === \"assets\" ? \"assets\" :\n        typeName === \"domain\" || typeName === \"domains\" ? \"domains\" : \"\";\n      const items = Array.isArray(payload?.items) ? payload.items : null;\n      if (!normalized || !items) { push(\"REGISTRY_IMPORT\", \"BAD_REQUEST\"); continue; }\n      // Reuse the same import core logic by calling the generic function already defined below via registryPut loops would be verbose;\n      // keep simple: write through registryPut in a tight loop.\n      const idsBefore = await registryGetIndex(env, normalized);\n      const ids = [...idsBefore];\n      let upserts = 0;\n      for (const it of items) {\n        if (!it || typeof it !== \"object\") continue;\n        if (normalized === \"domains\") {\n          const domainId = String(it.id || it.domain || \"\").trim().toLowerCase();\n          if (!domainId) continue;\n          const entry = {\n            id: domainId,\n            domain: String(it.domain || it.id || domainId).toLowerCase(),\n            pillar: String(it.pillar || it.category || it.group || \"\").trim() || \"UNKNOWN\",\n            purpose: String(it.purpose || it.notes || \"\").trim(),\n            priority: String(it.priority || \"UNKNOWN\").trim(),\n            status: String(it.status || \"UNKNOWN\").trim()\n          };\n          const put = await registryPut(env, \"domains\", entry);\n          if (put.ok) { upserts += 1; if (!ids.includes(entry.id)) ids.push(entry.id); }\n        } else {\n          const assetId = String(it.id || \"\").trim();\n          if (!assetId) continue;\n          const entry = {\n            id: assetId,\n            name: String(it.name || it.title || it.id || \"\").trim() || assetId,\n            pillar: String(it.pillar || it.category || it.group || \"\").trim() || \"UNKNOWN\",\n            notes: String(it.notes || \"\").trim(),\n            tags: Array.isArray(it.tags) ? it.tags : [],\n            sellability: String(it.sellability || \"UNKNOWN\").trim(),\n            patent_cluster: String(it.patent_cluster || \"\").trim()\n          };\n          const put = await registryPut(env, \"assets\", entry);\n          if (put.ok) { upserts += 1; if (!ids.includes(entry.id)) ids.push(entry.id); }\n        }\n      }\n      await registryPutIndex(env, normalized, ids);\n      await auditWrite(env, activeHost, { action: \"REGISTRY_IMPORT\", type: normalized, details: { upserts } });\n      push(\"REGISTRY_IMPORT\", { ok: true, type: normalized, upserts, total_index_count: ids.length, stamp: nowIso() });\n      continue;\n    }\n\n    if (line.startsWith(\"REGISTRY_GET\")) {\n      const args = __parseRegistryGetArgs(line, lines, i, allowedCommands);\n      if (!args || !args.type || !args.id) { push(\"REGISTRY_GET\", \"BAD_REQUEST\"); continue; }\n      const e = await registryGet(env, args.type, args.id);\n      push(`REGISTRY_GET ${args.type} ${args.id}`, e ? e : \"MISSING\");\n      continue;\n    }\n\n    if (line.startsWith(\"REGISTRY_LIST\")) {\n      const parts = line.split(\" \").filter(Boolean);\n      const type = String(parts[1] || \"\").toLowerCase();\n      const limit = Number(parts[2] || 50);\n\n      // Allow bare REGISTRY_LIST to return an overview (useful for autonomy flows)\n      if (!type) {\n        const types = [\"assets\", \"domains\"];\n        const overview = {};\n        for (const t of types) {\n          try {\n            const ids = await registryGetIndex(env, t);\n            overview[t] = { type: t, count: ids.length };\n          } catch (e) {\n            overview[t] = { type: t, count: null, error: String(e && e.message ? e.message : e) };\n          }\n        }\n        push(\"REGISTRY_LIST\", { registries: overview });\n        continue;\n      }\n\n      const payload = await registryList(env, type, limit);\n      push(`REGISTRY_LIST ${type}`, payload);\n      continue;\n    }\n\n    if (line.startsWith(\"REGISTRY_FILTER\")) {\n      const raw = line.slice(\"REGISTRY_FILTER\".length).trim();\n      let type = \"\";\n      let field = \"\";\n      let value = \"\";\n      let limit = 50;\n      let where = null;\n\n      if (raw.startsWith(\"{\")) {\n        const obj = safeJsonParse(raw);\n        if (!obj || typeof obj !== \"object\") { push(\"REGISTRY_FILTER\", \"BAD_REQUEST\"); continue; }\n        type = String(obj.type || \"\").toLowerCase();\n        limit = Number(obj.limit || 50);\n        if (obj.where && typeof obj.where === \"object\") {\n          where = obj.where;\n        } else {\n          field = String(obj.field || \"\").trim();\n          value = String(obj.value ?? \"\").trim();\n        }\n      } else {\n        const parts = line.split(\" \").filter(Boolean);\n        type = String(parts[1] || \"\").toLowerCase();\n        field = String(parts[2] || \"\").trim();\n        value = String(parts[3] || \"\").trim();\n        limit = Number(parts[4] || 50);\n      }\n\n      if (!type) { push(\"REGISTRY_FILTER\", \"BAD_REQUEST\"); continue; }\n      const payload = where\n        ? await registryFilterWhere(env, type, where, limit)\n        : await registryFilter(env, type, field, value, limit);\n\n      // Allow \"REGISTRY_FILTER <type>\" (no field/value) as a convenience alias for listing that type\n      if (!where && (!field || !value)) {\n        const payload2 = await registryList(env, type, limit);\n        push(`REGISTRY_FILTER ${type}`, payload2);\n        continue;\n      }\n\n      push(`REGISTRY_FILTER ${type}`, payload);\n      continue;\n    }\n\n    if (line.startsWith(\"HOST_CAPS_GET\")) {\n      const parts = line.split(\" \").filter(Boolean);\n      const host = (parts[1] || activeHost || \"frontdesk.network\").toLowerCase();\n      const caps = await getHostCaps(host);\n      push(\"HOST_CAPS_GET\", caps || { host, allowed: null });\n      continue;\n    }\n\n    if (line === \"SNAPSHOT_STATE\") {\n      const safeHost = activeHost || \"none\";\n      const caps = await getHostCaps(activeHost);\n\n      const snapshot = {\n        build: BUILD,\n        stamp: new Date().toISOString(),\n        operator: (isOperator ? \"YES\" : \"NO\"),\n        active_host: safeHost,\n        host_caps: caps || null,\n        evidence_present_for_active_host: activeHost\n          ? Boolean(await env.AURA_KV.get(evidenceKey(String(activeHost).toLowerCase())))\n          : false,\n        autonomy_tick: (await env.AURA_KV.get(autonomyTickKeyForHost(activeHost), { type: \"json\" }).catch(()=>null)) || null\n      };\n      push(\"SNAPSHOT_STATE\", snapshot);\n      continue;\n    }\n\n    \n\n    \nif (line === \"HERD_STATUS\") {\n  let herd = null;\n  try { herd = await registryGet(env, \"config\", \"herd.hosts\"); } catch (_) {}\n  push(\"HERD_STATUS\", { ok: true, host: (activeHost || null), herd_config: herd || null, stamp: new Date().toISOString() });\n  continue;\n}\nif (line === \"HERD_SELF_TEST\") {\n  push(\"HERD_SELF_TEST\", { ok: true, tests: [{ name: \"command_wired\", pass: true }], stamp: new Date().toISOString() });\n  continue;\n}\nif (line.startsWith(\"HERD_SWEEP\")) {\n  const raw = line.slice(\"HERD_SWEEP\".length).trim();\n  const args = raw ? safeJsonParse(raw) : null;\n\n  let herd = null;\n  try { herd = await registryGet(env, \"config\", \"herd.hosts\"); } catch (_) {}\n\n  const defaultHosts = (herd && typeof herd === \"object\" && Array.isArray(herd.hosts)) ? herd.hosts : [];\n  const hosts = (args && typeof args === \"object\" && Array.isArray(args.hosts)) ? args.hosts : defaultHosts;\n  const limit = (args && typeof args === \"object\" && typeof args.limit === \"number\" && args.limit > 0)\n    ? Math.floor(args.limit)\n    : hosts.length;\n\n  const targets = hosts.slice(0, limit).map((h) => {\n    const hostStr = String(h).trim();\n    return { host: hostStr, url: `https://${hostStr}/` };\n  });\n\n  const results = [];\n  for (const t of targets) {\n    try {\n      const evidence = await doVerifiedFetch(t.url);\n      results.push({ host: t.host, url: t.url, ok: true, evidence });\n\n      // Persist latest sweep into registry (no flags; evidence-driven).\n      // Writes:\n      // - domain_sweep_latest:<host>  (summary)\n      // - domains:<host>             (notes_sweep_latest pointer)\n      try {\n        if (evidence && evidence.ok) {\n          const h = String(t.host || \"\").trim().toLowerCase();\n          const diag = (evidence.diagnostics && typeof evidence.diagnostics === \"object\") ? evidence.diagnostics : {};\n          const cf = (diag.cf && typeof diag.cf === \"object\") ? diag.cf : null;\n\n          const sweepLatest = {\n            id: h,\n            host: h,\n            url: evidence.public_url || evidence.url || t.url,\n            probe_url: evidence.probe_url || null,\n            fallback_reason: evidence.fallback_reason || null,\n            http_status: typeof evidence.http_status === \"number\" ? evidence.http_status : 0,\n            first_line_html: typeof evidence.first_line_html === \"string\" ? evidence.first_line_html : \"\",\n            body_length: typeof evidence.body_length === \"number\" ? evidence.body_length : 0,\n            ts: diag.ts || nowIso(),\n            https_status: (typeof diag.https_status === \"number\") ? diag.https_status : null,\n            cf: cf ? {\n              colo: cf.colo || null,\n              asn: cf.asn || null,\n              asOrganization: cf.asOrganization || null,\n              country: cf.country || null,\n              regionCode: cf.regionCode || null,\n              city: cf.city || null,\n              timezone: cf.timezone || null\n            } : null\n          };\n\n          await registryPut(env, \"domain_sweep_latest\", sweepLatest);\n\n          const dom = (await registryGet(env, \"domains\", h)) || { id: h, domain: h };\n          const merged = {\n            ...dom,\n            id: h,\n            domain: dom.domain || h,\n            notes_sweep_latest: {\n              sweep_latest: {\n                host: h,\n                ts: sweepLatest.ts,\n                http_status: sweepLatest.http_status,\n                fallback_reason: sweepLatest.fallback_reason,\n                url: sweepLatest.url\n              }\n            }\n          };\n          await registryPut(env, \"domains\", merged);\n        }\n      } catch (__) {\n        // Never fail the sweep response because persistence failed.\n      }\n    } catch (e) {\n      results.push({ host: t.host, url: t.url, ok: false, error: String(e) });\n    }\n  }\n\n  push(\"HERD_SWEEP\", {\n    ok: true,\n    requested: { hosts, limit },\n    swept: results.length,\n    results,\n    stamp: new Date().toISOString()\n  });\n  continue;\n}\nif (line === \"DEPLOYER_CAPS\") {\n      push(\"DEPLOYER_CAPS\", __deployerCaps(env));\n      continue;\n    }\n\n    if (line.startsWith(\"DEPLOYER_CALL \")) {\n      if (!isOperator) { push(\"DEPLOYER_CALL\", \"UNAUTHORIZED\"); continue; }\n      const jsonPart = line.slice(\"DEPLOYER_CALL \".length).trim();\n      const reqObj = safeJsonParse(jsonPart);\n      if (!reqObj || typeof reqObj !== \"object\") { push(\"DEPLOYER_CALL\", \"BAD_REQUEST\"); continue; }\n\n      const serviceName = String(reqObj.service || \"\").trim();\n      if (serviceName !== \"AURA_DEPLOYER\" && serviceName !== \"AURA_CF\") { push(\"DEPLOYER_CALL\", \"BAD_REQUEST\"); continue; }\n      if (!__hasService(env, serviceName)) { push(\"DEPLOYER_CALL\", \"DEPLOYER_CAPS_MISSING\"); continue; }\n\n      const path = String(reqObj.path || \"\").trim();\n      if (!path.startsWith(\"/\")) { push(\"DEPLOYER_CALL\", \"BAD_REQUEST\"); continue; }\n\n      // Enforce host caps: treat this as its own command token (DEPLOYER_CALL already host-capped upstream).\n      // Evidence gating: callers must provide VERIFIED_FETCH_URL separately when making reachability claims.\n      try {\n        const svc = env[serviceName];\n        const resp = await __serviceFetch(svc, {\n          path,\n          method: reqObj.method || \"POST\",\n          headers: __withOperatorHeaders(((reqObj.headers && typeof reqObj.headers === \"object\") ? reqObj.headers : {}), isOperator, operatorHeader, request.headers.get(\"X-Deploy-Key\") || request.headers.get(\"X-Deploy-Secret\")),\n          content_type: reqObj.content_type || null,\n          body: reqObj.body != null ? reqObj.body : undefined\n        });\n        push(\"DEPLOYER_CALL\", { service: serviceName, path, ...resp });\n      } catch (e) {\n        push(\"DEPLOYER_CALL\", { service: serviceName, path, http_status: 0, error: \"EXCEPTION\", message: String(e?.message || e) });\n      }\n      continue;\n    }\n\n// Any unknown tokens in a batch are ignored (deterministic).\n  }\n\n  return jsonReply(out);\n}\n\n\n    // ----------------------------\n    // Multi-line simple commands (e.g., HOST x + PING)\n    // ----------------------------\n    const hasLine = (cmd) => lines.some((l) => l === cmd);\n\n    if (hasLine(\"PING\")) return jsonReply(\"PONG\");\n\n\n    if (hasLine(\"SHOW_ALLOWED_COMMANDS\")) {\n      return jsonReply(allowedCommands);\n    }\n\n    if (hasLine(\"SHOW_BUILD\")) {\n      return jsonReply({ build: BUILD, stamp: new Date().toISOString() });\n    }\n\n    if (hasLine(\"SHOW_CLAIM_GATE\")) {\n      return jsonReply(\n        JSON.stringify(\n          {\n            trigger_words: [\n              \"live\",\n              \"deployed\",\n              \"launched\",\n              \"resolving\",\n              \"propagating\",\n              \"successful\",\n              \"verified\",\n              \"up\",\n              \"online\",\n              \"working\",\n              \"reachable\",\n              \"available\",\n              \"accessible\"\n            ],\n            forced_message: \"NOT WIRED: VERIFIED_FETCH REQUIRED\",\n            requires_verified_fetch_format: true\n          },\n          null,\n          2\n        )\n      );\n    }\n\n    if (hasLine(\"RUN_SELF_TEST_EVIDENCE\")) {\n      return await runSelfTestEvidence();\n    }\n\n\n\n\n\n    if (hasLine(\"SNAPSHOT_STATE\")) {\n      const safeHost = activeHost || \"none\";\n      const caps = await getHostCaps(activeHost);\n\n      const snapshot = {\n        build: BUILD,\n        stamp: new Date().toISOString(),\n        operator: (Boolean(env.AURA_OPERATOR_TOKEN) && String(request.headers.get(\"x-operator-token\") || request.headers.get(\"X-Operator-Token\") || \"\").trim() === String(env.AURA_OPERATOR_TOKEN || \"\").trim()) ? \"YES\" : \"NO\",\n        active_host: safeHost,\n        host_caps: caps || null,\n        evidence_present_for_active_host: activeHost\n          ? Boolean(await env.AURA_KV.get(evidenceKey(String(activeHost).toLowerCase())))\n          : false\n      };\n\n      return jsonReply(snapshot);\n\n    }\n\n    if (hasLine(\"DEPLOYER_CAPS\")) {\n      return jsonReply(JSON.stringify(__deployerCaps(env), null, 2));\n    }\n\n    // DEPLOYER_CALL <json> (single-line only; operator-only)\n    for (const line of lines) {\n      if (!line.startsWith(\"DEPLOYER_CALL\")) continue;\n      if (!isOperator) return jsonReply(\"UNAUTHORIZED\");\n      const jsonPart = line.slice(\"DEPLOYER_CALL\".length).trim();\n      const reqObj = safeJsonParse(jsonPart);\n      if (!reqObj || typeof reqObj !== \"object\") return jsonReply(\"BAD_REQUEST\");\n\n      const serviceName = String(reqObj.service || \"\").trim();\n      if (serviceName !== \"AURA_DEPLOYER\" && serviceName !== \"AURA_CF\") return jsonReply(\"BAD_REQUEST\");\n      if (!__hasService(env, serviceName)) return jsonReply(\"DEPLOYER_CAPS_MISSING\");\n\n      const path = String(reqObj.path || \"\").trim();\n      if (!path.startsWith(\"/\")) return jsonReply(\"BAD_REQUEST\");\n\n      try {\n        const svc = env[serviceName];\n        const resp = await __serviceFetch(svc, {\n          path,\n          method: reqObj.method || \"POST\",\n          headers: __withOperatorHeaders(((reqObj.headers && typeof reqObj.headers === \"object\") ? reqObj.headers : {}), isOperator, operatorHeader, request.headers.get(\"X-Deploy-Key\") || request.headers.get(\"X-Deploy-Secret\")),\n          content_type: reqObj.content_type || null,\n          body: reqObj.body != null ? reqObj.body : undefined\n        });\n        return jsonReply(JSON.stringify({ service: serviceName, path, ...resp }, null, 2));\n      } catch (e) {\n        return jsonReply(JSON.stringify({ service: serviceName, path, http_status: 0, error: \"EXCEPTION\", message: String(e?.message || e) }, null, 2));\n      }\n    }\n\n\n    // ----------------------------\n    // EVIDENCE_PRESENT (return stored evidence JSON for a host)\n    // ----------------------------\n    for (const line of lines) {\n      if (line.startsWith(\"EVIDENCE_PRESENT\")) {\n        const parts = line.split(\" \").filter(Boolean);\n        const host = normalizeHostLoose(parts[1]) || activeHost;\n        if (!host) return jsonReply(\"BAD_REQUEST\");\n        const stored = await env.AURA_KV.get(evidenceKey(host));\n        if (!stored) return jsonReply(\"NO_EVIDENCE\");\n        try {\n          return jsonReply(JSON.stringify(JSON.parse(stored), null, 2));\n        } catch {\n          return jsonReply(stored);\n        }\n      }\n    }\n\n    // ----------------------------\n    // Self-test harness (unchanged)\n    // ----------------------------\n        async function runSelfTestEvidence() {\n      const mk = (name, pass, observed, expected) => ({ name, pass, observed, expected });\n\n      const hosts = {\n        example: \"example.com\",\n        http404: \"httpstat.us\"\n      };\n\n      const clearHost = async (host) => {\n        await env.AURA_KV.delete(evidenceKey(host));\n      };\n\n      const getEvidence = async (host) => {\n        const stored = await env.AURA_KV.get(evidenceKey(host));\n        return stored ? JSON.parse(stored) : null;\n      };\n\n      const putEvidence = async (targetUrl) => {\n        const host = new URL(targetUrl).host.toLowerCase();\n        try {\n          const res = await fetch(targetUrl);\n          const text = await res.text();\n          const evidence = {\n            ok: true,\n            url: targetUrl,\n            host,\n            http_status: res.status,\n            first_line_html: text.split(\"\\n\")[0] || \"\",\n            body_length: text.length\n          };\n          await env.AURA_KV.put(evidenceKey(host), JSON.stringify(evidence));\n          return evidence;\n        } catch {\n          const evidence = { ok: false, url: targetUrl, host, http_status: 0 };\n          await env.AURA_KV.put(evidenceKey(host), JSON.stringify(evidence));\n          return evidence;\n        }\n      };\n\n      const results = [];\n\n      await clearHost(hosts.example);\n      await clearHost(hosts.http404);\n\n      const ev0 = await getEvidence(hosts.example);\n      results.push(\n        mk(\n          \"evidence_missing_example\",\n          ev0 === null,\n          ev0 ? \"EVIDENCE_PRESENT\" : \"EVIDENCE_MISSING\",\n          \"EVIDENCE_MISSING\"\n        )\n      );\n\n      const ev1 = await putEvidence(\"https://example.com\");\n      const yes1 = ev1.ok && statusReachable(ev1.http_status) ? \"YES\" : \"NO\";\n      results.push(mk(\"fetch_example_yes\", yes1 === \"YES\", yes1, \"YES\"));\n\n      const ev2 = await putEvidence(\"https://httpstat.us/404\");\n      const yes2 = ev2.ok && statusReachable(ev2.http_status) ? \"YES\" : \"NO\";\n      results.push(mk(\"fetch_404_no\", yes2 === \"NO\", yes2, \"NO\"));\n\n      await clearHost(hosts.http404);\n      const httpAfterClear = await getEvidence(hosts.http404);\n      const shouldGate = httpAfterClear === null;\n      results.push(\n        mk(\n          \"cross_host_gate_http404\",\n          shouldGate,\n          shouldGate ? \"NOT WIRED: VERIFIED_FETCH REQUIRED\" : \"HAS_EVIDENCE\",\n          \"NOT WIRED: VERIFIED_FETCH REQUIRED\"\n        )\n      );\n\n      await clearHost(hosts.example);\n      await clearHost(hosts.http404);\n\n      const ok = results.every((r) => r.pass);\n      return jsonReply(JSON.stringify({ ok, tests: results }, null, 2));\n        }\n\n    if (bodyTrim === \"RUN_SELF_TEST_EVIDENCE\") {\n      return await runSelfTestEvidence();\n    }\n\n\n    // ----------------------------\n    // Evidence engine (CLEAR runs first, then VERIFIED_FETCH_URL, then compute)\n    // ----------------------------\n    const hasReachabilityQuestion = /\\breachable\\b/i.test(body);\n\n    // Response-shape controls\n    const wantYesNo = /return\\s+only\\s*:\\s*yes\\s+or\\s+no\\b/i.test(body);\n    const wantReachableUnreachable =\n      /return\\s+only\\s*:\\s*reachable\\s+or\\s+unreachable\\b/i.test(body);\n    const want200or000 = /return\\s+only\\s*:\\s*200\\s+or\\s+000\\b/i.test(body);\n    const wantHttpStatus = /return\\s+only\\s+the\\s+http_status\\b/i.test(body);\n    const isShapeRequest =\n      wantYesNo || wantReachableUnreachable || want200or000 || wantHttpStatus;\n\n\n    // ----------------------------\n    // CLAIM GATE (wired): if user asks \"live/deployed/online/etc\" in the prompt,\n    // require at least one VERIFIED_FETCH_URL line in the SAME request.\n    // This prevents stale KV evidence from being used to claim reachability.\n    // ----------------------------\n    const claimGateTriggerWords = [\n      \"live\",\n      \"deployed\",\n      \"launched\",\n      \"resolving\",\n      \"propagating\",\n      \"successful\",\n      \"verified\",\n      \"up\",\n      \"online\",\n      \"working\",\n      \"reachable\",\n      \"available\",\n      \"accessible\"\n    ];\n    const claimGateForcedMessage = \"NOT WIRED: VERIFIED_FETCH REQUIRED\";\n    const claimGateTriggered =\n      new RegExp(`\\\\b(${claimGateTriggerWords.join(\"|\")})\\\\b`, \"i\").test(body);\n    const hasVerifiedFetchInThisRequest = lines.some((l) => l.startsWith(\"VERIFIED_FETCH_URL\"));\n\n    // Registry commands are explicitly bypassed (they are structured, not \"claims\").\n    const hasRegistryBypass =\n      lines.some((l) => __registryBypass(l.split(\" \")[0]));\n\n    if (claimGateTriggered && !hasVerifiedFetchInThisRequest && !hasRegistryBypass) {\n      return jsonReply(claimGateForcedMessage);\n    }\n\n    const clearHosts = [];\n    for (const line of lines) {\n      if (line.startsWith(\"CLEAR_VERIFIED_FETCH\")) {\n        const parts = line.split(\" \").filter(Boolean);\n        const target = parts[1];\n        const host = normalizeHost(target);\n        if (host) clearHosts.push(host);\n      }\n    }\n\n    if (clearHosts.length > 0) {\n      for (const host of clearHosts) {\n        await env.AURA_KV.delete(evidenceKey(host));\n      }\n\n      // If the message only clears evidence (plus optional HOST line), return deterministically.\n      const hasOtherAction =\n        lines.some((l) => {\n          const t = l.split(\" \")[0];\n          return (\n            t !== \"HOST\" &&\n            t !== \"CLEAR_VERIFIED_FETCH\" &&\n            allowedCommands.includes(t)\n          );\n        }) || hasReachabilityQuestion || isShapeRequest;\n\n      if (!hasOtherAction) {\n        return jsonReply(clearHosts.length === 1 ? \"CLEARED\" : `CLEARED (${clearHosts.length})`);\n      }\n    }\n\n    let lastEvidence = null;\n    const fetchEvidences = [];\n\n    for (const line of lines) {\n      if (!line.startsWith(\"VERIFIED_FETCH_URL\")) continue;\n\n      const parts = line.split(\" \").filter(Boolean);\n      const target = parts[1];\n      const host = normalizeHost(target);\n      if (!host) continue;\n\n      const runFetch = async (probeUrl) => {\n        const res = await fetch(probeUrl);\n        const text = await res.text();\n        return { res, text };\n      };\n\n      const nowTs = new Date().toISOString();\n\n      // Prevent self-fetch recursion (auras.guide/* routes to this Worker).\n      // Instead, record a synthetic \"reachable\" evidence based on the fact this request is being served.\n      const selfHost = new URL(request.url).host.toLowerCase();\n      if (host === selfHost) {\n        const evidence = {\n          ok: true,\n          host,\n          url: target,\n          probe_url: null,\n          http_status: 200,\n          first_line_html: \"SELF_HOST_SYNTHETIC_EVIDENCE\",\n          body_length: 0,\n          synthetic: true,\n          reason: \"WORKER_SELF_ROUTE_ASSUME_REACHABLE\",\n          diagnostics: {\n            cf: request.cf || null,\n            self_host: selfHost,\n            ts: nowTs\n          }\n        };\n\n        await env.AURA_KV.put(evidenceKey(host), JSON.stringify(evidence));\n        lastEvidence = evidence;\n        fetchEvidences.push(evidence);\n        continue;\n      }\n\n      try {\n        // 1) Try HTTPS (or whatever the user provided)\n        const { res: res1, text: text1 } = await runFetch(target);\n\n        // 2) If HTTPS returns 525, retry HTTP for same host/path/query\n        if (res1.status === 525) {\n          const u = new URL(target);\n          if (u.protocol === \"https:\") {\n            u.protocol = \"http:\";\n            const httpUrl = u.toString();\n\n            const { res: res2, text: text2 } = await runFetch(httpUrl);\n\n            const evidence = {\n              ok: true,\n              host,\n              public_url: target,\n              probe_url: httpUrl,\n              fallback_reason: \"CF_HTTPS_525_HTTP_PROBE\",\n              http_status: res2.status,\n              first_line_html: text2.split(\"\\n\")[0] || \"\",\n              body_length: text2.length,\n              diagnostics: {\n                cf: request.cf || null,\n                https_status: 525,\n                ts: nowTs\n              }\n            };\n\n            await env.AURA_KV.put(evidenceKey(host), JSON.stringify(evidence));\n            lastEvidence = evidence;\n            fetchEvidences.push(evidence);\n            continue;\n          }\n        }\n\n        // Normal path: store what we got\n        const evidence = {\n          ok: true,\n          host,\n          url: target,\n          http_status: res1.status,\n          first_line_html: text1.split(\"\\n\")[0] || \"\",\n          body_length: text1.length,\n          diagnostics: {\n            cf: request.cf || null,\n            ts: nowTs\n          }\n        };\n\n        await env.AURA_KV.put(evidenceKey(host), JSON.stringify(evidence));\n        lastEvidence = evidence;\n        fetchEvidences.push(evidence);\n      } catch (err) {\n        const evidence = {\n          ok: false,\n          host,\n          url: target,\n          http_status: 0,\n          error: String(err?.message || err),\n          error_name: err?.name || \"UNKNOWN\",\n          diagnostics: {\n            cf: request.cf || null,\n            ts: nowTs\n          }\n        };\n\n        await env.AURA_KV.put(evidenceKey(host), JSON.stringify(evidence));\n        lastEvidence = evidence;\n        fetchEvidences.push(evidence);\n      }\n    }\n\n    // ----------------------------\n    // Target selection for questions:\n    // Prefer an asked host (URL or bare domain mention). Otherwise use active HOST context.\n    // ----------------------------\n    const targetHostForQuestion = askedHost || activeHost || null;\n\n    // Inline compute from VERIFIED_FETCH_URL executed in THIS message when asked host matches\n    if (lastEvidence && targetHostForQuestion && lastEvidence.host === targetHostForQuestion) {\n      const st = Number(lastEvidence.http_status || 0);\n      const r = lastEvidence.ok && statusReachable(st);\n\n      if (wantHttpStatus) return jsonReply(String(st));\n      if (want200or000) return jsonReply(st === 200 ? \"200\" : \"000\");\n      if (wantReachableUnreachable) return jsonReply(r ? \"REACHABLE\" : \"UNREACHABLE\");\n      if (wantYesNo) return jsonReply(r ? \"YES\" : \"NO\");\n    }\n\n    // If VERIFIED_FETCH_URL ran and there is NO reachability question, return the evidence JSON by default.\n    if (fetchEvidences.length > 0 && !hasReachabilityQuestion && !isShapeRequest) {\n      const payload = fetchEvidences.length === 1 ? fetchEvidences[0] : fetchEvidences;\n      return jsonReply(payload);\n    }\n\n    // ----------------------------\n    // Shape-only queries (no \"reachable\" keyword) using HOST context + existing evidence.\n    // Example: \"HOST example.com\\nReturn ONLY the http_status\"\n    // ----------------------------\n    if (!hasReachabilityQuestion && isShapeRequest) {\n      const hostToUse = targetHostForQuestion;\n      if (!hostToUse) return jsonReply(\"NOT WIRED: VERIFIED_FETCH REQUIRED\");\n\n      const stored = await env.AURA_KV.get(evidenceKey(hostToUse));\n      if (!stored) return jsonReply(\"NOT WIRED: VERIFIED_FETCH REQUIRED\");\n\n      const evidence = JSON.parse(stored);\n      const st = Number(evidence.http_status || 0);\n      const r = evidence.ok && statusReachable(st);\n\n      if (wantHttpStatus) return jsonReply(String(st));\n      if (want200or000) return jsonReply(st === 200 ? \"200\" : \"000\");\n      if (wantReachableUnreachable) return jsonReply(r ? \"REACHABLE\" : \"UNREACHABLE\");\n      if (wantYesNo) return jsonReply(r ? \"YES\" : \"NO\");\n\n      return jsonReply(String(st));\n    }\n\n    // Evidence-memory reachability path (host-scoped KV)\n    if (hasReachabilityQuestion) {\n      const hostToUse = targetHostForQuestion;\n      if (!hostToUse) return jsonReply(\"NOT WIRED: VERIFIED_FETCH REQUIRED\");\n\n      const stored = await env.AURA_KV.get(evidenceKey(hostToUse));\n      if (!stored) return jsonReply(\"NOT WIRED: VERIFIED_FETCH REQUIRED\");\n\n      const evidence = JSON.parse(stored);\n      const st = Number(evidence.http_status || 0);\n      const r = evidence.ok && statusReachable(st);\n\n      if (wantHttpStatus) return jsonReply(String(st));\n      if (wantReachableUnreachable) return jsonReply(r ? \"REACHABLE\" : \"UNREACHABLE\");\n      if (wantYesNo) return jsonReply(r ? \"YES\" : \"NO\");\n\n      return jsonReply(r ? \"YES\" : \"NO\");\n    }\n\n// ----------------------------\n// Memory Substrate Commands (explicit; storage-backed)\n// ----------------------------\n\nconst importRegistryCore = async (typeName, items) => {\n  const idsBefore = await registryGetIndex(env, typeName);\n  const ids = [...idsBefore];\n\n  let upserts = 0;\n  for (const it of items) {\n    if (!it || typeof it !== \"object\") continue;\n\n    if (typeName === \"domains\") {\n      const domainId = String(it.id || it.domain || \"\").trim().toLowerCase();\n      if (!domainId) continue;\n\n      const entry = {\n        id: domainId,\n        domain: String(it.domain || it.id || domainId).toLowerCase(),\n        pillar: String(it.pillar || it.category || it.group || \"\").trim() || \"UNKNOWN\",\n        purpose: String(it.purpose || it.notes || \"\").trim(),\n        priority: String(it.priority || \"UNKNOWN\").trim(),\n        status: String(it.status || \"UNKNOWN\").trim()\n      };\n\n      const put = await registryPut(env, \"domains\", entry);\n      if (put.ok) {\n        upserts += 1;\n        if (!ids.includes(entry.id)) ids.push(entry.id);\n      }\n      continue;\n    }\n\n    // assets\n    const assetId = String(it.id || \"\").trim();\n    if (!assetId) continue;\n\n    const entry = {\n      id: assetId,\n      name: String(it.name || it.title || it.id || \"\").trim() || assetId,\n      pillar: String(it.pillar || it.category || it.group || \"\").trim() || \"UNKNOWN\",\n      notes: String(it.notes || \"\").trim(),\n      tags: Array.isArray(it.tags) ? it.tags : [],\n      sellability: String(it.sellability || \"UNKNOWN\").trim(),\n      patent_cluster: String(it.patent_cluster || \"\").trim()\n    };\n\n    const put = await registryPut(env, \"assets\", entry);\n    if (put.ok) {\n      upserts += 1;\n      if (!ids.includes(entry.id)) ids.push(entry.id);\n    }\n  }\n\n  await registryPutIndex(env, typeName, ids);\n  await auditWrite(env, activeHost, { action: \"REGISTRY_IMPORT\", type: typeName, details: { upserts } });\n\n  return jsonReply(\n    JSON.stringify(\n      { ok: true, type: typeName, upserts, total_index_count: ids.length, stamp: nowIso() },\n      null,\n      2\n    )\n  );\n};\n\nconst importRegistry = async (typeName) => {\n  const raw = body.replace(/^REGISTRY_IMPORT_(ASSETS|DOMAINS)\\s*/i, \"\").trim();\n  const parsed = safeJsonParse(raw);\n  if (!parsed) return jsonReply(\"BAD_REQUEST\");\n\n  const items = Array.isArray(parsed) ? parsed : (Array.isArray(parsed.items) ? parsed.items : null);\n  if (!items) return jsonReply(\"BAD_REQUEST\");\n\n  return await importRegistryCore(typeName, items);\n};\n\nconst importRegistryGeneric = async () => {\n  // Accept: REGISTRY_IMPORT {\"type\":\"assets\",\"items\":[...]} OR {\"type\":\"domains\",\"items\":[...]} OR {\"type\":\"assets\",\"items\":...}\n  const raw = body.replace(/^REGISTRY_IMPORT\\s*/i, \"\").trim();\n  const parsed = safeJsonParse(raw);\n  if (!parsed || typeof parsed !== \"object\") return jsonReply(\"BAD_REQUEST\");\n\n  const typeName = String(parsed.type || \"\").toLowerCase().trim();\n  const normalized =\n    typeName === \"asset\" || typeName === \"assets\" ? \"assets\" :\n    typeName === \"domain\" || typeName === \"domains\" ? \"domains\" :\n    \"\";\n\n  if (!normalized) return jsonReply(\"BAD_REQUEST\");\n\n  const items = Array.isArray(parsed.items) ? parsed.items : (Array.isArray(parsed) ? parsed : null);\n  if (!items) return jsonReply(\"BAD_REQUEST\");\n\n  return await importRegistryCore(normalized, items);\n};\n\n\n\n// DISABLED: legacy import handler (batch mode authoritative)\n\n\n\n// DISABLED: legacy import handler (batch mode authoritative)\n\n\n// REGISTRY_IMPORT (generic): body is JSON object { type: \"assets\"|\"domains\", items: [...] }\n\n// DISABLED: legacy import handler (batch mode authoritative)\n\n\n\n// REGISTRY_GET <type> <id>\nfor (const line of lines) {\n  if (line.startsWith(\"REGISTRY_GET\")) {\n    const parts = line.split(\" \").filter(Boolean);\n    const type = String(parts[1] || \"\").toLowerCase();\n    const id = String(parts[2] || \"\").trim();\n    if (!type || !id) return jsonReply(\"BAD_REQUEST\");\n    const e = await registryGet(env, type, id);\n    return jsonReply(e ? JSON.stringify(e, null, 2) : \"MISSING\");\n  }\n}\n\n// REGISTRY_LIST <type> [limit]\nfor (const line of lines) {\n  if (line.startsWith(\"REGISTRY_LIST\")) {\n    const parts = line.split(\" \").filter(Boolean);\n    const type = String(parts[1] || \"\").toLowerCase();\n    const limit = Number(parts[2] || 50);\n    if (!type) return jsonReply(\"BAD_REQUEST\");\n    const payload = await registryList(env, type, limit);\n    return jsonReply(payload);\n  }\n}\n\n// REGISTRY_FILTER <type> <field> <value> [limit]\nfor (const line of lines) {\n  if (line.startsWith(\"REGISTRY_FILTER\")) {\n    const raw = line.slice(\"REGISTRY_FILTER\".length).trim();\n    let type = \"\";\n    let field = \"\";\n    let value = \"\";\n    let limit = 50;\n    let where = null;\n\n    if (raw.startsWith(\"{\")) {\n      const obj = safeJsonParse(raw);\n      if (!obj || typeof obj !== \"object\") return jsonReply(\"BAD_REQUEST\");\n      type = String(obj.type || \"\").toLowerCase();\n      limit = Number(obj.limit || 50);\n      if (obj.where && typeof obj.where === \"object\") {\n        where = obj.where;\n      } else {\n        field = String(obj.field || \"\").trim();\n        value = String(obj.value ?? \"\").trim();\n      }\n    } else {\n      const parts = line.split(\" \").filter(Boolean);\n      type = String(parts[1] || \"\").toLowerCase();\n      field = String(parts[2] || \"\").trim();\n      value = String(parts[3] || \"\").trim();\n      limit = Number(parts[4] || 50);\n    }\n\n    if (!type) return jsonReply(\"BAD_REQUEST\");\n    if (!where && (!field || !value)) return jsonReply(\"BAD_REQUEST\");\n\n    const payload = where\n      ? await registryFilterWhere(env, type, where, limit)\n      : await registryFilter(env, type, field, value, limit);\n\n    return jsonReply(payload);\n  }\n}\n\nif (bodyTrim === \"AUDIT_CLEAR\") {\n  if (!isOperator) return jsonReply(\"UNAUTHORIZED\");\n  // Require a VERIFIED_FETCH seed for the active host before allowing audit mutation.\n  if (!activeHost) return jsonReply(\"BAD_REQUEST\");\n  const evSeed = await env.AURA_KV.get(evidenceKey(activeHost));\n  if (!evSeed) return jsonReply(\"NOT_WIRED: VERIFIED_FETCH REQUIRED\");\n  try {\n    // Fast-clear: resetting seq makes prior events unreachable without KV list/delete.\n    await env.AURA_KV.put(auditSeqKey(String(activeHost || \"frontdesk.network\").toLowerCase()), \"0\");\n    await env.AURA_KV.put(auditClearedAtKey(String(activeHost || \"frontdesk.network\").toLowerCase()), nowIso());\n    return jsonReply(\"CLEARED\");\n  } catch (e) {\n    return jsonReply(JSON.stringify({ ok: false, error: \"AUDIT_CLEAR_EXCEPTION\", message: String(e?.message || e) }));\n  }\n}\n\n    // ----------------------------\n    // Consent-first Intent (explicit commands only)\n    // ----------------------------\n    for (const line of lines) {\n      if (line.startsWith(\"INTENT_ADD\")) {\n        const m = line.match(/^INTENT_ADD\\s+(\\S+)\\s+(\\S+)\\s+(.+)$/);\n        if (!m) return jsonReply(\"BAD_REQUEST\");\n        const host = m[1].toLowerCase();\n        const tag = m[2].toLowerCase();\n        const text = m[3];\n\n        const payload = {\n          host,\n          tag,\n          text,\n          created_at: new Date().toISOString(),\n          consent: \"EXPLICIT_COMMAND\"\n        };\n\n        await env.AURA_KV.put(intentKey(host, tag), JSON.stringify(payload));\n        return jsonReply(\"INTENT_SAVED\");\n      }\n\n      if (line.startsWith(\"INTENT_GET\")) {\n        const parts = line.split(\" \").filter(Boolean);\n        const host = (parts[1] || \"\").toLowerCase();\n        const tag = (parts[2] || \"\").toLowerCase();\n        if (!host || !tag) return jsonReply(\"BAD_REQUEST\");\n        const stored = await env.AURA_KV.get(intentKey(host, tag));\n        return jsonReply(stored ? stored : \"INTENT_MISSING\");\n      }\n\n      if (line.startsWith(\"INTENT_CLEAR\")) {\n        if (!isOperator) return jsonReply(\"UNAUTHORIZED\");\n        const parts = line.split(\" \").filter(Boolean);\n        const host = (parts[1] || \"\").toLowerCase();\n        const tag = (parts[2] || \"\").toLowerCase();\n        if (!host || !tag) return jsonReply(\"BAD_REQUEST\");\n        await env.AURA_KV.delete(intentKey(host, tag));\n        return jsonReply(\"CLEARED\");\n      }\n    }\n    if (lines && lines.length === 1) {\n      const nl = await naturalLanguageReply(lines[0], env, activeHost);\n      if (nl) return jsonReply(nl);\n    }\n\n    return jsonReply(\"NOT WIRED: VERIFIED_FETCH REQUIRED\");\n  \n    } catch (err) {\n      const msg = (err && (err.stack || err.message)) ? (err.stack || err.message) : String(err);\n      return new Response(JSON.stringify({ ok: false, error: msg }), { status: 500, headers: { 'content-type': 'application/json; charset=utf-8' } });\n    }\n},\n\n  async scheduled(event, env, ctx) {\n    try {\n      for (const host of AUTONOMY_TICK_HOSTS) {\n        const prev = await env.AURA_KV.get(autonomyTickKeyForHost(host), { type: \"json\" }).catch(()=>null);\n        const count = Number((prev && prev.count) || 0) + 1;\n        const payload = {\n        ok: true,\n        ts: new Date().toISOString(),\n        count,\n        build: BUILD,\n        note: \"AUTONOMY_LOOP_TICK\"\n      };\n      await env.AURA_KV.put(autonomyTickKeyForHost(host), JSON.stringify(payload));\n      }\n    } catch (_) {\n      // Fail-closed: never throw from cron.\n    }\n  }\n\n};\n\n\n\n\n\n\r\n"],
  "mappings": "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AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;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",
  "names": ["allowedCommands", "lines", "obj", "key", "id", "env", "isOperator", "operatorHeader", "url", "evidence", "__host", "__tickKey", "entry", "put"]
}
