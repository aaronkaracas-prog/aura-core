{"script_name":"aura-core-staging","bundle_b64":"77u/LyoqCiAqIEF1cmEgQ29yZSDigJQgc2luZ2xlLWZpbGUgQ2xvdWRmbGFyZSBXb3JrZXIKICogLSAvY29yZTogQ2hhdEdQVC1zdHlsZSBVSSAoc2FtZSB2aXN1YWxzKQogKiAtIC9jb3JlLmpzOiBVSSBsb2dpYyAoZXh0ZXJuYWwgSlMgc28gYnV0dG9ucyBhbHdheXMgd29yaykKICogLSAvY2hhdDogT3BlbkFJIFJlc3BvbnNlcyBBUEkgKHRleHQgKyB2aXNpb24pCiAqIC0gL3RyYW5zY3JpYmU6IE9wZW5BSSBXaGlzcGVyIHRyYW5zY3JpcHRpb24KICoKICogRklYRVMgKGxvY2tlZCBmcm9tIHlvdXIgYmFzZSk6CiAqIDEpIFVJIGJ1dHRvbnMgZGVhZDogbW92ZSBVSSBsb2dpYyB0byAvY29yZS5qcyAobm8gaW5saW5lIHNjcmlwdCkKICogMikgQ29tcG9zZXIgb3ZlcmxhcDogdXBkYXRlIHBhZGRpbmcgYmVmb3JlIHNjcm9sbAogKiAzKSBNaWM6IHByb3BlciByZWNvcmQtPnN0b3AtPmF3YWl0IGZpbmFsaXplLT4vdHJhbnNjcmliZS0+aW5zZXJ0IHRyYW5zY3JpcHQgKG5vIGF1dG8tc2VuZCkKICogNCkgVXBsb2FkOiB0aHVtYm5haWwgcHJldmlldyArIHNlbmQgd2l0aCBtZXNzYWdlICh2aXNpb24pCiAqIDUpIEltYWdlIGdlbmVyYXRpb246ICJjcmVhdGUgaW1hZ2UgLi4uIiByZXR1cm5zIGFuIGFzc2lzdGFudCBpbWFnZSB0aGF0IFVJIHJlbmRlcnMKICoKICogQUREICh0aGlzIHJvdW5kLCBmdW5jdGlvbmFsIHdpcmluZyBvbmx5OyAvY29yZSB2aXN1YWxzIHVuY2hhbmdlZCk6CiAqIDYpIC9tYWxpYnUuY2l0eSBzZXJ2ZXMgSFRNTCAoZGlyZWN0b3J5IHBhZ2UpCiAqIDcpIC9tYWxpYnUuY2l0eS9hcGkvcGxhY2VzIHByb3hpZXMgR29vZ2xlIFBsYWNlcyB1c2luZyBHT09HTEVfUExBQ0VTX0FQSV9LRVkgKHNlcnZlci1zaWRlKQogKi8KCmNvbnN0IFZFUlNJT04gPSAiQVVSQV9DT1JFX18yMDI2LTAxLTE4X19PTkVGSUxFX19DSEFUR1BUX1VJX0xPQ0tfMDRfX01BTElCVV9DSVRZXzAxX19HQVRFRklYXzAzX19ERVBMT1lfUEFZTE9BRF8wMSI7CmNvbnN0IFVJX0JVSUxEID0gIkFVUkFfVUlfQlVJTERfXzIwMjYtMDEtMTVfXzA2IjsKCmNvbnN0IExTX1RIUkVBRFNfS0VZID0gImF1cmFfdGhyZWFkc192MSI7CmNvbnN0IExTX0FDVElWRV9USFJFQURfS0VZID0gImF1cmFfYWN0aXZlX3RocmVhZF92MSI7CgpmdW5jdGlvbiBzYWZlSnNvbih0ZXh0KSB7CiAgY29uc3QgY2xlYW4gPSAodGV4dCB8fCAiIikucmVwbGFjZSgvXlx1RkVGRisvLCAiIikudHJpbSgpOwogIGlmICghY2xlYW4pIHJldHVybiBudWxsOwogIHRyeSB7CiAgICByZXR1cm4gSlNPTi5wYXJzZShjbGVhbik7CiAgfSBjYXRjaCAoZSkgewogICAgcmV0dXJuIHsgX19wYXJzZV9lcnJvcjogdHJ1ZSwgX19yYXc6IGNsZWFuLCBfX21lc3NhZ2U6IFN0cmluZyhlICYmIGUubWVzc2FnZSA/IGUubWVzc2FnZSA6IGUpIH07CiAgfQp9CmZ1bmN0aW9uIHNhZmVTdHIoeCkgewogIHJldHVybiB0eXBlb2YgeCA9PT0gInN0cmluZyIgPyB4IDogeCA9PSBudWxsID8gIiIgOiBTdHJpbmcoeCk7Cn0KCmZ1bmN0aW9uIG1ldGhvZE5vdEFsbG93ZWQoKSB7CiAgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibWV0aG9kX25vdF9hbGxvd2VkIiB9LCA0MDUsIHdpdGhOb0NhY2hlSGVhZGVycygpKTsKfQoKYXN5bmMgZnVuY3Rpb24gcmVhZEJvZHlKc29uKHJlcXVlc3QpIHsKICB0cnkgewogICAgY29uc3QgY2xvbmUgPSByZXF1ZXN0LmNsb25lKCk7CiAgICBjb25zdCB0ID0gYXdhaXQgY2xvbmUudGV4dCgpOwogICAgY29uc3QgaiA9IHNhZmVKc29uKHQpOwogICAgcmV0dXJuIChqICYmIHR5cGVvZiBqID09PSAib2JqZWN0IikgPyBqIDoge307CiAgfSBjYXRjaCB7CiAgICByZXR1cm4ge307CiAgfQp9CgpmdW5jdGlvbiBwaWNrTW9kZWwoZW52KSB7CiAgY29uc3QgbSA9IHNhZmVTdHIoZW52ICYmIChlbnYuT1BFTkFJX01PREVMIHx8IGVudi5BVVJBX01PREVMKSk7CiAgcmV0dXJuIG0gfHwgImdwdC00LjEtbWluaSI7Cn0KZnVuY3Rpb24gcGlja0FwaUtleShlbnYpIHsKICBjb25zdCBrID0gc2FmZVN0cihlbnYgJiYgKGVudi5PUEVOQUlfQVBJX0tFWSB8fCBlbnYuQVVSQV9PUEVOQUlfQVBJX0tFWSkpOwogIHJldHVybiBrIHx8ICIiOwp9CgpmdW5jdGlvbiB3aXRoTm9DYWNoZUhlYWRlcnMoZXh0cmEpIHsKICByZXR1cm4gT2JqZWN0LmFzc2lnbigKICAgIHsKICAgICAgImNhY2hlLWNvbnRyb2wiOiAibm8tc3RvcmUsIG5vLWNhY2hlLCBtdXN0LXJldmFsaWRhdGUsIG1heC1hZ2U9MCIsCiAgICAgIHByYWdtYTogIm5vLWNhY2hlIiwKICAgICAgZXhwaXJlczogIjAiLAogICAgfSwKICAgIGV4dHJhIHx8IHt9CiAgKTsKfQoKZnVuY3Rpb24ganNvbihvYmosIHN0YXR1cyA9IDIwMCwgaGVhZGVycyA9IHt9KSB7CiAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeShvYmopLCB7CiAgICBzdGF0dXMsCiAgICBoZWFkZXJzOiBPYmplY3QuYXNzaWduKHsgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04IiB9LCBoZWFkZXJzIHx8IHt9KSwKICB9KTsKfQpmdW5jdGlvbiBodG1sKGJvZHksIHN0YXR1cyA9IDIwMCwgaGVhZGVycyA9IHt9KSB7CiAgcmV0dXJuIG5ldyBSZXNwb25zZShib2R5LCB7CiAgICBzdGF0dXMsCiAgICBoZWFkZXJzOiBPYmplY3QuYXNzaWduKHsgImNvbnRlbnQtdHlwZSI6ICJ0ZXh0L2h0bWw7IGNoYXJzZXQ9dXRmLTgiIH0sIGhlYWRlcnMgfHwge30pLAogIH0pOwp9CmZ1bmN0aW9uIGpzKGJvZHksIHN0YXR1cyA9IDIwMCwgaGVhZGVycyA9IHt9KSB7CiAgcmV0dXJuIG5ldyBSZXNwb25zZShib2R5LCB7CiAgICBzdGF0dXMsCiAgICBoZWFkZXJzOiBPYmplY3QuYXNzaWduKHsgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qYXZhc2NyaXB0OyBjaGFyc2V0PXV0Zi04IiB9LCBoZWFkZXJzIHx8IHt9KSwKICB9KTsKfQoKZnVuY3Rpb24gaXNJbWFnZVByb21wdCh0ZXh0KSB7CiAgY29uc3QgdCA9IHNhZmVTdHIodGV4dCkudHJpbSgpLnRvTG93ZXJDYXNlKCk7CiAgaWYgKCF0KSByZXR1cm4gZmFsc2U7CiAgcmV0dXJuICgKICAgIHQuc3RhcnRzV2l0aCgiY3JlYXRlIGltYWdlIikgfHwKICAgIHQuc3RhcnRzV2l0aCgiZ2VuZXJhdGUgaW1hZ2UiKSB8fAogICAgdC5zdGFydHNXaXRoKCJtYWtlIGFuIGltYWdlIikgfHwKICAgIHQuc3RhcnRzV2l0aCgibWFrZSBpbWFnZSIpIHx8CiAgICB0LnN0YXJ0c1dpdGgoImNyZWF0ZSBhbiBpbWFnZSIpCiAgKTsKfQpmdW5jdGlvbiBleHRyYWN0SW1hZ2VQcm9tcHQodGV4dCkgewogIGNvbnN0IHJhdyA9IHNhZmVTdHIodGV4dCkudHJpbSgpOwogIGlmICghcmF3KSByZXR1cm4gIiI7CiAgcmV0dXJuIHJhdy5yZXBsYWNlKC9eKGNyZWF0ZXxnZW5lcmF0ZXxtYWtlKVxzKyhhblxzKyk/aW1hZ2Vccyoob2ZccyopPy9pLCAiIikudHJpbSgpIHx8IHJhdzsKfQoKLyoqCiAqIE9wZW5BSSBSZXNwb25zZXMgQVBJICh0ZXh0LW9ubHkgb3IgdmlzaW9uIGlucHV0IHZpYSBkYXRhIFVSTHMpCiAqLwphc3luYyBmdW5jdGlvbiBvcGVuYWlUZXh0KGVudiwgdXNlclRleHQsIGltYWdlc0RhdGFVcmxzKSB7CiAgY29uc3QgYXBpS2V5ID0gcGlja0FwaUtleShlbnYpOwogIGlmICghYXBpS2V5KSByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiAibWlzc2luZ19hcGlfa2V5IiB9OwoKICBjb25zdCBtb2RlbCA9IHBpY2tNb2RlbChlbnYpOwoKICBjb25zdCB1c2VyQ29udGVudCA9IFtdOwogIHVzZXJDb250ZW50LnB1c2goeyB0eXBlOiAiaW5wdXRfdGV4dCIsIHRleHQ6IHNhZmVTdHIodXNlclRleHQpIH0pOwoKICBpZiAoQXJyYXkuaXNBcnJheShpbWFnZXNEYXRhVXJscykgJiYgaW1hZ2VzRGF0YVVybHMubGVuZ3RoKSB7CiAgICBmb3IgKGNvbnN0IHUgb2YgaW1hZ2VzRGF0YVVybHMpIHsKICAgICAgY29uc3QgdXJsID0gc2FmZVN0cih1KS50cmltKCk7CiAgICAgIGlmICghdXJsKSBjb250aW51ZTsKICAgICAgdXNlckNvbnRlbnQucHVzaCh7IHR5cGU6ICJpbnB1dF9pbWFnZSIsIGltYWdlX3VybDogdXJsIH0pOwogICAgfQogIH0KCiAgY29uc3QgcGF5bG9hZCA9IHsKICAgIG1vZGVsLAogICAgaW5wdXQ6IFsKICAgICAgewogICAgICAgIHJvbGU6ICJzeXN0ZW0iLAogICAgICAgIGNvbnRlbnQ6IFsKICAgICAgICAgIHsKICAgICAgICAgICAgdHlwZTogImlucHV0X3RleHQiLAogICAgICAgICAgICB0ZXh0OgogICAgICAgICAgICAgICJZb3UgYXJlIEF1cmEuIEJlIGNvbmNpc2UuIElmIHVzZXIgYXNrcyBmb3IgSlNPTi1vbmx5LCByZXR1cm4gdmFsaWQgSlNPTiBvbmx5IHdpdGggbm8gZXh0cmEgdGV4dC4gTmV2ZXIgdXNlIGNvZGUgZmVuY2VzLiIsCiAgICAgICAgICB9LAogICAgICAgIF0sCiAgICAgIH0sCiAgICAgIHsgcm9sZTogInVzZXIiLCBjb250ZW50OiB1c2VyQ29udGVudCB9LAogICAgXSwKICB9OwoKICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2goImh0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvcmVzcG9uc2VzIiwgewogICAgbWV0aG9kOiAiUE9TVCIsCiAgICBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246ICJCZWFyZXIgIiArIGFwaUtleSwgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiB9LAogICAgYm9keTogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCksCiAgfSk7CgogIGNvbnN0IHJhdyA9IGF3YWl0IHJlc3AudGV4dCgpOwogIGlmICghcmVzcC5vaykgcmV0dXJuIHsgb2s6IGZhbHNlLCBlcnJvcjogIm9wZW5haV9lcnJvciIsIHN0YXR1czogcmVzcC5zdGF0dXMsIGRldGFpbDogc2FmZUpzb24ocmF3KSB8fCByYXcgfTsKCiAgbGV0IG91dFRleHQgPSAiIjsKICB0cnkgewogICAgY29uc3QgZGF0YSA9IEpTT04ucGFyc2UocmF3KTsKICAgIGlmIChkYXRhICYmIEFycmF5LmlzQXJyYXkoZGF0YS5vdXRwdXQpKSB7CiAgICAgIGZvciAoY29uc3QgaXRlbSBvZiBkYXRhLm91dHB1dCkgewogICAgICAgIGlmICghaXRlbSB8fCAhQXJyYXkuaXNBcnJheShpdGVtLmNvbnRlbnQpKSBjb250aW51ZTsKICAgICAgICBmb3IgKGNvbnN0IGMgb2YgaXRlbS5jb250ZW50KSB7CiAgICAgICAgICBpZiAoIWMpIGNvbnRpbnVlOwogICAgICAgICAgaWYgKGMudHlwZSA9PT0gIm91dHB1dF90ZXh0IiAmJiB0eXBlb2YgYy50ZXh0ID09PSAic3RyaW5nIikgb3V0VGV4dCArPSBjLnRleHQ7CiAgICAgICAgICBpZiAoYy50eXBlID09PSAidGV4dCIgJiYgdHlwZW9mIGMudGV4dCA9PT0gInN0cmluZyIpIG91dFRleHQgKz0gYy50ZXh0OwogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaWYgKCFvdXRUZXh0ICYmIGRhdGEgJiYgdHlwZW9mIGRhdGEub3V0cHV0X3RleHQgPT09ICJzdHJpbmciKSBvdXRUZXh0ID0gZGF0YS5vdXRwdXRfdGV4dDsKICB9IGNhdGNoIChfKSB7fQoKICBvdXRUZXh0ID0gc2FmZVN0cihvdXRUZXh0KS50cmltKCk7CiAgaWYgKCFvdXRUZXh0KSBvdXRUZXh0ID0gIltub190ZXh0X291dHB1dF0iOwogIHJldHVybiB7IG9rOiB0cnVlLCB0ZXh0OiBvdXRUZXh0IH07Cn0KCi8qKgogKiBPcGVuQUkgSW1hZ2UgZ2VuZXJhdGlvbgogKi8KYXN5bmMgZnVuY3Rpb24gb3BlbmFpSW1hZ2UoZW52LCBwcm9tcHQpIHsKICBjb25zdCBhcGlLZXkgPSBwaWNrQXBpS2V5KGVudik7CiAgaWYgKCFhcGlLZXkpIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6ICJtaXNzaW5nX2FwaV9rZXkiIH07CgogIGNvbnN0IHAgPSBzYWZlU3RyKHByb21wdCkudHJpbSgpOwogIGlmICghcCkgcmV0dXJuIHsgb2s6IGZhbHNlLCBlcnJvcjogIm1pc3NpbmdfcHJvbXB0IiB9OwoKICBjb25zdCBwYXlsb2FkID0geyBtb2RlbDogImdwdC1pbWFnZS0xIiwgcHJvbXB0OiBwLCBzaXplOiAiMTAyNHgxMDI0IiB9OwoKICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2goImh0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvaW1hZ2VzL2dlbmVyYXRpb25zIiwgewogICAgbWV0aG9kOiAiUE9TVCIsCiAgICBoZWFkZXJzOiB7IGF1dGhvcml6YXRpb246ICJCZWFyZXIgIiArIGFwaUtleSwgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiB9LAogICAgYm9keTogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCksCiAgfSk7CgogIGNvbnN0IHJhdyA9IGF3YWl0IHJlc3AudGV4dCgpOwogIGNvbnN0IGogPSBzYWZlSnNvbihyYXcpOwoKICBpZiAoIXJlc3Aub2spIHJldHVybiB7IG9rOiBmYWxzZSwgZXJyb3I6ICJvcGVuYWlfaW1hZ2VfZXJyb3IiLCBzdGF0dXM6IHJlc3Auc3RhdHVzLCBkZXRhaWw6IGogfHwgcmF3IH07CgogIGNvbnN0IGI2NCA9IGogJiYgai5kYXRhICYmIGouZGF0YVswXSAmJiB0eXBlb2Ygai5kYXRhWzBdLmI2NF9qc29uID09PSAic3RyaW5nIiA/IGouZGF0YVswXS5iNjRfanNvbiA6ICIiOwogIGlmICghYjY0KSByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiAiaW1hZ2Vfbm9fZGF0YSIsIGRldGFpbDogaiB8fCByYXcgfTsKCiAgcmV0dXJuIHsgb2s6IHRydWUsIGRhdGFfdXJsOiAiZGF0YTppbWFnZS9wbmc7YmFzZTY0LCIgKyBiNjQgfTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlQ2hhdChyZXF1ZXN0LCBlbnYpIHsKICBsZXQgYm9keVRleHQgPSAiIjsKICB0cnkgewogICAgYm9keVRleHQgPSBhd2FpdCByZXF1ZXN0LnRleHQoKTsKICB9IGNhdGNoIHsKICAgIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogImJhZF9yZXF1ZXN0IiwgZGV0YWlsOiAiY2Fubm90X3JlYWRfYm9keSIgfSwgNDAwKTsKICB9CgogIGNvbnN0IGJvZHkgPSBzYWZlSnNvbihib2R5VGV4dCk7CiAgaWYgKCFib2R5IHx8IHR5cGVvZiBib2R5ICE9PSAib2JqZWN0IikgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAiYmFkX2pzb24iIH0sIDQwMCk7CgogIGNvbnN0IHR5cGUgPSBzYWZlU3RyKGJvZHkudHlwZSk7CiAgaWYgKHR5cGUgIT09ICJ0ZXh0IiAmJiB0eXBlICE9PSAibWl4ZWQiKSByZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6ICJ1bnN1cHBvcnRlZF90eXBlIiwgZ290OiB0eXBlIH0sIDQwMCk7CgogIGNvbnN0IGlucHV0ID0gc2FmZVN0cihib2R5LmlucHV0KTsKICBpZiAoIWlucHV0KSByZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6ICJtaXNzaW5nX2lucHV0IiB9LCA0MDApOwoKICBpZiAoaW5wdXQudHJpbSgpLnRvTG93ZXJDYXNlKCkgPT09ICJwaW5nIikgcmV0dXJuIGpzb24oeyBvazogdHJ1ZSwgdGV4dDogInBvbmciIH0sIDIwMCwgd2l0aE5vQ2FjaGVIZWFkZXJzKCkpOwoKICBpZiAoaXNJbWFnZVByb21wdChpbnB1dCkpIHsKICAgIGNvbnN0IHByb21wdCA9IGV4dHJhY3RJbWFnZVByb21wdChpbnB1dCk7CiAgICBjb25zdCBpbWcgPSBhd2FpdCBvcGVuYWlJbWFnZShlbnYsIHByb21wdCk7CiAgICBpZiAoIWltZy5vaykgcmV0dXJuIGpzb24oaW1nLCA1MDAsIHdpdGhOb0NhY2hlSGVhZGVycygpKTsKICAgIHJldHVybiBqc29uKAogICAgICB7IG9rOiB0cnVlLCBraW5kOiAiaW1hZ2UiLCBpbWFnZV9kYXRhX3VybDogaW1nLmRhdGFfdXJsLCBjYXB0aW9uOiAiSW1hZ2UgZ2VuZXJhdGVkLiIgfSwKICAgICAgMjAwLAogICAgICB3aXRoTm9DYWNoZUhlYWRlcnMoKQogICAgKTsKICB9CgogIGNvbnN0IGltYWdlcyA9IEFycmF5LmlzQXJyYXkoYm9keS5pbWFnZXMpID8gYm9keS5pbWFnZXMgOiBbXTsKICBjb25zdCBvdXQgPSBhd2FpdCBvcGVuYWlUZXh0KGVudiwgaW5wdXQsIGltYWdlcyk7CiAgaWYgKCFvdXQub2spIHJldHVybiBqc29uKG91dCwgNTAwLCB3aXRoTm9DYWNoZUhlYWRlcnMoKSk7CgogIHJldHVybiBqc29uKHsgb2s6IHRydWUsIHRleHQ6IG91dC50ZXh0IH0sIDIwMCwgd2l0aE5vQ2FjaGVIZWFkZXJzKCkpOwp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVUcmFuc2NyaWJlKHJlcXVlc3QsIGVudikgewogIGNvbnN0IGFwaUtleSA9IHBpY2tBcGlLZXkoZW52KTsKICBpZiAoIWFwaUtleSkgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibWlzc2luZ19hcGlfa2V5IiB9LCA0MDApOwoKICBsZXQgZm9ybTsKICB0cnkgewogICAgZm9ybSA9IGF3YWl0IHJlcXVlc3QuZm9ybURhdGEoKTsKICB9IGNhdGNoIHsKICAgIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogImludmFsaWRfZm9ybV9kYXRhIiB9LCA0MDApOwogIH0KCiAgY29uc3QgZmlsZSA9IGZvcm0uZ2V0KCJmaWxlIik7CiAgaWYgKCFmaWxlKSByZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6ICJtaXNzaW5nX2ZpbGUiIH0sIDQwMCk7CgogIGNvbnN0IG91dCA9IG5ldyBGb3JtRGF0YSgpOwogIG91dC5hcHBlbmQoIm1vZGVsIiwgIndoaXNwZXItMSIpOwogIG91dC5hcHBlbmQoImZpbGUiLCBmaWxlLCAiYXVkaW8ud2VibSIpOwoKICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2goImh0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvYXVkaW8vdHJhbnNjcmlwdGlvbnMiLCB7CiAgICBtZXRob2Q6ICJQT1NUIiwKICAgIGhlYWRlcnM6IHsgYXV0aG9yaXphdGlvbjogIkJlYXJlciAiICsgYXBpS2V5IH0sCiAgICBib2R5OiBvdXQsCiAgfSk7CgogIGNvbnN0IHJhdyA9IGF3YWl0IHJlc3AudGV4dCgpOwogIGlmICghcmVzcC5vaykgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAib3BlbmFpX2Vycm9yIiwgc3RhdHVzOiByZXNwLnN0YXR1cywgZGV0YWlsOiBzYWZlSnNvbihyYXcpIH0sIDUwMCk7CgogIHRyeSB7CiAgICBjb25zdCBqID0gSlNPTi5wYXJzZShyYXcpOwogICAgY29uc3QgdCA9IGogJiYgdHlwZW9mIGoudGV4dCA9PT0gInN0cmluZyIgPyBqLnRleHQgOiAiIjsKICAgIHJldHVybiBqc29uKHsgb2s6IHRydWUsIHRleHQ6IHNhZmVTdHIodCkgfSwgMjAwLCB3aXRoTm9DYWNoZUhlYWRlcnMoKSk7CiAgfSBjYXRjaCB7CiAgICByZXR1cm4ganNvbih7IG9rOiB0cnVlLCB0ZXh0OiBzYWZlU3RyKHJhdykgfSwgMjAwLCB3aXRoTm9DYWNoZUhlYWRlcnMoKSk7CiAgfQp9CgovKioKICogTWFsaWJ1LmNpdHk6IEdvb2dsZSBQbGFjZXMgcHJveHkKICogVXNlcyBlbnYuR09PR0xFX1BMQUNFU19BUElfS0VZIChhbHJlYWR5IHNldCBwZXIgeW91ciBsb2NrKQogKi8KYXN5bmMgZnVuY3Rpb24gaGFuZGxlTWFsaWJ1UGxhY2VzKHJlcXVlc3QsIGVudikgewogIGNvbnN0IGtleSA9IHNhZmVTdHIoZW52ICYmIGVudi5HT09HTEVfUExBQ0VTX0FQSV9LRVkpLnRyaW0oKTsKICBpZiAoIWtleSkgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibWlzc2luZ19nb29nbGVfcGxhY2VzX2FwaV9rZXkiIH0sIDUwMCwgd2l0aE5vQ2FjaGVIZWFkZXJzKCkpOwoKICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTsKCiAgLy8gRGVmYXVsdHM6IE1hbGlidSwgQ0EKICBjb25zdCBkZWZhdWx0TGF0ID0gIjM0LjAyNTkiOwogIGNvbnN0IGRlZmF1bHRMbmcgPSAiLTExOC43Nzk4IjsKCiAgY29uc3QgcSA9IHNhZmVTdHIodXJsLnNlYXJjaFBhcmFtcy5nZXQoInEiKSkudHJpbSgpOwogIGNvbnN0IG1vZGUgPSBzYWZlU3RyKHVybC5zZWFyY2hQYXJhbXMuZ2V0KCJtb2RlIikpLnRyaW0oKS50b0xvd2VyQ2FzZSgpIHx8IChxID8gInRleHQiIDogIm5lYXJieSIpOwoKICBjb25zdCByYWRpdXMgPSBzYWZlU3RyKHVybC5zZWFyY2hQYXJhbXMuZ2V0KCJyYWRpdXMiKSkudHJpbSgpIHx8ICIyNTAwMCI7CiAgY29uc3QgdHlwZSA9IHNhZmVTdHIodXJsLnNlYXJjaFBhcmFtcy5nZXQoInR5cGUiKSkudHJpbSgpIHx8ICJyZXN0YXVyYW50IjsKICBjb25zdCBsYXQgPSBzYWZlU3RyKHVybC5zZWFyY2hQYXJhbXMuZ2V0KCJsYXQiKSkudHJpbSgpIHx8IGRlZmF1bHRMYXQ7CiAgY29uc3QgbG5nID0gc2FmZVN0cih1cmwuc2VhcmNoUGFyYW1zLmdldCgibG5nIikpLnRyaW0oKSB8fCBkZWZhdWx0TG5nOwoKICBsZXQgZW5kcG9pbnQgPSAiIjsKICBpZiAobW9kZSA9PT0gInRleHQiKSB7CiAgICBjb25zdCBxdWVyeSA9IHEgfHwgYCR7dHlwZX0gaW4gTWFsaWJ1IENBYDsKICAgIGVuZHBvaW50ID0KICAgICAgImh0dHBzOi8vbWFwcy5nb29nbGVhcGlzLmNvbS9tYXBzL2FwaS9wbGFjZS90ZXh0c2VhcmNoL2pzb24iICsKICAgICAgYD9xdWVyeT0ke2VuY29kZVVSSUNvbXBvbmVudChxdWVyeSl9YCArCiAgICAgIGAma2V5PSR7ZW5jb2RlVVJJQ29tcG9uZW50KGtleSl9YDsKICB9IGVsc2UgewogICAgZW5kcG9pbnQgPQogICAgICAiaHR0cHM6Ly9tYXBzLmdvb2dsZWFwaXMuY29tL21hcHMvYXBpL3BsYWNlL25lYXJieXNlYXJjaC9qc29uIiArCiAgICAgIGA/bG9jYXRpb249JHtlbmNvZGVVUklDb21wb25lbnQobGF0ICsgIiwiICsgbG5nKX1gICsKICAgICAgYCZyYWRpdXM9JHtlbmNvZGVVUklDb21wb25lbnQocmFkaXVzKX1gICsKICAgICAgYCZ0eXBlPSR7ZW5jb2RlVVJJQ29tcG9uZW50KHR5cGUpfWAgKwogICAgICBgJmtleT0ke2VuY29kZVVSSUNvbXBvbmVudChrZXkpfWA7CiAgfQoKICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2goZW5kcG9pbnQsIHsgbWV0aG9kOiAiR0VUIiB9KTsKICBjb25zdCByYXcgPSBhd2FpdCByZXNwLnRleHQoKTsKICBjb25zdCBkYXRhID0gc2FmZUpzb24ocmF3KTsKCiAgaWYgKCFyZXNwLm9rKSB7CiAgICByZXR1cm4ganNvbigKICAgICAgeyBvazogZmFsc2UsIGVycm9yOiAiZ29vZ2xlX3BsYWNlc19lcnJvciIsIHN0YXR1czogcmVzcC5zdGF0dXMsIGRldGFpbDogZGF0YSB8fCByYXcgfSwKICAgICAgNTAyLAogICAgICB3aXRoTm9DYWNoZUhlYWRlcnMoKQogICAgKTsKICB9CgogIC8vIEtlZXAgcmVzcG9uc2UgbGVhbiBidXQgdXNhYmxlCiAgY29uc3QgcmVzdWx0cyA9IGRhdGEgJiYgQXJyYXkuaXNBcnJheShkYXRhLnJlc3VsdHMpID8gZGF0YS5yZXN1bHRzIDogW107CiAgY29uc3Qgc2xpbSA9IHJlc3VsdHMubWFwKChyKSA9PiAoewogICAgcGxhY2VfaWQ6IHIucGxhY2VfaWQsCiAgICBuYW1lOiByLm5hbWUsCiAgICByYXRpbmc6IHIucmF0aW5nLAogICAgdXNlcl9yYXRpbmdzX3RvdGFsOiByLnVzZXJfcmF0aW5nc190b3RhbCwKICAgIHByaWNlX2xldmVsOiByLnByaWNlX2xldmVsLAogICAgdmljaW5pdHk6IHIudmljaW5pdHksCiAgICBmb3JtYXR0ZWRfYWRkcmVzczogci5mb3JtYXR0ZWRfYWRkcmVzcywKICAgIGJ1c2luZXNzX3N0YXR1czogci5idXNpbmVzc19zdGF0dXMsCiAgICB0eXBlczogci50eXBlcywKICAgIGdlb21ldHJ5OiByLmdlb21ldHJ5LAogICAgcGhvdG9zOiByLnBob3RvcywKICB9KSk7CgogIHJldHVybiBqc29uKAogICAgewogICAgICBvazogdHJ1ZSwKICAgICAgc291cmNlOiAiZ29vZ2xlX3BsYWNlcyIsCiAgICAgIG1vZGUsCiAgICAgIHF1ZXJ5OiBxIHx8IG51bGwsCiAgICAgIHR5cGUsCiAgICAgIHJhZGl1czogTnVtYmVyKHJhZGl1cykgfHwgcmFkaXVzLAogICAgICBjZW50ZXI6IHsgbGF0OiBOdW1iZXIobGF0KSB8fCBsYXQsIGxuZzogTnVtYmVyKGxuZykgfHwgbG5nIH0sCiAgICAgIHJlc3VsdHM6IHNsaW0sCiAgICB9LAogICAgMjAwLAogICAgd2l0aE5vQ2FjaGVIZWFkZXJzKCkKICApOwp9CgovKioKICogTWFsaWJ1LmNpdHkgSFRNTCAoc2VwYXJhdGUgZnJvbSAvY29yZTsgZG9lcyBub3QgY2hhbmdlIC9jb3JlIHZpc3VhbHMpCiAqLwpmdW5jdGlvbiByZW5kZXJNYWxpYnVDaXR5VUkoKSB7CiAgcmV0dXJuIGA8IWRvY3R5cGUgaHRtbD4KPGh0bWwgbGFuZz0iZW4iPgo8aGVhZD4KPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0xIiAvPgo8dGl0bGU+TWFsaWJ1LmNpdHk8L3RpdGxlPgo8c3R5bGU+Cjpyb290ey0tYmc6I2ZmZmZmZjstLW11dGVkOiM2YjcyODA7LS1saW5lOiNlNWU3ZWI7LS1zaGFkb3c6MCAxcHggMCByZ2JhKDAsMCwwLC4wMyk7LS1waWxsOiNmM2Y0ZjY7LS1ibHVlOiMyNTYzZWI7LS1ibHVlMjojMWQ0ZWQ4fQpodG1sLGJvZHl7aGVpZ2h0OjEwMCU7bWFyZ2luOjA7YmFja2dyb3VuZDp2YXIoLS1iZyk7Y29sb3I6IzExMTgyNztmb250LWZhbWlseTp1aS1zYW5zLXNlcmlmLHN5c3RlbS11aSwtYXBwbGUtc3lzdGVtLFNlZ29lIFVJLFJvYm90byxIZWx2ZXRpY2EsQXJpYWx9CmF7Y29sb3I6aW5oZXJpdH0KLndyYXB7bWF4LXdpZHRoOjk4MHB4O21hcmdpbjowIGF1dG87cGFkZGluZzoxOHB4IDE2cHggNDBweCAxNnB4fQoudG9we2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEwcHg7bWFyZ2luLWJvdHRvbToxNHB4fQouYnJhbmR7Zm9udC13ZWlnaHQ6ODAwO2ZvbnQtc2l6ZToxOHB4fQoubWV0YXtjb2xvcjp2YXIoLS1tdXRlZCk7Zm9udC1zaXplOjEycHh9Ci5jYXJke2JvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7Ym9yZGVyLXJhZGl1czoxNnB4O2JhY2tncm91bmQ6I2ZmZjtib3gtc2hhZG93OnZhcigtLXNoYWRvdyk7cGFkZGluZzoxMnB4IDEycHh9Ci5yb3d7ZGlzcGxheTpmbGV4O2dhcDoxMHB4O2ZsZXgtd3JhcDp3cmFwO2FsaWduLWl0ZW1zOmNlbnRlcn0KLmlucHV0e2ZsZXg6MTttaW4td2lkdGg6MjIwcHg7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1saW5lKTtib3JkZXItcmFkaXVzOjE0cHg7cGFkZGluZzoxMHB4IDEycHg7Zm9udC1zaXplOjE0cHg7b3V0bGluZTpub25lfQouYnRue2JvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7YmFja2dyb3VuZDojZmZmO2JvcmRlci1yYWRpdXM6MTRweDtwYWRkaW5nOjEwcHggMTJweDtjdXJzb3I6cG9pbnRlcjtmb250LXdlaWdodDo2NTB9Ci5idG4ucHJpbWFyeXtiYWNrZ3JvdW5kOnZhcigtLWJsdWUpO2JvcmRlci1jb2xvcjp2YXIoLS1ibHVlKTtjb2xvcjojZmZmfQouYnRuLnByaW1hcnk6aG92ZXJ7YmFja2dyb3VuZDp2YXIoLS1ibHVlMil9Ci5zbWFsbHtjb2xvcjp2YXIoLS1tdXRlZCk7Zm9udC1zaXplOjEycHg7bWFyZ2luLXRvcDoxMHB4fQoubGlzdHttYXJnaW4tdG9wOjE0cHg7ZGlzcGxheTpncmlkO2dyaWQtdGVtcGxhdGUtY29sdW1uczpyZXBlYXQoYXV0by1maXQsbWlubWF4KDI4MHB4LDFmcikpO2dhcDoxMnB4fQouaXRlbXtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWxpbmUpO2JvcmRlci1yYWRpdXM6MTZweDtiYWNrZ3JvdW5kOiNmZmY7Ym94LXNoYWRvdzp2YXIoLS1zaGFkb3cpO3BhZGRpbmc6MTJweH0KLm5hbWV7Zm9udC13ZWlnaHQ6ODAwO21hcmdpbjowIDAgNnB4IDB9Ci5hZGRye2NvbG9yOnZhcigtLW11dGVkKTtmb250LXNpemU6MTNweDtsaW5lLWhlaWdodDoxLjM1fQouYmFkZ2Vze21hcmdpbi10b3A6MTBweDtkaXNwbGF5OmZsZXg7Z2FwOjhweDtmbGV4LXdyYXA6d3JhcH0KLmJhZGdle2JhY2tncm91bmQ6dmFyKC0tcGlsbCk7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1saW5lKTtib3JkZXItcmFkaXVzOjk5OXB4O3BhZGRpbmc6NXB4IDlweDtmb250LXNpemU6MTJweDtjb2xvcjojMTExODI3fQo8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogIDxkaXYgY2xhc3M9IndyYXAiPgogICAgPGRpdiBjbGFzcz0idG9wIj4KICAgICAgPGRpdiBjbGFzcz0iYnJhbmQiPk1hbGlidS5jaXR5PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9Im1ldGEiPkRpcmVjdG9yeSAobGl2ZSk8L2Rpdj4KICAgICAgPGRpdiBjbGFzcz0ibWV0YSIgc3R5bGU9Im1hcmdpbi1sZWZ0OmF1dG8iPlBvd2VyZWQgYnkgR29vZ2xlIFBsYWNlczwvZGl2PgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgIDxkaXYgY2xhc3M9InJvdyI+CiAgICAgICAgPGlucHV0IGNsYXNzPSJpbnB1dCIgaWQ9InEiIHBsYWNlaG9sZGVyPSJTZWFyY2ggKGUuZy4sIHJlc3RhdXJhbnRzLCBjb2ZmZWUsIHRhY29zLCBzdXNoaSkiIC8+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0icmVzdGF1cmFudHMiPlJlc3RhdXJhbnRzPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIiBpZD0iY29mZmVlIj5Db2ZmZWU8L2J1dHRvbj4KICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gcHJpbWFyeSIgaWQ9InNlYXJjaCI+U2VhcmNoPC9idXR0b24+CiAgICAgIDwvZGl2PgogICAgICA8ZGl2IGNsYXNzPSJzbWFsbCI+VGlwOiB0aGlzIHBhZ2UgY2FsbHMgPGNvZGU+L21hbGlidS5jaXR5L2FwaS9wbGFjZXM8L2NvZGU+LiBLZXkgc3RheXMgc2VydmVyLXNpZGUuPC9kaXY+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJsaXN0IiBpZD0ibGlzdCI+PC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJzbWFsbCIgaWQ9InN0YXR1cyI+PC9kaXY+CiAgPC9kaXY+Cgo8c2NyaXB0PgooKCkgPT4gewogIGNvbnN0ICQgPSAoaWQpID0+IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGlkKTsKICBjb25zdCBsaXN0ID0gJCgibGlzdCIpOwogIGNvbnN0IHN0YXR1cyA9ICQoInN0YXR1cyIpOwogIGNvbnN0IHEgPSAkKCJxIik7CgogIGZ1bmN0aW9uIGVzYyhzKXsgcmV0dXJuIChzfHwiIikudG9TdHJpbmcoKS5yZXBsYWNlKC9bJjw+IiddL2csIGMgPT4gKHsnJic6JyZhbXA7JywnPCc6JyZsdDsnLCc+JzonJmd0OycsJyInOicmcXVvdDsnLCInIjonJiMzOTsnfVtjXSkpOyB9CgogIGFzeW5jIGZ1bmN0aW9uIGxvYWQocXVlcnkpewogICAgc3RhdHVzLnRleHRDb250ZW50ID0gIkxvYWRpbmcuLi4iOwogICAgbGlzdC5pbm5lckhUTUwgPSAiIjsKICAgIGNvbnN0IHVybCA9ICIvbWFsaWJ1LmNpdHkvYXBpL3BsYWNlcz9tb2RlPXRleHQmcT0iICsgZW5jb2RlVVJJQ29tcG9uZW50KHF1ZXJ5IHx8ICJyZXN0YXVyYW50cyBpbiBNYWxpYnUgQ0EiKTsKICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBmZXRjaCh1cmwpOwogICAgY29uc3QgaiA9IGF3YWl0IHJlc3AuanNvbigpLmNhdGNoKCgpID0+IG51bGwpOwogICAgaWYgKCFyZXNwLm9rIHx8ICFqIHx8ICFqLm9rKSB7CiAgICAgIHN0YXR1cy50ZXh0Q29udGVudCA9ICJFcnJvciBsb2FkaW5nIHBsYWNlcy4iOwogICAgICByZXR1cm47CiAgICB9CiAgICBjb25zdCBpdGVtcyA9IGoucmVzdWx0cyB8fCBbXTsKICAgIHN0YXR1cy50ZXh0Q29udGVudCA9IGl0ZW1zLmxlbmd0aCA/IChpdGVtcy5sZW5ndGggKyAiIHJlc3VsdHMiKSA6ICJObyByZXN1bHRzLiI7CiAgICBsaXN0LmlubmVySFRNTCA9IGl0ZW1zLm1hcChyID0+IHsKICAgICAgY29uc3QgbmFtZSA9IGVzYyhyLm5hbWUgfHwgIiIpOwogICAgICBjb25zdCBhZGRyID0gZXNjKHIuZm9ybWF0dGVkX2FkZHJlc3MgfHwgci52aWNpbml0eSB8fCAiIik7CiAgICAgIGNvbnN0IHJhdGluZyA9IChyLnJhdGluZyAhPSBudWxsKSA/ICgi4q2QICIgKyByLnJhdGluZykgOiAiIjsKICAgICAgY29uc3QgdG90YWwgPSAoci51c2VyX3JhdGluZ3NfdG90YWwgIT0gbnVsbCkgPyAoIigiICsgci51c2VyX3JhdGluZ3NfdG90YWwgKyAiKSIpIDogIiI7CiAgICAgIGNvbnN0IHByaWNlID0gKHIucHJpY2VfbGV2ZWwgIT0gbnVsbCkgPyAoIiQiLnJlcGVhdChNYXRoLm1heCgxLCBNYXRoLm1pbig0LCByLnByaWNlX2xldmVsKzEpKSkpIDogIiI7CiAgICAgIHJldHVybiAoCiAgICAgICAgJzxkaXYgY2xhc3M9Iml0ZW0iPicgKwogICAgICAgICAgJzxkaXYgY2xhc3M9Im5hbWUiPicgKyBuYW1lICsgJzwvZGl2PicgKwogICAgICAgICAgJzxkaXYgY2xhc3M9ImFkZHIiPicgKyBhZGRyICsgJzwvZGl2PicgKwogICAgICAgICAgJzxkaXYgY2xhc3M9ImJhZGdlcyI+JyArCiAgICAgICAgICAgIChyYXRpbmcgPyAnPHNwYW4gY2xhc3M9ImJhZGdlIj4nICsgcmF0aW5nICsgIiAiICsgdG90YWwgKyAnPC9zcGFuPicgOiAiIikgKwogICAgICAgICAgICAocHJpY2UgPyAnPHNwYW4gY2xhc3M9ImJhZGdlIj4nICsgcHJpY2UgKyAnPC9zcGFuPicgOiAiIikgKwogICAgICAgICAgJzwvZGl2PicgKwogICAgICAgICc8L2Rpdj4nCiAgICAgICk7CiAgICB9KS5qb2luKCIiKTsKICB9CgogICQoInNlYXJjaCIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4gbG9hZCgocS52YWx1ZXx8IiIpLnRyaW0oKSB8fCAicmVzdGF1cmFudHMgaW4gTWFsaWJ1IENBIikpOwogICQoInJlc3RhdXJhbnRzIikuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7IHEudmFsdWU9InJlc3RhdXJhbnRzIGluIE1hbGlidSBDQSI7IGxvYWQocS52YWx1ZSk7IH0pOwogICQoImNvZmZlZSIpLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4geyBxLnZhbHVlPSJjb2ZmZWUgaW4gTWFsaWJ1IENBIjsgbG9hZChxLnZhbHVlKTsgfSk7CgogIHEuYWRkRXZlbnRMaXN0ZW5lcigia2V5ZG93biIsIChlKSA9PiB7CiAgICBpZiAoZS5rZXkgPT09ICJFbnRlciIpIGxvYWQoKHEudmFsdWV8fCIiKS50cmltKCkpOwogIH0pOwoKICBsb2FkKCJyZXN0YXVyYW50cyBpbiBNYWxpYnUgQ0EiKTsKfSkoKTsKPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPmA7Cn0KCi8qKgogKiBVSSBIVE1MOiBzYW1lIHZpc3VhbHMsIGJ1dCBsb2FkcyBleHRlcm5hbCAvY29yZS5qcwogKi8KZnVuY3Rpb24gcmVuZGVyVUkoKSB7CiAgcmV0dXJuIGA8IWRvY3R5cGUgaHRtbD4KPGh0bWwgbGFuZz0iZW4iPgo8aGVhZD4KPG1ldGEgY2hhcnNldD0idXRmLTgiIC8+CjxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0xIiAvPgo8dGl0bGU+QXVyYTwvdGl0bGU+CjxzdHlsZT4KOnJvb3R7LS1iZzojZmZmZmZmOy0tbXV0ZWQ6IzZiNzI4MDstLW11dGVkMjojOWNhM2FmOy0tbGluZTojZTVlN2ViOy0tcGlsbDojZjNmNGY2Oy0tc2hhZG93OjAgMXB4IDAgcmdiYSgwLDAsMCwuMDMpOy0tcmluZzowIDAgMCAzcHggcmdiYSg1OSwxMzAsMjQ2LC4xOCk7LS1ibHVlOiMyNTYzZWI7LS1ibHVlMjojMWQ0ZWQ4fQpodG1sLGJvZHl7aGVpZ2h0OjEwMCU7bWFyZ2luOjA7YmFja2dyb3VuZDp2YXIoLS1iZyk7Y29sb3I6IzExMTgyNztmb250LWZhbWlseTp1aS1zYW5zLXNlcmlmLHN5c3RlbS11aSwtYXBwbGUtc3lzdGVtLFNlZ29lIFVJLFJvYm90byxIZWx2ZXRpY2EsQXJpYWwsIkFwcGxlIENvbG9yIEVtb2ppIiwiU2Vnb2UgVUkgRW1vamkifQphe2NvbG9yOmluaGVyaXR9Ci5hcHB7ZGlzcGxheTpmbGV4O2hlaWdodDoxMDAlfQouc2lkZXt3aWR0aDoyODBweDtib3JkZXItcmlnaHQ6MXB4IHNvbGlkIHZhcigtLWxpbmUpO2JhY2tncm91bmQ6I2ZiZmJmYztkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1ufQouc2lkZVRvcHtwYWRkaW5nOjE0cHggMTRweCAxMHB4IDE0cHh9Ci5icmFuZHtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDoxMHB4O2ZvbnQtd2VpZ2h0OjY1MH0KLmJyYW5kTmFtZXtmb250LXNpemU6MTZweH0KLm9ubGluZXtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo2cHg7Y29sb3I6dmFyKC0tbXV0ZWQpO2ZvbnQtd2VpZ2h0OjUwMDtmb250LXNpemU6MTJweDttYXJnaW4tbGVmdDphdXRvfQouZG90e3dpZHRoOjhweDtoZWlnaHQ6OHB4O2JvcmRlci1yYWRpdXM6OTk5cHg7YmFja2dyb3VuZDojMjJjNTVlO2JveC1zaGFkb3c6MCAwIDAgMnB4IHJnYmEoMzQsMTk3LDk0LC4xNSl9Ci5idXR0ZXJ7d2lkdGg6MThweDtoZWlnaHQ6MThweDtkaXNwbGF5OmlubGluZS1mbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO29wYWNpdHk6Ljl9Ci5idXR0ZXIgc3Zne3dpZHRoOjE4cHg7aGVpZ2h0OjE4cHg7ZGlzcGxheTpibG9jaztmaWxsOiMxMTE4Mjd9Ci5zaWRlUm93e2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEwcHh9Ci5zaWRlQnRue2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEwcHg7d2lkdGg6MTAwJTtwYWRkaW5nOjEwcHggMTBweDtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWxpbmUpO2JvcmRlci1yYWRpdXM6MTRweDtiYWNrZ3JvdW5kOiNmZmY7Ym94LXNoYWRvdzp2YXIoLS1zaGFkb3cpO2N1cnNvcjpwb2ludGVyfQoucGx1c3t3aWR0aDoxOHB4O2hlaWdodDoxOHB4O2JvcmRlci1yYWRpdXM6OTk5cHg7ZGlzcGxheTppbmxpbmUtZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjtiYWNrZ3JvdW5kOnZhcigtLXBpbGwpO2JvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7Zm9udC13ZWlnaHQ6NzAwfQouc2lkZUJ0biBzcGFue2ZvbnQtc2l6ZToxNHB4fQoucHJvamVjdHN7cGFkZGluZzo4cHggNnB4IDEycHggNnB4O2JvcmRlci10b3A6MXB4IHNvbGlkIHZhcigtLWxpbmUpfQouc2VjVGl0bGV7cGFkZGluZzo4cHggMTBweDtjb2xvcjp2YXIoLS1tdXRlZCk7Zm9udC1zaXplOjEycHg7Zm9udC13ZWlnaHQ6NjUwO3RleHQtdHJhbnNmb3JtOnVwcGVyY2FzZTtsZXR0ZXItc3BhY2luZzouMDVlbX0KLml0ZW17ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtnYXA6MTBweDtwYWRkaW5nOjlweCAxMHB4O2JvcmRlci1yYWRpdXM6MTJweDtjdXJzb3I6cG9pbnRlcn0KLml0ZW06aG92ZXJ7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4wNCl9Ci5pdGVtLmFjdGl2ZXtiYWNrZ3JvdW5kOnJnYmEoMzcsOTksMjM1LC4xMCl9Ci5pY297d2lkdGg6MThweDtoZWlnaHQ6MThweDtib3JkZXItcmFkaXVzOjZweDtiYWNrZ3JvdW5kOnJnYmEoMCwwLDAsLjA2KTtkaXNwbGF5OmlubGluZS1mbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2NvbG9yOnZhcigtLW11dGVkKTtmb250LXNpemU6MTJweH0KLmxhYmVse2ZsZXg6MTttaW4td2lkdGg6MDtmb250LXNpemU6MTNweDt3aGl0ZS1zcGFjZTpub3dyYXA7b3ZlcmZsb3c6aGlkZGVuO3RleHQtb3ZlcmZsb3c6ZWxsaXBzaXN9Ci5tYWlue2ZsZXg6MTtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1uO21pbi13aWR0aDowfQoudG9wYmFye2hlaWdodDo1NHB4O2JvcmRlci1ib3R0b206MXB4IHNvbGlkIHZhcigtLWxpbmUpO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjEwcHg7cGFkZGluZzowIDE2cHg7YmFja2dyb3VuZDojZmZmfQoudG9wYmFyVGl0bGV7Zm9udC13ZWlnaHQ6NjUwfQoubWV0YXtjb2xvcjp2YXIoLS1tdXRlZCk7Zm9udC1zaXplOjEycHh9Ci5jaGF0e2ZsZXg6MTtvdmVyZmxvdzphdXRvO3BhZGRpbmc6MjJweCAxOHB4IDE3MHB4IDE4cHh9Ci53cmFwe21heC13aWR0aDo4NjBweDttYXJnaW46MCBhdXRvfQouZW1wdHl7bWluLWhlaWdodDo1NXZoO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcn0KLmVtcHR5IGgxe2ZvbnQtc2l6ZTozMHB4O2ZvbnQtd2VpZ2h0OjY1MDttYXJnaW46MDtjb2xvcjojMTExODI3fQoubXNne2Rpc3BsYXk6ZmxleDtnYXA6MTJweDttYXJnaW46MCAwIDE0cHggMH0KLmF2YXRhcnt3aWR0aDozMnB4O2hlaWdodDozMnB4O2JvcmRlci1yYWRpdXM6MTBweDtiYWNrZ3JvdW5kOnJnYmEoMzcsOTksMjM1LC4wOCk7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2NvbG9yOiMxZDRlZDg7Zm9udC13ZWlnaHQ6ODAwfQouYnViYmxle2ZsZXg6MTttaW4td2lkdGg6MH0KLnJvbGV7Zm9udC13ZWlnaHQ6NjUwO21hcmdpbi1ib3R0b206NnB4fQoudGV4dHt3aGl0ZS1zcGFjZTpwcmUtd3JhcDtsaW5lLWhlaWdodDoxLjQ1O2NvbG9yOiMxMTE4Mjd9Ci51c2VyIC5hdmF0YXJ7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4wNik7Y29sb3I6IzExMTgyN30KLmltZ01zZ3ttYXJnaW4tdG9wOjhweH0KLmltZ01zZyBpbWd7bWF4LXdpZHRoOjEwMCU7Ym9yZGVyLXJhZGl1czoxNHB4O2JvcmRlcjoxcHggc29saWQgdmFyKC0tbGluZSk7ZGlzcGxheTpibG9jaztib3gtc2hhZG93OnZhcigtLXNoYWRvdyl9Ci5pbWdDYXB7Y29sb3I6dmFyKC0tbXV0ZWQpO2ZvbnQtc2l6ZToxMnB4O21hcmdpbi10b3A6OHB4fQouY29tcG9zZXJXcmFwe3Bvc2l0aW9uOmZpeGVkO2xlZnQ6MjgwcHg7cmlnaHQ6MDtib3R0b206MDtwYWRkaW5nOjE0cHggMTZweCAxNnB4IDE2cHg7YmFja2dyb3VuZDpsaW5lYXItZ3JhZGllbnQodG8gdG9wLCByZ2JhKDI1NSwyNTUsMjU1LDEpLCByZ2JhKDI1NSwyNTUsMjU1LC45OCkgNzAlLCByZ2JhKDI1NSwyNTUsMjU1LDApKTt9CkBtZWRpYSAobWF4LXdpZHRoOjkyMHB4KXsgLnNpZGV7d2lkdGg6MjYwcHh9IC5jb21wb3NlcldyYXB7bGVmdDoyNjBweH0gfQpAbWVkaWEgKG1heC13aWR0aDo3MjBweCl7IC5zaWRle2Rpc3BsYXk6bm9uZX0gLmNvbXBvc2VyV3JhcHtsZWZ0OjB9IH0KLmNvbXBvc2Vye21heC13aWR0aDo4NjBweDttYXJnaW46MCBhdXRvfQoudGh1bWJze2Rpc3BsYXk6ZmxleDtnYXA6MTBweDtmbGV4LXdyYXA6d3JhcDttYXJnaW46MCAwIDEwcHggMnB4fQoudGh1bWJ7d2lkdGg6ODRweDtoZWlnaHQ6ODRweDtib3JkZXItcmFkaXVzOjE0cHg7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1saW5lKTtiYWNrZ3JvdW5kOiNmZmY7b3ZlcmZsb3c6aGlkZGVuO3Bvc2l0aW9uOnJlbGF0aXZlO2JveC1zaGFkb3c6dmFyKC0tc2hhZG93KX0KLnRodW1iIGltZ3t3aWR0aDoxMDAlO2hlaWdodDoxMDAlO29iamVjdC1maXQ6Y292ZXI7ZGlzcGxheTpibG9ja30KLnRodW1iIC54e3Bvc2l0aW9uOmFic29sdXRlO3RvcDo2cHg7cmlnaHQ6NnB4O3dpZHRoOjIycHg7aGVpZ2h0OjIycHg7Ym9yZGVyLXJhZGl1czo5OTlweDtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWxpbmUpO2JhY2tncm91bmQ6cmdiYSgyNTUsMjU1LDI1NSwuOTUpO2Rpc3BsYXk6ZmxleDthbGlnbi1pdGVtczpjZW50ZXI7anVzdGlmeS1jb250ZW50OmNlbnRlcjtjdXJzb3I6cG9pbnRlcjtmb250LXdlaWdodDo5MDA7Y29sb3I6IzExMTgyN30KLmJveHtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6ZmxleC1lbmQ7Z2FwOjEwcHg7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1saW5lKTtiYWNrZ3JvdW5kOiNmZmY7Ym9yZGVyLXJhZGl1czoxOHB4O3BhZGRpbmc6MTBweCAxMnB4O2JveC1zaGFkb3c6dmFyKC0tc2hhZG93KX0KLmJ0bnt3aWR0aDozNnB4O2hlaWdodDozNnB4O2JvcmRlci1yYWRpdXM6MTJweDtib3JkZXI6MXB4IHNvbGlkIHZhcigtLWxpbmUpO2JhY2tncm91bmQ6I2ZmZjtjdXJzb3I6cG9pbnRlcjtkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2p1c3RpZnktY29udGVudDpjZW50ZXJ9Ci5idG46aG92ZXJ7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4wMyl9Ci5idG46YWN0aXZle3RyYW5zZm9ybTp0cmFuc2xhdGVZKDFweCl9Ci5pbnB1dHtmbGV4OjE7bWluLWhlaWdodDoyNHB4O21heC1oZWlnaHQ6MTYwcHg7cmVzaXplOm5vbmU7Ym9yZGVyOjA7b3V0bGluZTowO2ZvbnQtc2l6ZToxNHB4O2xpbmUtaGVpZ2h0OjEuNDU7cGFkZGluZzo3cHggMDtjb2xvcjojMTExODI3fQouc2VuZHtiYWNrZ3JvdW5kOnZhcigtLWJsdWUpO2JvcmRlci1jb2xvcjp2YXIoLS1ibHVlKTtjb2xvcjojZmZmfQouc2VuZDpob3ZlcntiYWNrZ3JvdW5kOnZhcigtLWJsdWUyKX0KLnN0YXR1c3tkaXNwbGF5OmZsZXg7YWxpZ24taXRlbXM6Y2VudGVyO2dhcDo4cHg7Y29sb3I6dmFyKC0tbXV0ZWQpO2ZvbnQtc2l6ZToxMnB4O21hcmdpbjoxMHB4IDRweCAwIDRweH0KLmtiZHttYXJnaW4tbGVmdDphdXRvO2NvbG9yOnZhcigtLW11dGVkMik7Zm9udC1zaXplOjEycHh9Ci5taWNCdG4ucmVje2JvcmRlci1jb2xvcjpyZ2JhKDIzOSw2OCw2OCwuMzUpO2JhY2tncm91bmQ6cmdiYSgyMzksNjgsNjgsLjEwKX0KLnNxdWlne2Rpc3BsYXk6bm9uZTthbGlnbi1pdGVtczpjZW50ZXI7Z2FwOjNweDttYXJnaW4tbGVmdDo2cHg7bWFyZ2luLXJpZ2h0OjZweDtoZWlnaHQ6MjBweH0KLnNxdWlnLm9ue2Rpc3BsYXk6ZmxleH0KLnNxe3dpZHRoOjNweDtoZWlnaHQ6MTBweDtib3JkZXItcmFkaXVzOjk5OXB4O2JhY2tncm91bmQ6cmdiYSgwLDAsMCwuNDUpO2FuaW1hdGlvbjpzcSAxLjBzIGluZmluaXRlIGVhc2UtaW4tb3V0fQouc3E6bnRoLWNoaWxkKDIpe2FuaW1hdGlvbi1kZWxheTouMTJzfSAuc3E6bnRoLWNoaWxkKDMpe2FuaW1hdGlvbi1kZWxheTouMjRzfSAuc3E6bnRoLWNoaWxkKDQpe2FuaW1hdGlvbi1kZWxheTouMzZzfSAuc3E6bnRoLWNoaWxkKDUpe2FuaW1hdGlvbi1kZWxheTouNDhzfSAuc3E6bnRoLWNoaWxkKDYpe2FuaW1hdGlvbi1kZWxheTouNjBzfQpAa2V5ZnJhbWVzIHNxezAlLDEwMCV7dHJhbnNmb3JtOnNjYWxlWSguNTUpfSA1MCV7dHJhbnNmb3JtOnNjYWxlWSgxLjQ1KX19Ci5tZW51e3Bvc2l0aW9uOmFic29sdXRlO2JvdHRvbTo2NHB4O2xlZnQ6MTBweDtiYWNrZ3JvdW5kOiNmZmY7Ym9yZGVyOjFweCBzb2xpZCB2YXIoLS1saW5lKTtib3JkZXItcmFkaXVzOjE0cHg7Ym94LXNoYWRvdzowIDEycHggMzBweCByZ2JhKDAsMCwwLC4xMCk7cGFkZGluZzo2cHg7ZGlzcGxheTpub25lO21pbi13aWR0aDoyMjBweH0KLm1lbnUub257ZGlzcGxheTpibG9ja30KLm1lbnVJdGVte2Rpc3BsYXk6ZmxleDtnYXA6MTBweDthbGlnbi1pdGVtczpjZW50ZXI7cGFkZGluZzoxMHB4O2JvcmRlci1yYWRpdXM6MTJweDtjdXJzb3I6cG9pbnRlcn0KLm1lbnVJdGVtOmhvdmVye2JhY2tncm91bmQ6cmdiYSgwLDAsMCwuMDQpfQoubWVudUl0ZW0gLm1pe3dpZHRoOjIwcHg7aGVpZ2h0OjIwcHg7Ym9yZGVyLXJhZGl1czo4cHg7YmFja2dyb3VuZDpyZ2JhKDAsMCwwLC4wNik7ZGlzcGxheTpmbGV4O2FsaWduLWl0ZW1zOmNlbnRlcjtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2ZvbnQtc2l6ZToxMnB4O2NvbG9yOnZhcigtLW11dGVkKX0KLm1lbnVJdGVtIC5tdHtmb250LXNpemU6MTNweH0KLm1lbnVJdGVtIC5tc3tmb250LXNpemU6MTJweDtjb2xvcjp2YXIoLS1tdXRlZCk7bWFyZ2luLXRvcDoycHh9Ci5tZW51VGV4dHtkaXNwbGF5OmZsZXg7ZmxleC1kaXJlY3Rpb246Y29sdW1ufQouc3RvcEJ0bntkaXNwbGF5Om5vbmU7Ym9yZGVyLWNvbG9yOnJnYmEoMjM5LDY4LDY4LC4zNSk7YmFja2dyb3VuZDpyZ2JhKDIzOSw2OCw2OCwuMTApfQouc3RvcEJ0bi5vbntkaXNwbGF5OmZsZXh9Cjwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CjxkaXYgY2xhc3M9ImFwcCI+CiAgPGRpdiBjbGFzcz0ic2lkZSI+CiAgICA8ZGl2IGNsYXNzPSJzaWRlVG9wIj4KICAgICAgPGRpdiBjbGFzcz0iYnJhbmQiPgogICAgICAgIDxkaXYgY2xhc3M9InNpZGVSb3ciIHN0eWxlPSJ3aWR0aDoxMDAlIj4KICAgICAgICAgIDxkaXYgY2xhc3M9ImJyYW5kTmFtZSI+QXVyYTwvZGl2PgogICAgICAgICAgPGRpdiBjbGFzcz0iYnV0dGVyIiBhcmlhLWhpZGRlbj0idHJ1ZSIgdGl0bGU9IkF1cmEiPgogICAgICAgICAgICA8c3ZnIHZpZXdCb3g9IjAgMCAyNCAyNCIgcm9sZT0iaW1nIiBmb2N1c2FibGU9ImZhbHNlIiBhcmlhLWhpZGRlbj0idHJ1ZSI+PHBhdGggZD0iTTEyIDEyYy0xLjcgMi40LTQuNiA0LjgtNy4zIDQuOEMyIDE2LjggMSAxNC44IDEgMTIuMyAxIDkgMi42IDYuNCA1LjEgNi40YzIuMiAwIDQuNyAyLjEgNi45IDUuNnptMCAwYzEuNyAyLjQgNC42IDQuOCA3LjMgNC44IDIuNyAwIDMuNy0yIDMuNy00LjUgMC0zLjMtMS42LTUuOS00LjEtNS45LTIuMiAwLTQuNyAyLjEtNi45IDUuNnpNMTIgMTJjLTEuMi0zLjgtMS4xLTcuOCAxLTkuNC45LS43IDIuMS0uNiAyLjYuNC44IDEuNy0uMyA0LjUtMy42IDl6TTEyIDEyYzEuMi0zLjggMS4xLTcuOC0xLTkuNC0uOS0uNy0yLjEtLjYtMi42LjQtLjggMS43LjMgNC41IDMuNiA5eiIvPjwvc3ZnPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzPSJvbmxpbmUiPjxzcGFuIGNsYXNzPSJkb3QiPjwvc3Bhbj48c3BhbiBpZD0ic3RhdHVzVGV4dCI+T25saW5lPC9zcGFuPjwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICA8L2Rpdj4KICAgICAgPGRpdiBzdHlsZT0iaGVpZ2h0OjEwcHgiPjwvZGl2PgogICAgICA8YnV0dG9uIGNsYXNzPSJzaWRlQnRuIiBpZD0ibmV3Q2hhdEJ0biI+PHNwYW4gY2xhc3M9InBsdXMiPis8L3NwYW4+PHNwYW4+TmV3IGNoYXQ8L3NwYW4+PC9idXR0b24+CiAgICA8L2Rpdj4KCiAgICA8ZGl2IGNsYXNzPSJwcm9qZWN0cyI+CiAgICAgIDxkaXYgY2xhc3M9InNlY1RpdGxlIj5Qcm9qZWN0czwvZGl2PgogICAgICA8ZGl2IGlkPSJwcm9qZWN0TGlzdCI+PC9kaXY+CiAgICAgIDxkaXYgY2xhc3M9InNlY1RpdGxlIiBzdHlsZT0ibWFyZ2luLXRvcDo4cHgiPkNoYXRzPC9kaXY+CiAgICAgIDxkaXYgaWQ9InRocmVhZExpc3QiPjwvZGl2PgogICAgPC9kaXY+CiAgPC9kaXY+CgogIDxkaXYgY2xhc3M9Im1haW4iPgogICAgPGRpdiBjbGFzcz0idG9wYmFyIj48ZGl2IGNsYXNzPSJ0b3BiYXJUaXRsZSI+QXVyYTwvZGl2PjxkaXYgY2xhc3M9Im1ldGEiPnwgJHtVSV9CVUlMRH08L2Rpdj48L2Rpdj4KICAgIDxkaXYgY2xhc3M9ImNoYXQiIGlkPSJjaGF0Ij48ZGl2IGNsYXNzPSJ3cmFwIj4KICAgICAgPGRpdiBjbGFzcz0iZW1wdHkiIGlkPSJlbXB0eSI+PGgxPkFzayBhbnl0aGluZzwvaDE+PC9kaXY+CiAgICAgIDxkaXYgaWQ9Im1zZ3MiPjwvZGl2PgogICAgPC9kaXY+PC9kaXY+CgogICAgPGRpdiBjbGFzcz0iY29tcG9zZXJXcmFwIiBpZD0iY29tcG9zZXJXcmFwIj4KICAgICAgPGRpdiBjbGFzcz0iY29tcG9zZXIiPgogICAgICAgIDxkaXYgY2xhc3M9InRodW1icyIgaWQ9InRodW1icyI+PC9kaXY+CgogICAgICAgIDxkaXYgY2xhc3M9ImJveCI+CiAgICAgICAgICA8ZGl2IHN0eWxlPSJwb3NpdGlvbjpyZWxhdGl2ZSI+CiAgICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biIgaWQ9InBsdXNCdG4iIHRpdGxlPSJBdHRhY2giPis8L2J1dHRvbj4KICAgICAgICAgICAgPGRpdiBjbGFzcz0ibWVudSIgaWQ9InBsdXNNZW51Ij4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtZW51SXRlbSIgaWQ9Im1lbnVVcGxvYWQiPjxkaXYgY2xhc3M9Im1pIj7wn5a8PC9kaXY+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzPSJtZW51VGV4dCI+PGRpdiBjbGFzcz0ibXQiPlVwbG9hZCBpbWFnZTwvZGl2PjxkaXYgY2xhc3M9Im1zIj5BdHRhY2ggYW5kIHNlbmQ8L2Rpdj48L2Rpdj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICA8dGV4dGFyZWEgY2xhc3M9ImlucHV0IiBpZD0iaW5wdXQiIHJvd3M9IjEiIHBsYWNlaG9sZGVyPSJBc2sgYW55dGhpbmciPjwvdGV4dGFyZWE+CgogICAgICAgICAgPGRpdiBjbGFzcz0ic3F1aWciIGlkPSJzcXVpZyIgYXJpYS1oaWRkZW49InRydWUiPgogICAgICAgICAgICA8ZGl2IGNsYXNzPSJzcSI+PC9kaXY+PGRpdiBjbGFzcz0ic3EiPjwvZGl2PjxkaXYgY2xhc3M9InNxIj48L2Rpdj48ZGl2IGNsYXNzPSJzcSI+PC9kaXY+PGRpdiBjbGFzcz0ic3EiPjwvZGl2PjxkaXYgY2xhc3M9InNxIj48L2Rpdj4KICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgIDxidXR0b24gY2xhc3M9ImJ0biBzdG9wQnRuIiBpZD0ic3RvcEJ0biIgdGl0bGU9IlN0b3AiPuKWoDwvYnV0dG9uPgogICAgICAgICAgPGJ1dHRvbiBjbGFzcz0iYnRuIG1pY0J0biIgaWQ9Im1pY0J0biIgdGl0bGU9IlZvaWNlIj7wn46kPC9idXR0b24+CiAgICAgICAgICA8YnV0dG9uIGNsYXNzPSJidG4gc2VuZCIgaWQ9InNlbmRCdG4iIHRpdGxlPSJTZW5kIj7inqQ8L2J1dHRvbj4KCiAgICAgICAgICA8aW5wdXQgdHlwZT0iZmlsZSIgaWQ9ImZpbGVJbnB1dCIgYWNjZXB0PSJpbWFnZS8qIiBzdHlsZT0iZGlzcGxheTpub25lIiAvPgogICAgICAgIDwvZGl2PgoKICAgICAgICA8ZGl2IGNsYXNzPSJzdGF0dXMiPjxzcGFuPis8L3NwYW4+PHNwYW4gaWQ9ImhpbnQiPkFzayBhbnl0aGluZzwvc3Bhbj48c3BhbiBjbGFzcz0ia2JkIj5FbnRlciB0byBzZW5kIOKAoiBTaGlmdCtFbnRlciBuZXcgbGluZTwvc3Bhbj48L2Rpdj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICA8L2Rpdj4KPC9kaXY+Cgo8c2NyaXB0IHNyYz0iL2NvcmUuanM/dj0ke2VuY29kZVVSSUNvbXBvbmVudChVSV9CVUlMRCl9Ij48L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+YDsKfQoKLyoqCiAqIEV4dGVybmFsIFVJIGxvZ2ljOiB0aGlzIGlzIHdoYXQgbWFrZXMgYnV0dG9ucyB3b3JrCiAqLwpmdW5jdGlvbiByZW5kZXJDb3JlSnMoKSB7CiAgcmV0dXJuIGAoKCkgPT4gewogICJ1c2Ugc3RyaWN0IjsKCiAgY29uc3QgTFNfVEhSRUFEU19LRVkgPSAke0pTT04uc3RyaW5naWZ5KExTX1RIUkVBRFNfS0VZKX07CiAgY29uc3QgTFNfQUNUSVZFX1RIUkVBRF9LRVkgPSAke0pTT04uc3RyaW5naWZ5KExTX0FDVElWRV9USFJFQURfS0VZKX07CiAgY29uc3QgVUlfQlVJTEQgPSAke0pTT04uc3RyaW5naWZ5KFVJX0JVSUxEKX07CiAgY29uc3QgdGhyZWFkU3RvcmVLZXkgPSAoaWQpID0+ICJhdXJhX3RocmVhZF8iICsgaWQ7CgogIGNvbnN0IGVsQ2hhdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjaGF0Iik7CiAgY29uc3QgZWxNc2dzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIm1zZ3MiKTsKICBjb25zdCBlbEVtcHR5ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImVtcHR5Iik7CiAgY29uc3QgZWxJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJpbnB1dCIpOwogIGNvbnN0IGVsU2VuZCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzZW5kQnRuIik7CiAgY29uc3QgZWxQbHVzID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoInBsdXNCdG4iKTsKICBjb25zdCBlbE1lbnUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicGx1c01lbnUiKTsKICBjb25zdCBlbE1lbnVVcGxvYWQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibWVudVVwbG9hZCIpOwogIGNvbnN0IGVsRmlsZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJmaWxlSW5wdXQiKTsKICBjb25zdCBlbFRodW1icyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJ0aHVtYnMiKTsKICBjb25zdCBlbFRocmVhZExpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidGhyZWFkTGlzdCIpOwogIGNvbnN0IGVsUHJvamVjdExpc3QgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicHJvamVjdExpc3QiKTsKICBjb25zdCBlbE5ld0NoYXRCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgibmV3Q2hhdEJ0biIpOwogIGNvbnN0IGVsU3RhdHVzVGV4dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJzdGF0dXNUZXh0Iik7CiAgY29uc3QgZWxIaW50ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImhpbnQiKTsKICBjb25zdCBlbE1pY0J0biA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJtaWNCdG4iKTsKICBjb25zdCBlbFN0b3BCdG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3RvcEJ0biIpOwogIGNvbnN0IGVsU3F1aWcgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgic3F1aWciKTsKCiAgLy8gSWYgYW55IHJlcXVpcmVkIGVsZW1lbnQgaXMgbWlzc2luZywgc3RvcCBzaWxlbnRseSB3aXRoIGEgdmlzaWJsZSBoaW50LgogIGNvbnN0IHJlcXVpcmVkID0gW2VsQ2hhdCwgZWxNc2dzLCBlbEVtcHR5LCBlbElucHV0LCBlbFNlbmQsIGVsUGx1cywgZWxNZW51LCBlbE1lbnVVcGxvYWQsIGVsRmlsZSwgZWxUaHVtYnMsIGVsVGhyZWFkTGlzdCwgZWxQcm9qZWN0TGlzdCwgZWxOZXdDaGF0QnRuLCBlbFN0YXR1c1RleHQsIGVsSGludCwgZWxNaWNCdG4sIGVsU3RvcEJ0biwgZWxTcXVpZ107CiAgaWYgKHJlcXVpcmVkLnNvbWUoeCA9PiAheCkpIHsKICAgIGNvbnN0IG0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgIG0uc3R5bGUucG9zaXRpb24gPSAiZml4ZWQiOwogICAgbS5zdHlsZS5ib3R0b20gPSAiMTJweCI7CiAgICBtLnN0eWxlLmxlZnQgPSAiMTJweCI7CiAgICBtLnN0eWxlLnBhZGRpbmcgPSAiMTBweCAxMnB4IjsKICAgIG0uc3R5bGUuYm9yZGVyID0gIjFweCBzb2xpZCAjZTVlN2ViIjsKICAgIG0uc3R5bGUuYm9yZGVyUmFkaXVzID0gIjEycHgiOwogICAgbS5zdHlsZS5iYWNrZ3JvdW5kID0gIndoaXRlIjsKICAgIG0uc3R5bGUuZm9udEZhbWlseSA9ICJzeXN0ZW0tdWksIC1hcHBsZS1zeXN0ZW0sIFNlZ29lIFVJLCBSb2JvdG8sIEFyaWFsIjsKICAgIG0uc3R5bGUuZm9udFNpemUgPSAiMTJweCI7CiAgICBtLnRleHRDb250ZW50ID0gIlVJIGVycm9yOiBtaXNzaW5nIERPTSBlbGVtZW50cy4gUmVsb2FkLiI7CiAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKG0pOwogICAgcmV0dXJuOwogIH0KCiAgbGV0IGF0dGFjaG1lbnRzID0gW107CiAgbGV0IGlzUmVjb3JkaW5nID0gZmFsc2U7CiAgbGV0IG1lZGlhUmVjb3JkZXIgPSBudWxsOwogIGxldCByZWNvcmRlZENodW5rcyA9IFtdOwogIGxldCBzdG9wUHJvbWlzZVJlc29sdmUgPSBudWxsOwoKICBmdW5jdGlvbiBzZXRTdGF0dXModCl7IGVsU3RhdHVzVGV4dC50ZXh0Q29udGVudCA9IHQ7IH0KICBmdW5jdGlvbiBzZXRIaW50KHQpeyBlbEhpbnQudGV4dENvbnRlbnQgPSB0OyB9CgogIGZ1bmN0aW9uIG1ha2VJZCgpeyByZXR1cm4gInRfIiArIE1hdGgucmFuZG9tKCkudG9TdHJpbmcoMTYpLnNsaWNlKDIpICsgRGF0ZS5ub3coKS50b1N0cmluZygxNik7IH0KCiAgZnVuY3Rpb24gbG9hZFRocmVhZHMoKXsKICAgIHRyeSB7IHJldHVybiBKU09OLnBhcnNlKGxvY2FsU3RvcmFnZS5nZXRJdGVtKExTX1RIUkVBRFNfS0VZKSB8fCAiW10iKSB8fCBbXTsgfSBjYXRjaCB7IHJldHVybiBbXTsgfQogIH0KICBmdW5jdGlvbiBzYXZlVGhyZWFkcyhsaXN0KXsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oTFNfVEhSRUFEU19LRVksIEpTT04uc3RyaW5naWZ5KGxpc3QgfHwgW10pKTsgfQogIGZ1bmN0aW9uIGdldEFjdGl2ZVRocmVhZCgpeyByZXR1cm4gbG9jYWxTdG9yYWdlLmdldEl0ZW0oTFNfQUNUSVZFX1RIUkVBRF9LRVkpIHx8ICIiOyB9CiAgZnVuY3Rpb24gc2V0QWN0aXZlVGhyZWFkKGlkKXsgbG9jYWxTdG9yYWdlLnNldEl0ZW0oTFNfQUNUSVZFX1RIUkVBRF9LRVksIGlkKTsgfQoKICBmdW5jdGlvbiBsb2FkTWVzc2FnZXMoaWQpewogICAgdHJ5IHsgcmV0dXJuIEpTT04ucGFyc2UobG9jYWxTdG9yYWdlLmdldEl0ZW0odGhyZWFkU3RvcmVLZXkoaWQpKSB8fCAiW10iKSB8fCBbXTsgfSBjYXRjaCB7IHJldHVybiBbXTsgfQogIH0KICBmdW5jdGlvbiBzYXZlTWVzc2FnZXMoaWQsIG1zZ3MpeyBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSh0aHJlYWRTdG9yZUtleShpZCksIEpTT04uc3RyaW5naWZ5KG1zZ3MgfHwgW10pKTsgfQoKICBmdW5jdGlvbiBlbnN1cmVUaHJlYWQoKXsKICAgIGxldCBpZCA9IGdldEFjdGl2ZVRocmVhZCgpOwogICAgY29uc3QgdGhyZWFkcyA9IGxvYWRUaHJlYWRzKCk7CiAgICBpZiAoIWlkIHx8ICF0aHJlYWRzLmZpbmQodCA9PiB0LmlkID09PSBpZCkpIHsKICAgICAgaWQgPSBtYWtlSWQoKTsKICAgICAgdGhyZWFkcy51bnNoaWZ0KHsgaWQsIHRpdGxlOiAiTmV3IGNoYXQiIH0pOwogICAgICBzYXZlVGhyZWFkcyh0aHJlYWRzKTsKICAgICAgc2V0QWN0aXZlVGhyZWFkKGlkKTsKICAgIH0KICAgIHJldHVybiBpZDsKICB9CgogIGZ1bmN0aW9uIHNjcm9sbFRvQm90dG9tKCl7IHRyeSB7IGVsQ2hhdC5zY3JvbGxUb3AgPSBlbENoYXQuc2Nyb2xsSGVpZ2h0OyB9IGNhdGNoIHt9IH0KCiAgZnVuY3Rpb24gdXBkYXRlQ2hhdFBhZCgpewogICAgdHJ5IHsKICAgICAgY29uc3QgY3cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29tcG9zZXJXcmFwIik7CiAgICAgIGlmICghY3cpIHJldHVybjsKICAgICAgY29uc3QgcGFkID0gY3cub2Zmc2V0SGVpZ2h0ICsgMjQ7CiAgICAgIGVsQ2hhdC5zdHlsZS5wYWRkaW5nQm90dG9tID0gcGFkICsgInB4IjsKICAgIH0gY2F0Y2gge30KICB9CgogIGZ1bmN0aW9uIHJlbmRlclRocmVhZHMoKXsKICAgIGNvbnN0IHRocmVhZHMgPSBsb2FkVGhyZWFkcygpOwogICAgY29uc3QgYWN0aXZlID0gZ2V0QWN0aXZlVGhyZWFkKCk7CiAgICBlbFRocmVhZExpc3QuaW5uZXJIVE1MID0gIiI7CiAgICB0aHJlYWRzLmZvckVhY2goKHQpID0+IHsKICAgICAgY29uc3QgZCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICBkLmNsYXNzTmFtZSA9ICJpdGVtIiArICh0LmlkID09PSBhY3RpdmUgPyAiIGFjdGl2ZSIgOiAiIik7CiAgICAgIGQuaW5uZXJIVE1MID0gJzxkaXYgY2xhc3M9ImljbyI+8J+SrDwvZGl2PjxkaXYgY2xhc3M9ImxhYmVsIj48L2Rpdj4nOwogICAgICBkLnF1ZXJ5U2VsZWN0b3IoIi5sYWJlbCIpLnRleHRDb250ZW50ID0gdC50aXRsZSB8fCAiQ2hhdCI7CiAgICAgIGQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7IHNldEFjdGl2ZVRocmVhZCh0LmlkKTsgcmVuZGVyVGhyZWFkcygpOyByZW5kZXJDaGF0KCk7IH0pOwogICAgICBlbFRocmVhZExpc3QuYXBwZW5kQ2hpbGQoZCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHJlbmRlclByb2plY3RzKCl7CiAgICBjb25zdCBwcm9qZWN0cyA9IFsiQXVyYSBDb3JlIiwgIk1hbGlidS5jaXR5IiwgIkZyb250RGVzay5OZXR3b3JrIl07CiAgICBlbFByb2plY3RMaXN0LmlubmVySFRNTCA9ICIiOwogICAgcHJvamVjdHMuZm9yRWFjaCgocCkgPT4gewogICAgICBjb25zdCBkID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGQuY2xhc3NOYW1lID0gIml0ZW0iOwogICAgICBkLmlubmVySFRNTCA9ICc8ZGl2IGNsYXNzPSJpY28iPvCfj7c8L2Rpdj48ZGl2IGNsYXNzPSJsYWJlbCI+PC9kaXY+JzsKICAgICAgZC5xdWVyeVNlbGVjdG9yKCIubGFiZWwiKS50ZXh0Q29udGVudCA9IHA7CiAgICAgIGVsUHJvamVjdExpc3QuYXBwZW5kQ2hpbGQoZCk7CiAgICB9KTsKICB9CgogIGZ1bmN0aW9uIHJlbmRlckNoYXQoKXsKICAgIGNvbnN0IGlkID0gZW5zdXJlVGhyZWFkKCk7CiAgICBjb25zdCBtc2dzID0gbG9hZE1lc3NhZ2VzKGlkKTsKICAgIGVsTXNncy5pbm5lckhUTUwgPSAiIjsKICAgIGVsRW1wdHkuc3R5bGUuZGlzcGxheSA9IG1zZ3MubGVuZ3RoID8gIm5vbmUiIDogImZsZXgiOwoKICAgIG1zZ3MuZm9yRWFjaCgobSkgPT4gewogICAgICBjb25zdCByb3cgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgcm93LmNsYXNzTmFtZSA9ICJtc2cgIiArIChtLnJvbGUgPT09ICJ1c2VyIiA/ICJ1c2VyIiA6ICJhc3Npc3RhbnQiKTsKCiAgICAgIGNvbnN0IGF2ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGF2LmNsYXNzTmFtZSA9ICJhdmF0YXIiOwogICAgICBhdi50ZXh0Q29udGVudCA9IChtLnJvbGUgPT09ICJ1c2VyIikgPyAiWSIgOiAiQSI7CgogICAgICBjb25zdCBiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIGIuY2xhc3NOYW1lID0gImJ1YmJsZSI7CgogICAgICBjb25zdCByID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIHIuY2xhc3NOYW1lID0gInJvbGUiOwogICAgICByLnRleHRDb250ZW50ID0gKG0ucm9sZSA9PT0gInVzZXIiKSA/ICJZb3UiIDogIkF1cmEiOwoKICAgICAgY29uc3QgdCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImRpdiIpOwogICAgICB0LmNsYXNzTmFtZSA9ICJ0ZXh0IjsKICAgICAgdC50ZXh0Q29udGVudCA9IG0udGV4dCB8fCAiIjsKCiAgICAgIGIuYXBwZW5kQ2hpbGQocik7IGIuYXBwZW5kQ2hpbGQodCk7CgogICAgICBpZiAobSAmJiBtLmltYWdlRGF0YVVybCkgewogICAgICAgIGNvbnN0IHdyYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgICB3cmFwLmNsYXNzTmFtZSA9ICJpbWdNc2ciOwogICAgICAgIGNvbnN0IGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImltZyIpOwogICAgICAgIGltZy5zcmMgPSBtLmltYWdlRGF0YVVybDsKICAgICAgICB3cmFwLmFwcGVuZENoaWxkKGltZyk7CiAgICAgICAgaWYgKG0uY2FwdGlvbikgeyBjb25zdCBjYXAgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsgY2FwLmNsYXNzTmFtZSA9ICJpbWdDYXAiOyBjYXAudGV4dENvbnRlbnQgPSBtLmNhcHRpb247IHdyYXAuYXBwZW5kQ2hpbGQoY2FwKTsgfQogICAgICAgIGIuYXBwZW5kQ2hpbGQod3JhcCk7CiAgICAgIH0KCiAgICAgIHJvdy5hcHBlbmRDaGlsZChhdik7IHJvdy5hcHBlbmRDaGlsZChiKTsKICAgICAgZWxNc2dzLmFwcGVuZENoaWxkKHJvdyk7CiAgICB9KTsKCiAgICAvLyBGSVg6IHBhZCBGSVJTVCwgdGhlbiBzY3JvbGwKICAgIHVwZGF0ZUNoYXRQYWQoKTsKICAgIHNjcm9sbFRvQm90dG9tKCk7CiAgfQoKICBmdW5jdGlvbiByZW5kZXJUaHVtYnMoKXsKICAgIGVsVGh1bWJzLmlubmVySFRNTCA9ICIiOwogICAgYXR0YWNobWVudHMuZm9yRWFjaCgoYSwgaWR4KSA9PiB7CiAgICAgIGNvbnN0IGQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJkaXYiKTsKICAgICAgZC5jbGFzc05hbWUgPSAidGh1bWIiOwoKICAgICAgY29uc3QgaW1nID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW1nIik7CiAgICAgIGltZy5zcmMgPSBhLmRhdGFVcmw7CgogICAgICBjb25zdCB4ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZGl2Iik7CiAgICAgIHguY2xhc3NOYW1lID0gIngiOwogICAgICB4LnRleHRDb250ZW50ID0gIsOXIjsKICAgICAgeC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsgYXR0YWNobWVudHMuc3BsaWNlKGlkeCwgMSk7IHJlbmRlclRodW1icygpOyBhdXRvR3JvdygpOyB1cGRhdGVDaGF0UGFkKCk7IH0pOwoKICAgICAgZC5hcHBlbmRDaGlsZChpbWcpOyBkLmFwcGVuZENoaWxkKHgpOwogICAgICBlbFRodW1icy5hcHBlbmRDaGlsZChkKTsKICAgIH0pOwogICAgdXBkYXRlQ2hhdFBhZCgpOwogIH0KCiAgZnVuY3Rpb24gYXV0b0dyb3coKXsKICAgIGVsSW5wdXQuc3R5bGUuaGVpZ2h0ID0gIjBweCI7CiAgICBjb25zdCBoZ3QgPSBNYXRoLm1pbigxNjAsIE1hdGgubWF4KDI0LCBlbElucHV0LnNjcm9sbEhlaWdodCkpOwogICAgZWxJbnB1dC5zdHlsZS5oZWlnaHQgPSBoZ3QgKyAicHgiOwogICAgdXBkYXRlQ2hhdFBhZCgpOwogIH0KCiAgZnVuY3Rpb24gY2xvc2VNZW51KCl7IGVsTWVudS5jbGFzc0xpc3QucmVtb3ZlKCJvbiIpOyB9CiAgZnVuY3Rpb24gdG9nZ2xlTWVudSgpeyBlbE1lbnUuY2xhc3NMaXN0LnRvZ2dsZSgib24iKTsgfQoKICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsIChlKSA9PiB7CiAgICBpZiAoIWVsTWVudS5jb250YWlucyhlLnRhcmdldCkgJiYgIWVsUGx1cy5jb250YWlucyhlLnRhcmdldCkpIGNsb3NlTWVudSgpOwogIH0pOwoKICBlbFBsdXMuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoZSkgPT4geyBlLnByZXZlbnREZWZhdWx0KCk7IHRvZ2dsZU1lbnUoKTsgfSk7CiAgZWxNZW51VXBsb2FkLmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKCkgPT4geyBjbG9zZU1lbnUoKTsgZWxGaWxlLmNsaWNrKCk7IH0pOwoKICBlbEZpbGUuYWRkRXZlbnRMaXN0ZW5lcigiY2hhbmdlIiwgKGUpID0+IHsKICAgIGNvbnN0IGYgPSAoZS50YXJnZXQuZmlsZXMgJiYgZS50YXJnZXQuZmlsZXNbMF0pID8gZS50YXJnZXQuZmlsZXNbMF0gOiBudWxsOwogICAgaWYgKCFmKSByZXR1cm47CgogICAgY29uc3QgciA9IG5ldyBGaWxlUmVhZGVyKCk7CiAgICByLm9ubG9hZCA9IGZ1bmN0aW9uKCl7CiAgICAgIGF0dGFjaG1lbnRzLnB1c2goeyBuYW1lOiBmLm5hbWUsIHR5cGU6IGYudHlwZSwgZGF0YVVybDogci5yZXN1bHQgfSk7CiAgICAgIHJlbmRlclRodW1icygpOwogICAgfTsKICAgIHIucmVhZEFzRGF0YVVSTChmKTsKICAgIGVsRmlsZS52YWx1ZSA9ICIiOwogIH0pOwoKICBhc3luYyBmdW5jdGlvbiBzZW5kTWVzc2FnZSh0eHQpewogICAgY29uc3QgaWQgPSBlbnN1cmVUaHJlYWQoKTsKICAgIGNvbnN0IG1zZ3MgPSBsb2FkTWVzc2FnZXMoaWQpOwogICAgY29uc3Qgb3V0Z29pbmdJbWFnZXMgPSBhdHRhY2htZW50cy5tYXAoYSA9PiBhLmRhdGFVcmwpLmZpbHRlcihCb29sZWFuKTsKCiAgICBtc2dzLnB1c2goeyByb2xlOiAidXNlciIsIHRleHQ6IHR4dCwgaW1hZ2VzOiBvdXRnb2luZ0ltYWdlcyB9KTsKICAgIHNhdmVNZXNzYWdlcyhpZCwgbXNncyk7CiAgICByZW5kZXJDaGF0KCk7CiAgICBzZXRIaW50KCJBdXJhIGlzIHRoaW5raW5nLi4uIik7CgogICAgY29uc3QgcGF5bG9hZCA9IG91dGdvaW5nSW1hZ2VzLmxlbmd0aCA/IHsgdHlwZToibWl4ZWQiLCBpbnB1dDogdHh0LCBpbWFnZXM6IG91dGdvaW5nSW1hZ2VzIH0gOiB7IHR5cGU6InRleHQiLCBpbnB1dDogdHh0IH07CiAgICBhdHRhY2htZW50cyA9IFtdOwogICAgcmVuZGVyVGh1bWJzKCk7CgogICAgdHJ5IHsKICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IGZldGNoKCIvY2hhdCIsIHsgbWV0aG9kOiJQT1NUIiwgaGVhZGVyczp7ICJjb250ZW50LXR5cGUiOiJhcHBsaWNhdGlvbi9qc29uIiB9LCBib2R5OiBKU09OLnN0cmluZ2lmeShwYXlsb2FkKSB9KTsKICAgICAgY29uc3QgaiA9IGF3YWl0IHJlc3AuanNvbigpOwoKICAgICAgaWYgKCFqIHx8ICFqLm9rKSB7CiAgICAgICAgbXNncy5wdXNoKHsgcm9sZToiYXNzaXN0YW50IiwgdGV4dDogIltlcnJvcl0gIiArIChqICYmIGouZXJyb3IgPyBqLmVycm9yIDogInVua25vd24iKSB9KTsKICAgICAgfSBlbHNlIGlmIChqLmtpbmQgPT09ICJpbWFnZSIgJiYgai5pbWFnZV9kYXRhX3VybCkgewogICAgICAgIG1zZ3MucHVzaCh7IHJvbGU6ImFzc2lzdGFudCIsIHRleHQ6ICIiLCBpbWFnZURhdGFVcmw6IGouaW1hZ2VfZGF0YV91cmwsIGNhcHRpb246IGouY2FwdGlvbiB8fCAiIiB9KTsKICAgICAgfSBlbHNlIHsKICAgICAgICBtc2dzLnB1c2goeyByb2xlOiJhc3Npc3RhbnQiLCB0ZXh0OiBqLnRleHQgfSk7CiAgICAgIH0KCiAgICAgIHNhdmVNZXNzYWdlcyhpZCwgbXNncyk7CiAgICAgIHJlbmRlckNoYXQoKTsKICAgIH0gY2F0Y2ggewogICAgICBtc2dzLnB1c2goeyByb2xlOiJhc3Npc3RhbnQiLCB0ZXh0OiAiW25ldHdvcmtfZXJyb3JdIiB9KTsKICAgICAgc2F2ZU1lc3NhZ2VzKGlkLCBtc2dzKTsKICAgICAgcmVuZGVyQ2hhdCgpOwogICAgfSBmaW5hbGx5IHsKICAgICAgc2V0SGludCgiQXNrIGFueXRoaW5nIik7CiAgICB9CiAgfQoKICBlbFNlbmQuYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7CiAgICBjb25zdCB2ID0gKGVsSW5wdXQudmFsdWUgfHwgIiIpLnRyaW0oKTsKICAgIGlmICghdiAmJiBhdHRhY2htZW50cy5sZW5ndGggPT09IDApIHJldHVybjsKICAgIGNvbnN0IHR4dCA9IHYgfHwgIiAiOwogICAgZWxJbnB1dC52YWx1ZSA9ICIiOyBhdXRvR3JvdygpOwogICAgc2VuZE1lc3NhZ2UodHh0KTsKICB9KTsKCiAgZWxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCJpbnB1dCIsIGF1dG9Hcm93KTsKCiAgZWxJbnB1dC5hZGRFdmVudExpc3RlbmVyKCJrZXlkb3duIiwgKGUpID0+IHsKICAgIGlmIChlLmtleSA9PT0gIkVudGVyIiAmJiAhZS5zaGlmdEtleSkgewogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGNvbnN0IHYgPSAoZWxJbnB1dC52YWx1ZSB8fCAiIikudHJpbSgpOwogICAgICBpZiAoIXYgJiYgYXR0YWNobWVudHMubGVuZ3RoID09PSAwKSByZXR1cm47CiAgICAgIGNvbnN0IHR4dCA9IHYgfHwgIiAiOwogICAgICBlbElucHV0LnZhbHVlID0gIiI7IGF1dG9Hcm93KCk7CiAgICAgIHNlbmRNZXNzYWdlKHR4dCk7CiAgICB9CiAgfSk7CgogIC8vIFZvaWNlOiByZWNvcmQgLT4gc3RvcCAtPiBhd2FpdCByZWNvcmRlciBzdG9wIC0+IC90cmFuc2NyaWJlIC0+IGluc2VydCB0cmFuc2NyaXB0IChubyBhdXRvLXNlbmQpCiAgYXN5bmMgZnVuY3Rpb24gdHJhbnNjcmliZUF1ZGlvKGJsb2IsIG1pbWVUeXBlKXsKICAgIGNvbnN0IGZkID0gbmV3IEZvcm1EYXRhKCk7CiAgICBjb25zdCBmaWxlbmFtZSA9IChtaW1lVHlwZSAmJiBtaW1lVHlwZS5pbmNsdWRlcygibXA0IikpID8gImF1ZGlvLm00YSIgOiAiYXVkaW8ud2VibSI7CiAgICBmZC5hcHBlbmQoImZpbGUiLCBibG9iLCBmaWxlbmFtZSk7CiAgICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2goIi90cmFuc2NyaWJlIiwgeyBtZXRob2Q6ICJQT1NUIiwgYm9keTogZmQgfSk7CiAgICBsZXQgaiA9IG51bGw7CiAgICB0cnkgeyBqID0gYXdhaXQgcmVzcC5qc29uKCk7IH0gY2F0Y2gge30KICAgIGlmIChyZXNwLm9rICYmIGogJiYgai5vayAmJiB0eXBlb2Ygai50ZXh0ID09PSAic3RyaW5nIikgcmV0dXJuIGoudGV4dDsKICAgIGNvbnN0IG1zZyA9IChqICYmIGouZXJyb3IpID8gai5lcnJvciA6ICgiaHR0cF8iICsgcmVzcC5zdGF0dXMpOwogICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7CiAgfQoKICBmdW5jdGlvbiB3YWl0Rm9yU3RvcCgpewogICAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlKSA9PiB7IHN0b3BQcm9taXNlUmVzb2x2ZSA9IHJlc29sdmU7IH0pOwogIH0KCiAgYXN5bmMgZnVuY3Rpb24gc3RhcnRSZWNvcmRpbmcoKXsKICAgIGlmIChpc1JlY29yZGluZykgcmV0dXJuOwogICAgaWYgKCFuYXZpZ2F0b3IubWVkaWFEZXZpY2VzIHx8ICFuYXZpZ2F0b3IubWVkaWFEZXZpY2VzLmdldFVzZXJNZWRpYSkgeyBhbGVydCgiTWljIG5vdCBzdXBwb3J0ZWQuIik7IHJldHVybjsgfQogICAgY29uc3Qgc3RyZWFtID0gYXdhaXQgbmF2aWdhdG9yLm1lZGlhRGV2aWNlcy5nZXRVc2VyTWVkaWEoeyBhdWRpbzogdHJ1ZSB9KTsKCiAgICByZWNvcmRlZENodW5rcyA9IFtdOwogICAgc3RvcFByb21pc2VSZXNvbHZlID0gbnVsbDsKCiAgICBtZWRpYVJlY29yZGVyID0gbmV3IE1lZGlhUmVjb3JkZXIoc3RyZWFtKTsKICAgIG1lZGlhUmVjb3JkZXIub25kYXRhYXZhaWxhYmxlID0gKGV2KSA9PiB7IGlmIChldiAmJiBldi5kYXRhICYmIGV2LmRhdGEuc2l6ZSA+IDApIHJlY29yZGVkQ2h1bmtzLnB1c2goZXYuZGF0YSk7IH07CiAgICBtZWRpYVJlY29yZGVyLm9uc3RvcCA9ICgpID0+IHsKICAgICAgdHJ5IHsgc3RyZWFtLmdldFRyYWNrcygpLmZvckVhY2goKHQpID0+IHQuc3RvcCgpKTsgfSBjYXRjaCB7fQogICAgICBpZiAodHlwZW9mIHN0b3BQcm9taXNlUmVzb2x2ZSA9PT0gImZ1bmN0aW9uIikgeyBjb25zdCByID0gc3RvcFByb21pc2VSZXNvbHZlOyBzdG9wUHJvbWlzZVJlc29sdmUgPSBudWxsOyByKCk7IH0KICAgIH07CgogICAgbWVkaWFSZWNvcmRlci5zdGFydCgpOwogICAgaXNSZWNvcmRpbmcgPSB0cnVlOwogICAgZWxTcXVpZy5jbGFzc0xpc3QuYWRkKCJvbiIpOwogICAgZWxTdG9wQnRuLmNsYXNzTGlzdC5hZGQoIm9uIik7CiAgICBlbE1pY0J0bi5jbGFzc0xpc3QuYWRkKCJyZWMiKTsKICAgIGVsU2VuZC5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwogICAgc2V0U3RhdHVzKCJMaXN0ZW5pbmcuLi4iKTsKICAgIHVwZGF0ZUNoYXRQYWQoKTsKICB9CgogIGFzeW5jIGZ1bmN0aW9uIHN0b3BSZWNvcmRpbmcoKXsKICAgIGlmICghaXNSZWNvcmRpbmcpIHJldHVybjsKICAgIGlzUmVjb3JkaW5nID0gZmFsc2U7CgogICAgZWxTcXVpZy5jbGFzc0xpc3QucmVtb3ZlKCJvbiIpOwogICAgZWxTdG9wQnRuLmNsYXNzTGlzdC5yZW1vdmUoIm9uIik7CiAgICBlbE1pY0J0bi5jbGFzc0xpc3QucmVtb3ZlKCJyZWMiKTsKICAgIGVsU2VuZC5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwogICAgc2V0U3RhdHVzKCJUcmFuc2NyaWJpbmcuLi4iKTsKICAgIHVwZGF0ZUNoYXRQYWQoKTsKCiAgICBjb25zdCB3YWl0ZXIgPSB3YWl0Rm9yU3RvcCgpOwogICAgdHJ5IHsgbWVkaWFSZWNvcmRlci5yZXF1ZXN0RGF0YSAmJiBtZWRpYVJlY29yZGVyLnJlcXVlc3REYXRhKCk7IH0gY2F0Y2gge30KICAgIHRyeSB7IG1lZGlhUmVjb3JkZXIuc3RvcCgpOyB9IGNhdGNoIHt9CiAgICB0cnkgeyBhd2FpdCB3YWl0ZXI7IH0gY2F0Y2gge30KCiAgICBjb25zdCBtaW1lVHlwZSA9IChyZWNvcmRlZENodW5rcyAmJiByZWNvcmRlZENodW5rc1swXSAmJiByZWNvcmRlZENodW5rc1swXS50eXBlKSA/IHJlY29yZGVkQ2h1bmtzWzBdLnR5cGUgOiAiYXVkaW8vd2VibSI7CiAgICBjb25zdCBibG9iID0gbmV3IEJsb2IocmVjb3JkZWRDaHVua3MgfHwgW10sIHsgdHlwZTogbWltZVR5cGUgfHwgImF1ZGlvL3dlYm0iIH0pOwoKICAgIHRyeSB7CiAgICAgIGlmICghYmxvYiB8fCAhYmxvYi5zaXplKSB0aHJvdyBuZXcgRXJyb3IoImVtcHR5X2F1ZGlvIik7CiAgICAgIGNvbnN0IHR4dCA9IGF3YWl0IHRyYW5zY3JpYmVBdWRpbyhibG9iLCBtaW1lVHlwZSk7CiAgICAgIGNvbnN0IGNsZWFuZWQgPSAodHh0IHx8ICIiKS50cmltKCk7CiAgICAgIGlmIChjbGVhbmVkKSBlbElucHV0LnZhbHVlID0gY2xlYW5lZDsKICAgIH0gY2F0Y2ggewogICAgICBpZiAoIShlbElucHV0LnZhbHVlIHx8ICIiKS50cmltKCkpIGVsSW5wdXQudmFsdWUgPSAiW3ZvaWNlIGNhcHR1cmVkXSI7CiAgICB9CgogICAgYXV0b0dyb3coKTsKICAgIHNldFN0YXR1cygiT25saW5lIik7CiAgICBlbElucHV0LmZvY3VzKCk7CiAgfQoKICBlbE1pY0J0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgIGlmIChpc1JlY29yZGluZykgc3RvcFJlY29yZGluZygpOwogICAgZWxzZSBzdGFydFJlY29yZGluZygpLmNhdGNoKChlKSA9PiBhbGVydCgiTWljIGVycm9yOiAiICsgKGUgJiYgZS5tZXNzYWdlID8gZS5tZXNzYWdlIDogZSkpKTsKICB9KTsKICBlbFN0b3BCdG4uYWRkRXZlbnRMaXN0ZW5lcigiY2xpY2siLCAoKSA9PiB7IHN0b3BSZWNvcmRpbmcoKTsgfSk7CgogIGVsTmV3Q2hhdEJ0bi5hZGRFdmVudExpc3RlbmVyKCJjbGljayIsICgpID0+IHsKICAgIGNvbnN0IGlkID0gbWFrZUlkKCk7CiAgICBjb25zdCB0aHJlYWRzID0gbG9hZFRocmVhZHMoKTsKICAgIHRocmVhZHMudW5zaGlmdCh7IGlkLCB0aXRsZTogVUlfQlVJTEQgfSk7CiAgICBzYXZlVGhyZWFkcyh0aHJlYWRzKTsKICAgIHNldEFjdGl2ZVRocmVhZChpZCk7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSh0aHJlYWRTdG9yZUtleShpZCkpOwogICAgcmVuZGVyVGhyZWFkcygpOwogICAgcmVuZGVyQ2hhdCgpOwogIH0pOwoKICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigicmVzaXplIiwgdXBkYXRlQ2hhdFBhZCk7CgogIGVuc3VyZVRocmVhZCgpOwogIHJlbmRlclRocmVhZHMoKTsKICByZW5kZXJQcm9qZWN0cygpOwogIHJlbmRlckNoYXQoKTsKICBhdXRvR3JvdygpOwogIHVwZGF0ZUNoYXRQYWQoKTsKfSkoKTtgOwp9CgpmdW5jdGlvbiBleHRyYWN0UHJvdmlkZWRBdXRoVG9rZW4ocmVxdWVzdCkgewogIC8vIEFjY2VwdCBtdWx0aXBsZSBoZWFkZXIgc3R5bGVzIHRvIHJlZHVjZSBmcmljdGlvbiBhY3Jvc3MgdG9vbHMKICBjb25zdCBhdXRoID0gKHJlcXVlc3QuaGVhZGVycy5nZXQoImF1dGhvcml6YXRpb24iKSB8fCByZXF1ZXN0LmhlYWRlcnMuZ2V0KCJBdXRob3JpemF0aW9uIikgfHwgIiIpLnRyaW0oKTsKICBpZiAoYXV0aCkgewogICAgY29uc3QgbSA9IGF1dGgubWF0Y2goL15CZWFyZXJccysoLispJC9pKTsKICAgIGlmIChtICYmIG1bMV0pIHJldHVybiBTdHJpbmcobVsxXSkudHJpbSgpOwogIH0KCiAgY29uc3QgZmFsbGJhY2tzID0gWwogICAgcmVxdWVzdC5oZWFkZXJzLmdldCgieC1jb3JlLXBhc3MiKSwKICAgIHJlcXVlc3QuaGVhZGVycy5nZXQoIlgtQ29yZS1QYXNzIiksCiAgICByZXF1ZXN0LmhlYWRlcnMuZ2V0KCJ4LWFkbWluLXRva2VuIiksCiAgICByZXF1ZXN0LmhlYWRlcnMuZ2V0KCJYLUFkbWluLVRva2VuIiksCiAgICByZXF1ZXN0LmhlYWRlcnMuZ2V0KCJ4LW9wZXJhdG9yLXRva2VuIiksCiAgICByZXF1ZXN0LmhlYWRlcnMuZ2V0KCJYLU9wZXJhdG9yLVRva2VuIiksCiAgXTsKCiAgZm9yIChjb25zdCByYXcgb2YgZmFsbGJhY2tzKSB7CiAgICBjb25zdCBzID0gU3RyaW5nKHJhdyB8fCAiIikudHJpbSgpOwogICAgaWYgKCFzKSBjb250aW51ZTsKICAgIGNvbnN0IG0gPSBzLm1hdGNoKC9eQmVhcmVyXHMrKC4rKSQvaSk7CiAgICBpZiAobSAmJiBtWzFdKSByZXR1cm4gU3RyaW5nKG1bMV0pLnRyaW0oKTsKICAgIHJldHVybiBzOyAvLyByYXcgdG9rZW4KICB9CiAgcmV0dXJuICIiOwp9CgpmdW5jdGlvbiBpc09wZXJhdG9yUmVxdWVzdChyZXF1ZXN0LCBlbnYpIHsKICBjb25zdCBwcm92aWRlZCA9IGV4dHJhY3RQcm92aWRlZEF1dGhUb2tlbihyZXF1ZXN0KTsKICBpZiAoIXByb3ZpZGVkKSByZXR1cm4gZmFsc2U7CgogIGNvbnN0IGFkbWluVG9rZW4gPSAoZW52ICYmIGVudi5BVVJBX0FETUlOX1RPS0VOKSA/IFN0cmluZyhlbnYuQVVSQV9BRE1JTl9UT0tFTikudHJpbSgpIDogIiI7CiAgY29uc3Qgb3BlcmF0b3JUb2tlbiA9IChlbnYgJiYgZW52LkFVUkFfT1BFUkFUT1JfVE9LRU4pID8gU3RyaW5nKGVudi5BVVJBX09QRVJBVE9SX1RPS0VOKS50cmltKCkgOiAiIjsKCiAgaWYgKGFkbWluVG9rZW4gJiYgcHJvdmlkZWQgPT09IGFkbWluVG9rZW4pIHJldHVybiB0cnVlOwogIGlmIChvcGVyYXRvclRva2VuICYmIHByb3ZpZGVkID09PSBvcGVyYXRvclRva2VuKSByZXR1cm4gdHJ1ZTsKICByZXR1cm4gZmFsc2U7Cn0KCgpleHBvcnQgZGVmYXVsdCB7CiAgYXN5bmMgZmV0Y2gocmVxdWVzdCwgZW52KSB7CiAgICB0cnkgewogICAgICBjb25zdCB1cmwgPSBuZXcgVVJMKHJlcXVlc3QudXJsKTsKICAgICAgY29uc3QgcGF0aCA9IHVybC5wYXRobmFtZTsKCiAgICAgIC8vIFByb3RlY3QgcHJpdmlsZWdlZCBwcmVmaXhlcyAoZmFsbGJhY2sgZ2F0ZSkKICAgICAgaWYgKAogICAgICAgIHBhdGguc3RhcnRzV2l0aCgiL2FkbWluIikgfHwKICAgICAgICBwYXRoLnN0YXJ0c1dpdGgoIi9vcGVyYXRvciIpIHx8CiAgICAgICAgcGF0aC5zdGFydHNXaXRoKCIvb3BzIikgfHwKICAgICAgICBwYXRoLnN0YXJ0c1dpdGgoIi9pbnRlcm5hbCIpIHx8CiAgICAgICAgcGF0aC5zdGFydHNXaXRoKCIvZGVwbG95ZXIiKSB8fAogICAgICAgIHBhdGguc3RhcnRzV2l0aCgiL3NlY3JldHMiKQogICAgICApIHsKICAgICAgICBjb25zdCBvayA9IGlzT3BlcmF0b3JSZXF1ZXN0KHJlcXVlc3QsIGVudik7CiAgICAgICAgaWYgKCFvaykgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAidW5hdXRob3JpemVkIiB9LCA0MDEsIHdpdGhOb0NhY2hlSGVhZGVycygpKTsKICAgICAgfQoKICAgICAgLy8gVUkgKFVOQ0hBTkdFRCB2aXN1YWxzKQogICAgICBpZiAocGF0aCA9PT0gIi8iIHx8IHBhdGggPT09ICIvY29yZSIpIHsKICAgICAgICByZXR1cm4gaHRtbChyZW5kZXJVSSgpLCAyMDAsIHdpdGhOb0NhY2hlSGVhZGVycygpKTsKICAgICAgfQogICAgICBpZiAocGF0aCA9PT0gIi9jb3JlLmpzIikgewogICAgICAgIHJldHVybiBqcyhyZW5kZXJDb3JlSnMoKSwgMjAwLCB3aXRoTm9DYWNoZUhlYWRlcnMoKSk7CiAgICAgIH0KCiAgICAgIC8vIEhlYWx0aC92ZXJzaW9uCiAgICAgIGlmIChwYXRoID09PSAiL2hlYWx0aCIpIHsKICAgICAgICByZXR1cm4ganNvbih7IG9rOiB0cnVlLCBzZXJ2aWNlOiAiYXVyYS1jb3JlIiwgdWlfYnVpbGQ6IFVJX0JVSUxELCB2ZXJzaW9uOiBWRVJTSU9OIH0sIDIwMCwgd2l0aE5vQ2FjaGVIZWFkZXJzKCkpOwogICAgICB9CiAgICAgIGlmIChwYXRoID09PSAiL3ZlcnNpb24iKSB7CiAgICAgICAgcmV0dXJuIGpzb24oeyBvazogdHJ1ZSwgc2VydmljZTogImF1cmEtY29yZSIsIHVpX2J1aWxkOiBVSV9CVUlMRCwgdmVyc2lvbjogVkVSU0lPTiB9LCAyMDAsIHdpdGhOb0NhY2hlSGVhZGVycygpKTsKICAgICAgfQogICAgICAvLyBBZG1pbiAob3BlcmF0b3Igb25seSkKICAgICAgaWYgKHJlcXVlc3QubWV0aG9kID09PSAiR0VUIiAmJiBwYXRoID09PSAiL2FkbWluL3NlbGZ0ZXN0IikgewogICAgICAgIHJldHVybiBqc29uKHsgb2s6IHRydWUsIGFkbWluOiB0cnVlLCB1aV9idWlsZDogVUlfQlVJTEQsIHZlcnNpb246IFZFUlNJT04gfSwgMjAwLCB3aXRoTm9DYWNoZUhlYWRlcnMoKSk7CiAgICAgIH0KICAgICAgaWYgKHJlcXVlc3QubWV0aG9kID09PSAiR0VUIiAmJiBwYXRoID09PSAiL2FkbWluL2NhcGFiaWxpdGllcyIpIHsKICAgICAgICByZXR1cm4ganNvbih7CiAgICAgICAgICBvazogdHJ1ZSwKICAgICAgICAgIHVpX2J1aWxkOiBVSV9CVUlMRCwKICAgICAgICAgIHZlcnNpb246IFZFUlNJT04sCiAgICAgICAgICBjYXBhYmlsaXRpZXM6IHsKICAgICAgICAgICAgb3BlcmF0b3JfZ2F0ZTogdHJ1ZSwKICAgICAgICAgICAgYWRtaW5fcm91dGVzOiB0cnVlLAogICAgICAgICAgICBzZWxmX2RlcGxveTogdHJ1ZSwKICAgICAgICAgICAgZGVwbG95ZXJfY2FsbDogdHJ1ZSwKICAgICAgICAgICAgcGF5bG9hZF9nZW46IHRydWUsCiAgICAgICAgICAgIGt2OiAhIShlbnYgJiYgKGVudi5BVVJBX01FTSB8fCBlbnYuQVVSQV9LVikpLAogICAgICAgICAgICByMjogISEoZW52ICYmIGVudi5BVVJBX1VQTE9BRFMpLAogICAgICAgICAgICBvcGVuYWk6ICEhKGVudiAmJiAoZW52Lk9QRU5BSV9BUElfS0VZIHx8IGVudi5BVVJBX09QRU5BSV9BUElfS0VZKSksCiAgICAgICAgICAgIGdvb2dsZV9wbGFjZXNfcHJveHk6ICEhKGVudiAmJiBlbnYuR09PR0xFX1BMQUNFU19BUElfS0VZKQogICAgICAgICAgfQogICAgICAgIH0sIDIwMCwgd2l0aE5vQ2FjaGVIZWFkZXJzKCkpOwogICAgICB9CiAgICAgIGlmIChwYXRoID09PSAiL2FkbWluL3NlbGYtZGVwbG95LXN0YWdpbmciKSB7CiAgICAgICAgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibm90X2VuYWJsZWQiIH0sIDUwMSwgd2l0aE5vQ2FjaGVIZWFkZXJzKCkpOwogICAgICB9CgogICAgICAvLyBTZWxmLWRlcGxveSAoQXVyYSBDb3JlIC0+IGF1cmEtZGVwbG95ZXIgdmlhIHNlcnZpY2UgYmluZGluZykKICAgICAgaWYgKHBhdGggPT09ICIvYWRtaW4vc2VsZl9kZXBsb3kvcHJlcGFyZSIpIHsKICAgICAgICBpZiAocmVxdWVzdC5tZXRob2QgIT09ICJQT1NUIikgcmV0dXJuIG1ldGhvZE5vdEFsbG93ZWQoKTsKICAgICAgICBpZiAoIWVudj8uQVVSQV9ERVBMT1lFUikgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibWlzc2luZ19kZXBsb3llcl9iaW5kaW5nIiB9LCA1MDAsIHdpdGhOb0NhY2hlSGVhZGVycygpKTsKICAgICAgICBpZiAoIWVudj8uREVQTE9ZX1NFQ1JFVCkgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibWlzc2luZ19ERVBMT1lfU0VDUkVUIiB9LCA1MDAsIHdpdGhOb0NhY2hlSGVhZGVycygpKTsKICAgICAgICByZXR1cm4ganNvbih7IG9rOiB0cnVlIH0sIDIwMCwgd2l0aE5vQ2FjaGVIZWFkZXJzKCkpOwogICAgICB9CgogICAgICBpZiAocGF0aCA9PT0gIi9hZG1pbi9zZWxmX2RlcGxveS9jb21taXQiKSB7CiAgICAgICAgaWYgKHJlcXVlc3QubWV0aG9kICE9PSAiUE9TVCIpIHJldHVybiBtZXRob2ROb3RBbGxvd2VkKCk7CiAgICAgICAgaWYgKCFlbnY/LkFVUkFfREVQTE9ZRVIpIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogIm1pc3NpbmdfZGVwbG95ZXJfYmluZGluZyIgfSwgNTAwLCB3aXRoTm9DYWNoZUhlYWRlcnMoKSk7CiAgICAgICAgaWYgKCFlbnY/LkRFUExPWV9TRUNSRVQpIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogIm1pc3NpbmdfREVQTE9ZX1NFQ1JFVCIgfSwgNTAwLCB3aXRoTm9DYWNoZUhlYWRlcnMoKSk7CgogICAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZWFkQm9keUpzb24ocmVxdWVzdCk7CiAgICAgICAgY29uc3Qgc2NyaXB0X25hbWUgPSBTdHJpbmcoYm9keT8uc2NyaXB0X25hbWUgfHwgImF1cmEtY29yZS1zdGFnaW5nIik7CiAgICAgICAgY29uc3QgYnVuZGxlX2I2NCA9IFN0cmluZyhib2R5Py5idW5kbGVfYjY0IHx8ICIiKTsKICAgICAgICBpZiAoIWJ1bmRsZV9iNjQpIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogIm1pc3NpbmdfcmVxdWlyZWRfZmllbGRzIiwgcmVxdWlyZWQ6IFsiYnVuZGxlX2I2NCJdLCBnb3Q6IE9iamVjdC5rZXlzKGJvZHkgfHwge30pIH0sIDQwMCwgd2l0aE5vQ2FjaGVIZWFkZXJzKCkpOwoKICAgICAgICAvLyBEZXBsb3llciBwYXlsb2FkIGNvbXBhdGliaWxpdHk6IHNlbmQgcmVkdW5kYW50IGZpZWxkIG5hbWVzIHRvIG1hdGNoIGRlcGxveWVyIGV4cGVjdGF0aW9ucy4KICAgICAgICAvLyAoU29tZSBkZXBsb3llciBidWlsZHMgaGlzdG9yaWNhbGx5IHVzZWQgZGlmZmVyZW50IGtleXMuKQogICAgICAgIGNvbnN0IGRlcGxveVBheWxvYWQgPSB7CiAgICAgICAgICBzY3JpcHRfbmFtZSwKICAgICAgICAgIHNjcmlwdE5hbWU6IHNjcmlwdF9uYW1lLAogICAgICAgICAgbmFtZTogc2NyaXB0X25hbWUsCiAgICAgICAgICBidW5kbGVfYjY0LAogICAgICAgICAgYnVuZGxlQjY0OiBidW5kbGVfYjY0LAogICAgICAgICAgYnVuZGxlOiBidW5kbGVfYjY0LAogICAgICAgIH07CgogICAgICAgIGNvbnN0IHVwc3RyZWFtID0gYXdhaXQgZW52LkFVUkFfREVQTE9ZRVIuZmV0Y2goImh0dHBzOi8vYXVyYS1kZXBsb3llci9kZXBsb3kiLCB7CiAgICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgICAgImFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgICAgLy8gU3VwcG9ydCBib3RoIGhlYWRlciBzdHlsZXMKICAgICAgICAgICAgIngtZGVwbG95LWtleSI6IFN0cmluZyhlbnYuREVQTE9ZX1NFQ1JFVCksCiAgICAgICAgICAgICJhdXRob3JpemF0aW9uIjogIkJlYXJlciAiICsgU3RyaW5nKGVudi5ERVBMT1lfU0VDUkVUKQogICAgICAgICAgfSwKICAgICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRlcGxveVBheWxvYWQpCiAgICAgICAgfSk7CgogICAgICAgIGNvbnN0IHR4dCA9IGF3YWl0IHVwc3RyZWFtLnRleHQoKTsKICAgICAgICBsZXQganMgPSBudWxsOwogICAgICAgIHRyeSB7IGpzID0gSlNPTi5wYXJzZSh0eHQpOyB9IGNhdGNoIHt9CiAgICAgICAgcmV0dXJuIGpzb24oeyBvazogdHJ1ZSwgdXBzdHJlYW1fc3RhdHVzOiB1cHN0cmVhbS5zdGF0dXMsIHVwc3RyZWFtOiBqcyB8fCB7IHJhdzogdHh0IH0gfSwgMjAwLCB3aXRoTm9DYWNoZUhlYWRlcnMoKSk7CiAgICAgIH0KCiAgICAgIC8vIERlcGxveWVyIGhlYWx0aCAodmlhIHNlcnZpY2UgYmluZGluZykKICAgICAgaWYgKHJlcXVlc3QubWV0aG9kID09PSAiR0VUIiAmJiBwYXRoID09PSAiL2FkbWluL2RlcGxveWVyL2hlYWx0aCIpIHsKICAgICAgICBpZiAoIWVudj8uQVVSQV9ERVBMT1lFUikgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibWlzc2luZ19kZXBsb3llcl9iaW5kaW5nIiB9LCA1MDAsIHdpdGhOb0NhY2hlSGVhZGVycygpKTsKCiAgICAgICAgY29uc3QgciA9IGF3YWl0IGVudi5BVVJBX0RFUExPWUVSLmZldGNoKCJodHRwczovL2F1cmEtZGVwbG95ZXIvaGVhbHRoIiwgewogICAgICAgICAgbWV0aG9kOiAiR0VUIiwKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgImFjY2VwdCI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgICAgImNhY2hlLWNvbnRyb2wiOiAibm8tc3RvcmUiLAogICAgICAgICAgICAicHJhZ21hIjogIm5vLWNhY2hlIiwKICAgICAgICAgICAgIngtZGVwbG95LWtleSI6IFN0cmluZyhlbnYuREVQTE9ZX1NFQ1JFVCB8fCAiIikKICAgICAgICAgIH0sCiAgICAgICAgICByZWRpcmVjdDogImZvbGxvdyIKICAgICAgICB9KTsKCiAgICAgICAgY29uc3QgdCA9IGF3YWl0IHIudGV4dCgpOwoKICAgICAgICBjb25zdCBoID0ge307CiAgICAgICAgdHJ5IHsKICAgICAgICAgIGZvciAoY29uc3QgW2ssIHZdIG9mIHIuaGVhZGVycy5lbnRyaWVzKCkpIHsKICAgICAgICAgICAgY29uc3QgbGsgPSBTdHJpbmcoayB8fCAiIikudG9Mb3dlckNhc2UoKTsKICAgICAgICAgICAgaWYgKGxrID09PSAiY29udGVudC10eXBlIiB8fCBsayA9PT0gImNmLXJheSIgfHwgbGsgPT09ICJzZXJ2ZXIiIHx8IGxrID09PSAiY2FjaGUtY29udHJvbCIpIHsKICAgICAgICAgICAgICBoW2xrXSA9IHY7CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9IGNhdGNoIHt9CgogICAgICAgIGxldCBqID0gbnVsbDsKICAgICAgICB0cnkgeyBqID0gSlNPTi5wYXJzZSh0KTsgfSBjYXRjaCB7IGogPSBudWxsOyB9CgogICAgICAgIHJldHVybiBqc29uKHsgb2s6IHRydWUsIHVwc3RyZWFtOiAic2VydmljZV9iaW5kaW5nOkFVUkFfREVQTE9ZRVI6L2hlYWx0aCIsIHN0YXR1czogci5zdGF0dXMsIGhlYWRlcnM6IGgsIGpzb246IGosIHJhdzogaiA/IG51bGwgOiB0IH0sIDIwMCwgd2l0aE5vQ2FjaGVIZWFkZXJzKCkpOwogICAgICB9CgovLyBNYWxpYnUuY2l0eSAoTkVXKQogICAgICBpZiAocmVxdWVzdC5tZXRob2QgPT09ICJHRVQiICYmIChwYXRoID09PSAiL21hbGlidS5jaXR5IiB8fCBwYXRoID09PSAiL21hbGlidS5jaXR5LyIpKSB7CiAgICAgICAgcmV0dXJuIGh0bWwocmVuZGVyTWFsaWJ1Q2l0eVVJKCksIDIwMCwgd2l0aE5vQ2FjaGVIZWFkZXJzKCkpOwogICAgICB9CiAgICAgIGlmIChyZXF1ZXN0Lm1ldGhvZCA9PT0gIkdFVCIgJiYgcGF0aCA9PT0gIi9tYWxpYnUuY2l0eS9hcGkvcGxhY2VzIikgewogICAgICAgIHJldHVybiBhd2FpdCBoYW5kbGVNYWxpYnVQbGFjZXMocmVxdWVzdCwgZW52KTsKICAgICAgfQoKICAgICAgLy8gTWFsaWJ1Q2l0eSBhbGlhcyAocHVibGljKSDigJQga2VlcCBleGlzdGluZyBiZWhhdmlvcgogICAgICBpZiAocmVxdWVzdC5tZXRob2QgPT09ICJHRVQiICYmIChwYXRoID09PSAiL01hbGlidUNpdHkiIHx8IHBhdGggPT09ICIvbWFsaWJ1Y2l0eSIpKSB7CiAgICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZShudWxsLCB7IHN0YXR1czogMzAyLCBoZWFkZXJzOiB3aXRoTm9DYWNoZUhlYWRlcnMoeyBsb2NhdGlvbjogImh0dHBzOi8vbWFsaWJ1LmNpdHkiIH0pIH0pOwogICAgICB9CgogICAgICAvLyBBUElzCiAgICAgIGlmIChwYXRoID09PSAiL3RyYW5zY3JpYmUiKSB7CiAgICAgICAgaWYgKHJlcXVlc3QubWV0aG9kICE9PSAiUE9TVCIpIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogIm1ldGhvZF9ub3RfYWxsb3dlZCIgfSwgNDA1KTsKICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlVHJhbnNjcmliZShyZXF1ZXN0LCBlbnYpOwogICAgICB9CiAgICAgIGlmIChwYXRoID09PSAiL2NoYXQiKSB7CiAgICAgICAgaWYgKHJlcXVlc3QubWV0aG9kICE9PSAiUE9TVCIpIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogIm1ldGhvZF9ub3RfYWxsb3dlZCIgfSwgNDA1KTsKICAgICAgICByZXR1cm4gYXdhaXQgaGFuZGxlQ2hhdChyZXF1ZXN0LCBlbnYpOwogICAgICB9CgogICAgICAKICAvLyBESUFHTk9TVElDIFJPVVRFIOKAlCBURU1QT1JBUlkKICBpZiAocGF0aCA9PT0gIi9fX2FkbWluX2dhdGVfZGVidWciKSB7CiAgICBjb25zdCBoZWFkZXJzU2VlbiA9IHt9OwogICAgdHJ5IHsKICAgICAgZm9yIChjb25zdCBbaywgdl0gb2YgcmVxdWVzdC5oZWFkZXJzLmVudHJpZXMoKSkgaGVhZGVyc1NlZW5ba10gPSB2OwogICAgfSBjYXRjaCB7fQogICAgcmV0dXJuIGpzb24oewogICAgICBvazogdHJ1ZSwKICAgICAgZGlhZ25vc3RpYzogdHJ1ZSwKICAgICAgcGF0aCwKICAgICAgaGFzX2VudjogewogICAgICAgIEFVUkFfQURNSU5fVE9LRU46ICEhKGVudiAmJiBlbnYuQVVSQV9BRE1JTl9UT0tFTiksCiAgICAgICAgQVVSQV9PUEVSQVRPUl9UT0tFTjogISEoZW52ICYmIGVudi5BVVJBX09QRVJBVE9SX1RPS0VOKSwKICAgICAgICBBVVJBX0RFUExPWUVSOiAhIShlbnYgJiYgZW52LkFVUkFfREVQTE9ZRVIpLAogICAgICAgIEFVUkFfS1Y6ICEhKGVudiAmJiBlbnYuQVVSQV9LVikKICAgICAgfSwKICAgICAgaGVhZGVyc19zZWVuOiB7CiAgICAgICAgYXV0aG9yaXphdGlvbjogcmVxdWVzdC5oZWFkZXJzLmdldCgiYXV0aG9yaXphdGlvbiIpLAogICAgICAgIHhfY29yZV9wYXNzOiByZXF1ZXN0LmhlYWRlcnMuZ2V0KCJ4LWNvcmUtcGFzcyIpLAogICAgICAgIHhfZGVwbG95X2tleTogcmVxdWVzdC5oZWFkZXJzLmdldCgieC1kZXBsb3kta2V5IikKICAgICAgfSwKICAgICAgbm90ZTogIlRFTVAgZGlhZ25vc3RpYyByb3V0ZS4gUmVtb3ZlIGFmdGVyIHVzZS4iCiAgICB9KTsKICB9CgpyZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6ICJub3RfZm91bmQiLCBwYXRoIH0sIDQwNCk7CiAgICB9IGNhdGNoIChlKSB7CiAgICAgIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogInVuaGFuZGxlZF9leGNlcHRpb24iLCBkZXRhaWw6IFN0cmluZyhlICYmIGUubWVzc2FnZSA/IGUubWVzc2FnZSA6IGUpIH0sIDUwMCk7CiAgICB9CiAgfSwKfTsKCgoKDQo="}