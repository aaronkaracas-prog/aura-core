{
  "script_name": "aura-core-staging",
  "target": "staging",
  "bundle_b64": "dmFyIF9fZGVmUHJvcCA9IE9iamVjdC5kZWZpbmVQcm9wZXJ0eTsKdmFyIF9fbmFtZSA9ICh0YXJnZXQsIHZhbHVlKSA9PiBfX2RlZlByb3AodGFyZ2V0LCAibmFtZSIsIHsgdmFsdWUsIGNvbmZpZ3VyYWJsZTogdHJ1ZSB9KTsKCi8vIHNyYy9pbmRleC5qcwphc3luYyBmdW5jdGlvbiBzaGEyNTZIZXgodGV4dCkgewogIGNvbnN0IGRhdGEgPSBuZXcgVGV4dEVuY29kZXIoKS5lbmNvZGUodGV4dCk7CiAgY29uc3QgZGlnZXN0ID0gYXdhaXQgY3J5cHRvLnN1YnRsZS5kaWdlc3QoIlNIQS0yNTYiLCBkYXRhKTsKICByZXR1cm4gQXJyYXkuZnJvbShuZXcgVWludDhBcnJheShkaWdlc3QpKS5tYXAoKGIpID0+IGIudG9TdHJpbmcoMTYpLnBhZFN0YXJ0KDIsICIwIikpLmpvaW4oIiIpOwp9Cl9fbmFtZShzaGEyNTZIZXgsICJzaGEyNTZIZXgiKTsKZnVuY3Rpb24ganNvbihzdGF0dXMsIG9iaiwgZXh0cmFIZWFkZXJzKSB7CiAgcmV0dXJuIG5ldyBSZXNwb25zZShKU09OLnN0cmluZ2lmeShvYmopLCB7CiAgICBzdGF0dXMsCiAgICBoZWFkZXJzOiB7CiAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgIC4uLmV4dHJhSGVhZGVycyB8fCB7fQogICAgfQogIH0pOwp9Cl9fbmFtZShqc29uLCAianNvbiIpOwpmdW5jdGlvbiBub3dNcygpIHsKICByZXR1cm4gRGF0ZS5ub3coKTsKfQpfX25hbWUobm93TXMsICJub3dNcyIpOwpmdW5jdGlvbiBzYWZlSGVhZGVyVmFsdWUodikgewogIGlmICghdikgcmV0dXJuIG51bGw7CiAgY29uc3QgcyA9IFN0cmluZyh2KTsKICByZXR1cm4gcy5sZW5ndGggPiAyMDAgPyBzLnNsaWNlKDAsIDIwMCkgKyAiXHUyMDI2IiA6IHM7Cn0KX19uYW1lKHNhZmVIZWFkZXJWYWx1ZSwgInNhZmVIZWFkZXJWYWx1ZSIpOwpmdW5jdGlvbiBzYWZlQm9keVNuaXBwZXQodGV4dCkgewogIGlmICh0ZXh0ID09IG51bGwpIHJldHVybiBudWxsOwogIGNvbnN0IHMgPSBTdHJpbmcodGV4dCk7CiAgcmV0dXJuIHMubGVuZ3RoID4gNDAwID8gcy5zbGljZSgwLCA0MDApICsgIlx1MjAyNiIgOiBzOwp9Cl9fbmFtZShzYWZlQm9keVNuaXBwZXQsICJzYWZlQm9keVNuaXBwZXQiKTsKYXN5bmMgZnVuY3Rpb24gcGhyYXNlTWV0YShwaHJhc2UpIHsKICBpZiAoIXBocmFzZSkgcmV0dXJuIHsgcHJlc2VudDogZmFsc2UsIHNoYTI1NjogbnVsbCwgbGVuZ3RoOiAwIH07CiAgY29uc3QgcCA9IFN0cmluZyhwaHJhc2UpOwogIHJldHVybiB7IHByZXNlbnQ6IHRydWUsIHNoYTI1NjogYXdhaXQgc2hhMjU2SGV4KHApLCBsZW5ndGg6IHAubGVuZ3RoIH07Cn0KX19uYW1lKHBocmFzZU1ldGEsICJwaHJhc2VNZXRhIik7CmZ1bmN0aW9uIHBocmFzZUhlYWRlckJ1bmRsZShwaHJhc2UpIHsKICBpZiAoIXBocmFzZSkgcmV0dXJuIHt9OwogIGNvbnN0IHAgPSBTdHJpbmcocGhyYXNlKTsKICByZXR1cm4gewogICAgIlgtUHJvbW90aW9uLVBocmFzZSI6IHAsCiAgICAiWC1BdXJhLVBocmFzZSI6IHAsCiAgICAiWC1Qcm9tb3Rpb24tUGFzc3BocmFzZSI6IHAsCiAgICAiWC1Qcm9tb3Rpb24tUGhyYXNlLVRva2VuIjogcCwKICAgICJYLVByb21vdGlvbi1Ub2tlbiI6IHAsCiAgICAiWC1QaHJhc2UiOiBwCiAgfTsKfQpfX25hbWUocGhyYXNlSGVhZGVyQnVuZGxlLCAicGhyYXNlSGVhZGVyQnVuZGxlIik7CmFzeW5jIGZ1bmN0aW9uIGZldGNoV2l0aFRpbWVvdXQodXJsLCBtcykgewogIGNvbnN0IGNvbnRyb2xsZXIgPSBuZXcgQWJvcnRDb250cm9sbGVyKCk7CiAgY29uc3QgdCA9IHNldFRpbWVvdXQoKCkgPT4gY29udHJvbGxlci5hYm9ydCgpLCBtcyk7CiAgdHJ5IHsKICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBmZXRjaCh1cmwsIHsgbWV0aG9kOiAiR0VUIiwgc2lnbmFsOiBjb250cm9sbGVyLnNpZ25hbCB9KTsKICAgIHJldHVybiByZXNwOwogIH0gZmluYWxseSB7CiAgICBjbGVhclRpbWVvdXQodCk7CiAgfQp9Cl9fbmFtZShmZXRjaFdpdGhUaW1lb3V0LCAiZmV0Y2hXaXRoVGltZW91dCIpOwpmdW5jdGlvbiBidWlsZEhlYWx0aE9iamVjdCgpIHsKICByZXR1cm4gewogICAgb2s6IHRydWUsCiAgICBzZXJ2aWNlOiAiYXVyYS1jb3JlIiwKICAgIGF1dG9ub215OiB0cnVlLAogICAgdmVyc2lvbjogIkFVUkFfQ09SRV9fMjAyNi0wMS0yMV9fQVVUT05PTVlfU1RFUF8xN01fX0RZTkFNSUNfSEVBREVSX1BST0JFX19ERVBMT1lFUl9ESUFHX19LVl9UT0tFTl9GQUxMQkFDSyIKICB9Owp9Cl9fbmFtZShidWlsZEhlYWx0aE9iamVjdCwgImJ1aWxkSGVhbHRoT2JqZWN0Iik7CmZ1bmN0aW9uIHNhZmVFcShhLCBiKSB7CiAgaWYgKCFhIHx8ICFiKSByZXR1cm4gZmFsc2U7CiAgY29uc3Qgc2EgPSBTdHJpbmcoYSk7CiAgY29uc3Qgc2IgPSBTdHJpbmcoYik7CiAgaWYgKHNhLmxlbmd0aCAhPT0gc2IubGVuZ3RoKSByZXR1cm4gZmFsc2U7CiAgbGV0IG91dCA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzYS5sZW5ndGg7IGkrKykgb3V0IHw9IHNhLmNoYXJDb2RlQXQoaSkgXiBzYi5jaGFyQ29kZUF0KGkpOwogIHJldHVybiBvdXQgPT09IDA7Cn0KX19uYW1lKHNhZmVFcSwgInNhZmVFcSIpOwpmdW5jdGlvbiBleHRyYWN0UGhyYXNlKHBheWxvYWQyKSB7CiAgaWYgKCFwYXlsb2FkMikgcmV0dXJuIG51bGw7CiAgcmV0dXJuIHBheWxvYWQyLnByb21vdGlvbl9waHJhc2UgfHwgcGF5bG9hZDIucHJvbW90aW9uUGhyYXNlIHx8IHBheWxvYWQyLnBocmFzZSB8fCBwYXlsb2FkMi52YWx1ZSB8fCBudWxsOwp9Cl9fbmFtZShleHRyYWN0UGhyYXNlLCAiZXh0cmFjdFBocmFzZSIpOwp2YXIgaW5kZXhfZGVmYXVsdCA9IHsKICBhc3luYyBmZXRjaChyZXF1ZXN0LCBlbnYsIGN0eCkgewogICAgdHJ5IHsKICAgICAgY29uc3QgdXJsID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7CiAgICAgIGNvbnN0IGFkbWluID0gcmVxdWVzdC5oZWFkZXJzLmdldCgiWC1Db3JlLVBhc3MiKSB8fCByZXF1ZXN0LmhlYWRlcnMuZ2V0KCJYLUF1cmEtUGFzcyIpIHx8IHJlcXVlc3QuaGVhZGVycy5nZXQoIlgtQWRtaW4tVG9rZW4iKTsKICAgICAgY29uc3QgYXV0b25vbXlIZWFkZXIgPSByZXF1ZXN0LmhlYWRlcnMuZ2V0KCJYLUF1cmEtQXV0b25vbXkiKTsKICAgICAgY29uc3QgaXNBZG1pbiA9IGFkbWluICYmIGFkbWluID09PSBlbnYuQVVSQV9BRE1JTl9UT0tFTjsKICAgICAgY29uc3QgS1YgPSBlbnYuQVVSQV9LVjsKICAgICAgY29uc3QgYXV0b25vbXlFbmFibGVkID0gYXdhaXQgS1YuZ2V0KCJhdXRvbm9teV9lbmFibGVkIikgPT09ICJ0cnVlIjsKICAgICAgY29uc3Qga3ZBdXRvbm9teVRva2VuID0gYXdhaXQgS1YuZ2V0KCJhdXRvbm9teV90b2tlbiIpOwogICAgICBjb25zdCBlbnZBdXRvbm9teVRva2VuID0gZW52LkFVUkFfQVVUT05PTVlfVE9LRU4gfHwgbnVsbDsKICAgICAgY29uc3QgaXNBdXRvbm9teSA9IGF1dG9ub215RW5hYmxlZCAmJiAhIWF1dG9ub215SGVhZGVyICYmIChlbnZBdXRvbm9teVRva2VuICYmIHNhZmVFcShhdXRvbm9teUhlYWRlciwgZW52QXV0b25vbXlUb2tlbikgfHwga3ZBdXRvbm9teVRva2VuICYmIHNhZmVFcShhdXRvbm9teUhlYWRlciwga3ZBdXRvbm9teVRva2VuKSk7CiAgICAgIGlmICh1cmwucGF0aG5hbWUuc3RhcnRzV2l0aCgiL2FkbWluIikpIHsKICAgICAgICBpZiAoIWlzQWRtaW4pIHsKICAgICAgICAgIGNvbnN0IGFsbG93ZWRBdXRvbm9teSA9IGlzQXV0b25vbXkgJiYgLy8gYm91bmRlZCBhdXRvbm9teTogZGVwbG95IHBpcGVsaW5lIG9ubHkKICAgICAgICAgICh1cmwucGF0aG5hbWUgPT09ICIvYWRtaW4vYXVyYS9kZXBsb3kvcmVxdWVzdCIgJiYgcmVxdWVzdC5tZXRob2QgPT09ICJQT1NUIiB8fCB1cmwucGF0aG5hbWUgPT09ICIvYWRtaW4vYXVyYS9kZXBsb3kvdmVyaWZ5IiAmJiByZXF1ZXN0Lm1ldGhvZCA9PT0gIlBPU1QiIHx8IHVybC5wYXRobmFtZSA9PT0gIi9hZG1pbi9hdXJhL2RlcGxveS9wcm9tb3RlIiAmJiByZXF1ZXN0Lm1ldGhvZCA9PT0gIlBPU1QiKTsKICAgICAgICAgIGlmICghYWxsb3dlZEF1dG9ub215KSB7CiAgICAgICAgICAgIHJldHVybiBqc29uKDQwMSwgeyBvazogZmFsc2UsIGVycm9yOiAidW5hdXRob3JpemVkIiB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KICAgICAgaWYgKHVybC5wYXRobmFtZSA9PT0gIi9hZG1pbi9kZXBsb3llci9wcm9iZSIgJiYgcmVxdWVzdC5tZXRob2QgPT09ICJQT1NUIikgewogICAgICAgIGlmICghaXNBZG1pbikgewogICAgICAgICAgcmV0dXJuIGpzb24oNDAzLCB7IG9rOiBmYWxzZSwgZXJyb3I6ICJyb290X29ubHkiIH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC50ZXh0KCk7CiAgICAgICAgbGV0IHBheWxvYWQyOwogICAgICAgIHRyeSB7CiAgICAgICAgICBwYXlsb2FkMiA9IEpTT04ucGFyc2UoYm9keSB8fCAie30iKTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgIHJldHVybiBqc29uKDQwMCwgeyBvazogZmFsc2UsIGVycm9yOiAiYmFkX2pzb24iIH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBwaHJhc2UgPSBleHRyYWN0UGhyYXNlKHBheWxvYWQyKSB8fCBudWxsOwogICAgICAgIGNvbnN0IG1ldGEgPSBhd2FpdCBwaHJhc2VNZXRhKHBocmFzZSk7CiAgICAgICAgY29uc3QgZXh0cmFQaHJhc2VIZWFkZXJzID0gQXJyYXkuaXNBcnJheShwYXlsb2FkMi5leHRyYV9waHJhc2VfaGVhZGVycykgPyBwYXlsb2FkMi5leHRyYV9waHJhc2VfaGVhZGVycy5tYXAoKGgpID0+IFN0cmluZyhoKSkuZmlsdGVyKChoKSA9PiBoICYmIGgubGVuZ3RoIDwgMTAwKSA6IFtdOwogICAgICAgIGNvbnN0IHF1ZXJ5UGhyYXNlID0gcGF5bG9hZDIucXVlcnlfcGhyYXNlID09PSB0cnVlOwogICAgICAgIGNvbnN0IHByb2JlSGVhZGVycyA9IHsKICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAiWC1EZXBsb3ktS2V5IjogZW52LkRFUExPWV9TRUNSRVQsCiAgICAgICAgICAuLi5waHJhc2UgPyBwaHJhc2VIZWFkZXJCdW5kbGUocGhyYXNlKSA6IHt9CiAgICAgICAgfTsKICAgICAgICBmb3IgKGNvbnN0IGggb2YgZXh0cmFQaHJhc2VIZWFkZXJzKSB7CiAgICAgICAgICBpZiAoaC50b0xvd2VyQ2FzZSgpID09PSAiY29udGVudC10eXBlIiB8fCBoLnRvTG93ZXJDYXNlKCkgPT09ICJ4LWRlcGxveS1rZXkiKSBjb250aW51ZTsKICAgICAgICAgIGlmIChwaHJhc2UpIHByb2JlSGVhZGVyc1toXSA9IFN0cmluZyhwaHJhc2UpOwogICAgICAgIH0KICAgICAgICBjb25zdCBiYXNlVXJsID0gImh0dHBzOi8vZGVwbG95ZXIvZGVwbG95IjsKICAgICAgICBjb25zdCB1cmxPdXQgPSBxdWVyeVBocmFzZSAmJiBwaHJhc2UgPyBiYXNlVXJsICsgIj9wcm9tb3Rpb25fcGhyYXNlPSIgKyBlbmNvZGVVUklDb21wb25lbnQoU3RyaW5nKHBocmFzZSkpIDogYmFzZVVybDsKICAgICAgICBjb25zdCByZXNwID0gYXdhaXQgZW52LkFVUkFfREVQTE9ZRVIuZmV0Y2godXJsT3V0LCB7CiAgICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICAgIGhlYWRlcnM6IHsKICAgICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgICAgIlgtRGVwbG95LUtleSI6IGVudi5ERVBMT1lfU0VDUkVULAogICAgICAgICAgICAuLi5waHJhc2UgPyBwaHJhc2VIZWFkZXJCdW5kbGUocGhyYXNlKSA6IHt9CiAgICAgICAgICB9LAogICAgICAgICAgYm9keQogICAgICAgIH0pOwogICAgICAgIGNvbnN0IHRleHQgPSBhd2FpdCByZXNwLnRleHQoKTsKICAgICAgICByZXR1cm4ganNvbigyMDAsIHsKICAgICAgICAgIG9rOiB0cnVlLAogICAgICAgICAgYWN0aW9uOiAiZGVwbG95ZXJfcHJvYmUiLAogICAgICAgICAgcGhyYXNlOiBtZXRhLAogICAgICAgICAgaGVhZGVyc19zZW50OiBPYmplY3Qua2V5cyhwcm9iZUhlYWRlcnMpLmZpbHRlcigoaykgPT4gIVsiY29udGVudC10eXBlIiwgIngtZGVwbG95LWtleSJdLmluY2x1ZGVzKFN0cmluZyhrKS50b0xvd2VyQ2FzZSgpKSksCiAgICAgICAgICBxdWVyeV9waHJhc2U6IHF1ZXJ5UGhyYXNlLAogICAgICAgICAgZGVwbG95ZXJfaHR0cF9zdGF0dXM6IHJlc3Auc3RhdHVzLAogICAgICAgICAgZGVwbG95ZXJfb2s6IHJlc3Aub2ssCiAgICAgICAgICBkZXBsb3llcl9ib2R5X3NuaXBwZXQ6IHNhZmVCb2R5U25pcHBldCh0ZXh0KQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmICh1cmwucGF0aG5hbWUgPT09ICIvYWRtaW4vZm91bmRyeS9kZXBsb3kiICYmIHJlcXVlc3QubWV0aG9kID09PSAiUE9TVCIpIHsKICAgICAgICBpZiAoIWlzQWRtaW4pIHsKICAgICAgICAgIHJldHVybiBqc29uKDQwMywgeyBvazogZmFsc2UsIGVycm9yOiAicm9vdF9vbmx5IiB9KTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QudGV4dCgpOwogICAgICAgIGxldCBmb3VuZHJ5UGhyYXNlID0gbnVsbDsKICAgICAgICB0cnkgewogICAgICAgICAgY29uc3QgcCA9IEpTT04ucGFyc2UoYm9keSk7CiAgICAgICAgICBmb3VuZHJ5UGhyYXNlID0gZXh0cmFjdFBocmFzZShwKTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgIGZvdW5kcnlQaHJhc2UgPSBudWxsOwogICAgICAgIH0KICAgICAgICBjb25zdCByZXNwID0gYXdhaXQgZW52LkFVUkFfREVQTE9ZRVIuZmV0Y2goImh0dHBzOi8vZGVwbG95ZXIvZGVwbG95IiwgewogICAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgICJYLURlcGxveS1LZXkiOiBlbnYuREVQTE9ZX1NFQ1JFVCwKICAgICAgICAgICAgLi4uZm91bmRyeVBocmFzZSA/IHBocmFzZUhlYWRlckJ1bmRsZShmb3VuZHJ5UGhyYXNlKSA6IHt9CiAgICAgICAgICB9LAogICAgICAgICAgYm9keQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoYXdhaXQgcmVzcC50ZXh0KCksIHsgc3RhdHVzOiByZXNwLnN0YXR1cyB9KTsKICAgICAgfQogICAgICBpZiAodXJsLnBhdGhuYW1lID09PSAiL2FkbWluL2F1cmEvc2VsZl9kZXBsb3kiICYmIHJlcXVlc3QubWV0aG9kID09PSAiUE9TVCIpIHsKICAgICAgICBpZiAoIWlzQWRtaW4pIHsKICAgICAgICAgIHJldHVybiBqc29uKDQwMywgeyBvazogZmFsc2UsIGVycm9yOiAicm9vdF9vbmx5IiB9KTsKICAgICAgICB9CiAgICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QudGV4dCgpOwogICAgICAgIGlmICghYm9keSB8fCBib2R5Lmxlbmd0aCA8IDEwKSB7CiAgICAgICAgICByZXR1cm4ganNvbig0MDAsIHsgb2s6IGZhbHNlLCBlcnJvcjogImludmFsaWRfZGVwbG95X3BheWxvYWQiIH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCByZXNwID0gYXdhaXQgZW52LkFVUkFfREVQTE9ZRVIuZmV0Y2goImh0dHBzOi8vZGVwbG95ZXIvZGVwbG95IiwgewogICAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgICBoZWFkZXJzOiB7CiAgICAgICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgICAgICJYLURlcGxveS1LZXkiOiBlbnYuREVQTE9ZX1NFQ1JFVCwKICAgICAgICAgICAgIlgtQXVyYS1BY3Rpb24iOiAic2VsZi1kZXBsb3kiCiAgICAgICAgICB9LAogICAgICAgICAgYm9keQogICAgICAgIH0pOwogICAgICAgIHJldHVybiBqc29uKHJlc3Auc3RhdHVzLCB7CiAgICAgICAgICBvazogcmVzcC5vaywKICAgICAgICAgIHN0YXR1czogcmVzcC5zdGF0dXMsCiAgICAgICAgICBhY3Rpb246ICJhdXJhX3NlbGZfZGVwbG95IiwKICAgICAgICAgIHRpbWVzdGFtcDogbm93TXMoKQogICAgICAgIH0pOwogICAgICB9CiAgICAgIGNvbnN0IEtWX0tFWVMgPSB7CiAgICAgICAgLy8gcGhyYXNlIHRpY2tldCAocm9vdC1taW50ZWQpCiAgICAgICAgcGhyYXNlOiAiZGVwbG95OnByb21vdGlvbl9waHJhc2UiLAogICAgICAgIHBocmFzZUV4cGlyZXNBdDogImRlcGxveTpwcm9tb3Rpb25fcGhyYXNlX2V4cGlyZXNfYXQiLAogICAgICAgIHBocmFzZVNpbmdsZVVzZTogImRlcGxveTpwcm9tb3Rpb25fcGhyYXNlX3NpbmdsZV91c2UiLAogICAgICAgIGxhc3RTdGFnaW5nSGFzaDogImRlcGxveTpsYXN0X3N0YWdpbmdfaGFzaCIsCiAgICAgICAgbGFzdFN0YWdpbmdBdDogImRlcGxveTpsYXN0X3N0YWdpbmdfYXQiLAogICAgICAgIGxhc3RTdGFnaW5nVmVyaWZpZWRBdDogImRlcGxveTpsYXN0X3N0YWdpbmdfdmVyaWZpZWRfYXQiLAogICAgICAgIGxhc3RTdGFnaW5nVmVyaWZ5VXJsOiAiZGVwbG95Omxhc3Rfc3RhZ2luZ192ZXJpZnlfdXJsIiwKICAgICAgICBsYXN0U3RhZ2luZ1ZlcmlmeU1vZGU6ICJkZXBsb3k6bGFzdF9zdGFnaW5nX3ZlcmlmeV9tb2RlIiwKICAgICAgICBsYXN0UHJvZEhhc2g6ICJkZXBsb3k6bGFzdF9wcm9kX2hhc2giLAogICAgICAgIGxhc3RQcm9kQXQ6ICJkZXBsb3k6bGFzdF9wcm9kX2F0IiwKICAgICAgICBsYXN0S25vd25Hb29kUHJvZEhhc2g6ICJkZXBsb3k6bGFzdF9rbm93bl9nb29kX3Byb2RfaGFzaCIsCiAgICAgICAgbGFzdEtub3duR29vZFByb2RBdDogImRlcGxveTpsYXN0X2tub3duX2dvb2RfcHJvZF9hdCIKICAgICAgfTsKICAgICAgYXN5bmMgZnVuY3Rpb24gcmVhZFN0YXR1cygpIHsKICAgICAgICBjb25zdCBbCiAgICAgICAgICBsYXN0U3RhZ2luZ0hhc2gsCiAgICAgICAgICBsYXN0U3RhZ2luZ0F0LAogICAgICAgICAgbGFzdFN0YWdpbmdWZXJpZmllZEF0LAogICAgICAgICAgbGFzdFN0YWdpbmdWZXJpZnlVcmwsCiAgICAgICAgICBsYXN0U3RhZ2luZ1ZlcmlmeU1vZGUsCiAgICAgICAgICBsYXN0UHJvZEhhc2gsCiAgICAgICAgICBsYXN0UHJvZEF0LAogICAgICAgICAgbGFzdEtub3duR29vZFByb2RIYXNoLAogICAgICAgICAgbGFzdEtub3duR29vZFByb2RBdAogICAgICAgIF0gPSBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgICBLVi5nZXQoS1ZfS0VZUy5sYXN0U3RhZ2luZ0hhc2gpLAogICAgICAgICAgS1YuZ2V0KEtWX0tFWVMubGFzdFN0YWdpbmdBdCksCiAgICAgICAgICBLVi5nZXQoS1ZfS0VZUy5sYXN0U3RhZ2luZ1ZlcmlmaWVkQXQpLAogICAgICAgICAgS1YuZ2V0KEtWX0tFWVMubGFzdFN0YWdpbmdWZXJpZnlVcmwpLAogICAgICAgICAgS1YuZ2V0KEtWX0tFWVMubGFzdFN0YWdpbmdWZXJpZnlNb2RlKSwKICAgICAgICAgIEtWLmdldChLVl9LRVlTLmxhc3RQcm9kSGFzaCksCiAgICAgICAgICBLVi5nZXQoS1ZfS0VZUy5sYXN0UHJvZEF0KSwKICAgICAgICAgIEtWLmdldChLVl9LRVlTLmxhc3RLbm93bkdvb2RQcm9kSGFzaCksCiAgICAgICAgICBLVi5nZXQoS1ZfS0VZUy5sYXN0S25vd25Hb29kUHJvZEF0KQogICAgICAgIF0pOwogICAgICAgIHJldHVybiB7CiAgICAgICAgICBsYXN0X3N0YWdpbmdfaGFzaDogbGFzdFN0YWdpbmdIYXNoIHx8IG51bGwsCiAgICAgICAgICBsYXN0X3N0YWdpbmdfYXQ6IGxhc3RTdGFnaW5nQXQgPyBOdW1iZXIobGFzdFN0YWdpbmdBdCkgOiBudWxsLAogICAgICAgICAgbGFzdF9zdGFnaW5nX3ZlcmlmaWVkX2F0OiBsYXN0U3RhZ2luZ1ZlcmlmaWVkQXQgPyBOdW1iZXIobGFzdFN0YWdpbmdWZXJpZmllZEF0KSA6IG51bGwsCiAgICAgICAgICBsYXN0X3N0YWdpbmdfdmVyaWZ5X3VybDogbGFzdFN0YWdpbmdWZXJpZnlVcmwgfHwgbnVsbCwKICAgICAgICAgIGxhc3Rfc3RhZ2luZ192ZXJpZnlfbW9kZTogbGFzdFN0YWdpbmdWZXJpZnlNb2RlIHx8IG51bGwsCiAgICAgICAgICBsYXN0X3Byb2RfaGFzaDogbGFzdFByb2RIYXNoIHx8IG51bGwsCiAgICAgICAgICBsYXN0X3Byb2RfYXQ6IGxhc3RQcm9kQXQgPyBOdW1iZXIobGFzdFByb2RBdCkgOiBudWxsLAogICAgICAgICAgbGFzdF9rbm93bl9nb29kX3Byb2RfaGFzaDogbGFzdEtub3duR29vZFByb2RIYXNoIHx8IG51bGwsCiAgICAgICAgICBsYXN0X2tub3duX2dvb2RfcHJvZF9hdDogbGFzdEtub3duR29vZFByb2RBdCA/IE51bWJlcihsYXN0S25vd25Hb29kUHJvZEF0KSA6IG51bGwKICAgICAgICB9OwogICAgICB9CiAgICAgIF9fbmFtZShyZWFkU3RhdHVzLCAicmVhZFN0YXR1cyIpOwogICAgICBhc3luYyBmdW5jdGlvbiBzZXRQaHJhc2VUaWNrZXQocGhyYXNlLCB0dGxNcywgc2luZ2xlVXNlKSB7CiAgICAgICAgY29uc3QgZXhwaXJlc0F0ID0gbm93TXMoKSArICh0dGxNcyB8fCAxMCAqIDYwICogMWUzKTsKICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgICBLVi5wdXQoS1ZfS0VZUy5waHJhc2UsIFN0cmluZyhwaHJhc2UpKSwKICAgICAgICAgIEtWLnB1dChLVl9LRVlTLnBocmFzZUV4cGlyZXNBdCwgU3RyaW5nKGV4cGlyZXNBdCkpLAogICAgICAgICAgS1YucHV0KEtWX0tFWVMucGhyYXNlU2luZ2xlVXNlLCBzaW5nbGVVc2UgPyAidHJ1ZSIgOiAiZmFsc2UiKQogICAgICAgIF0pOwogICAgICAgIHJldHVybiB7IHBocmFzZV9zZXQ6IHRydWUsIGV4cGlyZXNfYXQ6IGV4cGlyZXNBdCwgc2luZ2xlX3VzZTogISFzaW5nbGVVc2UgfTsKICAgICAgfQogICAgICBfX25hbWUoc2V0UGhyYXNlVGlja2V0LCAic2V0UGhyYXNlVGlja2V0Iik7CiAgICAgIGFzeW5jIGZ1bmN0aW9uIGNsZWFyUGhyYXNlVGlja2V0KCkgewogICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFsKICAgICAgICAgIEtWLmRlbGV0ZShLVl9LRVlTLnBocmFzZSksCiAgICAgICAgICBLVi5kZWxldGUoS1ZfS0VZUy5waHJhc2VFeHBpcmVzQXQpLAogICAgICAgICAgS1YuZGVsZXRlKEtWX0tFWVMucGhyYXNlU2luZ2xlVXNlKQogICAgICAgIF0pOwogICAgICAgIHJldHVybiB7IHBocmFzZV9jbGVhcmVkOiB0cnVlIH07CiAgICAgIH0KICAgICAgX19uYW1lKGNsZWFyUGhyYXNlVGlja2V0LCAiY2xlYXJQaHJhc2VUaWNrZXQiKTsKICAgICAgYXN5bmMgZnVuY3Rpb24gZ2V0UGhyYXNlVGlja2V0KCkgewogICAgICAgIGNvbnN0IFtwaHJhc2UsIGV4cGlyZXNBdCwgc2luZ2xlVXNlXSA9IGF3YWl0IFByb21pc2UuYWxsKFsKICAgICAgICAgIEtWLmdldChLVl9LRVlTLnBocmFzZSksCiAgICAgICAgICBLVi5nZXQoS1ZfS0VZUy5waHJhc2VFeHBpcmVzQXQpLAogICAgICAgICAgS1YuZ2V0KEtWX0tFWVMucGhyYXNlU2luZ2xlVXNlKQogICAgICAgIF0pOwogICAgICAgIGNvbnN0IGV4cCA9IGV4cGlyZXNBdCA/IE51bWJlcihleHBpcmVzQXQpIDogbnVsbDsKICAgICAgICBjb25zdCBpc0V4cGlyZWQgPSBleHAgIT0gbnVsbCAmJiBub3dNcygpID4gZXhwOwogICAgICAgIGlmICghcGhyYXNlIHx8ICFleHAgfHwgaXNFeHBpcmVkKSB7CiAgICAgICAgICByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiAibm9fdmFsaWRfcGhyYXNlX3RpY2tldCIgfTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHsgb2s6IHRydWUsIHBocmFzZTogU3RyaW5nKHBocmFzZSksIGV4cGlyZXNfYXQ6IGV4cCwgc2luZ2xlX3VzZTogc2luZ2xlVXNlID09PSAidHJ1ZSIgfTsKICAgICAgfQogICAgICBfX25hbWUoZ2V0UGhyYXNlVGlja2V0LCAiZ2V0UGhyYXNlVGlja2V0Iik7CiAgICAgIGFzeW5jIGZ1bmN0aW9uIGNvbnN1bWVQaHJhc2VJZk5lZWRlZCh0aWNrZXQpIHsKICAgICAgICBpZiAodGlja2V0ICYmIHRpY2tldC5zaW5nbGVfdXNlKSB7CiAgICAgICAgICBhd2FpdCBjbGVhclBocmFzZVRpY2tldCgpOwogICAgICAgIH0KICAgICAgfQogICAgICBfX25hbWUoY29uc3VtZVBocmFzZUlmTmVlZGVkLCAiY29uc3VtZVBocmFzZUlmTmVlZGVkIik7CiAgICAgIGlmICh1cmwucGF0aG5hbWUgPT09ICIvYWRtaW4vYXVyYS9kZXBsb3kvc3RhdHVzIiAmJiByZXF1ZXN0Lm1ldGhvZCA9PT0gIkdFVCIpIHsKICAgICAgICBpZiAoIWlzQWRtaW4pIHsKICAgICAgICAgIHJldHVybiBqc29uKDQwMywgeyBvazogZmFsc2UsIGVycm9yOiAicm9vdF9vbmx5IiB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKCFpc0FkbWluKSB7CiAgICAgICAgICBpZiAoIXBheWxvYWQucHJvbW90aW9uX3BocmFzZSkgewogICAgICAgICAgICBjb25zdCB0aWNrZXQgPSBhd2FpdCBnZXRQaHJhc2VUaWNrZXQoKTsKICAgICAgICAgICAgaWYgKCF0aWNrZXQub2spIHsKICAgICAgICAgICAgICByZXR1cm4ganNvbig0MDksIHsgb2s6IGZhbHNlLCBlcnJvcjogInByb21vdGlvbl9waHJhc2VfcmVxdWlyZWQiLCBtZXNzYWdlOiAiUm9vdCBtdXN0IHNldCBhIHBocmFzZSB0aWNrZXQgdmlhIC9hZG1pbi9hdXJhL2RlcGxveS9waHJhc2UgYmVmb3JlIGF1dG9ub215IGNhbiBwcm9tb3RlLiIgfSk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgcGF5bG9hZC5wcm9tb3Rpb25fcGhyYXNlID0gdGlja2V0LnBocmFzZTsKICAgICAgICAgICAgcGF5bG9hZC5fX2t2X3BocmFzZV90aWNrZXQgPSB0aWNrZXQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IHN0YXR1cyA9IGF3YWl0IHJlYWRTdGF0dXMoKTsKICAgICAgICByZXR1cm4ganNvbigyMDAsIHsgb2s6IHRydWUsIHN0YXR1cyB9KTsKICAgICAgfQogICAgICBpZiAodXJsLnBhdGhuYW1lID09PSAiL2FkbWluL2F1cmEvZGVwbG95L3BocmFzZSIgJiYgcmVxdWVzdC5tZXRob2QgPT09ICJQT1NUIikgewogICAgICAgIGlmICghaXNBZG1pbikgewogICAgICAgICAgcmV0dXJuIGpzb24oNDAzLCB7IG9rOiBmYWxzZSwgZXJyb3I6ICJyb290X29ubHkiIH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC50ZXh0KCk7CiAgICAgICAgbGV0IHBheWxvYWQyOwogICAgICAgIHRyeSB7CiAgICAgICAgICBwYXlsb2FkMiA9IEpTT04ucGFyc2UoYm9keSB8fCAie30iKTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgIHJldHVybiBqc29uKDQwMCwgeyBvazogZmFsc2UsIGVycm9yOiAiYmFkX2pzb24iIH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBwaHJhc2UgPSBwYXlsb2FkMi5wcm9tb3Rpb25fcGhyYXNlIHx8IHBheWxvYWQyLnBocmFzZSB8fCBwYXlsb2FkMi52YWx1ZTsKICAgICAgICBpZiAoIXBocmFzZSB8fCBTdHJpbmcocGhyYXNlKS5sZW5ndGggPCAzKSB7CiAgICAgICAgICByZXR1cm4ganNvbig0MDAsIHsgb2s6IGZhbHNlLCBlcnJvcjogIm1pc3NpbmdfcHJvbW90aW9uX3BocmFzZSIgfSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHR0bE1zID0gcGF5bG9hZDIudHRsX21zID8gTnVtYmVyKHBheWxvYWQyLnR0bF9tcykgOiAxMCAqIDYwICogMWUzOwogICAgICAgIGNvbnN0IHNpbmdsZVVzZSA9IHBheWxvYWQyLnNpbmdsZV91c2UgIT09IGZhbHNlOwogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IHNldFBocmFzZVRpY2tldChTdHJpbmcocGhyYXNlKSwgdHRsTXMsIHNpbmdsZVVzZSk7CiAgICAgICAgcmV0dXJuIGpzb24oMjAwLCB7IG9rOiB0cnVlLCBhY3Rpb246ICJwaHJhc2VfdGlja2V0X3NldCIsIC4uLnJlc3VsdCB9KTsKICAgICAgfQogICAgICBpZiAodXJsLnBhdGhuYW1lID09PSAiL2FkbWluL2F1cmEvZGVwbG95L3BocmFzZSIgJiYgcmVxdWVzdC5tZXRob2QgPT09ICJERUxFVEUiKSB7CiAgICAgICAgaWYgKCFpc0FkbWluKSB7CiAgICAgICAgICByZXR1cm4ganNvbig0MDMsIHsgb2s6IGZhbHNlLCBlcnJvcjogInJvb3Rfb25seSIgfSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHJlc3VsdCA9IGF3YWl0IGNsZWFyUGhyYXNlVGlja2V0KCk7CiAgICAgICAgcmV0dXJuIGpzb24oMjAwLCB7IG9rOiB0cnVlLCBhY3Rpb246ICJwaHJhc2VfdGlja2V0X2NsZWFyZWQiLCAuLi5yZXN1bHQgfSk7CiAgICAgIH0KICAgICAgaWYgKHVybC5wYXRobmFtZSA9PT0gIi9hZG1pbi9hdXJhL2RlcGxveS9yZXF1ZXN0IiAmJiByZXF1ZXN0Lm1ldGhvZCA9PT0gIlBPU1QiKSB7CiAgICAgICAgY29uc3QgYm9keSA9IGF3YWl0IHJlcXVlc3QudGV4dCgpOwogICAgICAgIGlmICghYm9keSB8fCBib2R5Lmxlbmd0aCA8IDEwKSB7CiAgICAgICAgICByZXR1cm4ganNvbig0MDAsIHsgb2s6IGZhbHNlLCBlcnJvcjogImludmFsaWRfZGVwbG95X3BheWxvYWQiIH0pOwogICAgICAgIH0KICAgICAgICBsZXQgcGF5bG9hZDI7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIHBheWxvYWQyID0gSlNPTi5wYXJzZShib2R5KTsKICAgICAgICB9IGNhdGNoIHsKICAgICAgICAgIHJldHVybiBqc29uKDQwMCwgeyBvazogZmFsc2UsIGVycm9yOiAiYmFkX2pzb24iIH0pOwogICAgICAgIH0KICAgICAgICBpZiAoIWlzQWRtaW4pIHsKICAgICAgICAgIGlmICghcGF5bG9hZDIucHJvbW90aW9uX3BocmFzZSkgewogICAgICAgICAgICBjb25zdCB0aWNrZXQgPSBhd2FpdCBnZXRQaHJhc2VUaWNrZXQoKTsKICAgICAgICAgICAgaWYgKCF0aWNrZXQub2spIHsKICAgICAgICAgICAgICByZXR1cm4ganNvbig0MDksIHsgb2s6IGZhbHNlLCBlcnJvcjogInByb21vdGlvbl9waHJhc2VfcmVxdWlyZWQiLCBtZXNzYWdlOiAiUm9vdCBtdXN0IHNldCBhIHBocmFzZSB0aWNrZXQgdmlhIC9hZG1pbi9hdXJhL2RlcGxveS9waHJhc2UgYmVmb3JlIGF1dG9ub215IGNhbiBkZXBsb3kuIiB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXlsb2FkMi5wcm9tb3Rpb25fcGhyYXNlID0gdGlja2V0LnBocmFzZTsKICAgICAgICAgICAgcGF5bG9hZDIuX19rdl9waHJhc2VfdGlja2V0ID0gdGlja2V0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCB0YXJnZXQgPSBwYXlsb2FkMiAmJiAocGF5bG9hZDIudGFyZ2V0IHx8IHBheWxvYWQyLmVudiB8fCBwYXlsb2FkMi5lbnZpcm9ubWVudCkgfHwgcmVxdWVzdC5oZWFkZXJzLmdldCgiWC1BdXJhLURlcGxveS1UYXJnZXQiKSB8fCAic3RhZ2luZyI7CiAgICAgICAgaWYgKCFpc0FkbWluKSB7CiAgICAgICAgICBjb25zdCB0ID0gU3RyaW5nKHRhcmdldCkudG9Mb3dlckNhc2UoKTsKICAgICAgICAgIGlmICh0ICE9PSAic3RhZ2luZyIpIHsKICAgICAgICAgICAgcmV0dXJuIGpzb24oNDAzLCB7IG9rOiBmYWxzZSwgZXJyb3I6ICJhdXRvbm9teV9zdGFnaW5nX29ubHkiIH0pOwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBpZiAoU3RyaW5nKHRhcmdldCkudG9Mb3dlckNhc2UoKSA9PT0gInByb2QiIHx8IFN0cmluZyh0YXJnZXQpLnRvTG93ZXJDYXNlKCkgPT09ICJwcm9kdWN0aW9uIikgewogICAgICAgICAgaWYgKCFpc0FkbWluKSB7CiAgICAgICAgICAgIGlmICghcGF5bG9hZDIucHJvbW90aW9uX3BocmFzZSkgewogICAgICAgICAgICAgIGNvbnN0IHRpY2tldCA9IGF3YWl0IGdldFBocmFzZVRpY2tldCgpOwogICAgICAgICAgICAgIGlmICghdGlja2V0Lm9rKSB7CiAgICAgICAgICAgICAgICByZXR1cm4ganNvbig0MDksIHsgb2s6IGZhbHNlLCBlcnJvcjogInByb21vdGlvbl9waHJhc2VfcmVxdWlyZWQiLCBtZXNzYWdlOiAiUm9vdCBtdXN0IHNldCBhIHBocmFzZSB0aWNrZXQgdmlhIC9hZG1pbi9hdXJhL2RlcGxveS9waHJhc2UgYmVmb3JlIGF1dG9ub215IGNhbiBwcm9tb3RlLiIgfSk7CiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHBheWxvYWQyLnByb21vdGlvbl9waHJhc2UgPSB0aWNrZXQucGhyYXNlOwogICAgICAgICAgICAgIHBheWxvYWQyLl9fa3ZfcGhyYXNlX3RpY2tldCA9IHRpY2tldDsKICAgICAgICAgICAgfQogICAgICAgICAgfQogICAgICAgICAgY29uc3Qgc3RhdHVzID0gYXdhaXQgcmVhZFN0YXR1cygpOwogICAgICAgICAgaWYgKCFzdGF0dXMubGFzdF9zdGFnaW5nX2hhc2ggfHwgIXN0YXR1cy5sYXN0X3N0YWdpbmdfdmVyaWZpZWRfYXQpIHsKICAgICAgICAgICAgcmV0dXJuIGpzb24oNDA5LCB7CiAgICAgICAgICAgICAgb2s6IGZhbHNlLAogICAgICAgICAgICAgIGVycm9yOiAic3RhZ2luZ19yZXF1aXJlZCIsCiAgICAgICAgICAgICAgbWVzc2FnZTogIlN0YWdpbmcgZGVwbG95ICsgdmVyaWZ5IGlzIHJlcXVpcmVkIGJlZm9yZSBwcm9kIHByb21vdGlvbi4iCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgY29uc3QgcHJvbW90aW5nSGFzaCA9IHBheWxvYWQyLnByb21vdGluZ19oYXNoIHx8IHBheWxvYWQyLnN0YWdpbmdfaGFzaCB8fCByZXF1ZXN0LmhlYWRlcnMuZ2V0KCJYLUF1cmEtUHJvbW90aW5nLUhhc2giKTsKICAgICAgICAgIGlmICghcHJvbW90aW5nSGFzaCB8fCBwcm9tb3RpbmdIYXNoICE9PSBzdGF0dXMubGFzdF9zdGFnaW5nX2hhc2gpIHsKICAgICAgICAgICAgcmV0dXJuIGpzb24oNDA5LCB7CiAgICAgICAgICAgICAgb2s6IGZhbHNlLAogICAgICAgICAgICAgIGVycm9yOiAicHJvbW90aW5nX2hhc2hfbWlzbWF0Y2giLAogICAgICAgICAgICAgIHJlcXVpcmVkOiBzdGF0dXMubGFzdF9zdGFnaW5nX2hhc2gKICAgICAgICAgICAgfSk7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IGJvZHlUb1NlbmQgPSBKU09OLnN0cmluZ2lmeShwYXlsb2FkMik7CiAgICAgICAgY29uc3QgYm9keUhhc2ggPSBhd2FpdCBzaGEyNTZIZXgoYm9keVRvU2VuZCk7CiAgICAgICAgaWYgKFN0cmluZyh0YXJnZXQpLnRvTG93ZXJDYXNlKCkgPT09ICJzdGFnaW5nIikgewogICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoWwogICAgICAgICAgICBLVi5wdXQoS1ZfS0VZUy5sYXN0U3RhZ2luZ0hhc2gsIGJvZHlIYXNoKSwKICAgICAgICAgICAgS1YucHV0KEtWX0tFWVMubGFzdFN0YWdpbmdBdCwgU3RyaW5nKG5vd01zKCkpKSwKICAgICAgICAgICAgS1YucHV0KEtWX0tFWVMubGFzdFN0YWdpbmdWZXJpZmllZEF0LCAiIiksCiAgICAgICAgICAgIEtWLnB1dChLVl9LRVlTLmxhc3RTdGFnaW5nVmVyaWZ5VXJsLCAiIiksCiAgICAgICAgICAgIEtWLnB1dChLVl9LRVlTLmxhc3RTdGFnaW5nVmVyaWZ5TW9kZSwgIiIpCiAgICAgICAgICBdKTsKICAgICAgICB9CiAgICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IGVudi5BVVJBX0RFUExPWUVSLmZldGNoKCJodHRwczovL2RlcGxveWVyL2RlcGxveSIsIHsKICAgICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICAgICAiWC1EZXBsb3ktS2V5IjogZW52LkRFUExPWV9TRUNSRVQsCiAgICAgICAgICAgICJYLUF1cmEtQWN0aW9uIjogaXNBZG1pbiA/ICJkZXBsb3ktcmVxdWVzdC1yb290IiA6ICJkZXBsb3ktcmVxdWVzdC1hdXRvbm9teSIsCiAgICAgICAgICAgIC4uLnBheWxvYWQyICYmIHBheWxvYWQyLnByb21vdGlvbl9waHJhc2UgPyBwaHJhc2VIZWFkZXJCdW5kbGUocGF5bG9hZDIucHJvbW90aW9uX3BocmFzZSkgOiB7fQogICAgICAgICAgfSwKICAgICAgICAgIGJvZHk6IGJvZHlUb1NlbmQKICAgICAgICB9KTsKICAgICAgICBjb25zdCBkZXBsb3llclRleHQgPSBhd2FpdCByZXNwLnRleHQoKTsKICAgICAgICBjb25zdCBkZXBsb3llclNuaXBwZXQgPSBzYWZlQm9keVNuaXBwZXQoZGVwbG95ZXJUZXh0KTsKICAgICAgICBpZiAoIWlzQWRtaW4gJiYgcGF5bG9hZDIuX19rdl9waHJhc2VfdGlja2V0ICYmIHJlc3Aub2spIHsKICAgICAgICAgIGF3YWl0IGNvbnN1bWVQaHJhc2VJZk5lZWRlZChwYXlsb2FkMi5fX2t2X3BocmFzZV90aWNrZXQpOwogICAgICAgIH0KICAgICAgICBpZiAoIWlzQWRtaW4gJiYgcGF5bG9hZDIuX19rdl9waHJhc2VfdGlja2V0ICYmIHJlc3Aub2spIHsKICAgICAgICAgIGF3YWl0IGNvbnN1bWVQaHJhc2VJZk5lZWRlZChwYXlsb2FkMi5fX2t2X3BocmFzZV90aWNrZXQpOwogICAgICAgIH0KICAgICAgICBpZiAocmVzcC5vayAmJiAoU3RyaW5nKHRhcmdldCkudG9Mb3dlckNhc2UoKSA9PT0gInByb2QiIHx8IFN0cmluZyh0YXJnZXQpLnRvTG93ZXJDYXNlKCkgPT09ICJwcm9kdWN0aW9uIikpIHsKICAgICAgICAgIGF3YWl0IFByb21pc2UuYWxsKFsKICAgICAgICAgICAgS1YucHV0KEtWX0tFWVMubGFzdFByb2RIYXNoLCBib2R5SGFzaCksCiAgICAgICAgICAgIEtWLnB1dChLVl9LRVlTLmxhc3RQcm9kQXQsIFN0cmluZyhub3dNcygpKSksCiAgICAgICAgICAgIEtWLnB1dChLVl9LRVlTLmxhc3RLbm93bkdvb2RQcm9kSGFzaCwgYm9keUhhc2gpLAogICAgICAgICAgICBLVi5wdXQoS1ZfS0VZUy5sYXN0S25vd25Hb29kUHJvZEF0LCBTdHJpbmcobm93TXMoKSkpCiAgICAgICAgICBdKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIGpzb24ocmVzcC5zdGF0dXMsIHsKICAgICAgICAgIG9rOiByZXNwLm9rLAogICAgICAgICAgc3RhdHVzOiByZXNwLnN0YXR1cywKICAgICAgICAgIGFjdGlvbjogImRlcGxveV9yZXF1ZXN0IiwKICAgICAgICAgIHRhcmdldDogU3RyaW5nKHRhcmdldCksCiAgICAgICAgICBoYXNoOiBib2R5SGFzaCwKICAgICAgICAgIHRpbWVzdGFtcDogbm93TXMoKSwKICAgICAgICAgIGF1dGg6IGlzQWRtaW4gPyAicm9vdCIgOiAiYXV0b25vbXkiLAogICAgICAgICAgZGVwbG95ZXJfaHR0cF9zdGF0dXM6IHJlc3Auc3RhdHVzLAogICAgICAgICAgZGVwbG95ZXJfYm9keV9zbmlwcGV0OiBkZXBsb3llclNuaXBwZXQKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAodXJsLnBhdGhuYW1lID09PSAiL2FkbWluL2F1cmEvZGVwbG95L3ZlcmlmeSIgJiYgcmVxdWVzdC5tZXRob2QgPT09ICJQT1NUIikgewogICAgICAgIGNvbnN0IGJvZHkgPSBhd2FpdCByZXF1ZXN0LnRleHQoKTsKICAgICAgICBsZXQgcGF5bG9hZDIgPSB7fTsKICAgICAgICBpZiAoYm9keSAmJiBib2R5LnRyaW0oKS5sZW5ndGgpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIHBheWxvYWQyID0gSlNPTi5wYXJzZShib2R5KTsKICAgICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgICByZXR1cm4ganNvbig0MDAsIHsgb2s6IGZhbHNlLCBlcnJvcjogImJhZF9qc29uIiB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKCFpc0FkbWluKSB7CiAgICAgICAgICBpZiAoIXBheWxvYWQyLnByb21vdGlvbl9waHJhc2UpIHsKICAgICAgICAgICAgY29uc3QgdGlja2V0ID0gYXdhaXQgZ2V0UGhyYXNlVGlja2V0KCk7CiAgICAgICAgICAgIGlmICghdGlja2V0Lm9rKSB7CiAgICAgICAgICAgICAgcmV0dXJuIGpzb24oNDA5LCB7IG9rOiBmYWxzZSwgZXJyb3I6ICJwcm9tb3Rpb25fcGhyYXNlX3JlcXVpcmVkIiwgbWVzc2FnZTogIlJvb3QgbXVzdCBzZXQgYSBwaHJhc2UgdGlja2V0IHZpYSAvYWRtaW4vYXVyYS9kZXBsb3kvcGhyYXNlIGJlZm9yZSBhdXRvbm9teSBjYW4gcHJvbW90ZS4iIH0pOwogICAgICAgICAgICB9CiAgICAgICAgICAgIHBheWxvYWQyLnByb21vdGlvbl9waHJhc2UgPSB0aWNrZXQucGhyYXNlOwogICAgICAgICAgICBwYXlsb2FkMi5fX2t2X3BocmFzZV90aWNrZXQgPSB0aWNrZXQ7CiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGNvbnN0IHN0YXR1cyA9IGF3YWl0IHJlYWRTdGF0dXMoKTsKICAgICAgICBpZiAoIXN0YXR1cy5sYXN0X3N0YWdpbmdfaGFzaCkgewogICAgICAgICAgcmV0dXJuIGpzb24oNDA5LCB7IG9rOiBmYWxzZSwgZXJyb3I6ICJub19zdGFnaW5nX2RlcGxveV90b192ZXJpZnkiIH0pOwogICAgICAgIH0KICAgICAgICBjb25zdCBtb2RlID0gcGF5bG9hZDIgJiYgcGF5bG9hZDIubW9kZSB8fCByZXF1ZXN0LmhlYWRlcnMuZ2V0KCJYLUF1cmEtVmVyaWZ5LU1vZGUiKSB8fCAiZmV0Y2hfZmFsbGJhY2tfbG9jYWwiOwogICAgICAgIGNvbnN0IGhlYWx0aFVybCA9IHBheWxvYWQyLmhlYWx0aF91cmwgfHwgcGF5bG9hZDIudXJsIHx8IHJlcXVlc3QuaGVhZGVycy5nZXQoIlgtQXVyYS1IZWFsdGgtVXJsIikgfHwgbnVsbDsKICAgICAgICBpZiAoIWlzQWRtaW4pIHsKICAgICAgICAgIGlmIChTdHJpbmcobW9kZSkudG9Mb3dlckNhc2UoKSAhPT0gImxvY2FsIikgewogICAgICAgICAgICByZXR1cm4ganNvbig0MDMsIHsgb2s6IGZhbHNlLCBlcnJvcjogImF1dG9ub215X2xvY2FsX3ZlcmlmeV9vbmx5IiB9KTsKICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgaWYgKFN0cmluZyhtb2RlKS50b0xvd2VyQ2FzZSgpID09PSAibG9jYWwiKSB7CiAgICAgICAgICBjb25zdCBoZWFsdGhKc29uMiA9IGJ1aWxkSGVhbHRoT2JqZWN0KCk7CiAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgICAgIEtWLnB1dChLVl9LRVlTLmxhc3RTdGFnaW5nVmVyaWZpZWRBdCwgU3RyaW5nKG5vd01zKCkpKSwKICAgICAgICAgICAgS1YucHV0KEtWX0tFWVMubGFzdFN0YWdpbmdWZXJpZnlVcmwsIGhlYWx0aFVybCA/IFN0cmluZyhoZWFsdGhVcmwpIDogImxvY2FsIiksCiAgICAgICAgICAgIEtWLnB1dChLVl9LRVlTLmxhc3RTdGFnaW5nVmVyaWZ5TW9kZSwgImxvY2FsIikKICAgICAgICAgIF0pOwogICAgICAgICAgcmV0dXJuIGpzb24oMjAwLCB7CiAgICAgICAgICAgIG9rOiB0cnVlLAogICAgICAgICAgICBhY3Rpb246ICJzdGFnaW5nX3ZlcmlmaWVkIiwKICAgICAgICAgICAgc3RhZ2luZ19oYXNoOiBzdGF0dXMubGFzdF9zdGFnaW5nX2hhc2gsCiAgICAgICAgICAgIHZlcmlmaWVkX2F0OiBub3dNcygpLAogICAgICAgICAgICB2ZXJpZnlfbW9kZTogImxvY2FsIiwKICAgICAgICAgICAgaGVhbHRoOiBoZWFsdGhKc29uMiwKICAgICAgICAgICAgYXV0aDogaXNBZG1pbiA/ICJyb290IiA6ICJhdXRvbm9teSIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBpZiAoIWhlYWx0aFVybCkgewogICAgICAgICAgcmV0dXJuIGpzb24oNDAwLCB7CiAgICAgICAgICAgIG9rOiBmYWxzZSwKICAgICAgICAgICAgZXJyb3I6ICJtaXNzaW5nX2hlYWx0aF91cmwiLAogICAgICAgICAgICBtZXNzYWdlOiAiUHJvdmlkZSBoZWFsdGhfdXJsIG9yIHNldCBtb2RlPWxvY2FsLiIKICAgICAgICAgIH0pOwogICAgICAgIH0KICAgICAgICBsZXQgcmVzcDsKICAgICAgICBsZXQgdHh0OwogICAgICAgIHRyeSB7CiAgICAgICAgICByZXNwID0gYXdhaXQgZmV0Y2hXaXRoVGltZW91dChoZWFsdGhVcmwsIDhlMyk7CiAgICAgICAgICB0eHQgPSBhd2FpdCByZXNwLnRleHQoKTsKICAgICAgICB9IGNhdGNoIChlKSB7CiAgICAgICAgICBpZiAoU3RyaW5nKG1vZGUpLnRvTG93ZXJDYXNlKCkgPT09ICJmZXRjaF9mYWxsYmFja19sb2NhbCIpIHsKICAgICAgICAgICAgY29uc3QgaGVhbHRoSnNvbjIgPSBidWlsZEhlYWx0aE9iamVjdCgpOwogICAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgICAgICAgS1YucHV0KEtWX0tFWVMubGFzdFN0YWdpbmdWZXJpZmllZEF0LCBTdHJpbmcobm93TXMoKSkpLAogICAgICAgICAgICAgIEtWLnB1dChLVl9LRVlTLmxhc3RTdGFnaW5nVmVyaWZ5VXJsLCBTdHJpbmcoaGVhbHRoVXJsKSksCiAgICAgICAgICAgICAgS1YucHV0KEtWX0tFWVMubGFzdFN0YWdpbmdWZXJpZnlNb2RlLCAiZmFsbGJhY2tfbG9jYWxfYWZ0ZXJfZmV0Y2hfZXJyb3IiKQogICAgICAgICAgICBdKTsKICAgICAgICAgICAgcmV0dXJuIGpzb24oMjAwLCB7CiAgICAgICAgICAgICAgb2s6IHRydWUsCiAgICAgICAgICAgICAgYWN0aW9uOiAic3RhZ2luZ192ZXJpZmllZCIsCiAgICAgICAgICAgICAgc3RhZ2luZ19oYXNoOiBzdGF0dXMubGFzdF9zdGFnaW5nX2hhc2gsCiAgICAgICAgICAgICAgdmVyaWZpZWRfYXQ6IG5vd01zKCksCiAgICAgICAgICAgICAgdmVyaWZ5X21vZGU6ICJmYWxsYmFja19sb2NhbF9hZnRlcl9mZXRjaF9lcnJvciIsCiAgICAgICAgICAgICAgZmV0Y2hfZXJyb3I6IHsKICAgICAgICAgICAgICAgIG5hbWU6IGUgJiYgZS5uYW1lID8gU3RyaW5nKGUubmFtZSkgOiBudWxsLAogICAgICAgICAgICAgICAgbWVzc2FnZTogZSAmJiBlLm1lc3NhZ2UgPyBTdHJpbmcoZS5tZXNzYWdlKSA6IG51bGwKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGhlYWx0aDogaGVhbHRoSnNvbjIsCiAgICAgICAgICAgICAgYXV0aDogInJvb3QiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGpzb24oNTAyLCB7CiAgICAgICAgICAgIG9rOiBmYWxzZSwKICAgICAgICAgICAgZXJyb3I6ICJoZWFsdGhfZmV0Y2hfZXJyb3IiLAogICAgICAgICAgICBuYW1lOiBlICYmIGUubmFtZSA/IFN0cmluZyhlLm5hbWUpIDogbnVsbCwKICAgICAgICAgICAgbWVzc2FnZTogZSAmJiBlLm1lc3NhZ2UgPyBTdHJpbmcoZS5tZXNzYWdlKSA6IG51bGwsCiAgICAgICAgICAgIGhlYWx0aF91cmw6IFN0cmluZyhoZWFsdGhVcmwpCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgY29uc3QgY29udGVudFR5cGUgPSBzYWZlSGVhZGVyVmFsdWUocmVzcC5oZWFkZXJzLmdldCgiY29udGVudC10eXBlIikpOwogICAgICAgIGxldCBoZWFsdGhKc29uOwogICAgICAgIHRyeSB7CiAgICAgICAgICBoZWFsdGhKc29uID0gSlNPTi5wYXJzZSh0eHQpOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgaWYgKFN0cmluZyhtb2RlKS50b0xvd2VyQ2FzZSgpID09PSAiZmV0Y2hfZmFsbGJhY2tfbG9jYWwiKSB7CiAgICAgICAgICAgIGNvbnN0IGxvY2FsSGVhbHRoID0gYnVpbGRIZWFsdGhPYmplY3QoKTsKICAgICAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoWwogICAgICAgICAgICAgIEtWLnB1dChLVl9LRVlTLmxhc3RTdGFnaW5nVmVyaWZpZWRBdCwgU3RyaW5nKG5vd01zKCkpKSwKICAgICAgICAgICAgICBLVi5wdXQoS1ZfS0VZUy5sYXN0U3RhZ2luZ1ZlcmlmeVVybCwgU3RyaW5nKGhlYWx0aFVybCkpLAogICAgICAgICAgICAgIEtWLnB1dChLVl9LRVlTLmxhc3RTdGFnaW5nVmVyaWZ5TW9kZSwgImZhbGxiYWNrX2xvY2FsX2FmdGVyX25vdF9qc29uIikKICAgICAgICAgICAgXSk7CiAgICAgICAgICAgIHJldHVybiBqc29uKDIwMCwgewogICAgICAgICAgICAgIG9rOiB0cnVlLAogICAgICAgICAgICAgIGFjdGlvbjogInN0YWdpbmdfdmVyaWZpZWQiLAogICAgICAgICAgICAgIHN0YWdpbmdfaGFzaDogc3RhdHVzLmxhc3Rfc3RhZ2luZ19oYXNoLAogICAgICAgICAgICAgIHZlcmlmaWVkX2F0OiBub3dNcygpLAogICAgICAgICAgICAgIHZlcmlmeV9tb2RlOiAiZmFsbGJhY2tfbG9jYWxfYWZ0ZXJfbm90X2pzb24iLAogICAgICAgICAgICAgIGZldGNoX3Jlc3VsdDogewogICAgICAgICAgICAgICAgaHR0cF9zdGF0dXM6IHJlc3Auc3RhdHVzLAogICAgICAgICAgICAgICAgY29udGVudF90eXBlOiBjb250ZW50VHlwZSwKICAgICAgICAgICAgICAgIGJvZHlfc25pcHBldDogc2FmZUJvZHlTbmlwcGV0KHR4dCkKICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgIGhlYWx0aDogbG9jYWxIZWFsdGgsCiAgICAgICAgICAgICAgYXV0aDogInJvb3QiCiAgICAgICAgICAgIH0pOwogICAgICAgICAgfQogICAgICAgICAgcmV0dXJuIGpzb24oNTAyLCB7CiAgICAgICAgICAgIG9rOiBmYWxzZSwKICAgICAgICAgICAgZXJyb3I6ICJoZWFsdGhfbm90X2pzb24iLAogICAgICAgICAgICBoZWFsdGhfdXJsOiBTdHJpbmcoaGVhbHRoVXJsKSwKICAgICAgICAgICAgaHR0cF9zdGF0dXM6IHJlc3Auc3RhdHVzLAogICAgICAgICAgICBjb250ZW50X3R5cGU6IGNvbnRlbnRUeXBlLAogICAgICAgICAgICBib2R5X3NuaXBwZXQ6IHNhZmVCb2R5U25pcHBldCh0eHQpCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgaWYgKCFoZWFsdGhKc29uIHx8IGhlYWx0aEpzb24ub2sgIT09IHRydWUpIHsKICAgICAgICAgIHJldHVybiBqc29uKDQwOSwgewogICAgICAgICAgICBvazogZmFsc2UsCiAgICAgICAgICAgIGVycm9yOiAiaGVhbHRoX25vdF9vayIsCiAgICAgICAgICAgIGhlYWx0aF91cmw6IFN0cmluZyhoZWFsdGhVcmwpLAogICAgICAgICAgICBodHRwX3N0YXR1czogcmVzcC5zdGF0dXMsCiAgICAgICAgICAgIGNvbnRlbnRfdHlwZTogY29udGVudFR5cGUsCiAgICAgICAgICAgIGhlYWx0aDogaGVhbHRoSnNvbiB8fCBudWxsCiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgICAgYXdhaXQgUHJvbWlzZS5hbGwoWwogICAgICAgICAgS1YucHV0KEtWX0tFWVMubGFzdFN0YWdpbmdWZXJpZmllZEF0LCBTdHJpbmcobm93TXMoKSkpLAogICAgICAgICAgS1YucHV0KEtWX0tFWVMubGFzdFN0YWdpbmdWZXJpZnlVcmwsIFN0cmluZyhoZWFsdGhVcmwpKSwKICAgICAgICAgIEtWLnB1dChLVl9LRVlTLmxhc3RTdGFnaW5nVmVyaWZ5TW9kZSwgImZldGNoX29rIikKICAgICAgICBdKTsKICAgICAgICByZXR1cm4ganNvbigyMDAsIHsKICAgICAgICAgIG9rOiB0cnVlLAogICAgICAgICAgYWN0aW9uOiAic3RhZ2luZ192ZXJpZmllZCIsCiAgICAgICAgICBzdGFnaW5nX2hhc2g6IHN0YXR1cy5sYXN0X3N0YWdpbmdfaGFzaCwKICAgICAgICAgIHZlcmlmaWVkX2F0OiBub3dNcygpLAogICAgICAgICAgdmVyaWZ5X21vZGU6ICJmZXRjaF9vayIsCiAgICAgICAgICBoZWFsdGhfdXJsOiBTdHJpbmcoaGVhbHRoVXJsKSwKICAgICAgICAgIGh0dHBfc3RhdHVzOiByZXNwLnN0YXR1cywKICAgICAgICAgIGNvbnRlbnRfdHlwZTogY29udGVudFR5cGUsCiAgICAgICAgICBoZWFsdGg6IGhlYWx0aEpzb24sCiAgICAgICAgICBhdXRoOiAicm9vdCIKICAgICAgICB9KTsKICAgICAgfQogICAgICBpZiAodXJsLnBhdGhuYW1lID09PSAiL2FkbWluL2F1cmEvZGVwbG95L3Byb21vdGUiICYmIHJlcXVlc3QubWV0aG9kID09PSAiUE9TVCIpIHsKICAgICAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxdWVzdC50ZXh0KCk7CiAgICAgICAgaWYgKCFib2R5IHx8IGJvZHkubGVuZ3RoIDwgMTApIHsKICAgICAgICAgIHJldHVybiBqc29uKDQwMCwgeyBvazogZmFsc2UsIGVycm9yOiAiaW52YWxpZF9kZXBsb3lfcGF5bG9hZCIgfSk7CiAgICAgICAgfQogICAgICAgIGxldCBwYXlsb2FkMjsKICAgICAgICB0cnkgewogICAgICAgICAgcGF5bG9hZDIgPSBKU09OLnBhcnNlKGJvZHkpOwogICAgICAgIH0gY2F0Y2ggewogICAgICAgICAgcmV0dXJuIGpzb24oNDAwLCB7IG9rOiBmYWxzZSwgZXJyb3I6ICJiYWRfanNvbiIgfSk7CiAgICAgICAgfQogICAgICAgIGlmICghaXNBZG1pbikgewogICAgICAgICAgaWYgKCFwYXlsb2FkMi5wcm9tb3Rpb25fcGhyYXNlKSB7CiAgICAgICAgICAgIGNvbnN0IHRpY2tldCA9IGF3YWl0IGdldFBocmFzZVRpY2tldCgpOwogICAgICAgICAgICBpZiAoIXRpY2tldC5vaykgewogICAgICAgICAgICAgIHJldHVybiBqc29uKDQwOSwgeyBvazogZmFsc2UsIGVycm9yOiAicHJvbW90aW9uX3BocmFzZV9yZXF1aXJlZCIsIG1lc3NhZ2U6ICJSb290IG11c3Qgc2V0IGEgcGhyYXNlIHRpY2tldCB2aWEgL2FkbWluL2F1cmEvZGVwbG95L3BocmFzZSBiZWZvcmUgYXV0b25vbXkgY2FuIHByb21vdGUuIiB9KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBwYXlsb2FkMi5wcm9tb3Rpb25fcGhyYXNlID0gdGlja2V0LnBocmFzZTsKICAgICAgICAgICAgcGF5bG9hZDIuX19rdl9waHJhc2VfdGlja2V0ID0gdGlja2V0OwogICAgICAgICAgfQogICAgICAgIH0KICAgICAgICBjb25zdCBzdGF0dXMgPSBhd2FpdCByZWFkU3RhdHVzKCk7CiAgICAgICAgaWYgKCFzdGF0dXMubGFzdF9zdGFnaW5nX2hhc2ggfHwgIXN0YXR1cy5sYXN0X3N0YWdpbmdfdmVyaWZpZWRfYXQpIHsKICAgICAgICAgIHJldHVybiBqc29uKDQwOSwgeyBvazogZmFsc2UsIGVycm9yOiAic3RhZ2luZ19yZXF1aXJlZCIgfSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IHByb21vdGluZ0hhc2ggPSBwYXlsb2FkMi5wcm9tb3RpbmdfaGFzaCB8fCBwYXlsb2FkMi5zdGFnaW5nX2hhc2ggfHwgcmVxdWVzdC5oZWFkZXJzLmdldCgiWC1BdXJhLVByb21vdGluZy1IYXNoIik7CiAgICAgICAgaWYgKCFwcm9tb3RpbmdIYXNoIHx8IHByb21vdGluZ0hhc2ggIT09IHN0YXR1cy5sYXN0X3N0YWdpbmdfaGFzaCkgewogICAgICAgICAgcmV0dXJuIGpzb24oNDA5LCB7IG9rOiBmYWxzZSwgZXJyb3I6ICJwcm9tb3RpbmdfaGFzaF9taXNtYXRjaCIsIHJlcXVpcmVkOiBzdGF0dXMubGFzdF9zdGFnaW5nX2hhc2ggfSk7CiAgICAgICAgfQogICAgICAgIGNvbnN0IGJvZHlUb1NlbmQgPSBKU09OLnN0cmluZ2lmeShwYXlsb2FkMik7CiAgICAgICAgY29uc3QgYm9keUhhc2ggPSBhd2FpdCBzaGEyNTZIZXgoYm9keVRvU2VuZCk7CiAgICAgICAgY29uc3QgcmVzcCA9IGF3YWl0IGVudi5BVVJBX0RFUExPWUVSLmZldGNoKCJodHRwczovL2RlcGxveWVyL2RlcGxveSIsIHsKICAgICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgICAgaGVhZGVyczogewogICAgICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgICAgICAiWC1EZXBsb3ktS2V5IjogZW52LkRFUExPWV9TRUNSRVQsCiAgICAgICAgICAgICJYLUF1cmEtQWN0aW9uIjogaXNBZG1pbiA/ICJwcm9tb3RlLXRvLXByb2Qtcm9vdCIgOiAicHJvbW90ZS10by1wcm9kLWF1dG9ub215IiwKICAgICAgICAgICAgLi4ucGF5bG9hZDIgJiYgcGF5bG9hZDIucHJvbW90aW9uX3BocmFzZSA/IHBocmFzZUhlYWRlckJ1bmRsZShwYXlsb2FkMi5wcm9tb3Rpb25fcGhyYXNlKSA6IHt9CiAgICAgICAgICB9LAogICAgICAgICAgYm9keTogYm9keVRvU2VuZAogICAgICAgIH0pOwogICAgICAgIGNvbnN0IGRlcGxveWVyVGV4dCA9IGF3YWl0IHJlc3AudGV4dCgpOwogICAgICAgIGNvbnN0IGRlcGxveWVyU25pcHBldCA9IHNhZmVCb2R5U25pcHBldChkZXBsb3llclRleHQpOwogICAgICAgIGlmICghaXNBZG1pbiAmJiBwYXlsb2FkMi5fX2t2X3BocmFzZV90aWNrZXQgJiYgcmVzcC5vaykgewogICAgICAgICAgYXdhaXQgY29uc3VtZVBocmFzZUlmTmVlZGVkKHBheWxvYWQyLl9fa3ZfcGhyYXNlX3RpY2tldCk7CiAgICAgICAgfQogICAgICAgIGlmIChyZXNwLm9rKSB7CiAgICAgICAgICBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgICAgICAgIEtWLnB1dChLVl9LRVlTLmxhc3RQcm9kSGFzaCwgYm9keUhhc2gpLAogICAgICAgICAgICBLVi5wdXQoS1ZfS0VZUy5sYXN0UHJvZEF0LCBTdHJpbmcobm93TXMoKSkpLAogICAgICAgICAgICBLVi5wdXQoS1ZfS0VZUy5sYXN0S25vd25Hb29kUHJvZEhhc2gsIGJvZHlIYXNoKSwKICAgICAgICAgICAgS1YucHV0KEtWX0tFWVMubGFzdEtub3duR29vZFByb2RBdCwgU3RyaW5nKG5vd01zKCkpKQogICAgICAgICAgXSk7CiAgICAgICAgfQogICAgICAgIHJldHVybiBqc29uKHJlc3Auc3RhdHVzLCB7CiAgICAgICAgICBvazogcmVzcC5vaywKICAgICAgICAgIHN0YXR1czogcmVzcC5zdGF0dXMsCiAgICAgICAgICBhY3Rpb246ICJwcm9tb3RlX3RvX3Byb2QiLAogICAgICAgICAgcHJvbW90aW5nX2hhc2g6IHByb21vdGluZ0hhc2gsCiAgICAgICAgICBwcm9kX2hhc2g6IGJvZHlIYXNoLAogICAgICAgICAgdGltZXN0YW1wOiBub3dNcygpLAogICAgICAgICAgYXV0aDogaXNBZG1pbiA/ICJyb290IiA6ICJhdXRvbm9teSIsCiAgICAgICAgICBkZXBsb3llcl9odHRwX3N0YXR1czogcmVzcC5zdGF0dXMsCiAgICAgICAgICBkZXBsb3llcl9ib2R5X3NuaXBwZXQ6IGRlcGxveWVyU25pcHBldAogICAgICAgIH0pOwogICAgICB9CiAgICAgIGlmICh1cmwucGF0aG5hbWUgPT09ICIvaGVhbHRoIikgewogICAgICAgIHJldHVybiBqc29uKDIwMCwgYnVpbGRIZWFsdGhPYmplY3QoKSk7CiAgICAgIH0KICAgICAgcmV0dXJuIG5ldyBSZXNwb25zZSgib2siKTsKICAgIH0gY2F0Y2ggKGVycikgewogICAgICB0cnkgewogICAgICAgIGNvbnN0IHJlcVVybCA9IG5ldyBVUkwocmVxdWVzdC51cmwpOwogICAgICAgIGNvbnN0IGlzQWRtaW5QYXRoID0gcmVxVXJsLnBhdGhuYW1lLnN0YXJ0c1dpdGgoIi9hZG1pbiIpOwogICAgICAgIGNvbnN0IGFkbWluSGVhZGVyID0gcmVxdWVzdC5oZWFkZXJzLmdldCgiWC1Db3JlLVBhc3MiKSB8fCByZXF1ZXN0LmhlYWRlcnMuZ2V0KCJYLUF1cmEtUGFzcyIpIHx8IHJlcXVlc3QuaGVhZGVycy5nZXQoIlgtQWRtaW4tVG9rZW4iKTsKICAgICAgICBjb25zdCBpc1Jvb3QgPSBhZG1pbkhlYWRlciAmJiAoZW52ICYmIGVudi5BVVJBX0FETUlOX1RPS0VOKSAmJiBhZG1pbkhlYWRlciA9PT0gZW52LkFVUkFfQURNSU5fVE9LRU47CiAgICAgICAgaWYgKGlzQWRtaW5QYXRoICYmIGlzUm9vdCkgewogICAgICAgICAgY29uc3QgbXNnID0gZXJyICYmIGVyci5tZXNzYWdlID8gU3RyaW5nKGVyci5tZXNzYWdlKSA6ICJ1bmtub3duIjsKICAgICAgICAgIGNvbnN0IG5hbWUgPSBlcnIgJiYgZXJyLm5hbWUgPyBTdHJpbmcoZXJyLm5hbWUpIDogbnVsbDsKICAgICAgICAgIGNvbnN0IHN0YWNrID0gZXJyICYmIGVyci5zdGFjayA/IFN0cmluZyhlcnIuc3RhY2spIDogbnVsbDsKICAgICAgICAgIGNvbnN0IHN0YWNrU25pcHBldCA9IHN0YWNrID8gc3RhY2subGVuZ3RoID4gODAwID8gc3RhY2suc2xpY2UoMCwgODAwKSArICJcdTIwMjYiIDogc3RhY2sgOiBudWxsOwogICAgICAgICAgcmV0dXJuIGpzb24oNTAwLCB7CiAgICAgICAgICAgIG9rOiBmYWxzZSwKICAgICAgICAgICAgZXJyb3I6ICJpbnRlcm5hbF9lcnJvciIsCiAgICAgICAgICAgIG5hbWUsCiAgICAgICAgICAgIG1lc3NhZ2U6IG1zZywKICAgICAgICAgICAgc3RhY2tfc25pcHBldDogc3RhY2tTbmlwcGV0CiAgICAgICAgICB9KTsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggewogICAgICB9CiAgICAgIHJldHVybiBuZXcgUmVzcG9uc2UoImludGVybmFsIGVycm9yIiwgeyBzdGF0dXM6IDUwMCB9KTsKICAgIH0KICB9LAogIGFzeW5jIHNjaGVkdWxlZChldmVudCwgZW52LCBjdHgpIHsKICB9Cn07CmV4cG9ydCB7CiAgaW5kZXhfZGVmYXVsdCBhcyBkZWZhdWx0Cn07Ci8vIyBzb3VyY2VNYXBwaW5nVVJMPWluZGV4LmpzLm1hcAo="
}