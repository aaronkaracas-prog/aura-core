{"target":"prod","script_name":"aura-core","bundle_b64":"Ly8gQzpcVXNlcnNcQWFyb24gS2FyYWNhc1xhdXJhLXdvcmtlclxhdXJhXHNyY1xpbmRleC5qcwovLyBBVVJBX0NPUkVfXzIwMjYtMDEtMjFfX0FVVE9OT01ZX1NURVBfMTRfX0ZPVU5EWV9QUk9YWV9ERVBMT1lfU0VDUkVUX0RJQUdfXzAxCi8vIEZ1bGwtZmlsZSByZXBsYWNlbWVudC4gTm8gVUkgd29yay4KCmNvbnN0IEpTT05fSEVBREVSUyA9IHsgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uOyBjaGFyc2V0PXV0Zi04IiB9OwoKZnVuY3Rpb24ganNvbihvYmosIHN0YXR1cyA9IDIwMCwgZXh0cmFIZWFkZXJzID0ge30pIHsKICByZXR1cm4gbmV3IFJlc3BvbnNlKEpTT04uc3RyaW5naWZ5KG9iaiwgbnVsbCwgMiksIHsKICAgIHN0YXR1cywKICAgIGhlYWRlcnM6IHsgLi4uSlNPTl9IRUFERVJTLCAuLi5leHRyYUhlYWRlcnMgfSwKICB9KTsKfQoKZnVuY3Rpb24gdGV4dChib2R5LCBzdGF0dXMgPSAyMDAsIGV4dHJhSGVhZGVycyA9IHt9KSB7CiAgcmV0dXJuIG5ldyBSZXNwb25zZShib2R5LCB7CiAgICBzdGF0dXMsCiAgICBoZWFkZXJzOiB7ICJjb250ZW50LXR5cGUiOiAidGV4dC9wbGFpbjsgY2hhcnNldD11dGYtOCIsIC4uLmV4dHJhSGVhZGVycyB9LAogIH0pOwp9CgpmdW5jdGlvbiBub3dVdGNJc28oKSB7CiAgcmV0dXJuIG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKTsKfQoKZnVuY3Rpb24gaXNPYmplY3QodikgewogIHJldHVybiB2ICYmIHR5cGVvZiB2ID09PSAib2JqZWN0IiAmJiAhQXJyYXkuaXNBcnJheSh2KTsKfQoKZnVuY3Rpb24gc2FmZUlkKHByZWZpeCA9ICJpZCIpIHsKICBjb25zdCBhID0gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyhuZXcgVWludDhBcnJheSg4KSk7CiAgbGV0IHMgPSAiIjsKICBmb3IgKGNvbnN0IGIgb2YgYSkgcyArPSBiLnRvU3RyaW5nKDE2KS5wYWRTdGFydCgyLCAiMCIpOwogIHJldHVybiBgJHtwcmVmaXh9XyR7c31gOwp9Cgphc3luYyBmdW5jdGlvbiByZWFkSnNvbihyZXEpIHsKICBjb25zdCBjdCA9IHJlcS5oZWFkZXJzLmdldCgiY29udGVudC10eXBlIikgfHwgIiI7CiAgaWYgKCFjdC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCJhcHBsaWNhdGlvbi9qc29uIikpIHsKICAgIGNvbnN0IHQgPSBhd2FpdCByZXEudGV4dCgpOwogICAgaWYgKCF0KSByZXR1cm4ge307CiAgICB0cnkgeyByZXR1cm4gSlNPTi5wYXJzZSh0KTsgfSBjYXRjaCB7IHJldHVybiBudWxsOyB9CiAgfQogIHRyeSB7IHJldHVybiBhd2FpdCByZXEuanNvbigpOyB9IGNhdGNoIHsgcmV0dXJuIG51bGw7IH0KfQoKZnVuY3Rpb24gZ2V0QWRtaW5Ub2tlbkZyb21SZXEocmVxKSB7CiAgY29uc3QgaCA9IHJlcS5oZWFkZXJzOwoKICAvLyBQcmVmZXJyZWQgb3BlcmF0b3IgaGVhZGVyIChsZWdhY3kgKyBjdXJyZW50KQogIGNvbnN0IGNvcmUgPQogICAgaC5nZXQoIlgtQ29yZS1QYXNzIikgfHwKICAgIGguZ2V0KCJ4LWNvcmUtcGFzcyIpIHx8CiAgICBoLmdldCgiWC1Db3JlLVRva2VuIikgfHwKICAgIGguZ2V0KCJ4LWNvcmUtdG9rZW4iKSB8fAogICAgaC5nZXQoIlgtQWRtaW4tVG9rZW4iKSB8fAogICAgaC5nZXQoIngtYWRtaW4tdG9rZW4iKTsKCiAgaWYgKGNvcmUpIHJldHVybiBjb3JlOwoKICAvLyBGYWxsYmFjazogQXV0aG9yaXphdGlvbjogQmVhcmVyIDx0b2tlbj4KICBjb25zdCBhdXRoID0gaC5nZXQoIkF1dGhvcml6YXRpb24iKSB8fCBoLmdldCgiYXV0aG9yaXphdGlvbiIpOwogIGlmIChhdXRoICYmIC9eXHMqQmVhcmVyXHMrL2kudGVzdChhdXRoKSkgcmV0dXJuIGF1dGgucmVwbGFjZSgvXlxzKkJlYXJlclxzKy9pLCAiIikudHJpbSgpOwoKICByZXR1cm4gIiI7Cn0KCmZ1bmN0aW9uIGFkbWluQXV0aERpYWcocmVxLCBlbnYpIHsKICBjb25zdCB0b2tlbiA9IGdldEFkbWluVG9rZW5Gcm9tUmVxKHJlcSk7CiAgY29uc3QgZW52VG9rID0gZW52Py5BVVJBX0FETUlOX1RPS0VOIHx8ICIiOwogIHJldHVybiB7CiAgICBoZWFkZXJfcHJlc2VudDogISF0b2tlbiwKICAgIGhlYWRlcl9sZW46IHRva2VuID8gdG9rZW4ubGVuZ3RoIDogMCwKICAgIGVudl9wcmVzZW50OiAhIWVudlRvaywKICAgIGVudl9sZW46IGVudlRvayA/IGVudlRvay5sZW5ndGggOiAwLAogICAgbWF0Y2g6ICEhdG9rZW4gJiYgISFlbnZUb2sgJiYgdG9rZW4gPT09IGVudlRvaywKICAgIGhlYWRlcl9uYW1lc19jaGVja2VkOiBbIlgtQ29yZS1QYXNzIiwgIlgtQXVyYS1QYXNzIiwgIlgtQWRtaW4tVG9rZW4iXSwKICB9Owp9CgpmdW5jdGlvbiByZXF1aXJlQWRtaW4ocmVxLCBlbnYpIHsKICBjb25zdCB0b2tlbiA9IGdldEFkbWluVG9rZW5Gcm9tUmVxKHJlcSk7CiAgY29uc3QgZW52VG9rID0gZW52Py5BVVJBX0FETUlOX1RPS0VOIHx8ICIiOwogIGlmICghZW52VG9rKSByZXR1cm4geyBvazogZmFsc2UsIGVycm9yOiAic2VydmVyX21pc2NvbmZpZ3VyZWQiLCBzdGF0dXM6IDUwMCB9OwogIGlmICghdG9rZW4gfHwgdG9rZW4gIT09IGVudlRvaykgewogICAgcmV0dXJuIHsgb2s6IGZhbHNlLCBlcnJvcjogInVuYXV0aG9yaXplZCIsIHN0YXR1czogNDAxLCBhdXRoX2RpYWc6IGFkbWluQXV0aERpYWcocmVxLCBlbnYpIH07CiAgfQogIHJldHVybiB7IG9rOiB0cnVlIH07Cn0KCi8vIC0tLS0gS1YgaGVscGVycyAtLS0tCmFzeW5jIGZ1bmN0aW9uIGt2R2V0SnNvbihrdiwga2V5KSB7CiAgY29uc3QgdiA9IGF3YWl0IGt2LmdldChrZXkpOwogIGlmICghdikgcmV0dXJuIG51bGw7CiAgdHJ5IHsgcmV0dXJuIEpTT04ucGFyc2Uodik7IH0gY2F0Y2ggeyByZXR1cm4gbnVsbDsgfQp9Cgphc3luYyBmdW5jdGlvbiBrdlB1dEpzb24oa3YsIGtleSwgb2JqKSB7CiAgYXdhaXQga3YucHV0KGtleSwgSlNPTi5zdHJpbmdpZnkob2JqKSk7Cn0KCi8vIC0tLS0gSW1hZ2Ugc3RvcmFnZSAtLS0tCmNvbnN0IEtWX0xBU1RfSU1BR0VfS0VZID0gImltYWdlczpsYXN0X2lkIjsKCmFzeW5jIGZ1bmN0aW9uIHNhdmVJbWFnZVRvUjIoZW52LCB7IHBuZ0J5dGVzLCBpZCB9KSB7CiAgY29uc3Qga2V5ID0gYGltYWdlcy8ke2lkfS5wbmdgOwogIGF3YWl0IGVudi5BVVJBX1VQTE9BRFMucHV0KGtleSwgcG5nQnl0ZXMsIHsgaHR0cE1ldGFkYXRhOiB7IGNvbnRlbnRUeXBlOiAiaW1hZ2UvcG5nIiB9IH0pOwogIHJldHVybiBrZXk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGdldEltYWdlTWV0YShlbnYsIGlkKSB7CiAgcmV0dXJuIGF3YWl0IGt2R2V0SnNvbihlbnYuQVVSQV9LViwgYGltYWdlczptZXRhOiR7aWR9YCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIHNldEltYWdlTWV0YShlbnYsIGlkLCBtZXRhKSB7CiAgYXdhaXQga3ZQdXRKc29uKGVudi5BVVJBX0tWLCBgaW1hZ2VzOm1ldGE6JHtpZH1gLCBtZXRhKTsKICBhd2FpdCBlbnYuQVVSQV9LVi5wdXQoS1ZfTEFTVF9JTUFHRV9LRVksIGlkKTsKfQoKYXN5bmMgZnVuY3Rpb24gZ2V0TGFzdEltYWdlSWQoZW52KSB7CiAgcmV0dXJuIGF3YWl0IGVudi5BVVJBX0tWLmdldChLVl9MQVNUX0lNQUdFX0tFWSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIG9wZW5haUltYWdlR2VuZXJhdGUoZW52LCB7IHByb21wdCwgc2l6ZSB9KSB7CiAgY29uc3QgdXJsID0gImh0dHBzOi8vYXBpLm9wZW5haS5jb20vdjEvaW1hZ2VzL2dlbmVyYXRpb25zIjsKICBjb25zdCBib2R5ID0geyBtb2RlbDogImdwdC1pbWFnZS0xIiwgcHJvbXB0LCBzaXplOiBzaXplIHx8ICIxMDI0eDEwMjQiIH07CgogIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKHVybCwgewogICAgbWV0aG9kOiAiUE9TVCIsCiAgICBoZWFkZXJzOiB7CiAgICAgIGF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtlbnYuT1BFTkFJX0FQSV9LRVl9YCwKICAgICAgImNvbnRlbnQtdHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgIH0sCiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShib2R5KSwKICB9KTsKCiAgY29uc3QgdGV4dFJhdyA9IGF3YWl0IHJlcy50ZXh0KCk7CiAgbGV0IHBhcnNlZCA9IG51bGw7CiAgdHJ5IHsgcGFyc2VkID0gSlNPTi5wYXJzZSh0ZXh0UmF3KTsgfSBjYXRjaCB7IHBhcnNlZCA9IG51bGw7IH0KCiAgaWYgKCFyZXMub2spIHsKICAgIHJldHVybiB7IG9rOiBmYWxzZSwgc3RhdHVzOiByZXMuc3RhdHVzLCBkZXRhaWxzOiBwYXJzZWQgfHwgeyByYXc6IHRleHRSYXc/LnNsaWNlKDAsIDUwMDApIH0gfTsKICB9CgogIGNvbnN0IGI2NCA9IHBhcnNlZD8uZGF0YT8uWzBdPy5iNjRfanNvbjsKICBpZiAoIWI2NCkgcmV0dXJuIHsgb2s6IGZhbHNlLCBzdGF0dXM6IDUwMCwgZGV0YWlsczogeyBlcnJvcjogIm1pc3NpbmdfYjY0X2pzb24iLCByYXc6IHBhcnNlZCB9IH07CgogIGNvbnN0IGJ5dGVzID0gVWludDhBcnJheS5mcm9tKGF0b2IoYjY0KSwgKGMpID0+IGMuY2hhckNvZGVBdCgwKSk7CiAgcmV0dXJuIHsgb2s6IHRydWUsIGJ5dGVzLCByZXZpc2VkX3Byb21wdDogcGFyc2VkPy5kYXRhPy5bMF0/LnJldmlzZWRfcHJvbXB0IHx8IG51bGwgfTsKfQoKLy8gLS0tLSBUYXNrIHF1ZXVlIC0tLS0KY29uc3QgVEFTS1NfSU5ERVhfS0VZID0gInRhc2tzOmluZGV4IjsKY29uc3QgVEFTS1NfSU5ERVhfQ0FQID0gMjAwOwoKZnVuY3Rpb24gbm9ybWFsaXplVGFza0lucHV0KGlucHV0KSB7CiAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gInN0cmluZyIpIHJldHVybiBpbnB1dC50cmltKCk7CiAgaWYgKGlucHV0ID09IG51bGwpIHJldHVybiAiIjsKICByZXR1cm4gU3RyaW5nKGlucHV0KS50cmltKCk7Cn0KCgovLyAtLS0tIEltYWdlIHNpemUgZ3VhcmRyYWlscyAtLS0tCmNvbnN0IEFMTE9XRURfSU1BR0VfU0laRVMgPSBuZXcgU2V0KFsiMTAyNHgxMDI0IiwgIjEwMjR4MTUzNiIsICIxNTM2eDEwMjQiLCAiYXV0byJdKTsKCmZ1bmN0aW9uIG5vcm1hbGl6ZUltYWdlU2l6ZShzaXplLCBmYWxsYmFjayA9ICIxMDI0eDEwMjQiKSB7CiAgY29uc3QgcyA9IG5vcm1hbGl6ZVRhc2tJbnB1dChzaXplKSB8fCAiIjsKICBpZiAoIXMpIHJldHVybiB7IHNpemU6IGZhbGxiYWNrLCBjb2VyY2VkX2Zyb206IG51bGwgfTsKICBpZiAoQUxMT1dFRF9JTUFHRV9TSVpFUy5oYXMocykpIHJldHVybiB7IHNpemU6IHMsIGNvZXJjZWRfZnJvbTogbnVsbCB9OwogIHJldHVybiB7IHNpemU6IGZhbGxiYWNrLCBjb2VyY2VkX2Zyb206IHMgfTsKfQoKYXN5bmMgZnVuY3Rpb24gdGFza3NJbmRleEdldChlbnYpIHsKICBjb25zdCBpZHggPSBhd2FpdCBrdkdldEpzb24oZW52LkFVUkFfS1YsIFRBU0tTX0lOREVYX0tFWSk7CiAgcmV0dXJuIEFycmF5LmlzQXJyYXkoaWR4KSA/IGlkeCA6IFtdOwp9Cgphc3luYyBmdW5jdGlvbiB0YXNrc0luZGV4UHV0KGVudiwgYXJyKSB7CiAgYXdhaXQga3ZQdXRKc29uKGVudi5BVVJBX0tWLCBUQVNLU19JTkRFWF9LRVksIGFyci5zbGljZSgwLCBUQVNLU19JTkRFWF9DQVApKTsKfQoKYXN5bmMgZnVuY3Rpb24gdGFza0dldChlbnYsIGlkKSB7CiAgcmV0dXJuIGF3YWl0IGt2R2V0SnNvbihlbnYuQVVSQV9LViwgYHRhc2tzOnRhc2s6JHtpZH1gKTsKfQoKYXN5bmMgZnVuY3Rpb24gdGFza1B1dChlbnYsIHRhc2spIHsKICBhd2FpdCBrdlB1dEpzb24oZW52LkFVUkFfS1YsIGB0YXNrczp0YXNrOiR7dGFzay5pZH1gLCB0YXNrKTsKfQoKZnVuY3Rpb24gY29tcHV0ZU5leHRSdW5BdElzbyhkZWxheVNlY29uZHMgPSAwKSB7CiAgcmV0dXJuIG5ldyBEYXRlKERhdGUubm93KCkgKyBkZWxheVNlY29uZHMgKiAxMDAwKS50b0lTT1N0cmluZygpOwp9Cgphc3luYyBmdW5jdGlvbiBlbnF1ZXVlVGFzayhlbnYsIHsgbW9kZSA9ICJUQVNLIiwgaW5wdXQgPSAiIiwgbWF4X3JldHJpZXMgPSA1LCBkZWxheV9zZWNvbmRzID0gMCB9KSB7CiAgY29uc3QgaWQgPSBzYWZlSWQoInQiKTsKICBjb25zdCBub3cgPSBub3dVdGNJc28oKTsKICBjb25zdCB0YXNrID0gewogICAgaWQsCiAgICBtb2RlLAogICAgaW5wdXQ6IG5vcm1hbGl6ZVRhc2tJbnB1dChpbnB1dCksCiAgICBzdGF0dXM6ICJxdWV1ZWQiLAogICAgcmV0cmllczogMCwKICAgIG1heF9yZXRyaWVzOiBtYXhfcmV0cmllcyA/PyA1LAogICAgbmV4dF9ydW5fYXQ6IGNvbXB1dGVOZXh0UnVuQXRJc28oZGVsYXlfc2Vjb25kcyB8fCAwKSwKICAgIGNyZWF0ZWRfYXQ6IG5vdywKICAgIHVwZGF0ZWRfYXQ6IG5vdywKICAgIGNsYWltZWRfYXQ6IG51bGwsCiAgICBjbGFpbWVkX2J5OiBudWxsLAogICAgbGVhc2VfdW50aWw6IG51bGwsCiAgICByZXN1bHQ6IG51bGwsCiAgICBlcnJvcjogbnVsbCwKICB9OwoKICBhd2FpdCB0YXNrUHV0KGVudiwgdGFzayk7CiAgY29uc3QgaWR4ID0gYXdhaXQgdGFza3NJbmRleEdldChlbnYpOwogIGlkeC51bnNoaWZ0KGlkKTsKICBhd2FpdCB0YXNrc0luZGV4UHV0KGVudiwgaWR4KTsKICByZXR1cm4gdGFzazsKfQoKZnVuY3Rpb24gaXNEdWUodGFzaykgewogIGlmICghdGFzaykgcmV0dXJuIGZhbHNlOwogIGlmICh0YXNrLnN0YXR1cyAhPT0gInF1ZXVlZCIpIHJldHVybiBmYWxzZTsKICBpZiAoIXRhc2submV4dF9ydW5fYXQpIHJldHVybiB0cnVlOwogIHJldHVybiBEYXRlLnBhcnNlKHRhc2submV4dF9ydW5fYXQpIDw9IERhdGUubm93KCk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGNsYWltTmV4dER1ZShlbnYsIGNsYWltZXIgPSAicnVubmVyIiwgbGVhc2Vfc2Vjb25kcyA9IDE4MCkgewogIGNvbnN0IGlkeCA9IGF3YWl0IHRhc2tzSW5kZXhHZXQoZW52KTsKICBmb3IgKGNvbnN0IGlkIG9mIGlkeCkgewogICAgY29uc3QgdGFzayA9IGF3YWl0IHRhc2tHZXQoZW52LCBpZCk7CiAgICBpZiAoIWlzRHVlKHRhc2spKSBjb250aW51ZTsKICAgIGNvbnN0IG5vdyA9IG5vd1V0Y0lzbygpOwogICAgdGFzay5zdGF0dXMgPSAiY2xhaW1lZCI7CiAgICB0YXNrLmNsYWltZWRfYXQgPSBub3c7CiAgICB0YXNrLmNsYWltZWRfYnkgPSBjbGFpbWVyOwogICAgdGFzay5sZWFzZV91bnRpbCA9IGNvbXB1dGVOZXh0UnVuQXRJc28obGVhc2Vfc2Vjb25kcyk7CiAgICB0YXNrLnVwZGF0ZWRfYXQgPSBub3c7CiAgICBhd2FpdCB0YXNrUHV0KGVudiwgdGFzayk7CiAgICByZXR1cm4gdGFzazsKICB9CiAgcmV0dXJuIG51bGw7Cn0KCmFzeW5jIGZ1bmN0aW9uIGV4ZWN1dGVUYXNrKGVudiwgdGFzaykgewogIGNvbnN0IG5vdyA9IG5vd1V0Y0lzbygpOwogIGNvbnN0IGlucHV0ID0gdGFzay5pbnB1dCB8fCAiIjsKICBsZXQgcmVzdWx0ID0geyBraW5kOiAidGFzayIsIG9rOiB0cnVlLCBzdW1tYXJ5OiAiVGFzayBleGVjdXRlZCAoYmFzZWxpbmUpLiIsIGVjaG86IGlucHV0IH07CgogIGlmIChpbnB1dC5zdGFydHNXaXRoKCJJTUFHRV9KT0I6IikpIHsKICAgIGNvbnN0IHJlc3QgPSBpbnB1dC5zbGljZSgiSU1BR0VfSk9COiIubGVuZ3RoKS50cmltKCk7CiAgICBjb25zdCBwYXJ0cyA9IHJlc3Quc3BsaXQoInx8IikubWFwKChzKSA9PiBzLnRyaW0oKSkuZmlsdGVyKEJvb2xlYW4pOwogICAgY29uc3QgcHJvbXB0ID0gcGFydHNbMF0gfHwgIiI7CiAgICBsZXQgc2l6ZSA9ICIxMDI0eDEwMjQiOwogICAgZm9yIChjb25zdCBwIG9mIHBhcnRzLnNsaWNlKDEpKSB7CiAgICAgIGNvbnN0IG0gPSAvXnNpemVccyo9XHMqKC4rKSQvaS5leGVjKHApOwogICAgICBpZiAobSkgc2l6ZSA9IG1bMV0udHJpbSgpOwogICAgfQoKICAgIGNvbnN0IHNpemVOb3JtID0gbm9ybWFsaXplSW1hZ2VTaXplKHNpemUsICIxMDI0eDEwMjQiKTsKICAgIGNvbnN0IGltZ0lkID0gc2FmZUlkKCJpbWciKTsKICAgIGNvbnN0IGdlbiA9IGF3YWl0IG9wZW5haUltYWdlR2VuZXJhdGUoZW52LCB7IHByb21wdCwgc2l6ZTogc2l6ZU5vcm0uc2l6ZSB9KTsKICAgIGlmICghZ2VuLm9rKSB7CiAgICAgIHJlc3VsdCA9IHsgb2s6IGZhbHNlLCBlcnJvcjogIm9wZW5haSIsIHN0YXR1czogZ2VuLnN0YXR1cywgZGV0YWlsczogZ2VuLmRldGFpbHMgfTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnN0IHIyX2tleSA9IGF3YWl0IHNhdmVJbWFnZVRvUjIoZW52LCB7IHBuZ0J5dGVzOiBnZW4uYnl0ZXMsIGlkOiBpbWdJZCB9KTsKICAgICAgY29uc3QgbWV0YSA9IHsKICAgICAgICBpZDogaW1nSWQsCiAgICAgICAgbWltZTogImltYWdlL3BuZyIsCiAgICAgICAgcjJfa2V5LAogICAgICAgIGNyZWF0ZWRfYXQ6IG5vdywKICAgICAgICBwcm9tcHQsCiAgICAgICAgc2l6ZTogc2l6ZU5vcm0uc2l6ZSwKICAgICAgICByZXF1ZXN0ZWRfc2l6ZTogc2l6ZSwKICAgICAgICBjb2VyY2VkX3NpemVfZnJvbTogc2l6ZU5vcm0uY29lcmNlZF9mcm9tLAogICAgICAgIHJldmlzZWRfcHJvbXB0OiBnZW4ucmV2aXNlZF9wcm9tcHQsCiAgICAgIH07CiAgICAgIGF3YWl0IHNldEltYWdlTWV0YShlbnYsIGltZ0lkLCBtZXRhKTsKICAgICAgcmVzdWx0ID0geyBraW5kOiAiaW1hZ2UiLCBvazogdHJ1ZSwgaW1hZ2U6IHsgaWQ6IGltZ0lkLCBtaW1lOiAiaW1hZ2UvcG5nIiwgdXJsOiBgL2ltYWdlcy8ke2ltZ0lkfT9yYXc9MWAsIG1ldGEgfSB9OwogICAgfQogIH0KCiAgdGFzay5zdGF0dXMgPSAic3VjY2VlZGVkIjsKICB0YXNrLnJlc3VsdCA9IHJlc3VsdDsKICB0YXNrLmVycm9yID0gbnVsbDsKICB0YXNrLnVwZGF0ZWRfYXQgPSBub3c7CiAgcmV0dXJuIHRhc2s7Cn0KCmFzeW5jIGZ1bmN0aW9uIGZpbmlzaFRhc2soZW52LCB0YXNrKSB7CiAgYXdhaXQgdGFza1B1dChlbnYsIHRhc2spOwogIHJldHVybiB0YXNrOwp9Cgphc3luYyBmdW5jdGlvbiBydW5EdWUoZW52LCB7IG1heCA9IDUsIGNsYWltZXIgPSAicnVubmVyIiB9ID0ge30pIHsKICBjb25zdCByZXN1bHRzID0gW107CiAgbGV0IHJhbiA9IDA7CiAgZm9yIChsZXQgaSA9IDA7IGkgPCAobWF4IHx8IDUpOyBpKyspIHsKICAgIGNvbnN0IHRhc2sgPSBhd2FpdCBjbGFpbU5leHREdWUoZW52LCBjbGFpbWVyLCAxODApOwogICAgaWYgKCF0YXNrKSBicmVhazsKICAgIGNvbnN0IGV4ZWN1dGVkID0gYXdhaXQgZXhlY3V0ZVRhc2soZW52LCB0YXNrKTsKICAgIGF3YWl0IGZpbmlzaFRhc2soZW52LCBleGVjdXRlZCk7CiAgICByYW4rKzsKICAgIHJlc3VsdHMucHVzaCh7IGlkOiBleGVjdXRlZC5pZCwgc3RhdHVzOiBleGVjdXRlZC5zdGF0dXMsIG9rOiBleGVjdXRlZC5yZXN1bHQ/Lm9rID8/IHRydWUsIGVycm9yOiBleGVjdXRlZC5yZXN1bHQ/LmVycm9yID8/IG51bGwgfSk7CiAgfQogIHJldHVybiB7IHJhbiwgcmVzdWx0cyB9Owp9CgovLyAtLS0tIEZvdW5kcnkgZGVwbG95IHByb3h5IC0tLS0KYXN5bmMgZnVuY3Rpb24gcHJveHlGb3VuZHJ5RGVwbG95KHJlcSwgZW52LCB1cmwpIHsKICBjb25zdCBib2R5VGV4dCA9IGF3YWl0IHJlcS50ZXh0KCk7CiAgbGV0IHBheWxvYWQ7CiAgdHJ5IHsgcGF5bG9hZCA9IEpTT04ucGFyc2UoYm9keVRleHQgfHwgInt9Iik7IH0KICBjYXRjaCB7IHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogImJhZF9qc29uIiB9LCA0MDApOyB9CgogIGlmICghcGF5bG9hZCB8fCB0eXBlb2YgcGF5bG9hZCAhPT0gIm9iamVjdCIpIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogImJhZF9wYXlsb2FkIiB9LCA0MDApOwogIGlmICghZW52IHx8ICFlbnYuREVQTE9ZX1NFQ1JFVCkgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibWlzc2luZ19kZXBsb3lfc2VjcmV0X2JpbmRpbmciIH0sIDUwMCk7CiAgaWYgKCFlbnYuQVVSQV9ERVBMT1lFUikgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibWlzc2luZ19kZXBsb3llcl9iaW5kaW5nIiB9LCA1MDApOwoKICBjb25zdCBkZXBsb3lTZWNyZXQgPSBTdHJpbmcoZW52LkRFUExPWV9TRUNSRVQpOwogIGNvbnN0IGNvcmVTZWNyZXRMZW4gPSBkZXBsb3lTZWNyZXQubGVuZ3RoOwoKICAvLyBDb21wb3NlIHJlcXVlc3QgdG8gYXVyYS1kZXBsb3llcgogIGNvbnN0IGhlYWRlcnMgPSB7CiAgICAiY29udGVudC10eXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAoKICAgIC8vIGRlcGxveWVyIGF1dGggKHNlbmQgYSBidW5jaCBvZiBhbGlhc2VzIHNvIHdlIG5ldmVyIG1pc3MpCiAgICAieC1kZXBsb3ktc2VjcmV0IjogZGVwbG95U2VjcmV0LAogICAgIlgtRGVwbG95LVNlY3JldCI6IGRlcGxveVNlY3JldCwKICAgICJ4LWRlcGxveS1rZXkiOiBkZXBsb3lTZWNyZXQsCiAgICAiWC1EZXBsb3ktS2V5IjogZGVwbG95U2VjcmV0LAogICAgIngtZGVwbG95LXRva2VuIjogZGVwbG95U2VjcmV0LAogICAgIlgtRGVwbG95LVRva2VuIjogZGVwbG95U2VjcmV0LAogICAgIngtZGVwbG95LXBhc3MiOiBkZXBsb3lTZWNyZXQsCiAgICAiWC1EZXBsb3ktUGFzcyI6IGRlcGxveVNlY3JldCwKICAgICJ4LWRlcGxveWVyLXBhc3MiOiBkZXBsb3lTZWNyZXQsCgogICAgLy8gc29tZSBkZXBsb3llcnMgdXNlIEF1dGhvcml6YXRpb24gaW5zdGVhZAogICAgImF1dGhvcml6YXRpb24iOiAiQmVhcmVyICIgKyBkZXBsb3lTZWNyZXQsCiAgICAiQXV0aG9yaXphdGlvbiI6ICJCZWFyZXIgIiArIGRlcGxveVNlY3JldAogIH07CgogIGNvbnN0IGRlcGxveUJvZHkgPSBKU09OLnN0cmluZ2lmeShwYXlsb2FkKTsKCiAgLy8gMSkgVHJ5IHNlcnZpY2UgYmluZGluZyBmaXJzdCAoZmFzdCArIGtlZXBzIGl0IGluc2lkZSBDRikKICBsZXQgdXBzdHJlYW0gPSBhd2FpdCBlbnYuQVVSQV9ERVBMT1lFUi5mZXRjaCgiaHR0cHM6Ly9kZXBsb3llci5pbnRlcm5hbC9kZXBsb3kiLCB7CiAgICBtZXRob2Q6ICJQT1NUIiwKICAgIGhlYWRlcnMsCiAgICBib2R5OiBkZXBsb3lCb2R5CiAgfSk7CgogIC8vIFBhcnNlIHJlc3BvbnNlIChtYXkgYmUgSlNPTiBvciB0ZXh0KQogIGxldCB0ZXh0UmVzcCA9IGF3YWl0IHVwc3RyZWFtLnRleHQoKTsKICBsZXQgcGFyc2VkOwogIHRyeSB7IHBhcnNlZCA9IEpTT04ucGFyc2UodGV4dFJlc3AgfHwgInt9Iik7IH0KICBjYXRjaCB7IHBhcnNlZCA9IHsgb2s6IGZhbHNlLCBlcnJvcjogIm5vbl9qc29uX3Vwc3RyZWFtIiwgcmF3OiB0ZXh0UmVzcC5zbGljZSgwLCAyMDAwKSB9OyB9CgogIC8vIDIpIElmIGRlcGxveWVyIGNsYWltcyBpdCBkaWQgbm90IHJlY2VpdmUgdGhlIGhlYWRlciwgZmFsbCBiYWNrIHRvIHB1YmxpYyBmZXRjaC4KICAvLyAoU29tZSBDRiBzZXJ2aWNlLWJpbmRpbmcgZWRnZSBjYXNlcyBjYW4gZHJvcCBjdXN0b20gaGVhZGVycy4pCiAgaWYgKHVwc3RyZWFtLnN0YXR1cyA9PT0gNDAxICYmIHBhcnNlZCAmJiBwYXJzZWQuYXV0aF9kaWFnICYmIHBhcnNlZC5hdXRoX2RpYWcuaGVhZGVyX3ByZXNlbnQgPT09IGZhbHNlKSB7CiAgICBjb25zdCBwdWJsaWNVcmwgPSAiaHR0cHM6Ly9hdXJhLWRlcGxveWVyLmFhcm9ua2FyYWNhcy53b3JrZXJzLmRldi9kZXBsb3kiOwogICAgY29uc3QgdXAyID0gYXdhaXQgZmV0Y2gocHVibGljVXJsLCB7IG1ldGhvZDogIlBPU1QiLCBoZWFkZXJzLCBib2R5OiBkZXBsb3lCb2R5IH0pOwogICAgY29uc3QgdDIgPSBhd2FpdCB1cDIudGV4dCgpOwogICAgbGV0IHAyOwogICAgdHJ5IHsgcDIgPSBKU09OLnBhcnNlKHQyIHx8ICJ7fSIpOyB9CiAgICBjYXRjaCB7IHAyID0geyBvazogZmFsc2UsIGVycm9yOiAibm9uX2pzb25fdXBzdHJlYW0iLCByYXc6IHQyLnNsaWNlKDAsIDIwMDApIH07IH0KICAgIC8vIFJldHVybiBmYWxsYmFjayByZXNwb25zZSAoYWRkIHNtYWxsIGhpbnQpCiAgICBpZiAocDIgJiYgdHlwZW9mIHAyID09PSAib2JqZWN0IikgcDIudmlhID0gInB1YmxpY19mYWxsYmFjayI7CiAgICByZXR1cm4ganNvbihwMiwgdXAyLnN0YXR1cyk7CiAgfQoKICBpZiAocGFyc2VkICYmIHR5cGVvZiBwYXJzZWQgPT09ICJvYmplY3QiKSB7CiAgICBpZiAoIXBhcnNlZC52aWEpIHBhcnNlZC52aWEgPSAic2VydmljZV9iaW5kaW5nIjsKICAgIGlmICghcGFyc2VkLmNvcmVfZGlhZykgcGFyc2VkLmNvcmVfZGlhZyA9IHt9OwogICAgcGFyc2VkLmNvcmVfZGlhZy5jb3JlX2RlcGxveV9zZWNyZXRfbGVuID0gY29yZVNlY3JldExlbjsKICAgIHBhcnNlZC5jb3JlX2RpYWcuc2VudF9oZWFkZXJfbmFtZXMgPSBBcnJheS5mcm9tKGhlYWRlcnMua2V5cygpKTsKICAgIGlmIChwYXJzZWQuYXV0aF9kaWFnICYmIHR5cGVvZiBwYXJzZWQuYXV0aF9kaWFnID09PSAib2JqZWN0IikgewogICAgICBwYXJzZWQuYXV0aF9kaWFnLmNvcmVfZGVwbG95X3NlY3JldF9sZW4gPSBjb3JlU2VjcmV0TGVuOwogICAgfQogIH0KICByZXR1cm4ganNvbihwYXJzZWQsIHVwc3RyZWFtLnN0YXR1cyk7Cn0KCgovLyAtLS0tIENvcmUgZW5kcG9pbnRzIC0tLS0KZnVuY3Rpb24gY2FwYWJpbGl0aWVzUGF5bG9hZChlbnYpIHsKICByZXR1cm4gewogICAgdmVyc2lvbjogIkFVUkFfQ09SRV9fMjAyNi0wMS0yMV9fQVVUT05PTVlfU1RFUF8xNF9fRk9VTkRZX1BST1hZX0RFUExPWV9TRUNSRVRfRElBR19fMDEiLAogICAgbm93X3V0Yzogbm93VXRjSXNvKCksCiAgICBiaW5kaW5nczogewogICAgICBBVVJBX0tWOiAhIWVudi5BVVJBX0tWLAogICAgICBBVVJBX0FETUlOX1RPS0VOOiAhIWVudi5BVVJBX0FETUlOX1RPS0VOLAogICAgICBPUEVOQUlfQVBJX0tFWTogISFlbnYuT1BFTkFJX0FQSV9LRVksCiAgICAgIEFVUkFfVVBMT0FEUzogISFlbnYuQVVSQV9VUExPQURTLAogICAgICBBVVJBX0RFUExPWUVSOiAhIWVudi5BVVJBX0RFUExPWUVSLAogICAgICBBVVJBX0NGOiAhIWVudi5BVVJBX0NGLAogICAgICBERVBMT1lfU0VDUkVUOiAhIWVudi5ERVBMT1lfU0VDUkVULAogICAgfSwKICAgIGVuZHBvaW50czogWwogICAgICB7IG1ldGhvZDogIkdFVCIsIHBhdGg6ICIvaGVhbHRoIiwgcHVycG9zZTogInN0YXR1cyArIGJpbmRpbmcgcHJlc2VuY2UiIH0sCiAgICAgIHsgbWV0aG9kOiAiR0VUIiwgcGF0aDogIi9jb3JlIiwgcHVycG9zZTogIm1pbmltYWwgY29tbWFuZCBzdXJmYWNlIiB9LAogICAgICB7IG1ldGhvZDogIlBPU1QiLCBwYXRoOiAiL2NoYXQiLCBwdXJwb3NlOiAiYWNjZXB0IHRleHQvanNvbiBhbmQgcmV0dXJuIHJlc3BvbnNlIiB9LAogICAgICB7IG1ldGhvZDogIlBPU1QiLCBwYXRoOiAiL2F1cmEvY29tbWFuZCIsIHB1cnBvc2U6ICJzYW1lIGFzIC9jaGF0IChvcGVyYXRvciBzdXJmYWNlKSIgfSwKICAgICAgeyBtZXRob2Q6ICJHRVQiLCBwYXRoOiAiL3N0YXRlIiwgcHVycG9zZTogInRydXRoZnVsIHNlbGYtZGVzY3JpcHRpb24iIH0sCiAgICAgIHsgbWV0aG9kOiAiR0VUfEhFQUQiLCBwYXRoOiAiL2ltYWdlcy86aWQiLCBwdXJwb3NlOiAiaW1hZ2UgbWV0YTsgP3Jhdz0xIHN0cmVhbXMgYnl0ZXMgKHB1YmxpYykiIH0sCiAgICAgIHsgbWV0aG9kOiAiR0VUfEhFQUQiLCBwYXRoOiAiL2ltYWdlcy9sYXN0IiwgcHVycG9zZTogImxhc3QgaW1hZ2UgaWQgc2hvcnRjdXQ7ID9yYXc9MSBzdHJlYW1zIGJ5dGVzIChwdWJsaWMpIiB9LAogICAgICB7IG1ldGhvZDogIlBPU1QiLCBwYXRoOiAiL2ltYWdlcy9nZW5lcmF0ZSIsIHB1cnBvc2U6ICJnZW5lcmF0ZSBpbWFnZSAoYWRtaW4pIiwgcmVxdWlyZXM6IFsiT1BFTkFJX0FQSV9LRVkiLCAiQVVSQV9VUExPQURTIiwgIkFVUkFfS1YiXSB9LAogICAgICB7IG1ldGhvZDogIkdFVCIsIHBhdGg6ICIvYWRtaW4vY2FwYWJpbGl0aWVzIiwgcHVycG9zZTogImNhcGFiaWxpdHkgcmVnaXN0cnkgKGFkbWluKSIgfSwKICAgICAgeyBtZXRob2Q6ICJHRVQiLCBwYXRoOiAiL2FkbWluL2xvZ3MiLCBwdXJwb3NlOiAicmVjZW50IGxvZ3MgKGFkbWluKSIgfSwKICAgICAgeyBtZXRob2Q6ICJQT1NUIiwgcGF0aDogIi9hZG1pbi90YXNrcy9lbnF1ZXVlIiwgcHVycG9zZTogImVucXVldWUgdGFzayAoYWRtaW4pIiB9LAogICAgICB7IG1ldGhvZDogIkdFVCIsIHBhdGg6ICIvYWRtaW4vdGFza3MiLCBwdXJwb3NlOiAibGlzdCB0YXNrcyAoYWRtaW4pIFtzdGF0dXMsIGxpbWl0LCBvbmx5X2R1ZV0iIH0sCiAgICAgIHsgbWV0aG9kOiAiR0VUIiwgcGF0aDogIi9hZG1pbi90YXNrcy86aWQiLCBwdXJwb3NlOiAiZ2V0IHRhc2sgYnkgaWQgKGFkbWluKSIgfSwKICAgICAgeyBtZXRob2Q6ICJQT1NUIiwgcGF0aDogIi9hZG1pbi90YXNrcy9jbGFpbSIsIHB1cnBvc2U6ICJjbGFpbSBuZXh0IGR1ZSBxdWV1ZWQgdGFzayAoYWRtaW4pIiB9LAogICAgICB7IG1ldGhvZDogIlBPU1QiLCBwYXRoOiAiL2FkbWluL3Rhc2tzL2V4ZWN1dGUiLCBwdXJwb3NlOiAiZXhlY3V0ZSBjbGFpbWVkIHRhc2sgKGFkbWluKSIgfSwKICAgICAgeyBtZXRob2Q6ICJQT1NUIiwgcGF0aDogIi9hZG1pbi90YXNrcy9ydW5fZHVlIiwgcHVycG9zZTogImxvb3AgY2xhaW0rZXhlY3V0ZSB1cCB0byBOIChhZG1pbikiIH0sCiAgICAgIHsgbWV0aG9kOiAiUE9TVCIsIHBhdGg6ICIvYWRtaW4vZm91bmRyeS9kZXBsb3kiLCBwdXJwb3NlOiAiY29tcGF0OiBwcm94eSB0byBhdXJhLWRlcGxveWVyIC9kZXBsb3kgKGFkbWluKSIgfSwKICAgIF0sCiAgICBub3RlczogewogICAgICBhdXRvbm9teTogIlN0ZXAgMDcgZml4ZXMgYWRtaW4gYXV0aCBkcmlmdCBmb3IgL2FkbWluL2ZvdW5kcnkvZGVwbG95IGJ5IGFjY2VwdGluZyBoZWFkZXIgYWxpYXNlcyBhbmQgdW5pZnlpbmcgYXV0aC4gQWxzbyBwcm94aWVzIGRlcGxveSB2aWEgc2VydmljZSBiaW5kaW5nIGlmIERFUExPWV9TRUNSRVQgaXMgYm91bmQuIiwKICAgICAgdWk6ICJObyBVSSB3b3JrLiIsCiAgICB9LAogIH07Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUNoYXQocmVxKSB7CiAgY29uc3QgYm9keSA9IGF3YWl0IHJlcS50ZXh0KCk7CiAgcmV0dXJuIGpzb24oeyBvazogdHJ1ZSwga2luZDogImNoYXQiLCByZWNlaXZlZDogYm9keS5zbGljZSgwLCA4MDAwKSB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlU3RhdGUoZW52KSB7CiAgcmV0dXJuIGpzb24oeyBvazogdHJ1ZSwgc2VydmljZTogImF1cmEtY29yZSIsIHZlcnNpb246IGNhcGFiaWxpdGllc1BheWxvYWQoZW52KS52ZXJzaW9uLCBub3dfdXRjOiBub3dVdGNJc28oKSwgdHJ1dGhmdWw6IHRydWUgfSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUhlYWx0aChlbnYpIHsKICByZXR1cm4ganNvbih7CiAgICBvazogdHJ1ZSwKICAgIHNlcnZpY2U6ICJhdXJhLWNvcmUiLAogICAgdmVyc2lvbjogY2FwYWJpbGl0aWVzUGF5bG9hZChlbnYpLnZlcnNpb24sCiAgICBub3dfdXRjOiBub3dVdGNJc28oKSwKICAgIGhhc19rdjogISFlbnYuQVVSQV9LViwKICAgIGhhc19hZG1pbl90b2tlbjogISFlbnYuQVVSQV9BRE1JTl9UT0tFTiwKICAgIGhhc19vcGVuYWlfa2V5OiAhIWVudi5PUEVOQUlfQVBJX0tFWSwKICAgIGhhc19yMjogISFlbnYuQVVSQV9VUExPQURTLAogIH0pOwp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVJbWFnZUdldChyZXEsIGVudiwgaWQsIHJhdykgewogIGNvbnN0IG1ldGEgPSBhd2FpdCBnZXRJbWFnZU1ldGEoZW52LCBpZCk7CiAgaWYgKCFtZXRhKSByZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6ICJub3RfZm91bmQiIH0sIDQwNCk7CgogIGlmIChyYXcpIHsKICAgIGNvbnN0IG9iaiA9IGF3YWl0IGVudi5BVVJBX1VQTE9BRFMuZ2V0KG1ldGEucjJfa2V5KTsKICAgIGlmICghb2JqKSByZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6ICJub3RfZm91bmQiIH0sIDQwNCk7CiAgICBjb25zdCBoZWFkZXJzID0gbmV3IEhlYWRlcnMoKTsKICAgIGhlYWRlcnMuc2V0KCJjb250ZW50LXR5cGUiLCBtZXRhLm1pbWUgfHwgImltYWdlL3BuZyIpOwogICAgaGVhZGVycy5zZXQoImNhY2hlLWNvbnRyb2wiLCAicHVibGljLCBtYXgtYWdlPTMxNTM2MDAwLCBpbW11dGFibGUiKTsKICAgIHJldHVybiBuZXcgUmVzcG9uc2Uob2JqLmJvZHksIHsgc3RhdHVzOiAyMDAsIGhlYWRlcnMgfSk7CiAgfQoKICByZXR1cm4ganNvbih7IG9rOiB0cnVlLCBpbWFnZTogeyBpZDogbWV0YS5pZCwgbWltZTogbWV0YS5taW1lLCB1cmw6IGAvaW1hZ2VzLyR7aWR9P3Jhdz0xYCwgbWV0YSB9IH0pOwp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVJbWFnZUxhc3QocmVxLCBlbnYsIHJhdykgewogIGNvbnN0IGlkID0gYXdhaXQgZ2V0TGFzdEltYWdlSWQoZW52KTsKICBpZiAoIWlkKSByZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6ICJub3RfZm91bmQiIH0sIDQwNCk7CiAgcmV0dXJuIGhhbmRsZUltYWdlR2V0KHJlcSwgZW52LCBpZCwgcmF3KTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlSW1hZ2VHZW5lcmF0ZShyZXEsIGVudikgewogIGNvbnN0IGF1dGggPSByZXF1aXJlQWRtaW4ocmVxLCBlbnYpOwogIGlmICghYXV0aC5vaykgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiBhdXRoLmVycm9yLCBhdXRoX2RpYWc6IGF1dGguYXV0aF9kaWFnIH0sIGF1dGguc3RhdHVzKTsKCiAgY29uc3QgYm9keSA9IGF3YWl0IHJlYWRKc29uKHJlcSk7CiAgaWYgKGJvZHkgPT0gbnVsbCkgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAiYmFkX2pzb24iIH0sIDQwMCk7CgogIGNvbnN0IHByb21wdCA9IG5vcm1hbGl6ZVRhc2tJbnB1dChib2R5LnByb21wdCk7CiAgY29uc3Qgc2l6ZVJlcSA9IG5vcm1hbGl6ZVRhc2tJbnB1dChib2R5LnNpemUpIHx8ICIxMDI0eDEwMjQiOwogIGNvbnN0IHNpemVOb3JtID0gbm9ybWFsaXplSW1hZ2VTaXplKHNpemVSZXEsICIxMDI0eDEwMjQiKTsKICBpZiAoIXByb21wdCkgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibWlzc2luZ19wcm9tcHQiIH0sIDQwMCk7CgogIGNvbnN0IGltZ0lkID0gc2FmZUlkKCJpbWciKTsKICBjb25zdCBnZW4gPSBhd2FpdCBvcGVuYWlJbWFnZUdlbmVyYXRlKGVudiwgeyBwcm9tcHQsIHNpemU6IHNpemVOb3JtLnNpemUgfSk7CiAgaWYgKCFnZW4ub2spIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogIm9wZW5haSIsIHN0YXR1czogZ2VuLnN0YXR1cywgZGV0YWlsczogZ2VuLmRldGFpbHMgfSwgNTAyKTsKCiAgY29uc3QgcjJfa2V5ID0gYXdhaXQgc2F2ZUltYWdlVG9SMihlbnYsIHsgcG5nQnl0ZXM6IGdlbi5ieXRlcywgaWQ6IGltZ0lkIH0pOwogIGNvbnN0IG1ldGEgPSB7IGlkOiBpbWdJZCwgbWltZTogImltYWdlL3BuZyIsIHIyX2tleSwgY3JlYXRlZF9hdDogbm93VXRjSXNvKCksIHByb21wdCwgc2l6ZTogc2l6ZU5vcm0uc2l6ZSwgcmVxdWVzdGVkX3NpemU6IHNpemVSZXEsIGNvZXJjZWRfc2l6ZV9mcm9tOiBzaXplTm9ybS5jb2VyY2VkX2Zyb20sIHJldmlzZWRfcHJvbXB0OiBnZW4ucmV2aXNlZF9wcm9tcHQgfTsKICBhd2FpdCBzZXRJbWFnZU1ldGEoZW52LCBpbWdJZCwgbWV0YSk7CgogIHJldHVybiBqc29uKHsgb2s6IHRydWUsIGltYWdlOiB7IGlkOiBpbWdJZCwgbWltZTogImltYWdlL3BuZyIsIHVybDogYC9pbWFnZXMvJHtpbWdJZH0/cmF3PTFgLCBtZXRhIH0gfSk7Cn0KCmFzeW5jIGZ1bmN0aW9uIGhhbmRsZUFkbWluQ2FwYWJpbGl0aWVzKHJlcSwgZW52KSB7CiAgY29uc3QgYXV0aCA9IHJlcXVpcmVBZG1pbihyZXEsIGVudik7CiAgaWYgKCFhdXRoLm9rKSByZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6IGF1dGguZXJyb3IsIGF1dGhfZGlhZzogYXV0aC5hdXRoX2RpYWcgfSwgYXV0aC5zdGF0dXMpOwogIHJldHVybiBqc29uKHsgb2s6IHRydWUsIGVuZm9yY2VkOiB0cnVlLCB2aWE6ICJoZWFkZXIiLCBjYXBhYmlsaXRpZXM6IGNhcGFiaWxpdGllc1BheWxvYWQoZW52KSB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlQWRtaW5Mb2dzKHJlcSwgZW52KSB7CiAgY29uc3QgYXV0aCA9IHJlcXVpcmVBZG1pbihyZXEsIGVudik7CiAgaWYgKCFhdXRoLm9rKSByZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6IGF1dGguZXJyb3IsIGF1dGhfZGlhZzogYXV0aC5hdXRoX2RpYWcgfSwgYXV0aC5zdGF0dXMpOwogIHJldHVybiBqc29uKHsgb2s6IHRydWUsIGxvZ3M6IFtdLCBub3RlOiAiTG9ncyBlbmRwb2ludCBpcyBhIHBsYWNlaG9sZGVyIGluIHRoaXMgYnVpbGQuIiB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlVGFza3NMaXN0KHJlcSwgZW52LCB1cmwpIHsKICBjb25zdCBhdXRoID0gcmVxdWlyZUFkbWluKHJlcSwgZW52KTsKICBpZiAoIWF1dGgub2spIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogYXV0aC5lcnJvciwgYXV0aF9kaWFnOiBhdXRoLmF1dGhfZGlhZyB9LCBhdXRoLnN0YXR1cyk7CgogIGNvbnN0IGxpbWl0ID0gTWF0aC5tYXgoMSwgTWF0aC5taW4oNTAsIE51bWJlcih1cmwuc2VhcmNoUGFyYW1zLmdldCgibGltaXQiKSB8fCAiMTAiKSkpOwogIGNvbnN0IHN0YXR1c0ZpbHRlciA9ICh1cmwuc2VhcmNoUGFyYW1zLmdldCgic3RhdHVzIikgfHwgIiIpLnRyaW0oKTsKICBjb25zdCBvbmx5RHVlID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoIm9ubHlfZHVlIikgPT09ICIxIjsKCiAgY29uc3QgaWR4ID0gYXdhaXQgdGFza3NJbmRleEdldChlbnYpOwogIGNvbnN0IG91dCA9IFtdOwogIGZvciAoY29uc3QgaWQgb2YgaWR4KSB7CiAgICBjb25zdCB0ID0gYXdhaXQgdGFza0dldChlbnYsIGlkKTsKICAgIGlmICghdCkgY29udGludWU7CiAgICBpZiAoc3RhdHVzRmlsdGVyICYmIHQuc3RhdHVzICE9PSBzdGF0dXNGaWx0ZXIpIGNvbnRpbnVlOwogICAgaWYgKG9ubHlEdWUgJiYgIWlzRHVlKHQpKSBjb250aW51ZTsKICAgIG91dC5wdXNoKHQpOwogICAgaWYgKG91dC5sZW5ndGggPj0gbGltaXQpIGJyZWFrOwogIH0KICByZXR1cm4ganNvbih7IG9rOiB0cnVlLCB0YXNrczogb3V0IH0pOwp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVUYXNrR2V0KHJlcSwgZW52LCBpZCkgewogIGNvbnN0IGF1dGggPSByZXF1aXJlQWRtaW4ocmVxLCBlbnYpOwogIGlmICghYXV0aC5vaykgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiBhdXRoLmVycm9yLCBhdXRoX2RpYWc6IGF1dGguYXV0aF9kaWFnIH0sIGF1dGguc3RhdHVzKTsKICBjb25zdCB0ID0gYXdhaXQgdGFza0dldChlbnYsIGlkKTsKICBpZiAoIXQpIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogIm5vdF9mb3VuZCIgfSwgNDA0KTsKICByZXR1cm4ganNvbih7IG9rOiB0cnVlLCB0YXNrOiB0IH0pOwp9Cgphc3luYyBmdW5jdGlvbiBoYW5kbGVUYXNrc0VucXVldWUocmVxLCBlbnYpIHsKICBjb25zdCBhdXRoID0gcmVxdWlyZUFkbWluKHJlcSwgZW52KTsKICBpZiAoIWF1dGgub2spIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogYXV0aC5lcnJvciwgYXV0aF9kaWFnOiBhdXRoLmF1dGhfZGlhZyB9LCBhdXRoLnN0YXR1cyk7CgogIGNvbnN0IGJvZHkgPSBhd2FpdCByZWFkSnNvbihyZXEpOwogIGlmIChib2R5ID09IG51bGwpIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogImJhZF9qc29uIiB9LCA0MDApOwoKICBjb25zdCB0YXNrID0gYXdhaXQgZW5xdWV1ZVRhc2soZW52LCB7CiAgICBtb2RlOiBib2R5Lm1vZGUgfHwgIlRBU0siLAogICAgaW5wdXQ6IGJvZHkuaW5wdXQgfHwgIiIsCiAgICBtYXhfcmV0cmllczogaXNPYmplY3QoYm9keSkgPyBib2R5Lm1heF9yZXRyaWVzIDogNSwKICAgIGRlbGF5X3NlY29uZHM6IGlzT2JqZWN0KGJvZHkpID8gYm9keS5kZWxheV9zZWNvbmRzIDogMCwKICB9KTsKCiAgcmV0dXJuIGpzb24oeyBvazogdHJ1ZSwgdGFzayB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlVGFza3NDbGFpbShyZXEsIGVudikgewogIGNvbnN0IGF1dGggPSByZXF1aXJlQWRtaW4ocmVxLCBlbnYpOwogIGlmICghYXV0aC5vaykgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiBhdXRoLmVycm9yLCBhdXRoX2RpYWc6IGF1dGguYXV0aF9kaWFnIH0sIGF1dGguc3RhdHVzKTsKCiAgY29uc3QgYm9keSA9IGF3YWl0IHJlYWRKc29uKHJlcSk7CiAgaWYgKGJvZHkgPT0gbnVsbCkgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAiYmFkX2pzb24iIH0sIDQwMCk7CiAgY29uc3QgY2xhaW1lciA9IG5vcm1hbGl6ZVRhc2tJbnB1dChib2R5LmNsYWltZXIpIHx8ICJydW5uZXIiOwogIGNvbnN0IHRhc2sgPSBhd2FpdCBjbGFpbU5leHREdWUoZW52LCBjbGFpbWVyLCAxODApOwogIHJldHVybiBqc29uKHsgb2s6IHRydWUsIHRhc2s6IHRhc2sgfHwgbnVsbCB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlVGFza3NFeGVjdXRlKHJlcSwgZW52KSB7CiAgY29uc3QgYXV0aCA9IHJlcXVpcmVBZG1pbihyZXEsIGVudik7CiAgaWYgKCFhdXRoLm9rKSByZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6IGF1dGguZXJyb3IsIGF1dGhfZGlhZzogYXV0aC5hdXRoX2RpYWcgfSwgYXV0aC5zdGF0dXMpOwoKICBjb25zdCBib2R5ID0gYXdhaXQgcmVhZEpzb24ocmVxKTsKICBpZiAoYm9keSA9PSBudWxsKSByZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6ICJiYWRfanNvbiIgfSwgNDAwKTsKCiAgY29uc3QgaWQgPSBub3JtYWxpemVUYXNrSW5wdXQoYm9keS5pZCk7CiAgaWYgKCFpZCkgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibWlzc2luZ19pZCIgfSwgNDAwKTsKCiAgY29uc3QgdGFzayA9IGF3YWl0IHRhc2tHZXQoZW52LCBpZCk7CiAgaWYgKCF0YXNrKSByZXR1cm4ganNvbih7IG9rOiBmYWxzZSwgZXJyb3I6ICJub3RfZm91bmQiIH0sIDQwNCk7CiAgaWYgKHRhc2suc3RhdHVzICE9PSAiY2xhaW1lZCIpIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogIm5vdF9jbGFpbWVkIiwgc3RhdHVzOiB0YXNrLnN0YXR1cyB9LCA0MDkpOwoKICBjb25zdCBleGVjdXRlZCA9IGF3YWl0IGV4ZWN1dGVUYXNrKGVudiwgdGFzayk7CiAgYXdhaXQgZmluaXNoVGFzayhlbnYsIGV4ZWN1dGVkKTsKICByZXR1cm4ganNvbih7IG9rOiB0cnVlLCB0YXNrOiBleGVjdXRlZCB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlVGFza3NSdW5EdWUocmVxLCBlbnYpIHsKICBjb25zdCBhdXRoID0gcmVxdWlyZUFkbWluKHJlcSwgZW52KTsKICBpZiAoIWF1dGgub2spIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogYXV0aC5lcnJvciwgYXV0aF9kaWFnOiBhdXRoLmF1dGhfZGlhZyB9LCBhdXRoLnN0YXR1cyk7CgogIGNvbnN0IGJvZHkgPSBhd2FpdCByZWFkSnNvbihyZXEpOwogIGlmIChib2R5ID09IG51bGwpIHJldHVybiBqc29uKHsgb2s6IGZhbHNlLCBlcnJvcjogImJhZF9qc29uIiB9LCA0MDApOwoKICBjb25zdCBtYXggPSBOdW1iZXIoYm9keS5tYXggfHwgYm9keS5uIHx8IDUpIHx8IDU7CiAgY29uc3QgY2xhaW1lciA9IG5vcm1hbGl6ZVRhc2tJbnB1dChib2R5LmNsYWltZXIpIHx8ICJydW5uZXIiOwogIGNvbnN0IHJhbiA9IGF3YWl0IHJ1bkR1ZShlbnYsIHsgbWF4LCBjbGFpbWVyIH0pOwogIHJldHVybiBqc29uKHsgb2s6IHRydWUsIC4uLnJhbiB9KTsKfQoKYXN5bmMgZnVuY3Rpb24gaGFuZGxlQ29yZVBhZ2UoKSB7CiAgcmV0dXJuIHRleHQoIkF1cmEgQ29yZSBpcyBydW5uaW5nLiIpOwp9Cgphc3luYyBmdW5jdGlvbiBub3RGb3VuZChwYXRoKSB7CiAgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiAibm90X2ZvdW5kIiwgcGF0aCB9LCA0MDQpOwp9CgpleHBvcnQgZGVmYXVsdCB7CiAgYXN5bmMgZmV0Y2gocmVxLCBlbnYsIGN0eCkgewogICAgY29uc3QgdXJsID0gbmV3IFVSTChyZXEudXJsKTsKICAgIGNvbnN0IHBhdGggPSB1cmwucGF0aG5hbWU7CgogICAgaWYgKHJlcS5tZXRob2QgPT09ICJHRVQiICYmIHBhdGggPT09ICIvaGVhbHRoIikgcmV0dXJuIGhhbmRsZUhlYWx0aChlbnYpOwogICAgaWYgKHJlcS5tZXRob2QgPT09ICJHRVQiICYmIHBhdGggPT09ICIvc3RhdGUiKSByZXR1cm4gaGFuZGxlU3RhdGUoZW52KTsKICAgIGlmIChyZXEubWV0aG9kID09PSAiR0VUIiAmJiBwYXRoID09PSAiL2NvcmUiKSByZXR1cm4gaGFuZGxlQ29yZVBhZ2UoKTsKCiAgICBpZiAoKHJlcS5tZXRob2QgPT09ICJHRVQiIHx8IHJlcS5tZXRob2QgPT09ICJIRUFEIikgJiYgcGF0aC5zdGFydHNXaXRoKCIvaW1hZ2VzLyIpKSB7CiAgICAgIGNvbnN0IHJhdyA9IHVybC5zZWFyY2hQYXJhbXMuZ2V0KCJyYXciKSA9PT0gIjEiOwogICAgICBpZiAocGF0aCA9PT0gIi9pbWFnZXMvbGFzdCIpIHJldHVybiBoYW5kbGVJbWFnZUxhc3QocmVxLCBlbnYsIHJhdyk7CiAgICAgIGNvbnN0IGlkID0gcGF0aC5zcGxpdCgiLyIpLnBvcCgpOwogICAgICByZXR1cm4gaGFuZGxlSW1hZ2VHZXQocmVxLCBlbnYsIGlkLCByYXcpOwogICAgfQoKICAgIGlmIChyZXEubWV0aG9kID09PSAiUE9TVCIgJiYgKHBhdGggPT09ICIvY2hhdCIgfHwgcGF0aCA9PT0gIi9hdXJhL2NvbW1hbmQiKSkgcmV0dXJuIGhhbmRsZUNoYXQocmVxKTsKCiAgICBpZiAocmVxLm1ldGhvZCA9PT0gIlBPU1QiICYmIHBhdGggPT09ICIvaW1hZ2VzL2dlbmVyYXRlIikgcmV0dXJuIGhhbmRsZUltYWdlR2VuZXJhdGUocmVxLCBlbnYpOwoKICAgIGlmIChyZXEubWV0aG9kID09PSAiR0VUIiAmJiBwYXRoID09PSAiL2FkbWluL2NhcGFiaWxpdGllcyIpIHJldHVybiBoYW5kbGVBZG1pbkNhcGFiaWxpdGllcyhyZXEsIGVudik7CiAgICBpZiAocmVxLm1ldGhvZCA9PT0gIkdFVCIgJiYgcGF0aCA9PT0gIi9hZG1pbi9sb2dzIikgcmV0dXJuIGhhbmRsZUFkbWluTG9ncyhyZXEsIGVudik7CgogICAgaWYgKHBhdGggPT09ICIvYWRtaW4vdGFza3MiICYmIHJlcS5tZXRob2QgPT09ICJHRVQiKSByZXR1cm4gaGFuZGxlVGFza3NMaXN0KHJlcSwgZW52LCB1cmwpOwogICAgaWYgKHBhdGggPT09ICIvYWRtaW4vdGFza3MvZW5xdWV1ZSIgJiYgcmVxLm1ldGhvZCA9PT0gIlBPU1QiKSByZXR1cm4gaGFuZGxlVGFza3NFbnF1ZXVlKHJlcSwgZW52KTsKICAgIGlmIChwYXRoID09PSAiL2FkbWluL3Rhc2tzL2NsYWltIiAmJiByZXEubWV0aG9kID09PSAiUE9TVCIpIHJldHVybiBoYW5kbGVUYXNrc0NsYWltKHJlcSwgZW52KTsKICAgIGlmIChwYXRoID09PSAiL2FkbWluL3Rhc2tzL2V4ZWN1dGUiICYmIHJlcS5tZXRob2QgPT09ICJQT1NUIikgcmV0dXJuIGhhbmRsZVRhc2tzRXhlY3V0ZShyZXEsIGVudik7CiAgICBpZiAocGF0aCA9PT0gIi9hZG1pbi90YXNrcy9ydW5fZHVlIiAmJiByZXEubWV0aG9kID09PSAiUE9TVCIpIHJldHVybiBoYW5kbGVUYXNrc1J1bkR1ZShyZXEsIGVudik7CgogICAgaWYgKHBhdGguc3RhcnRzV2l0aCgiL2FkbWluL3Rhc2tzLyIpICYmIHJlcS5tZXRob2QgPT09ICJHRVQiKSB7CiAgICAgIGNvbnN0IGlkID0gcGF0aC5zcGxpdCgiLyIpLnBvcCgpOwogICAgICByZXR1cm4gaGFuZGxlVGFza0dldChyZXEsIGVudiwgaWQpOwogICAgfQoKICAgIGlmIChwYXRoID09PSAiL2FkbWluL2ZvdW5kcnkvZGVwbG95IiAmJiByZXEubWV0aG9kID09PSAiUE9TVCIpIHsKICAgICAgY29uc3QgYXV0aCA9IHJlcXVpcmVBZG1pbihyZXEsIGVudik7CiAgICAgIGlmICghYXV0aC5vaykgcmV0dXJuIGpzb24oeyBvazogZmFsc2UsIGVycm9yOiBhdXRoLmVycm9yLCBhdXRoX2RpYWc6IGF1dGguYXV0aF9kaWFnIH0sIGF1dGguc3RhdHVzKTsKICAgICAgcmV0dXJuIHByb3h5Rm91bmRyeURlcGxveShyZXEsIGVudiwgdXJsKTsKICAgIH0KCiAgICByZXR1cm4gbm90Rm91bmQocGF0aCk7CiAgfSwKCiAgYXN5bmMgc2NoZWR1bGVkKGV2ZW50LCBlbnYsIGN0eCkgewogICAgdHJ5IHsgYXdhaXQgcnVuRHVlKGVudiwgeyBtYXg6IDUsIGNsYWltZXI6ICJhdXRvIiB9KTsgfSBjYXRjaCB7fQogIH0sCn07Cg==","note":"foundry_deploy_prod_plain_no_gzip","promote_phrase":"PROMOTE_TO_PROD","promotion_phrase":"PROMOTE_TO_PROD","promote_to_prod":"PROMOTE_TO_PROD"}